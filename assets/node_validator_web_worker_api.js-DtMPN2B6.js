var Hf=Object.defineProperty;var Vf=(ce,z,ye)=>z in ce?Hf(ce,z,{enumerable:!0,configurable:!0,writable:!0,value:ye}):ce[z]=ye;var n=(ce,z,ye)=>Vf(ce,typeof z!="symbol"?z+"":z,ye);(function(){"use strict";class ce{assert(){}}function z(){return new ce}const ye=z();function N(t,e){ye.assert(t,e)}function zn(t,e){N(typeof t===e,`type assertion failed: expected "${e}", received "${typeof t}"`)}function Dc(t){N(t!==null,"expected a non-null value, received null")}function f(t,e){N(t instanceof e,`given value is not an instance of "${e.name}", specific type is "${typeof t=="object"&&t!==null?t.constructor.name:typeof t}"`)}class _t extends Error{constructor(o,r,s=`expected object with key: "${r}", instead found ${o}`){super(s);n(this,"key");n(this,"haveType");this.haveType=o,this.key=r,Object.freeze(this)}toJSON(){return{code:_t.name,message:this.message,have:this.haveType,key:this.key}}}class ae{encode(e){return this.encoder.convert(e)}decode(e){return this.decoder.convert(e)}}class c extends ae{}function jt(t){return typeof t=="number"}function Z(t){return typeof t=="string"}function _n(t){return typeof t=="object"&&t!==null}function st(t){return t!==void 0}function Pc(t,e){return Array.isArray(t)&&t.every(e)}function Oc(t){return e=>Pc(e,t)}function qt(t,e,o){return _n(t)&&e in t&&o(t[e])}function W(t,...e){return _n(t)&&e.every(o=>o in t)}function i(t,...e){if(typeof t!="object")throw new Error("expected object");if(t===null)throw new Error("received null");for(const o of e)if(!(o in t))throw new _t("object",o)}function g(t,e){if(!Z(t.code))throw new Error("code must be a string");if(t.code!==e)throw new Error(`expected code to be ${e}, got ${t.code}`)}function ie(t,e){if(!Z(t.type))throw new Error("type must be a string");if(t.type!==e)throw new Error(`expected type to be ${e}, got ${t.type}`)}class y extends Error{constructor(e){super(e)}get code(){return this.constructor.name}toJSON(){return U.convert(this)}}class M{convert(e){return f(e,y),{code:e.code,message:e.message}}}const U=new M,Tc="NoCodecFoundError";class Ie extends Error{constructor(o,r=`no codec found for: "${o}"`){super(r);n(this,"codec");this.codec=o,Object.freeze(this);debugger}toJSON(){return{code:h.encode(Ie.name),message:h.encode(this.message),codec:h.encode(this.codec)}}get code(){return Tc}}const $t=new Map;class Mc{convert(e){i(e,"code");const o=h.decode(e.code),r=$t.get(o);if(!r)throw new Ie(o);return r.decode(e)}}class Lc{convert(e){const o=$t.get(e.code);if(!o)throw new Ie(e.code);return o.encode(e)}}class Hc extends ae{constructor(){super(...arguments);n(this,"encoder",new Lc);n(this,"decoder",new Mc)}}const ct=new Hc;function C(t,e){$t.set(t,e)}const Yt="InvalidTypeError";class p extends y{constructor(o,r,s=`invalid type: have "${o}", want "${r}"`){super(s);n(this,"have");n(this,"want");this.have=o,this.want=r,Object.freeze(this)}toJSON(){return jn.encode(this)}get code(){return Yt}}class Vc{convert(e){return i(e,"code","have","want","message"),g(e,Yt),new p(h.decode(e.have),h.decode(e.want),h.decode(e.message))}}class Wc{convert(e){return f(e,p),{...U.convert(e),have:h.encode(e.have),want:h.encode(e.want)}}}class Uc extends c{constructor(){super(...arguments);n(this,"encoder",new Wc);n(this,"decoder",new Vc)}}const jn=new Uc;C(Yt,jn);const qn=Oc(st);class Fc{convert(e){return e}}const $n=new Fc;class Jc extends ae{constructor(){super(...arguments);n(this,"encoder",$n);n(this,"decoder",$n)}}const at=new Jc;class b{constructor(e){n(this,"itemCodec");this.itemCodec=e}convert(e){if(!qn(e)){const o=typeof e=="object"&&e!==null?e.constructor.name:typeof e,r="array";throw new Error(`invalid array value: have "${o}", want "${r}"`)}return e.map(o=>this.itemCodec.decode(o))}}class S{constructor(e){n(this,"itemCodec");this.itemCodec=e}convert(e){return f(e,Array),e.map(o=>this.itemCodec.encode(o))}}class v extends c{constructor(o,r){super();n(this,"encoder");n(this,"decoder");this.encoder=r,this.decoder=o}}class _{constructor(e){n(this,"itemCodec");this.itemCodec=e}convert(e){return e===null?null:this.itemCodec.decode(e)}}class j{constructor(e){n(this,"itemCodec");this.itemCodec=e}convert(e){return e===null?null:(Dc(e),this.itemCodec.encode(e))}}class q extends c{constructor(o,r){super();n(this,"encoder");n(this,"decoder");this.encoder=r,this.decoder=o}}class Gc{convert(e){if(!Z(e))throw new p(typeof e,"string");return e}}class Qc{convert(e){return zn(e,"string"),e}}class zc extends c{constructor(){super(...arguments);n(this,"encoder",new Qc);n(this,"decoder",new Gc)}}const h=new zc;new v(new b(h),new S(h));const L=new q(new _(h),new j(h));function be(t){return!t||!t.trim()?null:t}class Xt extends y{constructor(e="completer has already been completed"){super(e),Object.freeze(this)}get code(){return Yn}}const Yn="CompleterAlreadyCompletedError";class _c{convert(e){return i(e,"code","message"),g(e,Yn),new Xt(h.decode(e.message))}}class jc extends M{}class qc extends c{constructor(){super(...arguments);n(this,"encoder",new jc);n(this,"decoder",new _c)}}const $c=new qc;C(Xt.name,$c);function it(){return N(!1,"completer is not ready, this should never be reached")}function dt(){throw new Xt}class Yc{constructor(){n(this,"resolve",it);n(this,"reject",it);n(this,"completed",!1);n(this,"promise");this.promise=new Promise((e,o)=>{this.resolve=e,this.reject=o}),N(this.resolve!==it,"resolve should be set"),N(this.reject!==it,"resolve should be set")}get isCompleted(){return this.completed}complete(e){const o=this.resolve,r=this.reject;if(this.completed=!0,this.resolve=dt,this.reject=dt,e instanceof Promise){e.then(o,r);return}o(e)}completeError(e){this.reject(e),this.completed=!0,this.resolve=dt,this.reject=dt}}function lt(){return new Yc}class Ne extends y{constructor(o,r,s){super(s);n(this,"response");n(this,"status");this.status=o,this.response=r}toJSON(){return Xn.convert(this)}}class ut{convert(e){return f(e,Ne),{...U.convert(e),status:e.status}}}const Xn=new ut,Kt="BadResponseClientError";class Xc extends Ne{constructor(e,o,r="bad server response: client error"){super(e,o,r),Object.freeze(this)}get code(){return Kt}toJSON(){return Kn.encode(this)}}class Kc{convert(e){return i(e,"code","message","status"),g(e,Kt),new Xc(Number(e.status),null,h.decode(e.message))}}class Zc extends ut{}class ea extends c{constructor(){super(...arguments);n(this,"encoder",new Zc);n(this,"decoder",new Kc)}}const Kn=new ea;C(Kt,Kn);const Zt="BadResponseError";class ta extends Ne{constructor(e,o,r="bad server response"){super(e,o,r),Object.freeze(this)}get code(){return Zt}toJSON(){return Zn.encode(this)}}class oa{convert(e){return i(e,"code","message","status"),g(e,Zt),new ta(Number(e.status),null,h.decode(e.message))}}class na extends ut{}class ra extends c{constructor(){super(...arguments);n(this,"encoder",new na);n(this,"decoder",new oa)}}const Zn=new ra;C(Zt,Zn);class sa extends Ne{constructor(e,o,r="bad server response: server error"){super(e,o,r),Object.freeze(this)}get code(){return eo}}const eo="BadResponseServerError";class ca{convert(e){return i(e,"code","message","status"),g(e,eo),new sa(Number(e.status),null,h.decode(e.message))}}class aa extends ut{}class ia extends c{constructor(){super(...arguments);n(this,"encoder",new aa);n(this,"decoder",new ca)}}const da=new ia;C(eo,da);const to="ChannelClosedError";class Re extends y{constructor(e="channel closed"){super(e),Object.freeze(this)}get code(){return to}}class la{convert(e){return i(e,"code","message"),g(e,to),new Re(h.decode(e.message))}}class ua extends M{}class ha extends c{constructor(){super(...arguments);n(this,"encoder",new ua);n(this,"decoder",new la)}}const wa=new ha;C(to,wa);const oo="FetchError";class pa extends y{constructor(o,r=`fetch failed: ${String(o)}`){super(r);n(this,"cause");this.cause=o,Object.freeze(this)}get code(){return oo}}class fa{convert(e){return i(e,"code","message"),g(e,oo),new pa({},h.decode(e.message))}}class ma extends M{}class Aa extends c{constructor(){super(...arguments);n(this,"encoder",new ma);n(this,"decoder",new fa)}}const ga=new Aa;C(oo,ga);const no="IncorrectBase64PaddingError";class er extends y{constructor(e="incorrect padding"){super(e),Object.freeze(this)}get code(){return no}}class Ca{convert(e){return i(e,"code","message"),g(e,no),new er(h.decode(e.message))}}class ya extends M{}class ba extends c{constructor(){super(...arguments);n(this,"encoder",new ya);n(this,"decoder",new Ca)}}const Sa=new ba;C(no,Sa);class va{convert(e){if(!jt(e))throw new p(typeof e,"number");return e}}class Ba{convert(e){return zn(e,"number"),e}}class Ea extends c{constructor(){super(...arguments);n(this,"encoder",new Ba);n(this,"decoder",new va)}}const d=new Ea,tr=new q(new _(d),new j(d)),de=new v(new b(d),new S(d)),ee=new v(new b(tr),new S(tr)),ro="InvalidBase64AlphabetLengthError";class so extends y{constructor(o,r=`alphabet needs to be 64 characters, received ${o}`){super(r);n(this,"length");this.length=o,Object.freeze(this)}toJSON(){return or.encode(this)}get code(){return ro}}class ka{convert(e){return i(e,"code","length","message"),g(e,ro),new so(d.decode(e.length),h.decode(e.message))}}class xa{convert(e){return f(e,so),{...U.convert(e),length:d.encode(e.length)}}}class Ia extends c{constructor(){super(...arguments);n(this,"encoder",new xa);n(this,"decoder",new ka)}}const or=new Ia;C(ro,or);const co="InvalidHexStringError";class ao extends y{constructor(e="invalid hex string"){super(e),Object.freeze(this)}get code(){return co}}class Na{convert(e){return i(e,"code","message"),g(e,co),new ao(h.decode(e.message))}}class Ra extends M{}class Da extends c{constructor(){super(...arguments);n(this,"encoder",new Ra);n(this,"decoder",new Na)}}const Pa=new Da;C(co,Pa);const io="InvalidHexValueError";class nr extends y{constructor(o,r=`invalid hex value "${o}"`){super(r);n(this,"value");this.value=o,Object.freeze(this)}toJSON(){return rr.encode(this)}get code(){return io}}class Oa{convert(e){return i(e,"code","value","message"),g(e,io),new nr(d.decode(e.value),h.decode(e.message))}}class Ta{convert(e){return{...U.convert(e),value:d.encode(e.value)}}}class Ma extends c{constructor(){super(...arguments);n(this,"encoder",new Ta);n(this,"decoder",new Oa)}}const rr=new Ma;C(io,rr);const lo="InvalidInputError";class te extends y{constructor(e="invalid input"){super(e),Object.freeze(this)}get code(){return lo}}class La{convert(e){return i(e,"code","message"),g(e,lo),new te(h.decode(e.message))}}class Ha extends M{}class Va extends c{constructor(){super(...arguments);n(this,"encoder",new Ha);n(this,"decoder",new La)}}const Wa=new Va;C(lo,Wa);const uo="InvalidStringValueError";class sr extends y{constructor(o,r,s=`invalid string value: have "${o}", want "${r}"`){super(s);n(this,"have");n(this,"want");this.have=o,this.want=r,Object.freeze(this)}toJSON(){return cr.encode(this)}get code(){return uo}}class Ua{convert(e){return i(e,"code","have","want","message"),g(e,uo),new sr(h.decode(e.have),h.decode(e.want),h.decode(e.message))}}class Fa{convert(e){return f(e,sr),{...U.convert(e),have:h.encode(e.have),want:h.encode(e.want)}}}class Ja extends c{constructor(){super(...arguments);n(this,"encoder",new Fa);n(this,"decoder",new Ua)}}const cr=new Ja;C(uo,cr);const ho="InvalidTaggedBase64EncodingError";class ar extends y{constructor(e="invalid tagged base64 encoding"){super(e),Object.freeze(this)}toJSON(){return ir.encode(this)}get code(){return ho}}class Ga{convert(e){return i(e,"code","message"),g(e,ho),new ar(h.decode(e.message))}}class Qa extends M{}class za extends c{constructor(){super(...arguments);n(this,"encoder",new Qa);n(this,"decoder",new Ga)}}const ir=new za;C(ho,ir);const wo="MissingElementError";class ht extends y{constructor(e="missing element"){super(e),Object.freeze(this)}get code(){return wo}}class _a{convert(e){return i(e,"code","message"),g(e,wo),new ht(h.decode(e.message))}}class ja extends M{}class qa extends c{constructor(){super(...arguments);n(this,"encoder",new ja);n(this,"decoder",new _a)}}const $a=new qa;C(wo,$a);const po="NoCompleterFoundForRequestID";class dr extends y{constructor(o,r=`no completer found for request id "${o}"`){super(r);n(this,"requestID");this.requestID=o,Object.freeze(this)}toJSON(){return lr.encode(this)}get code(){return po}}class Ya{convert(e){return i(e,"code","requestID","message"),g(e,po),new dr(at.decode(e.requestID),h.decode(e.message))}}class Xa{convert(e){return f(e,dr),{...U.convert(e),requestID:at.encode(e.requestID)}}}class Ka extends c{constructor(){super(...arguments);n(this,"encoder",new Xa);n(this,"decoder",new Ya)}}const lr=new Ka;C(po,lr);const fo="NotFoundError";class Za extends y{constructor(o,r=`Not Found: ${o}`){super(r);n(this,"key");this.key=o,Object.freeze(this)}get code(){return fo}}class ur{constructor(e){n(this,"codec");this.codec=e}convert(e){return i(e,"code","key"),g(e,fo),new Za(this.codec.decode(e.key))}}class hr{constructor(e){n(this,"codec");this.codec=e}convert(e){return{...U.convert(e),key:this.codec.encode(e.key)}}}class wr extends c{constructor(o,r){super();n(this,"encoder");n(this,"decoder");this.encoder=o,this.decoder=r}}new wr(new hr(h),new ur(h));const ei=new wr(new hr(at),new ur(at));C(fo,ei);const mo="NoURLProvidedError";class ti extends y{constructor(e="no url provided"){super(e),Object.freeze(this)}get code(){return mo}}class oi{convert(e){return i(e,"code","message"),g(e,mo),new ti(h.decode(e.message))}}class ni extends M{}class ri extends c{constructor(){super(...arguments);n(this,"encoder",new ni);n(this,"decoder",new oi)}}const si=new ri;C(mo,si);const Ao="UnimplementedError";class D extends y{constructor(e="unimplemented"){super(e),Object.freeze(this);debugger}get code(){return Ao}}class ci{convert(e){return i(e,"code","message"),g(e,Ao),new D(h.decode(e.message))}}class ai extends M{}class ii extends c{constructor(){super(...arguments);n(this,"encoder",new ai);n(this,"decoder",new ci)}}const di=new ii;C(Ao,di);const go="QUERY_ERROR";class li extends y{constructor(o,r="missing element"){super(r);n(this,"error");this.error=o,Object.freeze(this)}get code(){return go}}class ui{convert(e){return i(e,"code","error","message"),g(e,go),new li(Ar.decode(e.error),h.decode(e.message))}}class hi{convert(e){return{code:e.code,error:Ar.encode(e.error),message:h.encode(e.message)}}}class wi extends c{constructor(){super(...arguments);n(this,"encoder",new hi);n(this,"decoder",new ui)}}const pi=new wi;class Co{}const yo="NotFound";class pr extends Co{constructor(){super(),Object.freeze(this)}valueOf(){return yo}toJSON(){return this.valueOf()}}const fi=new pr,bo="Missing";class fr extends Co{constructor(){super(),Object.freeze(this)}valueOf(){return bo}toJSON(){return this.valueOf()}}const mi=new fr;class mr extends Co{constructor(o){super();n(this,"error");this.error=o,Object.freeze(this)}toJSON(){return vo.encode(this)}}class Ai{constructor(e){n(this,"message");this.message=e,Object.freeze(this)}toJSON(){return So.encode(this)}}class gi{convert(e){return i(e,"message"),new Ai(h.decode(e.message))}}class Ci{convert(e){return{message:h.encode(e.message)}}}class yi extends c{constructor(){super(...arguments);n(this,"encoder",new Ci);n(this,"decoder",new gi)}}const So=new yi;class bi{convert(e){return i(e,"Error"),new mr(So.decode(e.Error))}}class Si{convert(e){return{Error:So.encode(e.error)}}}class vi extends c{constructor(){super(...arguments);n(this,"encoder",new Si);n(this,"decoder",new bi)}}const vo=new vi;class Bi{convert(e){return e===yo?fi:e===bo?mi:vo.decode(e)}}class Ei{convert(e){if(e instanceof pr)return yo;if(e instanceof fr)return bo;if(e instanceof mr)return vo.encode(e);throw new D}}class ki extends c{constructor(){super(...arguments);n(this,"encoder",new Ei);n(this,"decoder",new Bi)}}const Ar=new ki;C(go,pi);const gr="ResponseContentTypeIsNotApplicationJSONError";class wt extends Ne{constructor(o,r,s,a="response content type is not application/json"){super(r,s,a);n(this,"haveHeaderType");this.haveHeaderType=o,Object.freeze(this)}static fromResponse(o,r){return new wt(o.headers.get("content-type")??"undefined",o.status,o,r)}toJSON(){return Cr.encode(this)}get code(){return gr}}class xi{convert(e){return i(e,"code","status","have","want","message"),g(e,gr),new wt(h.decode(e.code),d.decode(e.status),null,h.decode(e.message))}}class Ii{convert(e){return{...Xn.convert(e),have:h.encode(e.haveHeaderType),want:h.encode("application/json")}}}class Ni extends c{constructor(){super(...arguments);n(this,"encoder",new Ii);n(this,"decoder",new xi)}}const Cr=new Ni;C(wt.name,Cr);const Bo="WebWorkerErrorResponse";class Ri extends y{constructor(o,r="error in web worker"){super(r);n(this,"error");this.error=o,Object.freeze(this)}toJSON(){return yr.encode(this)}get code(){return Bo}}class Di{convert(e){return i(e,"code","error","message"),g(e,Bo),new Ri(ct.decode(e.error),h.decode(e.message))}}class Pi{convert(e){return{...U.convert(e),error:ct.encode(e.error)}}}class Oi extends c{constructor(){super(...arguments);n(this,"encoder",new Pi);n(this,"decoder",new Di)}}const yr=new Oi;C(Bo,yr);var Eo=(t=>(t[t.success=0]="success",t[t.full=1]="full",t[t.failed=2]="failed",t))(Eo||{});class Ti{getFromEmpty(){}}class Mi{getFromEmpty(){return null}}class Li{getFromEmpty(){throw new ht}}const br={returnNull:new Mi,returnUndefined:new Ti,throwMissingElement:new Li};class Hi{constructor(e){n(this,"maxSize");N(!Number.isNaN(e),"maxSize must not be NaN"),N(Number.isInteger(e),"maxSize must be an integer"),N(e>0,"maxSize must be greater than 0"),this.maxSize=e}nextIndex(e){return N(e>=0,"index must be greater than or equal to 0"),(e+1)%this.maxSize}}class Vi{constructor(e){n(this,"preComputedSizeMinus1");N(!Number.isNaN(e),"maxSize must not be NaN"),N(Number.isInteger(e),"maxSize must be an integer"),N(e>0,"maxSize must be greater than 0"),N(Sr(e),"maxSize must be a power of two"),this.preComputedSizeMinus1=e-1}nextIndex(e){return N(e>=0,"index must be greater than or equal to 0"),e+1&this.preComputedSizeMinus1}}function Sr(t){return(t&t-1)===0}const ko="BufferFullError";class vr extends y{constructor(e="buffer full"){super(e),Object.freeze(this)}get code(){return ko}}class Wi{convert(e){return i(e,"code","message"),g(e,ko),new vr(h.decode(e.message))}}class Ui extends M{}class Fi extends c{constructor(){super(...arguments);n(this,"encoder",new Ui);n(this,"decoder",new Wi)}}const Ji=new Fi;C(ko,Ji);class Gi{putToFull(e,o){return e.get(),e.put(o)}}class Qi{putToFull(){return Eo.full}}class zi{putToFull(){throw new vr}}const Br={overwriteOldest:new Gi,returnFull:new Qi,throw:new zi};function _i(t){return Sr(t)?new Vi(t):new Hi(t)}class ji{constructor(e,o,r){n(this,"readIndex",0);n(this,"writeIndex",0);n(this,"buffer");n(this,"nextIndex");n(this,"getOnEmpty");n(this,"putOnFull");N(!Number.isNaN(e),"maxSize must not be NaN"),this.buffer=new Array(e),this.nextIndex=_i(e),this.getOnEmpty=o,this.putOnFull=r}get maxSize(){return this.buffer.length}get length(){return this.writeIndex<this.readIndex?this.writeIndex+this.maxSize-this.readIndex:this.writeIndex-this.readIndex}put(e){const o=this.nextIndex.nextIndex(this.writeIndex);return o===this.readIndex?this.putOnFull.putToFull(this,e):(this.buffer[this.writeIndex]=e,this.writeIndex=o,Eo.success)}get(){if(this.readIndex===this.writeIndex)return this.getOnEmpty.getFromEmpty(this);const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),e}[Symbol.iterator](){return new qi(this)}immutableIterable(){return{[Symbol.iterator]:()=>this.immutableIterator()}}immutableIterator(){return new $i(this.readIndex,this.writeIndex,this.buffer,this.nextIndex)}}class qi{constructor(e){n(this,"buffer");this.buffer=e}next(){const e=this.buffer.get();return e==null?{value:void 0,done:!0}:{value:e,done:!1}}}class $i{constructor(e,o,r,s){n(this,"readIndex");n(this,"writeIndex");n(this,"buffer");n(this,"nextIndex");this.readIndex=e,this.writeIndex=o,this.buffer=r,this.nextIndex=s}next(){if(this.readIndex===this.writeIndex)return{value:void 0,done:!0};const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),{value:e,done:!1}}}function le(t=32,e=br.returnUndefined,o=Br.overwriteOldest){return new ji(t,e,o)}class Yi{constructor(e){n(this,"publishQueue");n(this,"pollBlocked");n(this,"publishBlocked");n(this,"capacity");n(this,"closed",!1);this.publishQueue=le(Math.max(2,e),br.throwMissingElement,Br.throw);const o=lt();this.pollBlocked=o,this.publishBlocked=o,o.complete(),this.capacity=e-1}get isClosed(){return this.closed}close(){if(this.closed)throw new Re;this.closed=!0}async drain(){for(;this.publishQueue.length>0;)this.publishQueue.get()}async publish(e){if(this.closed)throw new Re;if(this.publishQueue.length>=this.capacity){if(this.publishBlocked.isCompleted){const o=lt();this.publishBlocked=o,await o.promise}return await this.publishBlocked.promise,this.publish(e)}this.publishQueue.put(e),this.pollBlocked.isCompleted||this.pollBlocked.complete()}async poll(){if(this.publishQueue.length<=0){if(this.isClosed)throw new Re;if(this.pollBlocked.isCompleted){const o=lt();this.pollBlocked=o}return await this.pollBlocked.promise,this.poll()}const e=this.publishQueue.get();return this.publishBlocked.isCompleted||this.publishBlocked.complete(),e}[Symbol.asyncIterator](){return new Xi(this)}}class Xi{constructor(e){n(this,"channel");this.channel=e}async next(){try{return{done:!1,value:await this.channel.poll()}}catch(e){if(e instanceof Re)return{done:!0,value:void 0};throw e}}}function Se(t){return new Yi(t)}class Ki{constructor(e){n(this,"channel");this.channel=e}async send(e){await this.channel.publish(e)}}function ue(t){return new Ki(t)}const xo="CorruptBase64InputError";class oe extends y{constructor(o,r=`corrupt input error at ${o}`){super(r);n(this,"offset");this.offset=o,Object.freeze(this)}get code(){return xo}toJSON(){return Er.encode(this)}}class Zi{convert(e){return i(e,"code","offset","message"),g(e,xo),new oe(d.decode(e.offset),h.decode(e.message))}}class ed{convert(e){return f(e,oe),{...U.convert(e),offset:d.encode(e.offset),message:h.encode(e.message)}}}class td extends c{constructor(){super(...arguments);n(this,"encoder",new ed);n(this,"decoder",new Zi)}}const Er=new td;C(xo,Er);const od=new TextEncoder;function kr(t){return od.encode(t)}const nd=new TextDecoder;function rd(t){return nd.decode(t)}function*xr(t){yield*kr(t)}function*sd(){for(let t=0;t<256;t++)yield 255}const De=-1,cd=61;class Pe{constructor(e,o,r=cd,s=!1){n(this,"encodeMap");n(this,"decodeMap");n(this,"padChar");n(this,"strict");this.encodeMap=e,this.decodeMap=o,this.padChar=r,this.strict=s}static withAlphabet(e){const o=e.length;if(o!==64)throw new so(o);const r=Array.from(xr(e)),s=Array.from(sd());for(let a=0;a<o;a++)s[r[a]]=a;return new Pe(r,s)}withPadding(e){return new Pe(this.encodeMap,this.decodeMap,e,this.strict)}encode(e){if(e.byteLength===0)return new ArrayBuffer(0);let o=0,r=0;const s=Math.floor(e.byteLength/3)*3,a=Math.ceil(e.byteLength/3)*4,l=new ArrayBuffer(a),u=new DataView(e),m=new DataView(l);for(;r<s;){const H=u.getUint8(r+0)<<16|u.getUint8(r+1)<<8|u.getUint8(r+2);m.setUint8(o+0,this.encodeMap[H>>18&63]),m.setUint8(o+1,this.encodeMap[H>>12&63]),m.setUint8(o+2,this.encodeMap[H>>6&63]),m.setUint8(o+3,this.encodeMap[H&63]),r+=3,o+=4}const w=e.byteLength-r;if(w===0)return l;let I=u.getUint8(r+0)<<16;switch(w===2&&(I|=u.getUint8(r+1)<<8),m.setUint8(o+0,this.encodeMap[I>>18&63]),m.setUint8(o+1,this.encodeMap[I>>12&63]),w){case 2:return m.setUint8(o+2,this.encodeMap[I>>6&63]),this.padChar!==De?(m.setUint8(o+3,this.padChar),l.slice(0,o+4)):l.slice(0,o+3);case 1:if(this.padChar!==De)return m.setUint8(o+2,this.padChar),m.setUint8(o+3,this.padChar),l.slice(0,o+4);break}return l.slice(0,o+2)}decode(e){const o=e.byteLength;if(o===0)return new ArrayBuffer(0);const r=new DataView(e),s=new ArrayBuffer(Math.floor(o/4*3)),a=new DataView(s),l=new ArrayBuffer(4),u=new DataView(l);let m=0,w=0,I=0,H=!1;for(;w<o&&!H;){let se=3,K=4;for(let R=0;R<4;R++){if(w===o){if(R===0)return s;if(R===1||this.padChar!==De)throw new oe(w-R);se=R-1,K=R,H=!0;break}const Q=r.getUint8(w);w++;const Rc=this.decodeMap[Q];if(Rc!==255){u.setUint8(R,Rc);continue}if(Q===10||Q===13){R--;continue}if(Q===this.padChar){switch(R){case 0:case 1:throw new er;case 2:for(;w<o&&(r.getUint8(w)===10||r.getUint8(w)===13);)w++;if(w===o)throw new oe(o);w++}for(;w<o&&(r.getUint8(w)===10||r.getUint8(w)===13);)w++;if(w<o)throw new oe(w);se=3,K=R,H=!0;break}throw new oe(w-1)}const T=u.getUint8(0)<<18|u.getUint8(1)<<12|u.getUint8(2)<<6|u.getUint8(3);switch(u.setUint8(2,T>>0&255),u.setUint8(1,T>>8&255),u.setUint8(0,T>>16&255),K){case 4:a.setUint8(I+2,u.getUint8(2)),u.setUint8(2,0);case 3:if(a.setUint8(I+1,u.getUint8(1)),this.strict&&u.getUint8(2)!==0)throw new oe(w-1);case 2:if(a.setUint8(I+0,u.getUint8(0)),this.strict&&(u.getUint8(1)!==0||u.getUint8(2)!==0))throw new oe(w-2)}I+=se,m+=K-1}return s.slice(0,m)}decodeString(e){return this.decode(kr(e).buffer)}encodeToString(e){return rd(this.encode(e))}}const Io=Pe.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ad=Io.withPadding(De),Ir=Pe.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),No=Ir.withPadding(De);function*id(t,e){for(let o=t.next();!o.done;o=t.next())e(o.value)&&(yield o.value)}function Ro(t,e){return id(t[Symbol.iterator](),e)}function*Nr(t,e){for(let o=t.next();!o.done;o=t.next())yield e(o.value)}function $(t,e){return Nr(t[Symbol.iterator](),e)}function*dd(t,e){for(let o=0;o<e;o++){const r=t.next();if(r.done)return;yield r.value}}function ld(t,e){return dd(t[Symbol.iterator](),e)}function Rr(t){const e=t.next();if(e.done)throw new ht;return e.value}function ud(t){let e;for(let o=t.next();!o.done;o=t.next())e=o.value;if(e===void 0)throw new ht;return e}function hd(t){return ud(t[Symbol.iterator]())}function*wd(t,e){for(let o=t.next();!o.done;o=t.next())yield*e(o.value)}function Dr(t,e){return wd(t[Symbol.iterator](),e)}function*pd(){let t=0;for(;;)yield t++}function Pr(t){return ld(pd(),Math.ceil(t))}function Or(t,e,o){const r=o;let s=e;for(let a=r.next();!a.done;a=r.next())s=t(s,a.value);return s}function*fd(t,e,o){for(let r=t.next(),s=e.next();!r.done&&!s.done;r=t.next(),s=e.next())yield o(r.value,s.value)}function Tr(t,e,o){return fd(t[Symbol.iterator](),e[Symbol.iterator](),o)}function Mr(t){if(t.startsWith("0x"))return Mr(t.substring(2));if(t.length&1)throw new ao;const e=new ArrayBuffer(t.length/2);return md(xr(t),e),e}function md(t,e){const o=new DataView(e);let r=0;for(;r<e.byteLength;){const s=t.next(),a=t.next();if(s.done||a.done)throw new ao;const l=Lr(s.value),u=Lr(a.value),m=l<<4|u;o.setUint8(r,m),r++}}function Lr(t){if(t>=48&&t<=57)return t-48;if(t>=97&&t<=102)return t-97+10;if(t>=65&&t<=70)return t-65+10;throw new nr(t)}function Ad(t){return t.toString(16).padStart(2,"0")}function*gd(t){yield*Nr(t,Ad)}function Cd(t){return gd(t[Symbol.iterator]())}class yd{convert(e){if(typeof e!="string")throw new p(typeof e,"string");return Mr(e)}}class bd{convert(e){return f(e,ArrayBuffer),["0x",...Cd(new Uint8Array(e))].join("")}}class Sd extends c{constructor(){super(...arguments);n(this,"encoder",new bd);n(this,"decoder",new yd)}}const P=new Sd;new q(new _(P),new j(P));const Hr=new v(new b(P),new S(P));class vd{convert(e){return e instanceof Array?Hr.decode(e):[P.decode(e)]}}class Bd{convert(e){return Hr.encode(e)}}class Ed extends c{constructor(){super(...arguments);n(this,"encoder",new Bd);n(this,"decoder",new vd)}}const ne=new Ed;class kd{constructor(e){n(this,"encoding");this.encoding=e}convert(e){if(typeof e!="string")throw new p(typeof e,"string");return this.encoding.decodeString(e)}}class xd{constructor(e){n(this,"encoding");this.encoding=e}convert(e){return this.encoding.encodeToString(e)}}class pt extends c{constructor(o){super();n(this,"encoder");n(this,"decoder");this.encoder=new xd(o),this.decoder=new kd(o)}}new pt(No),new pt(ad);const Vr=new pt(Ir),Wr=new pt(Io);class Id{convert(e){if(!Z(e))throw new p(typeof e,"string");const o=new Date(e);if(Number.isNaN(o.valueOf()))throw new p("NaN","number");return o}}class Nd{convert(e){return f(e,Date),e.toISOString()}}class Rd extends c{constructor(){super(...arguments);n(this,"encoder",new Nd);n(this,"decoder",new Id)}}const ve=new Rd;class Dd{convert(e){if(!Z(e))throw new p(typeof e,"string");return new URL(e)}}class Pd{convert(e){return e.toString()}}class Od extends c{constructor(){super(...arguments);n(this,"encoder",new Pd);n(this,"decoder",new Dd)}}const Ur=new Od,Fr=new q(new _(Ur),new j(Ur));class Jr{}class Gr{}const Oe="Close";class Te extends Gr{valueOf(){return Oe}}class Td{convert(){return Oe}}class Md{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==Oe)throw new p(e,Oe);return new Te}}class Ld extends c{constructor(){super(...arguments);n(this,"encoder",new Td);n(this,"decoder",new Md)}}const Qr=new Ld,Me="Connect";class Le extends Gr{valueOf(){return Me}toJSON(){return Do.encode(this)}}class Hd{convert(){return Me}}class Vd{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==Me)throw new p(e,Me);return new Le}}class Wd extends c{constructor(){super(...arguments);n(this,"encoder",new Hd);n(this,"decoder",new Vd)}}const Do=new Wd;class Ud{convert(e){if(e===Me)return Do.decode(e);if(e===Oe)return Qr.decode(e);throw new D}}class Fd{convert(e){if(e instanceof Le)return Do.encode(e);if(e instanceof Te)return Qr.encode(e);throw new D}}class Jd extends c{constructor(){super(...arguments);n(this,"encoder",new Fd);n(this,"decoder",new Ud)}}const zr=new Jd;class ft extends Jr{constructor(o){super();n(this,"command");this.command=o}get type(){return He}toJson(){return _r.encode(this)}}const He="WebSocket";class Gd{convert(e){return{[He]:zr.encode(e.command)}}}class Qd{convert(e){return i(e,He),new ft(zr.decode(e[He]))}}class zd extends c{constructor(){super(...arguments);n(this,"encoder",new Gd);n(this,"decoder",new Qd)}}const _r=new zd,he=new Map;he.set(He,_r);class _d{convert(e){const o=he.get(e.type);if(!o)throw new p(e.type,`one of ${Array.from($(he.keys(),r=>`"${r}"`)).join(", ")}`);return{[e.type]:o.encode(e)}}}class jd{convert(e){if(typeof e!="object"||e===null)throw new p(typeof e,"object");const o=Object.keys(e);if(o.length!==1)throw new D("multiple values contained within the Request object, unexpected");const[r]=o,s=he.get(r);if(i(e,r),!s)throw new p(r,`one of ${Array.from($(he.keys(),a=>`"${a}"`)).join(", ")}`);return s.decode(e[r])}}class qd extends c{constructor(){super(...arguments);n(this,"encoder",new _d);n(this,"decoder",new jd)}}function $d(t,e){if(he.has(t))throw new D;he.set(t,e)}const Yd=new qd;class mt{}const Ve="Error";class jr extends mt{constructor(o){super();n(this,"error");this.error=o}get type(){return Ve}toJson(){return qr.encode(this)}}class Xd{convert(e){return{[Ve]:ct.encode(e.error)}}}class Kd{convert(e){return i(e,Ve),new jr(ct.decode(e[Ve]))}}class Zd extends c{constructor(){super(...arguments);n(this,"encoder",new Xd);n(this,"decoder",new Kd)}}const qr=new Zd;class Po{}const We="Closed";class Ue extends Po{valueOf(){return We}toJSON(){return Oo.encode(this)}}class el{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==We)throw new p(e,We);return new Ue}}class tl{convert(){return We}}class ol extends c{constructor(){super(...arguments);n(this,"encoder",new tl);n(this,"decoder",new el)}}const Oo=new ol,Fe="Connecting";class Je extends Po{valueOf(){return Fe}toJSON(){return To.encode(this)}}class nl{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==Fe)throw new p(e,Fe);return new Je}}class rl{convert(){return Fe}}class sl extends c{constructor(){super(...arguments);n(this,"encoder",new rl);n(this,"decoder",new nl)}}const To=new sl,Ge="Opened";class Qe extends Po{valueOf(){return Ge}toJSON(){return Mo.encode(this)}}class cl{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==Ge)throw new p(e,Ge);return new Qe}}class al{convert(){return Ge}}class il extends c{constructor(){super(...arguments);n(this,"encoder",new al);n(this,"decoder",new cl)}}const Mo=new il;class dl{convert(e){if(e===Ge)return Mo.decode(e);if(e===We)return Oo.decode(e);if(e===Fe)return To.decode(e);throw new D}}class ll{convert(e){if(e instanceof Qe)return Mo.encode(e);if(e instanceof Ue)return Oo.encode(e);if(e instanceof Je)return To.encode(e);throw new D}}class ul extends c{constructor(){super(...arguments);n(this,"encoder",new ll);n(this,"decoder",new dl)}}const $r=new ul;class Yr extends mt{constructor(o){super();n(this,"status");this.status=o}get type(){return ze}toJson(){return Xr.encode(this)}}const ze="WebSocket";class hl{convert(e){return{[ze]:$r.encode(e.status)}}}class wl{convert(e){return i(e,ze),new Yr($r.decode(e[ze]))}}class pl extends c{constructor(){super(...arguments);n(this,"encoder",new hl);n(this,"decoder",new wl)}}const Xr=new pl,re=new Map;re.set(Ve,qr),re.set(ze,Xr);class fl{convert(e){const o=re.get(e.type);if(!o)throw new p(e.type,`one of ${Array.from($(re.keys(),r=>`"${r}"`)).join(", ")}`);return{[e.type]:o.encode(e)}}}class ml{convert(e){if(typeof e!="object"||e===null)throw new p(typeof e,"object");const o=Object.keys(e);if(o.length!==1)throw new D("multiple values contained within the response object, unexpected");const[r]=o,s=re.get(r);if(i(e,r),!s)throw new p(r,`one of ${Array.from($(re.keys(),a=>`"${a}"`)).join(", ")}`);return s.decode(e[r])}}class Al extends c{constructor(){super(...arguments);n(this,"encoder",new fl);n(this,"decoder",new ml)}}function gl(t,e){if(re.has(t))throw new D;re.set(t,e)}const Cl=new Al;class yl{convert(e){return new jr(e)}}const bl=new yl;class Sl{convert(e){return new Yr(e)}}const Lo=new Sl;class vl{constructor(e,o){this.sink=e,this.converter=o,this.sink=e,this.converter=o}async send(e){await this.sink.send(this.converter.convert(e))}}function we(t,e){return new vl(t,e)}async function Kr(t){return new Promise(e=>{const o=setTimeout(()=>{clearTimeout(o),e()},t)})}class Y{constructor(e,o,r){n(this,"significantDigitsMultiplier");this.alpha3Code=e,this.code=o,this.significantDigits=r,this.alpha3Code=e,this.code=o,this.significantDigits=r,this.significantDigitsMultiplier=BigInt(10)**BigInt(this.significantDigits)}toJSON(){return At.encode(this)}}const Zr=new Y("JPY",392,0),Bl=new Y("GBP",826,2),es=new Y("USD",840,2),El=new Y("EUR",978,2),kl=new Y("XXX",999,2),ts=new Y("ETH",1001,18),Ho=new Y("XBT",1002,8),os=new Y("ESP",10001,18),xl=[Zr,Bl,es,El,kl,ts,Ho,os],Il=new Map(xl.map(t=>[t.alpha3Code,t]));class Nl{convert(e){if(typeof e!="string")throw new te("CurrencyCodeDecoder: expected string");if(e==="BTC")return Ho;const o=Il.get(e);if(o===void 0)throw new te(`CurrencyCodeDecoder: unknown currency: "${e}"`);return o}}class Rl{convert(e){return f(e,Y),e.alpha3Code}}class Dl extends c{constructor(){super(...arguments);n(this,"decoder",new Nl);n(this,"encoder",new Rl)}}const At=new Dl;class F{constructor(e,o){this.currency=e,this.value=o,this.currency=e,this.value=o}static USD(e){return new F(es,BigInt(e))}static ETH(e){return new F(ts,BigInt(e))}static ESP(e){return new F(os,BigInt(e))}static JPY(e){return new F(Zr,BigInt(e))}static BTC(e){return new F(Ho,BigInt(e))}toString(){return gt.encode(this)}toJSON(){return gt.encode(this)}}function Pl(t){return t==="."||t===","||t===" "}function Ol(t,e){let o=-1;const r=t.length;for(let s=0;s<r;s++)e(t[s])&&(o=s);return o}class Tl{parseCurrencyCode(e){return At.decode(e)}parseValue(e,o){let r=1n;o[0]==="-"&&(r=-1n,o=o.substring(1));const s=Ol(o,Pl);if(s===-1){const w=BigInt(o.replace(/\D/g,""))*e.significantDigitsMultiplier;return r*w}const a=o.substring(0,s).replace(/\D/g,""),l=o.substring(s+1).replace(/\D/g,""),u=BigInt(a)*e.significantDigitsMultiplier,m=BigInt(l)*10n**BigInt(e.significantDigits-l.length);return r*(u+m)}convert(e){if(typeof e!="string")throw new te("MonetaryValueDecoder: expected string");const o=e.indexOf(" ");if(o<=-1)throw new te("MonetaryValueDecoder: missing non-breaking space");const r=e.substring(0,o),s=e.substring(o+1);if(/^-?[\d .,]+$/.test(r)){const l=this.parseCurrencyCode(s);return new F(l,this.parseValue(l,r))}const a=this.parseCurrencyCode(r);return new F(a,this.parseValue(a,s))}}class Ml{convert(e){f(e,F);const o=e.value<0n?"-":"",r=e.value<0n?-e.value:e.value,s=r%e.currency.significantDigitsMultiplier,a=r/e.currency.significantDigitsMultiplier,l=String(a),u=String(s);return/^0+$/.test(u)?`${At.encode(e.currency)} ${o}${l}`:`${At.encode(e.currency)} ${o}${a}.${String(s).padStart(e.currency.significantDigits,"0")}`}}class Ll extends c{constructor(){super(...arguments);n(this,"decoder",new Tl);n(this,"encoder",new Ml)}}const gt=new Ll,ns=new v(new b(gt),new S(gt));class V{constructor(e,o,r,s){n(this,"namespace");n(this,"name");n(this,"site");n(this,"blockExplorer");this.namespace=e,this.name=o,this.site=r,this.blockExplorer=s}}const Hl=new V(202374881,"Vienna",new URL("https://vienna.caldera.dev/"),new URL("https://vienna.calderaexplorer.xyz/")),Vl=new V(202374882,"OP Stack",new URL("https://stack.optimism.io/"),new URL("https://www.blockscout.com/")),Wl=new V(33914988448,"Arbitrum",new URL("https://arbitrum.io/"),new URL("https://arbiscan.io/")),Ul=new V(33914988449,"Eigen Layer",new URL("https://www.eigenlayer.xyz/"),new URL("https://www.blockscout.com/")),Fl=new V(33914988450,"Spire",new URL("https://www.spire.dev/"),new URL("https://www.blockscout.com/")),Jl=new V(33914988451,"Alt Layer",new URL("https://altlayer.io/"),new URL("https://www.blockscout.com/")),Gl=new V(33914988452,"Caldera",new URL("https://www.caldera.xyz/"),new URL("https://www.blockscout.com/")),Ql=new V(33914988453,"Vistara Labs",new URL("https://vistara.dev/"),new URL("https://www.blockscout.com/")),zl=new V(33914988454,"Polygon",new URL("https://polygon.technology/"),new URL("https://www.blockscout.com/")),_l=new V(263,"Milan",new URL("https://milan.caldera.dev/"),new URL("https://milan-devnet.explorer.caldera.xyz/")),jl=new V(41234687,"Kyoto",new URL("https://example.com/"),new URL("https://kyoto-explorer.altlayer.io/")),ql=new Map([Hl,Vl,Wl,zl,Ul,Fl,Jl,Gl,Ql,_l,jl].map(t=>[t.namespace,t]));class X{constructor(e,o){n(this,"tag");n(this,"data");this.tag=e,this.data=o}static fromString(e){const o=e.indexOf("~");if(o<0)throw new ar;const r=e.substring(0,o),s=No.decodeString(e.substring(o+1));return new X(r,s)}static inflate(e){return A.decode(e)}toString(){return`${this.tag}~${No.encodeToString(this.data)}`}valueOf(){return this.toString()}toJSON(){return this.toString()}}class $l{convert(e){if(typeof e!="string")throw new p(typeof e,"string");return X.fromString(e)}}class Yl{convert(e){return f(e,X),e.toString()}}class Xl extends c{constructor(){super(...arguments);n(this,"encoder",new Yl);n(this,"decoder",new $l)}}const A=new Xl,rs=["Residential","Mobile","Enterprise","AWS","Azure","GCP"],ss=["Espresso v1.0","Espresso v1.1","Espresso v1.2","Espresso v1.3","Espresso v1.4"],cs=["Linux","Unix","Windows","MacOS"],as=[["Espresso","https://espressosys.com/"],["BlockDaemon","https://www.blockdaemon.com/"],["Unit 410","https://unit410.com/"],["Nethermind","https://www.nethermind.io/"],["Sub7","https://sub7.xyz/"],["KudasaiJP","https://kudasai.co.jp/"],["Informal Systems","https://informal.systems/"],["P2P","https://p2p.org/"],["LinkPool","https://linkpool.com/"],["ZKV","https://zkvalidator.com/"],["Figment","https://figment.io/"]],Ct=2147483648,Kl=1103515245,Zl=12345;class pe{constructor(e){n(this,"state");this.state=e!==void 0?e:Math.floor(Math.random()*(Ct-1))}nextInt(){return this.state=(Kl*this.state+Zl)%Ct,this.state}nextFloat(){return this.nextInt()/(Ct-1)}nextRange(e,o){const r=o-e,s=this.nextInt()/Ct;return e+Math.floor(s*r)}fillBytes(e){const o=new ArrayBuffer(e),r=new DataView(o);let s=0;for(;s<e-4;s+=4)r.setUint32(s,this.nextRange(0,4294967295));for(let a=s;a<e;a++)r.setUint8(a,this.nextRange(0,256));return o}}const eu=[[["Mexico City",19.4333,-99.1333,"MX"],["Guadalajara",20.6767,-103.3475,"MX"],["Monterrey",25.6667,-100.3,"MX"],["Guatemala City",14.6133,-90.5353,"GT"],["Tijuana",32.525,-117.0333,"MX"],["Ecatepec",19.6097,-99.06,"MX"],["Tegucigalpa",14.1058,-87.2047,"HN"],["León de los Aldama",21.1167,-101.6833,"MX"],["San José",9.9325,-84.08,"CR"],["Panama City",8.9833,-79.5167,"PA"],["Juárez",31.745,-106.485,"MX"],["Comayagüela",14.098,-87.21,"HN"],["Mexicali",32.6633,-115.4678,"MX"],["Nezahualcóyotl",19.4081,-99.0186,"MX"],["Managua",12.1364,-86.2514,"NI"],["Morelia",19.7683,-101.1894,"MX"],["Aguascalientes",21.876,-102.296,"MX"],["Mérida",20.97,-89.62,"MX"],["Saltillo",25.4231,-100.9919,"MX"],["Culiacán",24.8069,-107.3939,"MX"]],[["Havana",23.1367,-82.3589,"CU"],["San Juan",18.3985,-66.061,"PR"],["Santiago",19.4572,-70.6889,"DO"],["Santo Domingo",18.4667,-69.95,"DO"],["Port-au-Prince",18.5333,-72.3333,"HT"],["Santo Domingo Este",18.4855,-69.8734,"DO"],["Kingston",17.9714,-76.7931,"JM"],["Carrefour",18.5344,-72.4094,"HT"],["Santiago de Cuba",20.0217,-75.8294,"CU"],["Pétion-Ville",18.5128,-72.2864,"HT"],["Holguín",20.8869,-76.2592,"CU"],["Gonaïves",19.4456,-72.6883,"HT"],["Camagüey",21.3839,-77.9075,"CU"],["Puerto Plata",19.8,-70.6833,"DO"],["Croix-des-Bouquets",18.5761,-72.2269,"HT"],["Nassau",25.0781,-77.3386,"BS"],["Fort-de-France",14.6,-61.0667,"MQ"],["Higüey",18.6167,-68.7,"DO"],["Santa Clara",22.4069,-79.9649,"CU"],["Bayamo",20.3817,-76.6428,"CU"]],[["Cairo",30.0444,31.2358,"EG"],["Lagos",6.455,3.3841,"NG"],["Kinshasa",-4.3219,15.3119,"CD"],["Luanda",-8.8383,13.2344,"AO"],["Johannesburg",-26.2044,28.0456,"ZA"],["Dar es Salaam",-6.8161,39.2803,"TZ"],["Douala",4.05,9.7,"CM"],["Giza",29.987,31.2118,"EG"],["Abidjan",5.3167,-4.0333,"CI"],["Cape Town",-33.9253,18.4239,"ZA"],["Bamako",12.6392,-8.0028,"ML"],["Abuja",9.0667,7.4833,"NG"],["Ibadan",7.3964,3.9167,"NG"],["Addis Ababa",9.03,38.74,"ET"],["Mbuji-Mayi",-6.15,23.6,"CD"],["Mogadishu",2.0392,45.3419,"SO"],["Lusaka",-15.4167,28.2833,"ZM"],["Antananarivo",-18.91,47.525,"MG"],["Awka",6.2069,7.0678,"NG"],["Bamenda",5.9614,10.1517,"CM"]],[["Tokyo",35.6897,139.6922,"JP"],["Delhi",28.61,77.23,"IN"],["Manila",14.5958,120.9772,"PH"],["Dhaka",23.7639,90.3889,"BD"],["Moscow",55.7558,37.6172,"RU"],["Ho Chi Minh City",10.7756,106.7019,"VN"],["Xi’an",34.2611,108.9422,"CN"],["Dongguan",23.021,113.752,"CN"],["Tongshan",34.204,117.284,"CN"],["Jining",35.4151,116.5871,"CN"],["Cangzhou",38.3047,116.8387,"CN"],["Shaoyang",27.2395,111.4679,"CN"],["Dalian",38.9,121.6,"CN"],["Ankara",39.93,32.85,"TR"],["Zhangzhou",24.513,117.647,"CN"],["Changsha",28.228,112.939,"CN"],["Ürümqi",43.8225,87.6125,"CN"],["Ningbo",29.8603,121.6245,"CN"],["Suihua",46.654,126.969,"CN"],["Deyang",31.127,104.398,"CN"]],[["London",51.5072,-.1275,"GB"],["Madrid",40.4169,-3.7033,"ES"],["Berlin",52.52,13.405,"DE"],["Barcelona",41.3828,2.1769,"ES"],["Athens",37.9842,23.7281,"GR"],["Budapest",47.4925,19.0514,"HU"],["Birmingham",52.48,-1.9025,"GB"],["Stuttgart",48.7775,9.18,"DE"],["Munich",48.1375,11.575,"DE"],["Hamburg",53.55,10,"DE"],["Bucharest",44.4325,26.1039,"RO"],["Vienna",48.2083,16.3725,"AT"],["Stockholm",59.3294,18.0686,"SE"],["Minsk",53.9,27.5667,"BY"],["Warsaw",52.23,21.0111,"PL"],["Valencia",39.47,-.3764,"ES"],["Amsterdam",52.3728,4.8936,"NL"],["Copenhagen",55.6761,12.5683,"DK"],["Porto",41.1621,-8.622,"PT"],["Brussels",50.8467,4.3525,"BE"]],[["New York",40.6943,-73.9249,"US"],["Los Angeles",34.1141,-118.4068,"US"],["Chicago",41.8375,-87.6866,"US"],["Miami",25.784,-80.2101,"US"],["Dallas",32.7935,-96.7667,"US"],["Philadelphia",40.0077,-75.1339,"US"],["Atlanta",33.7628,-84.422,"US"],["Boston",42.3188,-71.0852,"US"],["Phoenix",33.5722,-112.0892,"US"],["Detroit",42.3834,-83.1024,"US"],["Seattle",47.6211,-122.3244,"US"],["San Francisco",37.7558,-122.4449,"US"],["San Diego",32.8313,-117.1222,"US"],["Minneapolis",44.9635,-93.2678,"US"],["Brooklyn",40.6501,-73.9496,"US"],["Vancouver",49.25,-123.1,"CA"],["Riverside",33.9381,-117.3949,"US"],["Baltimore",39.3051,-76.6144,"US"],["Portland",45.5371,-122.65,"US"],["Sacramento",38.5677,-121.4685,"US"]],[["Melbourne",-37.8142,144.9631,"AU"],["Sydney",-33.8678,151.21,"AU"],["Brisbane",-27.4678,153.0281,"AU"],["Perth",-31.9559,115.8606,"AU"],["Auckland",-36.8406,174.74,"NZ"],["Adelaide",-34.9275,138.6,"AU"],["Port Moresby",-9.4789,147.1494,"PG"],["Gold Coast",-28.0167,153.4,"AU"],["Cranbourne",-38.0996,145.2834,"AU"],["Christchurch",-43.531,172.6365,"NZ"],["Manukau City",-37,174.885,"NZ"],["Central Coast",-33.3,151.2,"AU"],["Wollongong",-34.4331,150.8831,"AU"],["Ipswich",-27.6144,152.7608,"AU"],["Wellington",-41.2889,174.7772,"NZ"],["Northcote",-36.8019,174.7494,"NZ"],["Hobart",-42.8806,147.325,"AU"],["Lae",-6.7303,147.0008,"PG"],["Suva",-18.1416,178.4419,"FJ"],["Nouméa",-22.2758,166.458,"NC"]],[["São Paulo",-23.55,-46.6333,"BR"],["Buenos Aires",-34.6033,-58.3817,"AR"],["Rio de Janeiro",-22.9111,-43.2056,"BR"],["Lima",-12.06,-77.0375,"PE"],["Bogotá",4.7111,-74.0722,"CO"],["Santiago",-33.4372,-70.6506,"CL"],["Belo Horizonte",-19.9167,-43.9333,"BR"],["Fortaleza",-3.7275,-38.5275,"BR"],["Santa Cruz de la Sierra",-17.7892,-63.1975,"BO"],["La Paz",-16.4958,-68.1333,"BO"],["Guayaquil",-2.19,-79.8875,"EC"],["Medellín",6.2308,-75.5906,"CO"],["Salvador",-12.9747,-38.4767,"BR"],["Caracas",10.4806,-66.9036,"VE"],["Córdoba",-31.4167,-64.1833,"AR"],["Santos",-23.9369,-46.325,"BR"],["Curitiba",-25.4297,-49.2711,"BR"],["Maracaibo",10.6333,-71.6333,"VE"],["Recife",-8.05,-34.9,"BR"],["Porto Alegre",-30.0331,-51.23,"BR"]]],is=[0,0,5,26,28,26,9,6],tu=is.reduce((t,e)=>t+e,0),ou=is.reduce((t,e)=>{const o=t[t.length-1]??0;return t.push(o+e),t},[]),nu=Array.from(Tr(ou,eu,(t,e)=>[t,e])),yt=new Date,bt=new Date(yt.getFullYear(),yt.getMonth(),yt.getDate()).valueOf();function ru(){return bt}async function*su(){}function ds(){const t=new Uint8Array(new Array(20).map(()=>0)).buffer;return{hash:new X("BLOCK",t),height:0,time:new Date(0),genTime:0,transactions:su(),numTransactions:0,proposer:[],size:0,fees:[]}}async function*cu(t){let e=1,o=bt;for(;o<yt.valueOf();){const r=Math.floor(t.nextFloat()*14*1e3);yield ls(new pe(e+r),e,o,o+r),o+=r,e++}}async function*au(t=new pe(bt)){yield ds(),yield*cu(t)}async function*iu(t,e,o){let r=e,s=o;for(;;){const a=Math.floor(t.nextFloat()*14*1e3),l=r+a-Date.now();await Kr(l),yield ls(new pe(s+a),s,r,r+a),r+=a,s++}}function ls(t,e,o,r){const s=Math.floor(t.nextRange(0,5)),a=t.nextRange(0,_e.length),l=_e[a];return{hash:new X("BLOCK",t.fillBytes(32)),height:e,genTime:r-o,time:new Date(r),numTransactions:s,transactions:lu(new pe(e+o),e,o,r,s),proposer:[l.address],size:Math.floor(t.nextFloat()*1024*s)+8,fees:[F.ESP(BigInt(t.nextRange(0,1e9)*1e3))]}}const us=Array.from(ql.keys());function du(t){return t.nextFloat()>.98?1:us[t.nextRange(0,us.length)]}async function*lu(t,e,o,r,s){const a=(r-o)/s;for(let l=0,u=o;u<r;u+=a,l++){const m=du(t),w=Math.floor(1024*t.nextFloat());yield{block:e,index:l,size:w,hash:new X("COMMIT",t.fillBytes(32)),time:new Date(u),sender:new X("PUBKEY",t.fillBytes(32)),tree:{namespace:m,data:t.fillBytes(w)}}}}function uu(t){const e=t.nextRange(0,tu),o=Ro(nu,([l])=>l<=e),[,r]=hd(o),s=t.nextRange(0,r.length);return r[s]}function hu(t){const e=t.nextRange(0,as.length);return as[e]}function wu(t){const e=t.nextRange(0,cs.length);return cs[e]}function pu(t){const e=t.nextRange(0,ss.length);return ss[e]}function fu(t){const e=t.nextRange(0,rs.length);return rs[e]}function mu(t){const[e,o]=hu(t),[,r,s,a]=uu(t),l=wu(t),u=pu(t),m=fu(t);return{pubkey:new X("PUBKEY",t.fillBytes(32)),name:`${e} Node ${a} ${t.nextRange(0,100)}`,address:t.fillBytes(32),company:{name:e,website:o},location:{coords:[r,s],country:a},operatingSystem:l,networkType:m,nodeType:u}}function*Au(){const t=new pe(bt),e=t.nextRange(50,150);for(let o=0;o<e;o++)yield mu(t)}const _e=Array.from(Au());class je{constructor(e){this.value=e,this.value=e}valueOf(){return Number(this.value)}toString(){return Number(this.value).toString()}}function Vo(t,e){return t.valueOf()<e.valueOf()}function gu(t,e){return t.valueOf()<=e.valueOf()}function St(t,e){return t.valueOf()>e.valueOf()}function hs(t,e){return gu(t,e)?t:e}function ws(t,e){return St(t,e)?t:e}class Wo{constructor(e,o){n(this,"min");n(this,"max");this.min=e,this.max=o}contains(e){return!(Vo(e.lat,this.min.lat)||St(e.lat,this.max.lat)||Vo(e.lng,this.min.lng)||St(e.lng,this.max.lng))}}function qe(t){const e=t[Symbol.iterator](),o=Rr(e),[r,s]=Or(([a,l],u)=>[a.min(u.bbox.min),l.max(u.bbox.max)],[o.bbox.min,o.bbox.max],e);return new Wo(r,s)}function Cu(t){const e=t[Symbol.iterator](),o=Rr(e),[r,s]=Or(([a,l],u)=>[a.min(u),l.max(u)],[o,o],e);return new Wo(r,s)}class fe{}const ps=new Map;function me(t,e){ps.set(t,e)}function fs(t){const e=ps.get(t);if(!e)throw new Ie(t);return e}class yu{convert(e){return fs(e.type).encode(e)}}class bu{convert(e){if(i(e,"type","coordinates"),!Z(e.type))throw new p(typeof e.type,"string");return fs(e.type).decode(e)}}class Su extends c{constructor(){super();n(this,"encoder");n(this,"decoder");this.encoder=new yu,this.decoder=new bu}}const ms=new Su,As=new v(new b(ms),new S(ms)),Uo="GeometryCollection";class vu extends fe{constructor(o){super();n(this,"type",Uo);n(this,"geometries");n(this,"bbox");this.geometries=o,this.bbox=qe(o)}toJSON(){return gs.encode(this)}}class Bu{constructor(e){n(this,"listGeometryCodec");this.listGeometryCodec=e}convert(e){return{type:e.type,geometries:this.listGeometryCodec.encode(e.geometries)}}}class Eu{constructor(e){n(this,"listGeometryCodec");this.listGeometryCodec=e}convert(e){return i(e,"type","geometries"),ie(e,Uo),new vu(this.listGeometryCodec.decode(e.geometries))}}class ku extends c{constructor(){super(...arguments);n(this,"encoder",new Bu(As));n(this,"decoder",new Eu(As))}}const gs=new ku;me(Uo,gs);class O extends je{toString(){return`${Number(this)}°`}}class xu{convert(e){return Number(e)}}class Iu{convert(e){if(!jt(e))throw new p(typeof e,"number");return new O(e)}}class Nu extends c{constructor(){super();n(this,"encoder");n(this,"decoder");this.encoder=new xu,this.decoder=new Iu}}const Ru=new Nu;class k extends je{toString(){return`${String(this.value)} lat`}}class x extends je{toString(){return`${String(this.value)} lng`}}class J extends je{toString(){return`${Number(this)} rad`}}class Du{convert(e){return Number(e)}}class Pu{convert(e){if(!jt(e))throw new p(typeof e,"number");return new J(e)}}class Ou extends c{constructor(){super();n(this,"encoder");n(this,"decoder");this.encoder=new Du,this.decoder=new Pu}}const Tu=new Ou;class B{constructor(e,o){this.lat=e,this.lng=o,this.lat=e,this.lng=o}min(e){return new B(hs(this.lat,e.lat),hs(this.lng,e.lng))}max(e){return new B(ws(this.lat,e.lat),ws(this.lng,e.lng))}toString(){return`${this.lat}, ${this.lng}`}}class Mu{constructor(e){n(this,"unitCodec");this.unitCodec=e}convert(e){return[this.unitCodec.encode(e.lat.value),this.unitCodec.encode(e.lng.value)]}}class Lu{constructor(e){n(this,"unitCodec");this.unitCodec=e}convert(e){if(!(e instanceof Array))throw new p(typeof e,"Array");if(e.length!==2)throw new TypeError(`Expected array of length 2, got ${e.length}`);const[o,r]=e;return new B(new k(this.unitCodec.decode(o)),new x(this.unitCodec.decode(r)))}}class Cs extends c{constructor(o){super();n(this,"encoder");n(this,"decoder");this.encoder=new Mu(o),this.decoder=new Lu(o)}}const ys=new Cs(Ru),bs=new Cs(Tu),Ss=new q(new _(ys),new j(ys));new q(new _(bs),new j(bs));class Hu{convert(e){return[Number(e.lng),Number(e.lat)]}}class Vu{convert(e){if(!(e instanceof Array))throw new p(typeof e,"Array");if(e.length!==2)throw new TypeError(`Expected array of length 2, got ${e.length}`);return new B(new k(new O(e[1])),new x(new O(e[0])))}}class Wu extends c{constructor(){super(...arguments);n(this,"encoder",new Hu);n(this,"decoder",new Vu)}}const vt=new Wu,Be=new v(new b(vt),new S(vt)),Ee=new v(new b(Be),new S(Be)),vs=new v(new b(Ee),new S(Ee)),Fo="LineString";class Bs extends fe{constructor(o){super();n(this,"type",Fo);n(this,"coordinates");n(this,"bbox");this.coordinates=o,this.bbox=Cu(o)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return Es.encode(this)}}class Uu{constructor(e){n(this,"codec");this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates)}}}class Fu{constructor(e){n(this,"codec");this.codec=e}convert(e){i(e,"type","coordinates"),ie(e,Fo);const o=this.codec.decode(e.coordinates);return new Bs(o)}}class Ju extends c{constructor(){super(...arguments);n(this,"encoder",new Uu(Be));n(this,"decoder",new Fu(Be))}}const Es=new Ju;me(Fo,Es);const Jo="MultiLineString";class Gu extends fe{constructor(o){super();n(this,"type",Jo);n(this,"coordinates");n(this,"bbox");this.coordinates=o,this.bbox=qe(o)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return ks.encode(this)}}class Qu{constructor(e){n(this,"codec");this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates))}}}class zu{constructor(e){n(this,"codec");this.codec=e}convert(e){i(e,"type","coordinates"),ie(e,Jo);const o=this.codec.decode(e.coordinates);return new Gu(o.map(r=>new Bs(r)))}}class _u extends c{constructor(){super(...arguments);n(this,"encoder",new Qu(Ee));n(this,"decoder",new zu(Ee))}}const ks=new _u;me(Jo,ks);const Go="Point";class Bt extends fe{constructor(o){super();n(this,"type",Go);n(this,"coordinates");n(this,"bbox");this.coordinates=o,this.bbox=new Wo(this.coordinates,this.coordinates)}toJSON(){return xs.encode(this)}}class ju{constructor(e){n(this,"codec");this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates)}}}class qu{constructor(e){n(this,"codec");this.codec=e}convert(e){return i(e,"type","coordinates"),ie(e,Go),new Bt(this.codec.decode(e.coordinates))}}class $u extends c{constructor(){super(...arguments);n(this,"encoder",new ju(vt));n(this,"decoder",new qu(vt))}}const xs=new $u;me(Go,xs);const Qo="MultiPoint";class zo extends fe{constructor(o){super();n(this,"type",Qo);n(this,"coordinates");n(this,"bbox");this.coordinates=o,this.bbox=qe(o)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return Is.encode(this)}}class Yu{constructor(e){n(this,"codec");this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates))}}}class Xu{constructor(e){n(this,"codec");this.codec=e}convert(e){i(e,"type","coordinates"),ie(e,Qo);const o=this.codec.decode(e.coordinates);return new zo(o.map(r=>new Bt(r)))}}class Ku extends c{constructor(){super(...arguments);n(this,"encoder",new Yu(Be));n(this,"decoder",new Xu(Be))}}const Is=new Ku;me(Qo,Is);const _o="Polygon";class Ns extends fe{constructor(o){super();n(this,"type",_o);n(this,"coordinates");n(this,"bbox");this.coordinates=o,this.bbox=qe(o)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return Rs.encode(this)}}class Zu{constructor(e){n(this,"codec");this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates.map(r=>r.coordinates)))}}}class eh{constructor(e){n(this,"codec");this.codec=e}convert(e){i(e,"type","coordinates"),ie(e,_o);const o=this.codec.decode(e.coordinates);return new Ns(o.map(r=>new zo(r.map(s=>new Bt(s)))))}}class th extends c{constructor(){super(...arguments);n(this,"encoder",new Zu(Ee));n(this,"decoder",new eh(Ee))}}const Rs=new th;me(_o,Rs);const jo="MultiPolygon";class oh extends fe{constructor(o){super();n(this,"type",jo);n(this,"coordinates");n(this,"bbox");this.coordinates=o,this.bbox=qe(o)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return Ds.encode(this)}}class nh{constructor(e){n(this,"codec");this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates.map(r=>r.coordinates.map(s=>s.coordinates))))}}}class rh{constructor(e){n(this,"codec");this.codec=e}convert(e){i(e,"type","coordinates"),ie(e,jo);const o=this.codec.decode(e.coordinates);return new oh(o.map(r=>new Ns(r.map(s=>new zo(s.map(a=>new Bt(a)))))))}}class sh extends c{constructor(){super(...arguments);n(this,"encoder",new nh(vs));n(this,"decoder",new rh(vs))}}const Ds=new sh;me(jo,Ds);const zt=class zt{constructor(e,o,r,s){n(this,"inputMin");n(this,"inputMax");n(this,"outputMin");n(this,"outputMax");n(this,"inputRangeInv");n(this,"outputRange");this.inputMin=e,this.inputMax=o,this.outputMin=r,this.outputMax=s,this.inputRangeInv=1/(this.inputMax-this.inputMin),this.outputRange=this.outputMax-this.outputMin}transform(e){return(e-this.inputMin)*this.inputRangeInv*this.outputRange+this.outputMin}};n(zt,"identity",new zt(0,1,0,1));let ke=zt;class G extends je{toString(){return`${Number(this)} dp`}}class ch{constructor(e,o,r,s){n(this,"minInput");n(this,"maxInput");n(this,"minOutput");n(this,"maxOutput");n(this,"horizontalAffine");n(this,"inverseHorizontalAffine");n(this,"verticalAffine");n(this,"inverseVerticalAffine");this.minInput=e,this.maxInput=o,this.minOutput=r,this.maxOutput=s,this.horizontalAffine=new ke(Number(e.lat),Number(o.lat),Number(r.lat),Number(s.lat)),this.inverseHorizontalAffine=new ke(Number(r.lat),Number(s.lat),Number(e.lat),Number(o.lat)),this.verticalAffine=new ke(Number(e.lng),Number(o.lng),Number(r.lng),Number(s.lng)),this.inverseVerticalAffine=new ke(Number(r.lng),Number(s.lng),Number(e.lng),Number(o.lng))}project(e){return new B(new k(new G(this.horizontalAffine.transform(Number(e.lat)))),new x(new G(this.verticalAffine.transform(Number(e.lng)))))}inverseProject(e){const o=new J(this.inverseHorizontalAffine.transform(Number(e.lat))),r=new J(this.inverseVerticalAffine.transform(Number(e.lng)));return new B(new k(o),new x(r))}}class ah{constructor(){n(this,"minInput",new B(new k(new O(-90)),new x(new O(-180))));n(this,"maxInput",new B(new k(new O(90)),new x(new O(180))));n(this,"minOutput",new B(new k(new J(-Math.PI/2)),new x(new J(-Math.PI))));n(this,"maxOutput",new B(new k(new J(Math.PI/2)),new x(new J(Math.PI))))}projectLatitude(e){return new k(this.convertDegreesToRadians(e))}convertDegreesToRadians(e){return new J(Number(e)*(Math.PI/180))}convertRadiansToDegrees(e){return new O(Number(e)*(180/Math.PI))}projectLongitude(e){return new x(this.convertDegreesToRadians(e))}inverseProjectLatitude(e){return new k(this.convertRadiansToDegrees(e))}inverseProjectLongitude(e){return new x(this.convertRadiansToDegrees(e))}project(e){return new B(this.projectLatitude(e.lat),this.projectLongitude(e.lng))}inverseProject(e){return new B(this.inverseProjectLatitude(e.lat),this.inverseProjectLongitude(e.lng))}}const Ps=new ah,Os=85.05133,E=class E{constructor(){n(this,"minInput",E.min);n(this,"maxInput",E.max);n(this,"minOutput",E.minProjection);n(this,"maxOutput",E.maxProjection)}static projectLongitude(e){return new x(Number(e))}static ensureLatitudeBounds(e){return St(e,E.max.lat)?E.max.lat:Vo(e,E.min.lat)?E.min.lat:e}static projectLatitude(e){return new k(Math.log(Math.tan(Math.PI/4+Number(this.ensureLatitudeBounds(e))/2)))}static inverseProjectLongitude(e){return new x(new J(Number(e)))}static inverseProjectLatitude(e){return new k(new J(2*Math.atan(Math.exp(Number(e)))-Math.PI/2))}static staticProject(e){return new B(this.projectLatitude(e.lat),this.projectLongitude(e.lng))}project(e){return E.staticProject(e)}static staticInverseProject(e){return new B(this.inverseProjectLatitude(e.lat),this.inverseProjectLongitude(e.lng))}inverseProject(e){return E.staticInverseProject(e)}};n(E,"min",Ps.project(new B(new k(new O(-Os)),new x(new O(-180))))),n(E,"max",Ps.project(new B(new k(new O(Os)),new x(new O(180))))),n(E,"minProjection",E.staticProject(E.min)),n(E,"maxProjection",E.staticProject(E.max));let Et=E;const ih="AwABAQEcDQABDA0AAQYNAAEEDgABgAwAAQINAAEWAWEMAAF6AfgMAAH/AfIMAAH/AfwMAAH/AfgMAAH/AeAMAAF/AdAMAAF/AfAMAAF/AeAMAAF/AeAMAAE/AfAMAAEfAfAMAAEfAfwMAAE/AfwMAAF/Af4MAAF/Af8BgAsAAT8B/wHgCgABHwE/Av8BgAkAAZ8BPwL/AeAIAAEDAUwBPwL/AfAIAAEDAU8B3wL/AfgIAAEFAUMBzwL/AfoIAAEMAWMB7wL/Af0IAAEBAaMB7wP/CQABZwHPA/8BgAcAATgBoAHvA/8B4AcAARwBQAFvA/8B4AcAAYQB7gEPA/8B8AcAAQwBDgEvAv8B/gEwBgABAwGBAS8BzwHvAf8B/AEQBgABAwH4AYwBfwGDAf8B/AEYBgABCAHyAeMBHwEDAf8B/AE4BgABHgF9AS8BhgEBAf8B/AEIBgABKwHXAWwBvQGBAf8B/AEOBgABHgH/AW8B+QEBAf8B/gcAAe4B/wEHAYABQAE/AfABAAEYBQABfwH8AQcBwQHpAf8B8AHBAT4FAAH/AdgBAwHgAX8B/wHAAQMB/wGAAQABoAIAAf8BwAEBAfcBPwH/AQABAwH/AcABHQH8AgAB/gEIAQABfwGfAfYBAAEjAf8BxwH/AfgCAAH+AR8BgAFfAUcB7AEAAQMD/wHkAgABfQGfAYABDQGPAf4BAAEDAv8B/gMAATEB/wEAAQQBDwHkAQABAwL/AfgDAAEPAf8BgAEAAQEB4AEAAQEC/wHwAwABFwH/AYABAAEBAdACAAL/AfADAAEfAf8B8AIAAZACAAL/AcADAAEHAf8B/gFMBAAC/wHAAwABDwL/AV8EAAF/Af8BgAMAAT8D/wHAAwABHwH+BAABfwP/AeADAAEfAfgEAAFfA/8B8AMAAQ8B8AQABP8BgAMAAQ8B8AQAAX8C/wH8BAABDwHAAwABAwP/AfwEAAEGBAABAwF/Av8B+AkAAQMD/wHgCQABAwHvAv8B8AkAAQEC/wH+AeAKAAFnAf8B+wFACgABXwH+AbgBgAoAAQ8BogFQAQMKAAEGAQABIAEDCgABDgIAAQMDAAH8BgABDAUAAQEB/wwAAQMB/woAAQEBgQHPAf8BgAkAAQYBAQL/AYAJAAEFAdEB3wH/AYAKAALfAf8LAAI/Af8LAAF+AT8B/woAAXgB/gE/Af8BgAkAAXsB/QG/Af8BgAYAAWABAAEBAfkB/gEPAf8B+AYAATwBAAEXAf4B/QEPAv8B8AUAAXsBAAEfAfwB/gHHAv8B/gUAAZgBAAE/AZQB/gEHA/8BwAQAAZgBAAE/AQMB/wGPA/8BwAQAAeQBAAF8AesB/wFHA/8BwAQAAcABAAF/Ae8B/wFHA/8BwAYAAX8B7wH+AccD/wGABgABPwH/AfgBxwP/BwABPwH/Af0B5QL/AfwHAAE8Af8B+AHOAX8B/wHgBwABHQH/AfwB/wEfAf8BwAcAAQ8B/wH+Af8BzwHxAYAHAAEHA/8B9wHgCAABFwP/AfsBwAF8BQABgAEAAQcB/wH5Af8B+wGAAXgEAAEDAYABAAEvAf8B+AE8AfoBAAGABgABAQEfAf8B+wE+AfAIAAEPAY8C/wH+AfAGAAEGAQABOAGfA/8BYAYAAQEBAAFgAV8D/wkAAcABPwP/BwABAgEAAYABPwP/CAABAQGAAV8D/wkAAQME/wGACAABAwH7A/8BwAgAAQUBbwP/AfgIAAEBAd8D/wH+CAABBwT/Af4IAAEFBP8B8QgAAQcE/wHgCAABDwT/AcAIAAE/BP8BgAgAAX8E/wGABgABAwGAAX8E/wHABgABAwFgBf8B8AGABgABcAF/BP8B+AFABgABCAX/AfgBoAYAARsF/wH8AVgGAAEDBf8B/gEcBwAF/wHMAQQHAAHvBP8B4AEwBwABfwT/AcABcAcAAQcE/wGAAXABDwYAAQcE/wGAAeABHwHABQABAwP/Ab4BAAEYAR8BwAUAAQMD/wGAAQEBKAE/AcAFAAEPA/8BgAEFARIBfwGABQABBwP/AeACAAF/AYAGAAP/AwABfwGABgAC/wH+ARABAAEQAf8BgAYAAv8B/gMAAf8BgAYAAf8B/gH8ATABAAEIAf8BwAUAAWIB/wH8AfABIAEAAQwBPwHgBQABawH/AfABAgGAAQABDgH/AfAFAAFDAf8B8AECAgABDAF/AfAFAAEBAf8B8AMAAQQBHwH2BQABIQH/AfADAAECAQ8B8AYAAf8B8AQAAQcBwAYAAf8B8AwAAf8B4wGACwAB/wHHAYALAAE/Ae8DAAECCAABPwGQDAABPwHgDAABfwHgBQABAQYAAV8B4AUAAQMGAAE/AcAFAAEGBgABPwHABQABHAYAAT4BgAgA";function dh(t){const e=new DataView(t),o=new Array(t.byteLength*8),r=t.byteLength;for(let s=0;s<r;s++){const a=e.getUint8(s);for(let l=0;l<8;l++){const u=7-l,m=s;o[m*8+l]=!!(a&1<<u)}}return o}function lh(t){const e=new DataView(t),o=t.byteLength;let r=0;for(let l=0;l<o;l+=2)r+=e.getUint8(l);const s=new ArrayBuffer(r),a=new DataView(s);for(let l=0,u=0;l<o;l+=2){const m=e.getUint8(l),w=e.getUint8(l+1);for(let I=0;I<m;I++)a.setUint8(u++,w)}return s}const kt=new G(12*7*16),uh=new G(Math.floor(Number(kt)*.75)),$e=new G(9),hh=kt,wh=kt;new ch(Et.minProjection,Et.maxProjection,new B(new k(wh),new x(new G(0))),new B(new k(new G(0)),new x(hh)));const ph=kt,fh=uh,Ts=new G(Math.floor(Number($e)/2)),mh=Math.floor(Number(ph)/Number($e)),Ah=Math.floor(Number(fh)/Number($e)),gh=Array.from($(Pr(Ah),t=>new k(new G(t*Number($e)+Number(Ts))))),Ch=Array.from($(Pr(mh),t=>new x(new G(t*Number($e)+Number(Ts))))),Ms=Array.from(Dr(Ch,t=>$(gh,e=>new B(e,t))));Math.ceil(Ms.length/8);const yh=Io.decodeString(ih),bh=lh(yh),Sh=dh(bh),vh=Tr(Ms,Sh,(t,e)=>[t,e]),Bh=Ro(vh,([,t])=>t),Eh=$(Bh,([t])=>t);Array.from(Eh);class qo{constructor(e,o){n(this,"width");n(this,"index");this.width=e,this.index=o}toJSON(){return $o.encode(this)}}class kh{convert(e){return i(e,"width","index"),new qo(d.decode(e.width),d.decode(e.index))}}class xh{convert(e){return f(e,qo),{width:d.encode(e.width),index:d.encode(e.index)}}}class Ih extends c{constructor(){super(...arguments);n(this,"encoder",new xh);n(this,"decoder",new kh)}}const $o=new Ih;class xe{static get lsb0(){return Rh}static get msb0(){return Ph}valueOf(){return this.toString()}toJSON(){return this.toString()}}const Ls="bitvec::order::Lsb0",Hs="bitvec::order::Msb0";class Nh extends xe{toString(){return Ls}}const Rh=new Nh;class Dh extends xe{toString(){return Hs}}const Ph=new Dh;class Oh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");switch(e){case Ls:return xe.lsb0;case Hs:return xe.msb0;default:throw new p(e,"CappuccinoAPIBitVecOrder")}}}class Th{convert(e){return e.toString()}}class Mh extends c{constructor(){super(...arguments);n(this,"encoder",new Th);n(this,"decoder",new Oh)}}const Vs=new Mh;class Yo{constructor(e,o,r,s){n(this,"order");n(this,"head");n(this,"bits");n(this,"data");this.order=e,this.head=o,this.bits=r,this.data=s}getBitVecIndexIterable(){return this.order===xe.lsb0?new Fh(this.head.width,this.bits):new Gh(this.head.width,this.bits)}[Symbol.iterator](){const e=this.getBitVecIndexIterable();return $(e,o=>Wh(this.data,o))[Symbol.iterator]()}toJSON(){return Ae.encode(this)}}class Lh{convert(e){return i(e,"order","head","bits","data"),new Yo(Vs.decode(e.order),$o.decode(e.head),d.decode(e.bits),de.decode(e.data))}}class Hh{convert(e){return f(e,Yo),{order:Vs.encode(e.order),head:$o.encode(e.head),bits:d.encode(e.bits),data:de.encode(e.data)}}}class Vh extends c{constructor(){super(...arguments);n(this,"encoder",new Hh);n(this,"decoder",new Lh)}}const Ae=new Vh,Ws=new v(new b(Ae),new S(Ae));function Wh(t,e){return(t[e.bucket]>>e.bitOffset&1)===1}class Us{constructor(e,o){n(this,"bucket");n(this,"bitOffset");this.bucket=e,this.bitOffset=o}}function Fs(t){switch(N(t===8||t===16||t===32,"bit width should be a power of two that is supported"),t){case 8:return 3;case 16:return 4;case 32:return 5;default:throw new D}}class Uh{constructor(e,o){n(this,"totalBits");n(this,"bitWidthMask");n(this,"bitWidthShift");n(this,"offset",0);this.totalBits=o;const r=Fs(e);this.bitWidthMask=e-1,this.bitWidthShift=r}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,o=this.offset&this.bitWidthMask;return this.offset+=1,{done:!1,value:new Us(e,o)}}}class Fh{constructor(e,o){n(this,"bitWidth");n(this,"totalBits");this.bitWidth=e,this.totalBits=o}[Symbol.iterator](){return new Uh(this.bitWidth,this.totalBits)}}class Jh{constructor(e,o){n(this,"bitWidth");n(this,"totalBits");n(this,"bitWidthMask");n(this,"bitWidthShift");n(this,"offset",0);this.bitWidth=e,this.totalBits=o;const r=Fs(e);this.bitWidthMask=e-1,this.bitWidthShift=r}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,o=this.bitWidth-1-(this.offset&this.bitWidthMask);return this.offset+=1,{done:!1,value:new Us(e,o)}}}class Gh{constructor(e,o){n(this,"bitWidth");n(this,"totalBits");this.bitWidth=e,this.totalBits=o}[Symbol.iterator](){return new Jh(this.bitWidth,this.totalBits)}}class Js{constructor(e,o,r){n(this,"r");n(this,"s");n(this,"v");this.r=e,this.s=o,this.v=r}toJSON(){return Xo.encode(this)}}class Qh{convert(e){return i(e,"r","s","v"),new Js(P.decode(e.r),P.decode(e.s),d.decode(e.v))}}class zh{convert(e){return f(e,Js),{r:P.encode(e.r),s:P.encode(e.s),v:d.encode(e.v)}}}class _h extends c{constructor(){super(...arguments);n(this,"encoder",new zh);n(this,"decoder",new Qh)}}const Xo=new _h;class Gs{constructor(e,o){n(this,"account");n(this,"amount");this.account=e,this.amount=o}toJSON(){return Ko.encode(this)}}class jh{convert(e){return i(e,"account","amount"),new Gs(P.decode(e.account),P.decode(e.amount))}}class qh{convert(e){return f(e,Gs),{account:P.encode(e.account),amount:P.encode(e.amount)}}}class $h extends c{constructor(){super(...arguments);n(this,"encoder",new qh);n(this,"decoder",new jh)}}const Ko=new $h;class Qs{constructor(e,o,r){n(this,"number");n(this,"timestamp");n(this,"hash");this.number=e,this.timestamp=o,this.hash=r}toJSON(){return Zo.encode(this)}}class Yh{convert(e){return i(e,"number","timestamp","hash"),new Qs(d.decode(e.number),h.decode(e.timestamp),h.decode(e.hash))}}class Xh{convert(e){return f(e,Qs),{number:d.encode(e.number),timestamp:h.encode(e.timestamp),hash:h.encode(e.hash)}}}class Kh extends c{constructor(){super(...arguments);n(this,"encoder",new Xh);n(this,"decoder",new Yh)}}const Zo=new Kh,zs=new q(new _(Zo),new j(Zo));class _s{constructor(e){n(this,"bytes");this.bytes=e}toJSON(){return en.encode(this)}}class Zh{convert(e){return i(e,"bytes"),new _s(Vr.decode(e.bytes))}}class ew{convert(e){return f(e,_s),{bytes:Vr.encode(e.bytes)}}}class tw extends c{constructor(){super(...arguments);n(this,"encoder",new ew);n(this,"decoder",new Zh)}}const en=new tw;class js{constructor(e,o,r,s,a,l,u,m,w,I){n(this,"height");n(this,"timestamp");n(this,"l1_head");n(this,"l1_finalized");n(this,"payload_commitment");n(this,"ns_table");n(this,"block_merkle_root");n(this,"fee_merkle_root");n(this,"builder_signature");n(this,"fee_info");this.height=e,this.timestamp=o,this.l1_head=r,this.l1_finalized=s,this.payload_commitment=a,this.ns_table=l,this.block_merkle_root=u,this.fee_merkle_root=m,this.builder_signature=w,this.fee_info=I}toJSON(){return Ye.encode(this)}}class ow{convert(e){return i(e,"height","timestamp","l1_head","l1_finalized","payload_commitment","ns_table","block_merkle_root","fee_merkle_root","builder_signature","fee_info"),new js(d.decode(e.height),d.decode(e.timestamp),d.decode(e.l1_head),zs.decode(e.l1_finalized),de.decode(e.payload_commitment),en.decode(e.ns_table),A.decode(e.block_merkle_root),A.decode(e.fee_merkle_root),Xo.decode(e.builder_signature),Ko.decode(e.fee_info))}}class nw{convert(e){return f(e,js),{height:d.encode(e.height),timestamp:d.encode(e.timestamp),l1_head:d.encode(e.l1_head),l1_finalized:zs.encode(e.l1_finalized),payload_commitment:de.encode(e.payload_commitment),ns_table:en.encode(e.ns_table),block_merkle_root:A.encode(e.block_merkle_root),fee_merkle_root:A.encode(e.fee_merkle_root),builder_signature:Xo.encode(e.builder_signature),fee_info:Ko.encode(e.fee_info)}}}class rw extends c{constructor(){super(...arguments);n(this,"encoder",new nw);n(this,"decoder",new ow)}}const Ye=new rw;class qs{constructor(e,o){n(this,"vm");n(this,"payload");this.vm=e,this.payload=o}toJSON(){return Xe.encode(this)}}class sw{convert(e){return i(e,"vm","payload"),new qs(d.decode(e.vm),de.decode(e.payload))}}class cw{convert(e){return f(e,qs),{vm:d.encode(e.vm),payload:de.encode(e.payload)}}}class aw extends c{constructor(){super(...arguments);n(this,"encoder",new cw);n(this,"decoder",new sw)}}const Xe=new aw;new v(new b(Xe),new S(Xe));class $s{constructor(e,o,r,s,a){n(this,"header");n(this,"hash");n(this,"size");n(this,"num_transactions");n(this,"proposer_id");this.header=e,this.hash=o,this.size=r,this.num_transactions=s,this.proposer_id=a}toJSON(){return tn.encode(this)}}class iw{convert(e){return i(e,"header","hash","size","num_transactions","proposer_id"),new $s(Ye.decode(e.header),A.decode(e.hash),d.decode(e.size),d.decode(e.num_transactions),ne.decode(e.proposer_id))}}class dw{convert(e){return f(e,$s),{header:Ye.encode(e.header),hash:A.encode(e.hash),size:d.encode(e.size),num_transactions:d.encode(e.num_transactions),proposer_id:ne.encode(e.proposer_id)}}}class lw extends c{constructor(){super(...arguments);n(this,"encoder",new dw);n(this,"decoder",new iw)}}const tn=new lw;new v(new b(tn),new S(tn));class Ys{constructor(e,o,r,s){n(this,"hash");n(this,"header");n(this,"offset");n(this,"transaction");this.hash=e,this.header=o,this.offset=r,this.transaction=s}toJSON(){return on.encode(this)}}class uw{convert(e){return i(e,"hash","header","offset","transaction"),new Ys(A.decode(e.hash),Ye.decode(e.header),d.decode(e.offset),Xe.decode(e.transaction))}}class hw{convert(e){return f(e,Ys),{hash:A.encode(e.hash),header:Ye.encode(e.header),offset:d.encode(e.offset),transaction:Xe.encode(e.transaction)}}}class ww extends c{constructor(){super(...arguments);n(this,"encoder",new hw);n(this,"decoder",new uw)}}const on=new ww;new v(new b(on),new S(on));class Xs{constructor(e,o){n(this,"signature");n(this,"bitvec");this.signature=e,this.bitvec=o}toJSON(){return nn.encode(this)}}class pw{convert(e){if(!qn(e)||e.length!==2)throw new p(typeof e,"Array");return new Xs(A.decode(e[0]),Ae.decode(e[1]))}}class fw{convert(e){return f(e,Xs),[A.encode(e.signature),Ae.encode(e.bitvec)]}}class mw extends c{constructor(){super(...arguments);n(this,"encoder",new fw);n(this,"decoder",new pw)}}const nn=new mw;new q(new _(nn),new j(nn));class Ke{}class rn extends Ke{toJSON(){return sn.encode(this)}}class Aw{convert(e){if(!Z(e)||e!=="Empty")throw new te;return new rn}}class gw{convert(e){return f(e,rn),"Empty"}}class Cw extends c{constructor(){super(...arguments);n(this,"encoder",new gw);n(this,"decoder",new Aw)}}const sn=new Cw;class cn extends Ke{constructor(o,r,s){super();n(this,"value");n(this,"pos");n(this,"elem");this.value=o,this.pos=r,this.elem=s}toJSON(){return an.encode(this)}}class yw{convert(e){i(e,"Leaf");const o=e.Leaf;return i(o,"value","pos","elem"),new cn(A.decode(o.value),A.decode(o.pos),A.decode(o.elem))}}class bw{convert(e){return f(e,cn),{Leaf:{value:A.encode(e.value),pos:A.encode(e.pos),elem:A.encode(e.elem)}}}}class Sw extends ae{constructor(){super(...arguments);n(this,"encoder",new bw);n(this,"decoder",new yw)}}const an=new Sw;class dn extends Ke{constructor(o){super();n(this,"value");this.value=o}toJSON(){return ln.encode(this)}}class vw{convert(e){i(e,"ForgettenSubtree");const o=e.ForgettenSubtree;return i(o,"value"),new dn(A.decode(o.value))}}class Bw{convert(e){return f(e,dn),{ForgettenSubtree:{value:A.encode(e.value)}}}}class Ew extends ae{constructor(){super(...arguments);n(this,"encoder",new Bw);n(this,"decoder",new vw)}}const ln=new Ew;class un extends Ke{constructor(o,r){super();n(this,"value");n(this,"children");this.value=o,this.children=r}toJSON(){return hn.encode(this)}}class kw{convert(e){i(e,"Branch");const o=e.Branch;return i(o,"value","children"),new un(A.decode(o.value),Zs.decode(o.children))}}class xw{convert(e){return f(e,un),{Branch:{value:A.encode(e.value),children:Zs.encode(e.children)}}}}class Iw extends c{constructor(){super(...arguments);n(this,"encoder",new xw);n(this,"decoder",new kw)}}const hn=new Iw;class Nw{convert(e){if(qt(e,"Leaf",st))return an.decoder.convert(e);if(qt(e,"Branch",st))return hn.decoder.convert(e);if(qt(e,"ForgettenSubtree",st))return ln.decoder.convert(e);if(Z(e))return sn.decoder.convert(e);throw new te}}class Rw{convert(e){if(f(e,Ke),e instanceof cn)return an.encode(e);if(e instanceof un)return hn.encode(e);if(e instanceof dn)return ln.encode(e);if(e instanceof rn)return sn.encode(e);throw new te}}class Dw extends c{constructor(){super(...arguments);n(this,"encoder",new Rw);n(this,"decoder",new Nw)}}const Ks=new Dw,Zs=new v(new b(Ks),new S(Ks));class wn{constructor(e,o,r,s,a,l,u,m){n(this,"hash");n(this,"height");n(this,"time");n(this,"numTransactions");n(this,"proposerID");n(this,"feeRecipient");n(this,"size");n(this,"blockReward");this.hash=e,this.height=o,this.time=r,this.numTransactions=s,this.proposerID=a,this.feeRecipient=l,this.size=u,this.blockReward=m}toJSON(){return Ze.encode(this)}}class Pw{convert(e){return i(e,"hash","height","time","num_transactions","proposer_id","fee_recipient","size","block_reward"),new wn(A.decode(e.hash),d.decode(e.height),ve.decode(e.time),d.decode(e.num_transactions),ne.decode(e.proposer_id),ne.decode(e.fee_recipient),d.decode(e.size),ns.decode(e.block_reward))}}class Ow{convert(e){return f(e,wn),{hash:A.encode(e.hash),height:d.encode(e.height),time:ve.encode(e.time),num_transactions:d.encode(e.numTransactions),proposer_id:ne.encode(e.proposerID),fee_recipient:ne.encode(e.feeRecipient),size:d.encode(e.size),block_reward:ns.encode(e.blockReward)}}}class Tw extends ae{constructor(){super(...arguments);n(this,"encoder",new Ow);n(this,"decoder",new Pw)}}const Ze=new Tw,ec=new v(new b(Ze),new S(Ze));class tc{constructor(e,o,r,s,a,l){n(this,"hash");n(this,"height");n(this,"proposerID");n(this,"numTransactions");n(this,"size");n(this,"time");this.hash=e,this.height=o,this.proposerID=r,this.numTransactions=s,this.size=a,this.time=l}toJSON(){return pn.encode(this)}}class Mw{convert(e){return i(e,"hash","height","proposer_id","num_transactions","size","time"),new tc(A.decode(e.hash),d.decode(e.height),ne.decode(e.proposer_id),d.decode(e.num_transactions),d.decode(e.size),ve.decode(e.time))}}class Lw{convert(e){return f(e,tc),{hash:A.encode(e.hash),height:d.encode(e.height),proposer_id:ne.encode(e.proposerID),num_transactions:d.encode(e.numTransactions),size:d.encode(e.size),time:ve.encode(e.time)}}}class Hw extends ae{constructor(){super(...arguments);n(this,"encoder",new Lw);n(this,"decoder",new Mw)}}const pn=new Hw;new v(new b(pn),new S(pn));function Vw(t,e){return t.blockHeights-e.blockHeights}class xt{constructor(e,o,r,s){n(this,"blockTime");n(this,"blockSize");n(this,"blockTransactions");n(this,"blockHeights");const a=[],l=Math.min(e.length,o.length,r.length,s.length);for(let T=0;T<l;T++){const R=s[T];R!==null&&a.push({blockTime:e[T],blockSize:o[T],blockTransactions:r[T],blockHeights:R})}a.sort(Vw);const u=a[0].blockHeights,m=a[a.length-1].blockHeights,w=[],I=[],H=[],se=[];for(let T=u,R=0;T<=m;T++){const Q=a[R];if(Q.blockHeights!==T){w.push(null),I.push(null),H.push(null),se.push(null);continue}w.push(Q.blockTime),I.push(Q.blockSize),H.push(Q.blockTransactions),se.push(Q.blockHeights),R++}const K=Math.max(0,se.length-50);this.blockTime=w.slice(K),this.blockSize=I.slice(K),this.blockTransactions=H.slice(K),this.blockHeights=se.slice(K)}toJSON(){return fn.encode(this)}}class Ww{convert(e){return i(e,"block_time","block_size","block_transactions","block_heights"),new xt(ee.decode(e.block_time),ee.decode(e.block_size),ee.decode(e.block_transactions),ee.decode(e.block_heights))}}class Uw{convert(e){return f(e,xt),{block_time:ee.encode(e.blockTime),block_size:ee.encode(e.blockSize),block_transactions:ee.encode(e.blockTransactions),block_heights:ee.encode(e.blockHeights)}}}class Fw extends c{constructor(){super(...arguments);n(this,"encoder",new Uw);n(this,"decoder",new Ww)}}const fn=new Fw,oc=de;class nc{constructor(e,o,r,s,a,l){n(this,"hash");n(this,"rollups");n(this,"height");n(this,"time");n(this,"offset");n(this,"numTransactions");this.hash=e,this.rollups=o,this.height=r,this.time=s,this.offset=a,this.numTransactions=l}toJSON(){return mn.encode(this)}}class Jw{convert(e){return i(e,"hash","rollups","height","time","offset","num_transactions"),new nc(A.decode(e.hash),oc.decode(e.rollups),d.decode(e.height),ve.decode(e.time),d.decode(e.offset),d.decode(e.num_transactions))}}class Gw{convert(e){return f(e,nc),{hash:A.encode(e.hash),rollups:oc.encode(e.rollups),height:d.encode(e.height),time:ve.encode(e.time),offset:d.encode(e.offset),num_transactions:d.encode(e.numTransactions)}}}class Qw extends c{constructor(){super(...arguments);n(this,"encoder",new Gw);n(this,"decoder",new Jw)}}const mn=new Qw;new v(new b(mn),new S(mn));const rc=d;class sc{constructor(e,o){n(this,"namespace");n(this,"payload");this.namespace=e,this.payload=o}toJSON(){return An.encode(this)}}class zw{convert(e){return i(e,"namespace","payload"),new sc(rc.decode(e.namespace),Wr.decode(e.payload))}}class _w{convert(e){return f(e,sc),{namespace:rc.encode(e.namespace),payload:Wr.encode(e.payload)}}}class jw extends c{constructor(){super(...arguments);n(this,"encoder",new _w);n(this,"decoder",new zw)}}const An=new jw;new v(new b(An),new S(An));class cc{constructor(e,o){n(this,"coords");n(this,"country");this.coords=e,this.country=o}toJSON(){return gn.encode(this)}}class qw{convert(e){return{coords:Ss.encode(e.coords),country:L.encode(e.country)}}}class $w{convert(e){return i(e,"coords","country"),new cc(Ss.decode(e.coords),be(L.decode(e.country)))}}class Yw extends c{constructor(){super(...arguments);n(this,"encoder",new qw);n(this,"decoder",new $w)}}const gn=new Yw,ac=new q(new _(gn),new j(gn));class ic{constructor(e,o,r,s,a,l,u,m){n(this,"publicKey");n(this,"name");n(this,"publicURL");n(this,"company");n(this,"location");n(this,"operatingSystem");n(this,"nodeType");n(this,"networkType");this.publicKey=e,this.name=o,this.publicURL=r,this.company=s,this.location=a,this.operatingSystem=l,this.nodeType=u,this.networkType=m}toJSON(){return et.encode(this)}}class Xw{convert(e){return{public_key:A.encode(e.publicKey),name:L.encode(e.name),public_url:Fr.encode(e.publicURL),company:L.encode(e.company),location:ac.encode(e.location),operating_system:L.encode(e.operatingSystem),node_type:L.encode(e.nodeType),network_type:L.encode(e.networkType)}}}class Kw{convert(e){return i(e,"public_key","name","public_url","company","location","operating_system","node_type","network_type"),new ic(A.decode(e.public_key),be(L.decode(e.name)),Fr.decode(e.public_url),be(L.decode(e.company)),ac.decode(e.location),be(L.decode(e.operating_system)),be(L.decode(e.node_type)),be(L.decode(e.network_type)))}}class Zw extends c{constructor(){super(...arguments);n(this,"encoder",new Xw);n(this,"decoder",new Kw)}}const et=new Zw,dc=new v(new b(et),new S(et));class ge{}const lc="SubscribeNodeIdentity";class Cn extends ge{valueOf(){return lc}}const uc="SubscribeLatestBlock";class yn extends ge{valueOf(){return uc}}const hc="SubscribeVoters";class bn extends ge{valueOf(){return hc}}const wc="RequestNodeIdentitySnapshot";class Sn extends ge{valueOf(){return wc}}const pc="RequestBlocksSnapshot";class vn extends ge{valueOf(){return pc}}const fc="RequestHistogramSnapshot";class Bn extends ge{valueOf(){return fc}}const mc="RequestVotersSnapshot";class En extends ge{valueOf(){return mc}}class ep{convert(e){return e.valueOf()}}class tp{convert(e){if(typeof e!="string")throw new p(typeof e,"string");switch(e){case lc:return new Cn;case uc:return new yn;case hc:return new bn;case wc:return new Sn;case pc:return new vn;case fc:return new Bn;case mc:return new En;default:throw new p(e,"CappuccinoNodeValidatorRequest")}}}class op extends c{constructor(){super(...arguments);n(this,"encoder",new ep);n(this,"decoder",new tp)}}const kn=new op,tt="NodeValidatorRequest";class It extends Jr{constructor(o){super();n(this,"request");this.request=o}get type(){return tt}toJson(){return Ac.encode(this)}}class np{convert(e){return{[tt]:kn.encode(e.request)}}}class rp{convert(e){return i(e,tt),new It(kn.decode(e[tt]))}}class sp extends c{constructor(){super(...arguments);n(this,"encoder",new np);n(this,"decoder",new rp)}}const Ac=new sp;class Ce{}const Nt="BlocksSnapshot";class xn extends Ce{constructor(o){super();n(this,"blocks");this.blocks=o}toJSON(){return In.encode(this)}}class cp{convert(e){i(e,Nt);const o=e[Nt];return new xn(ec.decode(o))}}class ap{convert(e){return{[Nt]:ec.encode(e.blocks)}}}class ip extends c{constructor(){super(...arguments);n(this,"encoder",new ap);n(this,"decoder",new cp)}}const In=new ip,Rt="HistogramSnapshot";class Dt extends Ce{constructor(o){super();n(this,"histograms");this.histograms=o}toJSON(){return Nn.encode(this)}}class dp{convert(e){return i(e,Rt),new Dt(fn.decode(e[Rt]))}}class lp{convert(e){return{[Rt]:fn.encode(e.histograms)}}}class up extends c{constructor(){super(...arguments);n(this,"encoder",new lp);n(this,"decoder",new dp)}}const Nn=new up,Pt="LatestBlock";class Ot extends Ce{constructor(o){super();n(this,"latestBlock");this.latestBlock=o}toJSON(){return Rn.encode(this)}}class hp{convert(e){return i(e,Pt),new Ot(Ze.decode(e[Pt]))}}class wp{convert(e){return{[Pt]:Ze.encode(e.latestBlock)}}}class pp extends c{constructor(){super(...arguments);n(this,"encoder",new wp);n(this,"decoder",new hp)}}const Rn=new pp,Tt="LatestVoters";class Dn extends Ce{constructor(o){super();n(this,"latestVoter");this.latestVoter=o}toJSON(){return Pn.encode(this)}}class fp{convert(e){return i(e,Tt),new Dn(Ae.decode(e[Tt]))}}class mp{convert(e){return{[Tt]:Ae.encode(e.latestVoter)}}}class Ap extends c{constructor(){super(...arguments);n(this,"encoder",new mp);n(this,"decoder",new fp)}}const Pn=new Ap,Mt="NodeIdentitySnapshot";class Lt extends Ce{constructor(o){super();n(this,"nodes");this.nodes=o}toJSON(){return On.encode(this)}}class gp{convert(e){i(e,Mt);const o=e[Mt];return new Lt(dc.decode(o))}}class Cp{convert(e){return{[Mt]:dc.encode(e.nodes)}}}class yp extends c{constructor(){super(...arguments);n(this,"encoder",new Cp);n(this,"decoder",new gp)}}const On=new yp,Ht="LatestNodeIdentity";class gc extends Ce{constructor(o){super();n(this,"nodeIdentity");this.nodeIdentity=o}toJSON(){return Tn.encode(this)}}class bp{convert(e){return i(e,Ht),new gc(et.decode(e[Ht]))}}class Sp{convert(e){return{[Ht]:et.encode(e.nodeIdentity)}}}class vp extends c{constructor(){super(...arguments);n(this,"encoder",new Sp);n(this,"decoder",new bp)}}const Tn=new vp,Vt="VotersSnapshot";class Mn extends Ce{constructor(o){super();n(this,"voters");this.voters=o}toJSON(){return Ln.encode(this)}}class Bp{convert(e){i(e,Vt);const o=e[Vt];return new Mn(Ws.decode(o))}}class Ep{convert(e){return{[Vt]:Ws.encode(e.voters)}}}class kp extends c{constructor(){super(...arguments);n(this,"encoder",new Ep);n(this,"decoder",new Bp)}}const Ln=new kp;class xp{convert(e){if(W(e,Nt))return In.decode(e);if(W(e,Rt))return Nn.decode(e);if(W(e,Pt))return Rn.decode(e);if(W(e,Ht))return Tn.decode(e);if(W(e,Tt))return Pn.decode(e);if(W(e,Mt))return On.decode(e);if(W(e,Vt))return Ln.decode(e);throw new D}}class Ip{convert(e){if(e instanceof xn)return In.encode(e);if(e instanceof Dt)return Nn.encode(e);if(e instanceof Ot)return Rn.encode(e);if(e instanceof gc)return Tn.encode(e);if(e instanceof Dn)return Pn.encode(e);if(e instanceof Lt)return On.encode(e);if(e instanceof Mn)return Ln.encode(e);throw new D}}class Np extends c{constructor(){super(...arguments);n(this,"encoder",new Ip);n(this,"decoder",new xp)}}const Wt=new Np,ot="NodeValidatorResponse";class Cc extends mt{constructor(o){super();n(this,"response");this.response=o}get type(){return ot}toJson(){return yc.encode(this)}}class Rp{convert(e){return{[ot]:Wt.encode(e.response)}}}class Dp{convert(e){i(e,ot);const o=e[ot];return new Cc(Wt.decode(o))}}class Pp extends c{constructor(){super(...arguments);n(this,"encoder",new Rp);n(this,"decoder",new Dp)}}const yc=new Pp;class Op{convert(e){return new Cc(e)}}const bc=new Op;function Hn(t){return new wn(t.hash,t.height,t.time,t.numTransactions,t.proposer,t.proposer,t.size,t.fees)}function Sc(t){return new ic(t.pubkey,t.name,null,t.company.name,new cc(new B(new k(new O(t.location.coords[0])),new x(new O(t.location.coords[1]))),t.location.country),t.operatingSystem,t.nodeType,t.networkType)}class Tp{constructor(e,o){n(this,"responseStream");n(this,"requestStream");n(this,"lifecycleResponseSink");n(this,"nodeValidatorResponseSink");n(this,"prng",new pe(ru()));n(this,"latestBlock",Hn(ds()));n(this,"latestBlocks",le(50));n(this,"latestVoters",le(50));n(this,"histogramBlockTimeData",le(50));n(this,"histogramBlockSizeData",le(50));n(this,"histogramBlockTransactionData",le(50));n(this,"histogramBlockHeightData",le(50));n(this,"isConnected",!1);n(this,"isSubscribedToLatestBlock",!1);n(this,"isSubscribedToVoters",!1);this.requestStream=e,this.responseStream=o,this.lifecycleResponseSink=we(ue(o),Lo),this.nodeValidatorResponseSink=we(ue(o),bc)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}generateVotersFromBlockDetail(e){const o=new pe(e.time.valueOf()),r=_e.length,s=Math.ceil(r/16),a=new Uint16Array(o.fillBytes(s*2));return new Yo(xe.lsb0,new qo(16,0),r,Array.from(a))}async updateBlockDetails(e){const o=this.latestBlock,r=(e.time.valueOf()-o.time.valueOf())/1e3,s=this.generateVotersFromBlockDetail(e);this.latestBlock=e,this.latestBlocks.put(e),this.latestVoters.put(s),this.histogramBlockTimeData.put(r),this.histogramBlockSizeData.put(e.size),this.histogramBlockTransactionData.put(e.numTransactions),this.histogramBlockHeightData.put(e.height),this.isConnected&&(this.isSubscribedToLatestBlock&&await this.nodeValidatorResponseSink.send(new Ot(e)),this.isSubscribedToVoters&&this.nodeValidatorResponseSink.send(new Dn(s)))}async initializeState(){for await(const e of au(this.prng))this.updateBlockDetails(Hn(e));await this.nodeValidatorResponseSink.send(new Ot(this.latestBlock)),await this.nodeValidatorResponseSink.send(new Dt(new xt(Array.from(this.histogramBlockTimeData.immutableIterable()),Array.from(this.histogramBlockSizeData.immutableIterable()),Array.from(this.histogramBlockTransactionData.immutableIterable()),Array.from(this.histogramBlockHeightData.immutableIterable())))),this.nodeValidatorResponseSink.send(new Lt(_e.map(Sc)))}async startProcessing(){await this.initializeState(),this.handleRequests(),this.streamBlocks()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async streamBlocks(){const e=this.latestBlock;for await(const o of iu(this.prng,e.time.valueOf(),e.height)){const r=Hn(o);this.updateBlockDetails(r)}}async handleRequest(e){if(e instanceof ft){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof It){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unrecognized request type",e)}async handleWebSocketCommand(e){if(e instanceof Le){await this.handleConnect();return}if(e instanceof Te){await this.handleClose();return}}async handleNodeValidatorRequest(e){if(e instanceof yn){await this.handleSubscribeLatestBlock();return}if(e instanceof Cn){await this.handleSubscribeNodeIdentity();return}if(e instanceof bn){await this.handleSubscribeVoters();return}if(e instanceof vn){await this.handleRequestBlocksSnapshot();return}if(e instanceof Bn){await this.handleRequestHistogramSnapshot();return}if(e instanceof Sn){await this.handleRequestNodeIdentitySnapshot();return}if(e instanceof En){await this.handleRequestVotersSnapshot();return}}async handleConnect(){if(this.isConnected)throw new Error("already connected to WebSocket");this.isConnected=!0,await this.lifecycleResponseSink.send(new Je),await this.lifecycleResponseSink.send(new Qe)}async handleClose(){if(!this.isConnected)throw new Error("not connected to WebSocket");this.isConnected=!1,this.isSubscribedToLatestBlock=!1,this.isSubscribedToVoters=!1,await this.lifecycleResponseSink.send(new Ue)}async assertIsConnected(){if(!this.isConnected)throw new Error("not connected to WebSocket")}async handleSubscribeLatestBlock(){await this.assertIsConnected(),this.isSubscribedToLatestBlock=!0}async handleSubscribeNodeIdentity(){await this.assertIsConnected()}async handleSubscribeVoters(){await this.assertIsConnected(),this.isSubscribedToVoters=!0}async handleRequestBlocksSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new xn(Array.from(this.latestBlocks.immutableIterable())))}async handleRequestHistogramSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Dt(new xt(Array.from(this.histogramBlockTimeData.immutableIterable()),Array.from(this.histogramBlockSizeData.immutableIterable()),Array.from(this.histogramBlockTransactionData.immutableIterable()),Array.from(this.histogramBlockHeightData.immutableIterable()))))}async handleRequestNodeIdentitySnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Lt(_e.map(Sc)))}async handleRequestVotersSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Mn(Array.from(this.latestVoters.immutableIterable())))}}class Mp{constructor(e,o,r){n(this,"responseStream");n(this,"requestStream");n(this,"capturedHAR");n(this,"lifecycleResponseSink");n(this,"nodeValidatorResponseSink");this.requestStream=e,this.responseStream=o,this.capturedHAR=r,this.lifecycleResponseSink=we(ue(o),Lo),this.nodeValidatorResponseSink=we(ue(o),bc)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof ft){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof It){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unknown request type",e)}async handleWebSocketCommand(e){if(e instanceof Le){await this.handleConnect();return}if(e instanceof Te){await this.handleClose();return}}async handleNodeValidatorRequest(e){if(e instanceof yn){await this.handleSubscribeLatestBlock();return}if(e instanceof Cn){await this.handleSubscribeNodeIdentity();return}if(e instanceof bn){await this.handleSubscribeVoters();return}if(e instanceof vn){await this.handleRequestBlocksSnapshot();return}if(e instanceof Bn){await this.handleRequestHistogramSnapshot();return}if(e instanceof Sn){await this.handleRequestNodeIdentitySnapshot();return}if(e instanceof En){await this.handleRequestVotersSnapshot();return}}async handleConnect(){await this.lifecycleResponseSink.send(new Je),await this.lifecycleResponseSink.send(new Qe);const e=Dr(this.capturedHAR.log.entries,s=>"_webSocketMessages"in s?s._webSocketMessages:[]),o=Ro(e,s=>s.type==="receive");let r=0;for(const s of o){if(r>0){const a=s.time*1e3-r*1e3;await Kr(a)}r=s.time;try{const a=Wt.decode(JSON.parse(s.data));await this.nodeValidatorResponseSink.send(a)}catch{console.error(`Failed to decode message: ${s.data}`);continue}}await this.lifecycleResponseSink.send(new Ue)}async handleClose(){}async handleSubscribeLatestBlock(){}async handleSubscribeNodeIdentity(){}async handleSubscribeVoters(){}async handleRequestBlocksSnapshot(){}async handleRequestHistogramSnapshot(){}async handleRequestNodeIdentitySnapshot(){}async handleRequestVotersSnapshot(){}}const Vn="WebSocketError";class Ut extends y{constructor(o,r=`websocket error: ${String(o)}`){super(r);n(this,"cause");this.cause=o,Object.freeze(this)}get code(){return Vn}}class Lp{convert(e){return i(e,"code","message"),g(e,Vn),new Ut({},h.decode(e.message))}}class Hp extends M{}class Vp extends c{constructor(){super(...arguments);n(this,"encoder",new Hp);n(this,"decoder",new Lp)}}const Wp=new Vp;C(Vn,Wp);class Up{constructor(e,o){n(this,"block");n(this,"offset");this.block=e,this.offset=o,Object.freeze(this)}toJSON(){return Wn.encode(this)}}class Fp{convert(e){return{block:d.encode(e.block),offset:d.encode(e.offset)}}}class Jp{convert(e){return i(e,"block","offset"),new Up(d.decode(e.block),d.decode(e.offset))}}class Gp extends c{constructor(){super(...arguments);n(this,"encoder",new Fp);n(this,"decoder",new Jp)}}const Wn=new Gp;class Qp{constructor(e){n(this,"address");this.address=e,Object.freeze(this)}toJSON(){return Un.encode(this)}}class zp{convert(e){return P.encode(e.address)}}class _p{convert(e){return new Qp(P.decode(e))}}class jp extends c{constructor(){super(...arguments);n(this,"encoder",new zp);n(this,"decoder",new _p)}}const Un=new jp;class qp{constructor(e,o,r){n(this,"address");n(this,"time");n(this,"message");this.address=e,this.time=o,this.message=r,Object.freeze(this)}toJSON(){return nt.encode(this)}}class $p{convert(e){return{address:Un.encode(e.address),time:d.encode(Math.floor(e.time.valueOf()/1e3)),message:h.encode(e.message)}}}class Yp{convert(e){return i(e,"address","time","message"),new qp(Un.decode(e.address),new Date(d.decode(e.time)*1e3),h.decode(e.message))}}class Xp extends c{constructor(){super(...arguments);n(this,"encoder",new $p);n(this,"decoder",new Yp)}}const nt=new Xp;new v(new b(nt),new S(nt));class Kp{constructor(e,o){n(this,"inscription");n(this,"chainDetails");this.inscription=e,this.chainDetails=o,Object.freeze(this)}toJSON(){return rt.encode(this)}}class Zp{convert(e){return{inscription:nt.encode(e.inscription),chain_details:Wn.encode(e.chainDetails)}}}class ef{convert(e){return i(e,"inscription","chain_details"),new Kp(nt.decode(e.inscription),Wn.decode(e.chain_details))}}class tf extends c{constructor(){super(...arguments);n(this,"encoder",new Zp);n(this,"decoder",new ef)}}const rt=new tf,vc=new v(new b(rt),new S(rt));class Fn{}const Ft="LatestInscription";class Bc extends Fn{constructor(o){super();n(this,"inscriptionAndChainDetails");this.inscriptionAndChainDetails=o}toJSON(){return Jn.encode(this)}}class of{convert(e){i(e,Ft);const o=e[Ft];return new Bc(rt.decode(o))}}class nf{convert(e){return{[Ft]:rt.encode(e.inscriptionAndChainDetails)}}}class rf extends c{constructor(){super(...arguments);n(this,"encoder",new nf);n(this,"decoder",new of)}}const Jn=new rf,Jt="RetrievedInscriptionsForWalletAddress";class Ec extends Fn{constructor(o){super();n(this,"inscriptionAndChainDetails");this.inscriptionAndChainDetails=o}toJSON(){return Gn.encode(this)}}class sf{convert(e){i(e,Jt);const o=e[Jt];return new Ec(vc.decode(o))}}class cf{convert(e){return{[Jt]:vc.encode(e.inscriptionAndChainDetails)}}}class af extends c{constructor(){super(...arguments);n(this,"encoder",new cf);n(this,"decoder",new sf)}}const Gn=new af;class df{constructor(e,o,r){n(this,"numBlocks");n(this,"numTransactions");n(this,"numInscriptions");this.numBlocks=e,this.numTransactions=o,this.numInscriptions=r}}class lf{convert(e){return{num_blocks:d.encode(e.numBlocks),num_transactions:d.encode(e.numTransactions),num_inscriptions:d.encode(e.numInscriptions)}}}class uf{convert(e){return i(e,"num_blocks","num_transactions","num_inscriptions"),new df(d.decode(e.num_blocks),d.decode(e.num_transactions),d.decode(e.num_inscriptions))}}class hf extends c{constructor(){super(...arguments);n(this,"encoder",new lf);n(this,"decoder",new uf)}}const kc=new hf,Gt="Stats";class xc extends Fn{constructor(o){super();n(this,"stats");this.stats=o}toJSON(){return Qn.encode(this)}}class wf{convert(e){i(e,Gt);const o=e[Gt];return new xc(kc.decode(o))}}class pf{convert(e){return{[Gt]:kc.encode(e.stats)}}}class ff extends c{constructor(){super(...arguments);n(this,"encoder",new pf);n(this,"decoder",new wf)}}const Qn=new ff;class mf{convert(e){if(W(e,Ft))return Jn.decode(e);if(W(e,Gt))return Qn.decode(e);if(W(e,Jt))return Gn.decode(e);throw new D}}class Af{convert(e){if(e instanceof Bc)return Jn.encode(e);if(e instanceof xc)return Qn.encode(e);if(e instanceof Ec)return Gn.encode(e);throw new D}}class gf extends c{constructor(){super(...arguments);n(this,"encoder",new Af);n(this,"decoder",new mf)}}const Ic=new gf,Qt="InscriptionResponse";class Nc extends mt{constructor(o){super();n(this,"response");this.response=o}get type(){return Qt}toJson(){return Sf.encode(this)}}class Cf{convert(e){return{[Qt]:Ic.encode(e.response)}}}class yf{convert(e){i(e,Qt);const o=e[Qt];return new Nc(Ic.decode(o))}}class bf extends c{constructor(){super(...arguments);n(this,"encoder",new Cf);n(this,"decoder",new yf)}}const Sf=new bf;class vf{convert(e){return new Nc(e)}}const Bf=new vf;class Ef{constructor(e,o,r){n(this,"responseStream");n(this,"requestStream");n(this,"serviceBaseURL");n(this,"lifecycleResponseSink");n(this,"nodeValidatorResponseSink");n(this,"errorResponseSink");n(this,"webSocket",null);n(this,"webSocketCompleter",null);this.requestStream=e,this.responseStream=o,this.serviceBaseURL=r,this.lifecycleResponseSink=we(ue(o),Lo),this.nodeValidatorResponseSink=we(ue(o),Bf),this.errorResponseSink=we(ue(o),bl)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof ft){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof It){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unrecognized request",e)}async handleWebSocketCommand(e){if(e instanceof Le){await this.handleConnect();return}if(e instanceof Te){await this.handleClose();return}}async handleNodeValidatorRequest(e){this.assertConnected(),await this.webSocketCompleter.promise,this.webSocket.send(JSON.stringify(kn.encode(e)))}assertNotConnected(){if(this.webSocket!==null)throw new Error("Already connected")}assertConnected(){if(this.webSocket===null)throw new Error("Not connected")}async handleConnect(){this.assertNotConnected(),await this.lifecycleResponseSink.send(new Je);const e=new URL("node-validator/details",this.serviceBaseURL),o=lt();this.webSocketCompleter=o;try{const r=new kf(this.nodeValidatorResponseSink),s=new xf(o,this.lifecycleResponseSink),a=new If(this.lifecycleResponseSink),l=new Nf(this.errorResponseSink),u=new WebSocket(e);u.onerror,u.addEventListener("open",s),u.addEventListener("message",r),u.addEventListener("close",a),u.addEventListener("error",l),u.addEventListener("close",()=>{u.removeEventListener("open",s),u.removeEventListener("message",r),u.removeEventListener("close",a),u.removeEventListener("error",l),this.webSocket=null}),this.webSocket=u}catch(r){const s=new Ut(r);this.errorResponseSink.send(s),o.completeError(s)}}async handleClose(){this.assertConnected(),this.webSocket.close(1e3,"done")}}class kf{constructor(e){n(this,"nodeValidatorResponseSink");this.nodeValidatorResponseSink=e}decodeMessage(e){return Wt.decode(JSON.parse(e.data))}async relayMessage(e){try{await this.nodeValidatorResponseSink.send(e)}catch(o){console.error("attempt to publish message to response stream failed",o)}}async handleEvent(e){try{const o=this.decodeMessage(e);this.relayMessage(o)}catch(o){console.error("Failed to decode server message from web socket",o);return}}}class xf{constructor(e,o){n(this,"completer");n(this,"lifecycleResponseSink");this.completer=e,this.lifecycleResponseSink=o}handleEvent(e){this.completer.complete(e.target),this.lifecycleResponseSink.send(new Qe)}}class If{constructor(e){n(this,"lifecycleResponseSink");this.lifecycleResponseSink=e}async handleEvent(){await this.lifecycleResponseSink.send(new Ue)}}class Nf{constructor(e){n(this,"errorResponseSink");this.errorResponseSink=e}errorFromEvent(e){return"error"in e?new Ut(e.error):new Ut(null,"web socket error: unknown error")}handleEvent(e){this.errorResponseSink.send(this.errorFromEvent(e))}}$d(tt,Ac),gl(ot,yc);async function Rf(t){const e=t.pathname,o=await fetch(e);if(!o.ok)throw new D;const r=await o.json(),s=Se(1024),a=Se(1024),l=new Mp(s,a,r);return l.startProcessing(),l}async function Df(t){const e=new URL(t);if(e.protocol==="replay:")return Rf(e);if(e.protocol==="ws:"||e.protocol==="wss:"){const o=Se(1024),r=Se(1024),s=new Ef(o,r,e);return s.startProcessing(),s}return null}async function Pf(){try{const s=await(await fetch("/config.json")).json();if(s.node_validator_service_url){const a=await Df(s.node_validator_service_url);if(a!==null)return a}}catch(r){console.warn("error determining service implementation, from configuration file",r)}const t=Se(1024),e=Se(1024),o=new Tp(t,e);return o.startProcessing(),o}async function Of(){return new Tf(await Pf())}class Tf{constructor(e){n(this,"service");this.service=e}get stream(){return this.service.stream}async send(e){return this.service.send(e)}}async function Mf(t,e){const o=await t;for await(const r of o.stream)e(Cl.encode(r))}class Lf{constructor(e){n(this,"service");const o=Of();this.service=o,Mf(o,e)}async handleEvent(e){const o=Yd.decode(e.data);try{(await this.service).send(o)}catch(r){console.warn("error processing message from event",r)}}}self.addEventListener("message",new Lf(self.postMessage.bind(self)))})();
