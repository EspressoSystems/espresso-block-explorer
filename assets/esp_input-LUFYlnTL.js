import{R as y,j as S}from"./iframe-FzErJqN6.js";import"./LoadingProvider-CBligMWO.js";import"./DateTimeFormattersProvider-CZowblb9.js";import"./LocaleProvider-DKgBZSpf.js";import"./PagePathProvider-CP4LF1jP.js";import"./NowProvider-_E-9Clgm.js";import{C as v}from"./NumberFormattersProvider-WL2WBrHm.js";import"./PathResolverProvider-CU74cDgI.js";import{U as D}from"./UnimplementedError-DRDLdWuq.js";import{M as g,E as p}from"./monetary_value-q68MMcLV.js";import{T as f,a as M,b as V}from"./text-D5oHP-2T.js";function w(t){return t.type==="change"}function h(t,e){e=e.replace(/^[^\d]+/g,""),e=e.replace(/[^\d]+$/g,"");const u=t.formatToParts(.5).find(a=>a.type==="decimal")?.value??".",s=e.split(u),n=BigInt(s[0].replace(/\D/g,""))*p.significantDigitsMultiplier;if(s.length<2)return g.ESP(n);const r=s[1].replace(/\D/g,"").slice(0,p.significantDigits),l=10n**BigInt(r.length);if(l>p.significantDigitsMultiplier)throw new D("we somehow have more significant digits than the currency supports");const i=BigInt(r)*(p.significantDigitsMultiplier/l);return g.ESP(n+i)}function P(t){return t.value%t.currency.significantDigitsMultiplier===0n?t.value/t.currency.significantDigitsMultiplier:Number(t.value)/Number(t.currency.significantDigitsMultiplier)}const x=t=>{const e=y.useContext(v).ESP,{value:d,onChange:u,...s}=t,n=d??g.ESP(0n),r=P(n),l=new f(e.format(r)),[i,a]=y.useState({rawValue:l,transformed:l,money:n});return i.money.value!==n.value&&a({rawValue:new f(e.format(r)),transformed:new f(e.format(r)),money:n}),S.jsx(M,{...s,value:i.rawValue,onKeyDown:()=>{},onChange:(o,c)=>{if(w(o)){const m=h(e,c.text),E={rawValue:c,transformed:c.copyWith({text:e.format(m.value/m.currency.significantDigitsMultiplier)}),money:m};a(E),u&&u(o,E.money);return}a({...i,rawValue:c,transformed:c})},onBlur:()=>{const o=i.transformed.copyWith({selection:V.collapsed(-1)});a({...i,rawValue:o,transformed:o,money:h(e,o.text)})}})};try{x.displayName="ESPInput",x.__docgenInfo={description:"",displayName:"ESPInput",props:{value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"MonetaryValue | null"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((event: ChangeEvent<HTMLInputElement> | SyntheticEvent<HTMLInputElement, Event>, value: MonetaryValue) => void)"}}}}}catch{}export{x as E};
