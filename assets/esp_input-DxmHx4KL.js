import{R as g,j as I}from"./iframe-D8Xp_xun.js";import{a as D}from"./assert-B20_bgky.js";import{d as _}from"./string-DO2hqbbz.js";import"./LoadingProvider-D2cYfIgs.js";import"./DateTimeFormattersProvider-Bs-k3ShI.js";import"./LocaleProvider-HRtypQVb.js";import"./PagePathProvider-BwB57U9a.js";import"./NowProvider-CfKugIy7.js";import{C as N}from"./NumberFormattersProvider-C5Ud-AgN.js";import"./PathResolverProvider-BDnGbYv1.js";import{U as b}from"./UnimplementedError-BGJ4_cDZ.js";import{f as L,c as F}from"./functional-By_9lidy.js";import{M as P,E as x}from"./monetary_value-CGCIrnLJ.js";import{T as d,a as w,b as E}from"./text-Cl3VGp0V.js";function B(c){return c.type==="change"}function M(c,y,o){o=o.replace(/^[^\d]+/g,""),o=o.replace(/[^\d]+$/g,"");const a=o.split(c),t=BigInt(a[0].replace(/\D/g,""))*x.significantDigitsMultiplier;if(a.length<2)return P.ESP(t);const e=a[1].replace(/\D/g,"").slice(0,x.significantDigits),n=10n**BigInt(e.length);if(n>x.significantDigitsMultiplier)throw new b("we somehow have more significant digits than the currency supports");const l=BigInt(e)*(x.significantDigitsMultiplier/n);return P.ESP(t+l)}function R(c,y,o,a,t){const e=M(c,y,t.text);if(e.value===a.money.value&&t.text===a.transformed.text)return _(),[t,e];const n=o.format(e.toNumericLiteralString()),l=o.formatToParts(e.toNumericLiteralString()),p=l[0].type==="currency",m=L((u,r)=>u+r.value.length,0,F(l,u=>u.type==="currency"||u.type==="literal")),f=p?n.length:n.length-m;if(e.value===a.money.value&&n===a.transformed.text&&t.text.length>a.transformed.text.length)return[t,e];D(t.selection.end-t.selection.start===0,"newTextEdit is a modification on top of a previous selection, as such the resulting selection is guaranteed to be collapsed and 0 length");const h=n.length-t.text.length,i=t.selection.start+h;return i<m&&p?[new d(n,E.collapsed(f)),e]:i>f&&!p?[new d(n,E.collapsed(f)),e]:[new d(n,E.collapsed(i)),e]}const j="1234567890.5",S=c=>{const{value:y,onChange:o,...a}=c,t=g.useContext(N),e=t.ESPFull,n=y??P.ESP(0n),l=n.toNumericLiteralString(),p=new d(e.format(l)),m=g.useMemo(()=>t.default.formatToParts(j),[t]),f=g.useMemo(()=>m.find(r=>r.type==="decimal")?.value??".",[m]),h=g.useMemo(()=>m.find(r=>r.type==="group")?.value??",",[m]),[i,u]=g.useState({rawValue:p,transformed:p,money:n});return g.useEffect(()=>{let r=u;return i.money.value!==n.value&&r(s=>s.money.value===n.value?s:{rawValue:new d(e.format(l)),transformed:new d(e.format(l)),money:n}),()=>{r=()=>{}}},[t,i,n,e,l]),I.jsx(w,{...a,value:i.transformed,onKeyDown:()=>{},onChange:(r,s)=>{if(B(r)){const[v,V]=R(f,h,e,i,s),C={rawValue:s,transformed:v,money:V};(v.text!==s.text||!v.selection.isEquivalentTo(s.selection)||!v.composing.isEquivalentTo(s.composing))&&r.preventDefault(),u(C),o&&o(r,V);return}u({...i,rawValue:s,transformed:s})},onBlur:()=>{const r=i.transformed.copyWith({selection:E.collapsed(-1)});u({...i,rawValue:r,transformed:r,money:M(f,h,r.text)})}})};try{S.displayName="ESPInput",S.__docgenInfo={description:"",displayName:"ESPInput",props:{value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"MonetaryValue | null"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((event: ChangeEvent<HTMLInputElement> | SyntheticEvent<HTMLInputElement, Event>, value: MonetaryValue) => void)"}}}}}catch{}export{S as E};
