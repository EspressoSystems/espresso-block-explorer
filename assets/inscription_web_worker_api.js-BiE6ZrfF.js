var bd=Object.defineProperty;var Ed=(W,I,j)=>I in W?bd(W,I,{enumerable:!0,configurable:!0,writable:!0,value:j}):W[I]=j;var t=(W,I,j)=>Ed(W,typeof I!="symbol"?I+"":I,j);(function(){"use strict";class W{assert(){}}function I(){return new W}const j=I();function v(n,e){j.assert(n,e)}function rr(n,e){v(typeof n===e,`type assertion failed: expected "${e}", received "${typeof n}"`)}function At(n){v(n!==null,"expected a non-null value, received null")}function S(n,e){v(n instanceof e,`given value is not an instance of "${e.name}", specific type is "${typeof n=="object"&&n!==null?n.constructor.name:typeof n}"`)}class ze extends Error{constructor(r,s,o=`expected object with key: "${s}", instead found ${r}`){super(o);t(this,"key");t(this,"haveType");this.haveType=r,this.key=s,Object.freeze(this)}toJSON(){return{code:ze.name,message:this.message,have:this.haveType,key:this.key}}}class qe{encode(e){return this.encoder.convert(e)}decode(e){return this.decoder.convert(e)}}class c extends qe{}function Nt(n){return typeof n=="number"}function z(n){return typeof n=="string"}function Ut(n){return typeof n=="object"&&n!==null}function Ot(n){return n!==void 0}function Wt(n,e){return Array.isArray(n)&&n.every(e)}function Mt(n){return e=>Wt(e,n)}function Je(n,...e){return Ut(n)&&e.every(r=>r in n)}function d(n,...e){if(typeof n!="object")throw new Error("expected object");if(n===null)throw new Error("received null");for(const r of e)if(!(r in n))throw new ze("object",r)}function p(n,e){if(!z(n.code))throw new Error("code must be a string");if(n.code!==e)throw new Error(`expected code to be ${e}, got ${n.code}`)}function tr(n,e){if(!z(n.type))throw new Error("type must be a string");if(n.type!==e)throw new Error(`expected type to be ${e}, got ${n.type}`)}class g extends Error{constructor(e){super(e)}get code(){return this.constructor.name}toJSON(){return x.convert(this)}}class y{convert(e){return S(e,g),{code:e.code,message:e.message}}}const x=new y,Tt="NoCodecFoundError";class de extends Error{constructor(r,s=`no codec found for: "${r}"`){super(s);t(this,"codec");this.codec=r,Object.freeze(this);debugger}toJSON(){return{code:i.encode(de.name),message:i.encode(this.message),codec:i.encode(this.codec)}}get code(){return Tt}}const $e=new Map;class Ft{convert(e){d(e,"code");const r=i.decode(e.code),s=$e.get(r);if(!s)throw new de(r);return s.decode(e)}}class Pt{convert(e){const r=$e.get(e.code);if(!r)throw new de(e.code);return r.encode(e)}}class Lt extends qe{constructor(){super(...arguments);t(this,"encoder",new Pt);t(this,"decoder",new Ft)}}const le=new Lt;function f(n,e){$e.set(n,e)}const He="InvalidTypeError";class h extends g{constructor(r,s,o=`invalid type: have "${r}", want "${s}"`){super(o);t(this,"have");t(this,"want");this.have=r,this.want=s,Object.freeze(this)}toJSON(){return sr.encode(this)}get code(){return He}}class jt{convert(e){return d(e,"code","have","want","message"),p(e,He),new h(i.decode(e.have),i.decode(e.want),i.decode(e.message))}}class zt{convert(e){return S(e,h),{...x.convert(e),have:i.encode(e.have),want:i.encode(e.want)}}}class qt extends c{constructor(){super(...arguments);t(this,"encoder",new zt);t(this,"decoder",new jt)}}const sr=new qt;f(He,sr);const Jt=Mt(Ot);class $t{convert(e){return e}}const or=new $t;class Ht extends qe{constructor(){super(...arguments);t(this,"encoder",or);t(this,"decoder",or)}}const ue=new Ht;class M{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){if(!Jt(e)){const r=typeof e=="object"&&e!==null?e.constructor.name:typeof e,s="array";throw new Error(`invalid array value: have "${r}", want "${s}"`)}return e.map(r=>this.itemCodec.decode(r))}}class T{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){return S(e,Array),e.map(r=>this.itemCodec.encode(r))}}class F extends c{constructor(r,s){super();t(this,"encoder");t(this,"decoder");this.encoder=s,this.decoder=r}}class he{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){return e===null?null:this.itemCodec.decode(e)}}class we{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){return e===null?null:(At(e),this.itemCodec.encode(e))}}class pe extends c{constructor(r,s){super();t(this,"encoder");t(this,"decoder");this.encoder=s,this.decoder=r}}class Vt{convert(e){if(!z(e))throw new h(typeof e,"string");return e}}class Qt{convert(e){return rr(e,"string"),e}}class Gt extends c{constructor(){super(...arguments);t(this,"encoder",new Qt);t(this,"decoder",new Vt)}}const i=new Gt;new F(new M(i),new T(i)),new pe(new he(i),new we(i));class Ve extends g{constructor(e="completer has already been completed"){super(e),Object.freeze(this)}get code(){return cr}}const cr="CompleterAlreadyCompletedError";class Xt{convert(e){return d(e,"code","message"),p(e,cr),new Ve(i.decode(e.message))}}class Zt extends y{}class _t extends c{constructor(){super(...arguments);t(this,"encoder",new Zt);t(this,"decoder",new Xt)}}const Kt=new _t;f(Ve.name,Kt);function fe(){return v(!1,"completer is not ready, this should never be reached")}function ge(){throw new Ve}class Yt{constructor(){t(this,"resolve",fe);t(this,"reject",fe);t(this,"completed",!1);t(this,"promise");this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r}),v(this.resolve!==fe,"resolve should be set"),v(this.reject!==fe,"resolve should be set")}get isCompleted(){return this.completed}complete(e){const r=this.resolve,s=this.reject;if(this.completed=!0,this.resolve=ge,this.reject=ge,e instanceof Promise){e.then(r,s);return}r(e)}completeError(e){this.reject(e),this.completed=!0,this.resolve=ge,this.reject=ge}}function me(){return new Yt}class q extends g{constructor(r,s,o){super(o);t(this,"response");t(this,"status");this.status=r,this.response=s}toJSON(){return ir.convert(this)}}class Ce{convert(e){return S(e,q),{...x.convert(e),status:e.status}}}const ir=new Ce,Qe="BadResponseClientError";class ar extends q{constructor(e,r,s="bad server response: client error"){super(e,r,s),Object.freeze(this)}get code(){return Qe}toJSON(){return dr.encode(this)}}class es{convert(e){return d(e,"code","message","status"),p(e,Qe),new ar(Number(e.status),null,i.decode(e.message))}}class ns extends Ce{}class rs extends c{constructor(){super(...arguments);t(this,"encoder",new ns);t(this,"decoder",new es)}}const dr=new rs;f(Qe,dr);const Ge="BadResponseError";class lr extends q{constructor(e,r,s="bad server response"){super(e,r,s),Object.freeze(this)}get code(){return Ge}toJSON(){return ur.encode(this)}}class ts{convert(e){return d(e,"code","message","status"),p(e,Ge),new lr(Number(e.status),null,i.decode(e.message))}}class ss extends Ce{}class os extends c{constructor(){super(...arguments);t(this,"encoder",new ss);t(this,"decoder",new ts)}}const ur=new os;f(Ge,ur);class hr extends q{constructor(e,r,s="bad server response: server error"){super(e,r,s),Object.freeze(this)}get code(){return Xe}}const Xe="BadResponseServerError";class cs{convert(e){return d(e,"code","message","status"),p(e,Xe),new hr(Number(e.status),null,i.decode(e.message))}}class is extends Ce{}class as extends c{constructor(){super(...arguments);t(this,"encoder",new is);t(this,"decoder",new cs)}}const ds=new as;f(Xe,ds);const Ze="ChannelClosedError";class J extends g{constructor(e="channel closed"){super(e),Object.freeze(this)}get code(){return Ze}}class ls{convert(e){return d(e,"code","message"),p(e,Ze),new J(i.decode(e.message))}}class us extends y{}class hs extends c{constructor(){super(...arguments);t(this,"encoder",new us);t(this,"decoder",new ls)}}const ws=new hs;f(Ze,ws);const _e="FetchError";class Ke extends g{constructor(r,s=`fetch failed: ${String(r)}`){super(s);t(this,"cause");this.cause=r,Object.freeze(this)}get code(){return _e}}class ps{convert(e){return d(e,"code","message"),p(e,_e),new Ke({},i.decode(e.message))}}class fs extends y{}class gs extends c{constructor(){super(...arguments);t(this,"encoder",new fs);t(this,"decoder",new ps)}}const ms=new gs;f(_e,ms);const Ye="IncorrectBase64PaddingError";class wr extends g{constructor(e="incorrect padding"){super(e),Object.freeze(this)}get code(){return Ye}}class Cs{convert(e){return d(e,"code","message"),p(e,Ye),new wr(i.decode(e.message))}}class vs extends y{}class ys extends c{constructor(){super(...arguments);t(this,"encoder",new vs);t(this,"decoder",new Cs)}}const Ss=new ys;f(Ye,Ss);class bs{convert(e){if(!Nt(e))throw new h(typeof e,"number");return e}}class Es{convert(e){return rr(e,"number"),e}}class ks extends c{constructor(){super(...arguments);t(this,"encoder",new Es);t(this,"decoder",new bs)}}const m=new ks,pr=new pe(new he(m),new we(m));new F(new M(m),new T(m)),new F(new M(pr),new T(pr));const en="InvalidBase64AlphabetLengthError";class nn extends g{constructor(r,s=`alphabet needs to be 64 characters, received ${r}`){super(s);t(this,"length");this.length=r,Object.freeze(this)}toJSON(){return fr.encode(this)}get code(){return en}}class xs{convert(e){return d(e,"code","length","message"),p(e,en),new nn(m.decode(e.length),i.decode(e.message))}}class Is{convert(e){return S(e,nn),{...x.convert(e),length:m.encode(e.length)}}}class Rs extends c{constructor(){super(...arguments);t(this,"encoder",new Is);t(this,"decoder",new xs)}}const fr=new Rs;f(en,fr);const rn="InvalidHexStringError";class tn extends g{constructor(e="invalid hex string"){super(e),Object.freeze(this)}get code(){return rn}}class Ds{convert(e){return d(e,"code","message"),p(e,rn),new tn(i.decode(e.message))}}class Bs extends y{}class As extends c{constructor(){super(...arguments);t(this,"encoder",new Bs);t(this,"decoder",new Ds)}}const Ns=new As;f(rn,Ns);const sn="InvalidHexValueError";class gr extends g{constructor(r,s=`invalid hex value "${r}"`){super(s);t(this,"value");this.value=r,Object.freeze(this)}toJSON(){return mr.encode(this)}get code(){return sn}}class Us{convert(e){return d(e,"code","value","message"),p(e,sn),new gr(m.decode(e.value),i.decode(e.message))}}class Os{convert(e){return{...x.convert(e),value:m.encode(e.value)}}}class Ws extends c{constructor(){super(...arguments);t(this,"encoder",new Os);t(this,"decoder",new Us)}}const mr=new Ws;f(sn,mr);const on="InvalidInputError";class $ extends g{constructor(e="invalid input"){super(e),Object.freeze(this)}get code(){return on}}class Ms{convert(e){return d(e,"code","message"),p(e,on),new $(i.decode(e.message))}}class Ts extends y{}class Fs extends c{constructor(){super(...arguments);t(this,"encoder",new Ts);t(this,"decoder",new Ms)}}const Ps=new Fs;f(on,Ps);const cn="InvalidStringValueError";class Cr extends g{constructor(r,s,o=`invalid string value: have "${r}", want "${s}"`){super(o);t(this,"have");t(this,"want");this.have=r,this.want=s,Object.freeze(this)}toJSON(){return vr.encode(this)}get code(){return cn}}class Ls{convert(e){return d(e,"code","have","want","message"),p(e,cn),new Cr(i.decode(e.have),i.decode(e.want),i.decode(e.message))}}class js{convert(e){return S(e,Cr),{...x.convert(e),have:i.encode(e.have),want:i.encode(e.want)}}}class zs extends c{constructor(){super(...arguments);t(this,"encoder",new js);t(this,"decoder",new Ls)}}const vr=new zs;f(cn,vr);const an="InvalidTaggedBase64EncodingError";class yr extends g{constructor(e="invalid tagged base64 encoding"){super(e),Object.freeze(this)}toJSON(){return Sr.encode(this)}get code(){return an}}class qs{convert(e){return d(e,"code","message"),p(e,an),new yr(i.decode(e.message))}}class Js extends y{}class $s extends c{constructor(){super(...arguments);t(this,"encoder",new Js);t(this,"decoder",new qs)}}const Sr=new $s;f(an,Sr);const dn="MissingElementError";class ln extends g{constructor(e="missing element"){super(e),Object.freeze(this)}get code(){return dn}}class Hs{convert(e){return d(e,"code","message"),p(e,dn),new ln(i.decode(e.message))}}class Vs extends y{}class Qs extends c{constructor(){super(...arguments);t(this,"encoder",new Vs);t(this,"decoder",new Hs)}}const Gs=new Qs;f(dn,Gs);const un="NoCompleterFoundForRequestID";class br extends g{constructor(r,s=`no completer found for request id "${r}"`){super(s);t(this,"requestID");this.requestID=r,Object.freeze(this)}toJSON(){return Er.encode(this)}get code(){return un}}class Xs{convert(e){return d(e,"code","requestID","message"),p(e,un),new br(ue.decode(e.requestID),i.decode(e.message))}}class Zs{convert(e){return S(e,br),{...x.convert(e),requestID:ue.encode(e.requestID)}}}class _s extends c{constructor(){super(...arguments);t(this,"encoder",new Zs);t(this,"decoder",new Xs)}}const Er=new _s;f(un,Er);const hn="NotFoundError";class Ks extends g{constructor(r,s=`Not Found: ${r}`){super(s);t(this,"key");this.key=r,Object.freeze(this)}get code(){return hn}}class kr{constructor(e){t(this,"codec");this.codec=e}convert(e){return d(e,"code","key"),p(e,hn),new Ks(this.codec.decode(e.key))}}class xr{constructor(e){t(this,"codec");this.codec=e}convert(e){return{...x.convert(e),key:this.codec.encode(e.key)}}}class Ir extends c{constructor(r,s){super();t(this,"encoder");t(this,"decoder");this.encoder=r,this.decoder=s}}new Ir(new xr(i),new kr(i));const Ys=new Ir(new xr(ue),new kr(ue));f(hn,Ys);const wn="NoURLProvidedError";class eo extends g{constructor(e="no url provided"){super(e),Object.freeze(this)}get code(){return wn}}class no{convert(e){return d(e,"code","message"),p(e,wn),new eo(i.decode(e.message))}}class ro extends y{}class to extends c{constructor(){super(...arguments);t(this,"encoder",new ro);t(this,"decoder",new no)}}const so=new to;f(wn,so);const pn="UnimplementedError";class b extends g{constructor(e="unimplemented"){super(e),Object.freeze(this);debugger}get code(){return pn}}class oo{convert(e){return d(e,"code","message"),p(e,pn),new b(i.decode(e.message))}}class co extends y{}class io extends c{constructor(){super(...arguments);t(this,"encoder",new co);t(this,"decoder",new oo)}}const ao=new io;f(pn,ao);const fn="QUERY_ERROR";class lo extends g{constructor(r,s="missing element"){super(s);t(this,"error");this.error=r,Object.freeze(this)}get code(){return fn}}class uo{convert(e){return d(e,"code","error","message"),p(e,fn),new lo(Ar.decode(e.error),i.decode(e.message))}}class ho{convert(e){return{code:e.code,error:Ar.encode(e.error),message:i.encode(e.message)}}}class wo extends c{constructor(){super(...arguments);t(this,"encoder",new ho);t(this,"decoder",new uo)}}const po=new wo;class gn{}const mn="NotFound";class Rr extends gn{constructor(){super(),Object.freeze(this)}valueOf(){return mn}toJSON(){return this.valueOf()}}const fo=new Rr,Cn="Missing";class Dr extends gn{constructor(){super(),Object.freeze(this)}valueOf(){return Cn}toJSON(){return this.valueOf()}}const go=new Dr;class Br extends gn{constructor(r){super();t(this,"error");this.error=r,Object.freeze(this)}toJSON(){return yn.encode(this)}}class mo{constructor(e){t(this,"message");this.message=e,Object.freeze(this)}toJSON(){return vn.encode(this)}}class Co{convert(e){return d(e,"message"),new mo(i.decode(e.message))}}class vo{convert(e){return{message:i.encode(e.message)}}}class yo extends c{constructor(){super(...arguments);t(this,"encoder",new vo);t(this,"decoder",new Co)}}const vn=new yo;class So{convert(e){return d(e,"Error"),new Br(vn.decode(e.Error))}}class bo{convert(e){return{Error:vn.encode(e.error)}}}class Eo extends c{constructor(){super(...arguments);t(this,"encoder",new bo);t(this,"decoder",new So)}}const yn=new Eo;class ko{convert(e){return e===mn?fo:e===Cn?go:yn.decode(e)}}class xo{convert(e){if(e instanceof Rr)return mn;if(e instanceof Dr)return Cn;if(e instanceof Br)return yn.encode(e);throw new b}}class Io extends c{constructor(){super(...arguments);t(this,"encoder",new xo);t(this,"decoder",new ko)}}const Ar=new Io;f(fn,po);const Nr="ResponseContentTypeIsNotApplicationJSONError";class H extends q{constructor(r,s,o,a="response content type is not application/json"){super(s,o,a);t(this,"haveHeaderType");this.haveHeaderType=r,Object.freeze(this)}static fromResponse(r,s){return new H(r.headers.get("content-type")??"undefined",r.status,r,s)}toJSON(){return Ur.encode(this)}get code(){return Nr}}class Ro{convert(e){return d(e,"code","status","have","want","message"),p(e,Nr),new H(i.decode(e.code),m.decode(e.status),null,i.decode(e.message))}}class Do{convert(e){return{...ir.convert(e),have:i.encode(e.haveHeaderType),want:i.encode("application/json")}}}class Bo extends c{constructor(){super(...arguments);t(this,"encoder",new Do);t(this,"decoder",new Ro)}}const Ur=new Bo;f(H.name,Ur);const Sn="WebWorkerErrorResponse";class Ao extends g{constructor(r,s="error in web worker"){super(s);t(this,"error");this.error=r,Object.freeze(this)}toJSON(){return Or.encode(this)}get code(){return Sn}}class No{convert(e){return d(e,"code","error","message"),p(e,Sn),new Ao(le.decode(e.error),i.decode(e.message))}}class Uo{convert(e){return{...x.convert(e),error:le.encode(e.error)}}}class Oo extends c{constructor(){super(...arguments);t(this,"encoder",new Uo);t(this,"decoder",new No)}}const Or=new Oo;f(Sn,Or);var bn=(n=>(n[n.success=0]="success",n[n.full=1]="full",n[n.failed=2]="failed",n))(bn||{});class Wo{getFromEmpty(){}}class Mo{getFromEmpty(){return null}}class To{getFromEmpty(){throw new ln}}const Wr={returnNull:new Mo,returnUndefined:new Wo,throwMissingElement:new To};class Fo{constructor(e){t(this,"maxSize");v(!Number.isNaN(e),"maxSize must not be NaN"),v(Number.isInteger(e),"maxSize must be an integer"),v(e>0,"maxSize must be greater than 0"),this.maxSize=e}nextIndex(e){return v(e>=0,"index must be greater than or equal to 0"),(e+1)%this.maxSize}}class Po{constructor(e){t(this,"preComputedSizeMinus1");v(!Number.isNaN(e),"maxSize must not be NaN"),v(Number.isInteger(e),"maxSize must be an integer"),v(e>0,"maxSize must be greater than 0"),v(Mr(e),"maxSize must be a power of two"),this.preComputedSizeMinus1=e-1}nextIndex(e){return v(e>=0,"index must be greater than or equal to 0"),e+1&this.preComputedSizeMinus1}}function Mr(n){return(n&n-1)===0}const En="BufferFullError";class Tr extends g{constructor(e="buffer full"){super(e),Object.freeze(this)}get code(){return En}}class Lo{convert(e){return d(e,"code","message"),p(e,En),new Tr(i.decode(e.message))}}class jo extends y{}class zo extends c{constructor(){super(...arguments);t(this,"encoder",new jo);t(this,"decoder",new Lo)}}const qo=new zo;f(En,qo);class Jo{putToFull(e,r){return e.get(),e.put(r)}}class $o{putToFull(){return bn.full}}class Ho{putToFull(){throw new Tr}}const Fr={overwriteOldest:new Jo,returnFull:new $o,throw:new Ho};function Vo(n){return Mr(n)?new Po(n):new Fo(n)}class Qo{constructor(e,r,s){t(this,"readIndex",0);t(this,"writeIndex",0);t(this,"buffer");t(this,"nextIndex");t(this,"getOnEmpty");t(this,"putOnFull");v(!Number.isNaN(e),"maxSize must not be NaN"),this.buffer=new Array(e),this.nextIndex=Vo(e),this.getOnEmpty=r,this.putOnFull=s}get maxSize(){return this.buffer.length}get length(){return this.writeIndex<this.readIndex?this.writeIndex+this.maxSize-this.readIndex:this.writeIndex-this.readIndex}put(e){const r=this.nextIndex.nextIndex(this.writeIndex);return r===this.readIndex?this.putOnFull.putToFull(this,e):(this.buffer[this.writeIndex]=e,this.writeIndex=r,bn.success)}get(){if(this.readIndex===this.writeIndex)return this.getOnEmpty.getFromEmpty(this);const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),e}[Symbol.iterator](){return new Go(this)}immutableIterable(){return{[Symbol.iterator]:()=>this.immutableIterator()}}immutableIterator(){return new Xo(this.readIndex,this.writeIndex,this.buffer,this.nextIndex)}}class Go{constructor(e){t(this,"buffer");this.buffer=e}next(){const e=this.buffer.get();return e==null?{value:void 0,done:!0}:{value:e,done:!1}}}class Xo{constructor(e,r,s,o){t(this,"readIndex");t(this,"writeIndex");t(this,"buffer");t(this,"nextIndex");this.readIndex=e,this.writeIndex=r,this.buffer=s,this.nextIndex=o}next(){if(this.readIndex===this.writeIndex)return{value:void 0,done:!0};const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),{value:e,done:!1}}}function Pr(n=32,e=Wr.returnUndefined,r=Fr.overwriteOldest){return new Qo(n,e,r)}class Zo{constructor(e){t(this,"publishQueue");t(this,"pollBlocked");t(this,"publishBlocked");t(this,"capacity");t(this,"closed",!1);this.publishQueue=Pr(Math.max(2,e),Wr.throwMissingElement,Fr.throw);const r=me();this.pollBlocked=r,this.publishBlocked=r,r.complete(),this.capacity=e-1}get isClosed(){return this.closed}close(){if(this.closed)throw new J;this.closed=!0}async drain(){for(;this.publishQueue.length>0;)this.publishQueue.get()}async publish(e){if(this.closed)throw new J;if(this.publishQueue.length>=this.capacity){if(this.publishBlocked.isCompleted){const r=me();this.publishBlocked=r,await r.promise}return await this.publishBlocked.promise,this.publish(e)}this.publishQueue.put(e),this.pollBlocked.isCompleted||this.pollBlocked.complete()}async poll(){if(this.publishQueue.length<=0){if(this.isClosed)throw new J;if(this.pollBlocked.isCompleted){const r=me();this.pollBlocked=r}return await this.pollBlocked.promise,this.poll()}const e=this.publishQueue.get();return this.publishBlocked.isCompleted||this.publishBlocked.complete(),e}[Symbol.asyncIterator](){return new _o(this)}}class _o{constructor(e){t(this,"channel");this.channel=e}async next(){try{return{done:!1,value:await this.channel.poll()}}catch(e){if(e instanceof J)return{done:!0,value:void 0};throw e}}}function ve(n){return new Zo(n)}class Ko{constructor(e){t(this,"channel");this.channel=e}async send(e){await this.channel.publish(e)}}function V(n){return new Ko(n)}const kn="CorruptBase64InputError";class A extends g{constructor(r,s=`corrupt input error at ${r}`){super(s);t(this,"offset");this.offset=r,Object.freeze(this)}get code(){return kn}toJSON(){return Lr.encode(this)}}class Yo{convert(e){return d(e,"code","offset","message"),p(e,kn),new A(m.decode(e.offset),i.decode(e.message))}}class ec{convert(e){return S(e,A),{...x.convert(e),offset:m.encode(e.offset),message:i.encode(e.message)}}}class nc extends c{constructor(){super(...arguments);t(this,"encoder",new ec);t(this,"decoder",new Yo)}}const Lr=new nc;f(kn,Lr);const rc=new TextEncoder;function jr(n){return rc.encode(n)}const tc=new TextDecoder;function sc(n){return tc.decode(n)}function*zr(n){yield*jr(n)}function*oc(){for(let n=0;n<256;n++)yield 255}const Q=-1,cc=61;class G{constructor(e,r,s=cc,o=!1){t(this,"encodeMap");t(this,"decodeMap");t(this,"padChar");t(this,"strict");this.encodeMap=e,this.decodeMap=r,this.padChar=s,this.strict=o}static withAlphabet(e){const r=e.length;if(r!==64)throw new nn(r);const s=Array.from(zr(e)),o=Array.from(oc());for(let a=0;a<r;a++)o[s[a]]=a;return new G(s,o)}withPadding(e){return new G(this.encodeMap,this.decodeMap,e,this.strict)}encode(e){if(e.byteLength===0)return new ArrayBuffer(0);let r=0,s=0;const o=Math.floor(e.byteLength/3)*3,a=Math.ceil(e.byteLength/3)*4,u=new ArrayBuffer(a),l=new DataView(e),C=new DataView(u);for(;s<o;){const O=l.getUint8(s+0)<<16|l.getUint8(s+1)<<8|l.getUint8(s+2);C.setUint8(r+0,this.encodeMap[O>>18&63]),C.setUint8(r+1,this.encodeMap[O>>12&63]),C.setUint8(r+2,this.encodeMap[O>>6&63]),C.setUint8(r+3,this.encodeMap[O&63]),s+=3,r+=4}const w=e.byteLength-s;if(w===0)return u;let B=l.getUint8(s+0)<<16;switch(w===2&&(B|=l.getUint8(s+1)<<8),C.setUint8(r+0,this.encodeMap[B>>18&63]),C.setUint8(r+1,this.encodeMap[B>>12&63]),w){case 2:return C.setUint8(r+2,this.encodeMap[B>>6&63]),this.padChar!==Q?(C.setUint8(r+3,this.padChar),u.slice(0,r+4)):u.slice(0,r+3);case 1:if(this.padChar!==Q)return C.setUint8(r+2,this.padChar),C.setUint8(r+3,this.padChar),u.slice(0,r+4);break}return u.slice(0,r+2)}decode(e){const r=e.byteLength;if(r===0)return new ArrayBuffer(0);const s=new DataView(e),o=new ArrayBuffer(Math.floor(r/4*3)),a=new DataView(o),u=new ArrayBuffer(4),l=new DataView(u);let C=0,w=0,B=0,O=!1;for(;w<r&&!O;){let er=3,Le=4;for(let k=0;k<4;k++){if(w===r){if(k===0)return o;if(k===1||this.padChar!==Q)throw new A(w-k);er=k-1,Le=k,O=!0;break}const je=s.getUint8(w);w++;const Bt=this.decodeMap[je];if(Bt!==255){l.setUint8(k,Bt);continue}if(je===10||je===13){k--;continue}if(je===this.padChar){switch(k){case 0:case 1:throw new wr;case 2:for(;w<r&&(s.getUint8(w)===10||s.getUint8(w)===13);)w++;if(w===r)throw new A(r);w++}for(;w<r&&(s.getUint8(w)===10||s.getUint8(w)===13);)w++;if(w<r)throw new A(w);er=3,Le=k,O=!0;break}throw new A(w-1)}const nr=l.getUint8(0)<<18|l.getUint8(1)<<12|l.getUint8(2)<<6|l.getUint8(3);switch(l.setUint8(2,nr>>0&255),l.setUint8(1,nr>>8&255),l.setUint8(0,nr>>16&255),Le){case 4:a.setUint8(B+2,l.getUint8(2)),l.setUint8(2,0);case 3:if(a.setUint8(B+1,l.getUint8(1)),this.strict&&l.getUint8(2)!==0)throw new A(w-1);case 2:if(a.setUint8(B+0,l.getUint8(0)),this.strict&&(l.getUint8(1)!==0||l.getUint8(2)!==0))throw new A(w-2)}B+=er,C+=Le-1}return o.slice(0,C)}decodeString(e){return this.decode(jr(e).buffer)}encodeToString(e){return sc(this.encode(e))}}const qr=G.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ic=qr.withPadding(Q),Jr=G.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),xn=Jr.withPadding(Q);function*ac(n,e){for(let r=n.next();!r.done;r=n.next())e(r.value)&&(yield r.value)}function dc(n,e){return ac(n[Symbol.iterator](),e)}function*$r(n,e){for(let r=n.next();!r.done;r=n.next())yield e(r.value)}function ye(n,e){return $r(n[Symbol.iterator](),e)}function lc(n){let e;for(let r=n.next();!r.done;r=n.next())e=r.value;if(e===void 0)throw new ln;return e}function Hr(n){return lc(n[Symbol.iterator]())}function*uc(n,e,r){for(let s=n.next(),o=e.next();!s.done&&!o.done;s=n.next(),o=e.next())yield r(s.value,o.value)}function hc(n,e,r){return uc(n[Symbol.iterator](),e[Symbol.iterator](),r)}function Vr(n){if(n.startsWith("0x"))return Vr(n.substring(2));if(n.length&1)throw new tn;const e=new ArrayBuffer(n.length/2);return wc(zr(n),e),e}function wc(n,e){const r=new DataView(e);let s=0;for(;s<e.byteLength;){const o=n.next(),a=n.next();if(o.done||a.done)throw new tn;const u=Qr(o.value),l=Qr(a.value),C=u<<4|l;r.setUint8(s,C),s++}}function Qr(n){if(n>=48&&n<=57)return n-48;if(n>=97&&n<=102)return n-97+10;if(n>=65&&n<=70)return n-65+10;throw new gr(n)}function pc(n){return n.toString(16).padStart(2,"0")}function*fc(n){yield*$r(n,pc)}function gc(n){return fc(n[Symbol.iterator]())}class mc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");return Vr(e)}}class Cc{convert(e){return S(e,ArrayBuffer),["0x",...gc(new Uint8Array(e))].join("")}}class vc extends c{constructor(){super(...arguments);t(this,"encoder",new Cc);t(this,"decoder",new mc)}}const N=new vc;new pe(new he(N),new we(N)),new F(new M(N),new T(N));class yc{constructor(e){t(this,"encoding");this.encoding=e}convert(e){if(typeof e!="string")throw new h(typeof e,"string");return this.encoding.decodeString(e)}}class Sc{constructor(e){t(this,"encoding");this.encoding=e}convert(e){return this.encoding.encodeToString(e)}}class Se extends c{constructor(r){super();t(this,"encoder");t(this,"decoder");this.encoder=new Sc(r),this.decoder=new yc(r)}}new Se(xn),new Se(ic),new Se(Jr),new Se(qr);class bc{convert(e){if(!z(e))throw new h(typeof e,"string");return new URL(e)}}class Ec{convert(e){return e.toString()}}class kc extends c{constructor(){super(...arguments);t(this,"encoder",new Ec);t(this,"decoder",new bc)}}const Gr=new kc;new pe(new he(Gr),new we(Gr));class Xr{}class Zr{}const X="Close";class be extends Zr{valueOf(){return X}}class xc{convert(){return X}}class Ic{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==X)throw new h(e,X);return new be}}class Rc extends c{constructor(){super(...arguments);t(this,"encoder",new xc);t(this,"decoder",new Ic)}}const _r=new Rc,Z="Connect";class Ee extends Zr{valueOf(){return Z}toJSON(){return In.encode(this)}}class Dc{convert(){return Z}}class Bc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==Z)throw new h(e,Z);return new Ee}}class Ac extends c{constructor(){super(...arguments);t(this,"encoder",new Dc);t(this,"decoder",new Bc)}}const In=new Ac;class Nc{convert(e){if(e===Z)return In.decode(e);if(e===X)return _r.decode(e);throw new b}}class Uc{convert(e){if(e instanceof Ee)return In.encode(e);if(e instanceof be)return _r.encode(e);throw new b}}class Oc extends c{constructor(){super(...arguments);t(this,"encoder",new Uc);t(this,"decoder",new Nc)}}const Kr=new Oc;class Rn extends Xr{constructor(r){super();t(this,"command");this.command=r}get type(){return _}toJson(){return Yr.encode(this)}}const _="WebSocket";class Wc{convert(e){return{[_]:Kr.encode(e.command)}}}class Mc{convert(e){return d(e,_),new Rn(Kr.decode(e[_]))}}class Tc extends c{constructor(){super(...arguments);t(this,"encoder",new Wc);t(this,"decoder",new Mc)}}const Yr=new Tc,P=new Map;P.set(_,Yr);class Fc{convert(e){const r=P.get(e.type);if(!r)throw new h(e.type,`one of ${Array.from(ye(P.keys(),s=>`"${s}"`)).join(", ")}`);return{[e.type]:r.encode(e)}}}class Pc{convert(e){if(typeof e!="object"||e===null)throw new h(typeof e,"object");const r=Object.keys(e);if(r.length!==1)throw new b("multiple values contained within the Request object, unexpected");const[s]=r,o=P.get(s);if(d(e,s),!o)throw new h(s,`one of ${Array.from(ye(P.keys(),a=>`"${a}"`)).join(", ")}`);return o.decode(e[s])}}class Lc extends c{constructor(){super(...arguments);t(this,"encoder",new Fc);t(this,"decoder",new Pc)}}function jc(n,e){P.has(n)||P.set(n,e)}const zc=new Lc;class Dn{}const K="Error";class et extends Dn{constructor(r){super();t(this,"error");this.error=r}get type(){return K}toJson(){return nt.encode(this)}}class qc{convert(e){return{[K]:le.encode(e.error)}}}class Jc{convert(e){return d(e,K),new et(le.decode(e[K]))}}class $c extends c{constructor(){super(...arguments);t(this,"encoder",new qc);t(this,"decoder",new Jc)}}const nt=new $c;class Bn{}const Y="Closed";class ke extends Bn{valueOf(){return Y}toJSON(){return An.encode(this)}}class Hc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==Y)throw new h(e,Y);return new ke}}class Vc{convert(){return Y}}class Qc extends c{constructor(){super(...arguments);t(this,"encoder",new Vc);t(this,"decoder",new Hc)}}const An=new Qc,ee="Connecting";class xe extends Bn{valueOf(){return ee}toJSON(){return Nn.encode(this)}}class Gc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==ee)throw new h(e,ee);return new xe}}class Xc{convert(){return ee}}class Zc extends c{constructor(){super(...arguments);t(this,"encoder",new Xc);t(this,"decoder",new Gc)}}const Nn=new Zc,ne="Opened";class Ie extends Bn{valueOf(){return ne}toJSON(){return Un.encode(this)}}class _c{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==ne)throw new h(e,ne);return new Ie}}class Kc{convert(){return ne}}class Yc extends c{constructor(){super(...arguments);t(this,"encoder",new Kc);t(this,"decoder",new _c)}}const Un=new Yc;class ei{convert(e){if(e===ne)return Un.decode(e);if(e===Y)return An.decode(e);if(e===ee)return Nn.decode(e);throw new b}}class ni{convert(e){if(e instanceof Ie)return Un.encode(e);if(e instanceof ke)return An.encode(e);if(e instanceof xe)return Nn.encode(e);throw new b}}class ri extends c{constructor(){super(...arguments);t(this,"encoder",new ni);t(this,"decoder",new ei)}}const rt=new ri;class tt extends Dn{constructor(r){super();t(this,"status");this.status=r}get type(){return re}toJson(){return st.encode(this)}}const re="WebSocket";class ti{convert(e){return{[re]:rt.encode(e.status)}}}class si{convert(e){return d(e,re),new tt(rt.decode(e[re]))}}class oi extends c{constructor(){super(...arguments);t(this,"encoder",new ti);t(this,"decoder",new si)}}const st=new oi,U=new Map;U.set(K,nt),U.set(re,st);class ci{convert(e){const r=U.get(e.type);if(!r)throw new h(e.type,`one of ${Array.from(ye(U.keys(),s=>`"${s}"`)).join(", ")}`);return{[e.type]:r.encode(e)}}}class ii{convert(e){if(typeof e!="object"||e===null)throw new h(typeof e,"object");const r=Object.keys(e);if(r.length!==1)throw new b("multiple values contained within the response object, unexpected");const[s]=r,o=U.get(s);if(d(e,s),!o)throw new h(s,`one of ${Array.from(ye(U.keys(),a=>`"${a}"`)).join(", ")}`);return o.decode(e[s])}}class ai extends c{constructor(){super(...arguments);t(this,"encoder",new ci);t(this,"decoder",new ii)}}function di(n,e){U.has(n)||U.set(n,e)}const li=new ai;class ui{convert(e){return new et(e)}}const hi=new ui;class wi{convert(e){return new tt(e)}}const ot=new wi;class pi{constructor(e,r){this.sink=e,this.converter=r,this.sink=e,this.converter=r}async send(e){await this.sink.send(this.converter.convert(e))}}function te(n,e){return new pi(n,e)}async function ct(n){return new Promise(e=>{const r=setTimeout(()=>{clearTimeout(r),e()},n)})}class R{constructor(e,r,s){t(this,"significantDigitsMultiplier");this.alpha3Code=e,this.code=r,this.significantDigits=s,this.alpha3Code=e,this.code=r,this.significantDigits=s,this.significantDigitsMultiplier=BigInt(10)**BigInt(this.significantDigits)}toJSON(){return Re.encode(this)}}const it=new R("JPY",392,0),fi=new R("GBP",826,2),at=new R("USD",840,2),gi=new R("EUR",978,2),mi=new R("XXX",999,2),dt=new R("ETH",1001,18),On=new R("XBT",1002,8),lt=new R("ESP",10001,18),Ci=[it,fi,at,gi,mi,dt,On,lt],vi=new Map(Ci.map(n=>[n.alpha3Code,n]));class yi{convert(e){if(typeof e!="string")throw new $("CurrencyCodeDecoder: expected string");if(e==="BTC")return On;const r=vi.get(e);if(r===void 0)throw new $(`CurrencyCodeDecoder: unknown currency: "${e}"`);return r}}class Si{convert(e){return S(e,R),e.alpha3Code}}class bi extends c{constructor(){super(...arguments);t(this,"decoder",new yi);t(this,"encoder",new Si)}}const Re=new bi;class D{constructor(e,r){this.currency=e,this.value=r,this.currency=e,this.value=r}static USD(e){return new D(at,BigInt(e))}static ETH(e){return new D(dt,BigInt(e))}static ESP(e){return new D(lt,BigInt(e))}static JPY(e){return new D(it,BigInt(e))}static BTC(e){return new D(On,BigInt(e))}toString(){return De.encode(this)}toJSON(){return De.encode(this)}}function Ei(n){return n==="."||n===","||n===" "}function ki(n,e){let r=-1;const s=n.length;for(let o=0;o<s;o++)e(n[o])&&(r=o);return r}class xi{parseCurrencyCode(e){return Re.decode(e)}parseValue(e,r){let s=1n;r[0]==="-"&&(s=-1n,r=r.substring(1));const o=ki(r,Ei);if(o===-1){const w=BigInt(r.replace(/\D/g,""))*e.significantDigitsMultiplier;return s*w}const a=r.substring(0,o).replace(/\D/g,""),u=r.substring(o+1).replace(/\D/g,""),l=BigInt(a)*e.significantDigitsMultiplier,C=BigInt(u)*10n**BigInt(e.significantDigits-u.length);return s*(l+C)}convert(e){if(typeof e!="string")throw new $("MonetaryValueDecoder: expected string");const r=e.indexOf(" ");if(r<=-1)throw new $("MonetaryValueDecoder: missing non-breaking space");const s=e.substring(0,r),o=e.substring(r+1);if(/^-?[\d .,]+$/.test(s)){const u=this.parseCurrencyCode(o);return new D(u,this.parseValue(u,s))}const a=this.parseCurrencyCode(s);return new D(a,this.parseValue(a,o))}}class Ii{convert(e){S(e,D);const r=e.value<0n?"-":"",s=e.value<0n?-e.value:e.value,o=s%e.currency.significantDigitsMultiplier,a=s/e.currency.significantDigitsMultiplier,u=String(a),l=String(o);return/^0+$/.test(l)?`${Re.encode(e.currency)} ${r}${u}`:`${Re.encode(e.currency)} ${r}${a}.${String(o).padStart(e.currency.significantDigits,"0")}`}}class Ri extends c{constructor(){super(...arguments);t(this,"decoder",new xi);t(this,"encoder",new Ii)}}const De=new Ri;new F(new M(De),new T(De));class E{constructor(e,r,s,o){t(this,"namespace");t(this,"name");t(this,"site");t(this,"blockExplorer");this.namespace=e,this.name=r,this.site=s,this.blockExplorer=o}}const Di=new E(202374881,"Vienna",new URL("https://vienna.caldera.dev/"),new URL("https://vienna.calderaexplorer.xyz/")),Bi=new E(202374882,"OP Stack",new URL("https://stack.optimism.io/"),new URL("https://www.blockscout.com/")),Ai=new E(33914988448,"Arbitrum",new URL("https://arbitrum.io/"),new URL("https://arbiscan.io/")),Ni=new E(33914988449,"Eigen Layer",new URL("https://www.eigenlayer.xyz/"),new URL("https://www.blockscout.com/")),Ui=new E(33914988450,"Spire",new URL("https://www.spire.dev/"),new URL("https://www.blockscout.com/")),Oi=new E(33914988451,"Alt Layer",new URL("https://altlayer.io/"),new URL("https://www.blockscout.com/")),Wi=new E(33914988452,"Caldera",new URL("https://www.caldera.xyz/"),new URL("https://www.blockscout.com/")),Mi=new E(33914988453,"Vistara Labs",new URL("https://vistara.dev/"),new URL("https://www.blockscout.com/")),Ti=new E(33914988454,"Polygon",new URL("https://polygon.technology/"),new URL("https://www.blockscout.com/")),Fi=new E(263,"Milan",new URL("https://milan.caldera.dev/"),new URL("https://milan-devnet.explorer.caldera.xyz/")),Pi=new E(41234687,"Kyoto",new URL("https://example.com/"),new URL("https://kyoto-explorer.altlayer.io/")),Li=1397311310,ji=new E(Li,"Infinite Garden",new URL("https://infinitegarden.espressosys.com/"),new URL("https://explorer.main.net.espressosys.com/")),zi=new Map([Di,Bi,Ai,Ti,Ni,Ui,Oi,Wi,Mi,Fi,Pi,ji].map(n=>[n.namespace,n]));class se{constructor(e,r){t(this,"tag");t(this,"data");this.tag=e,this.data=r}static fromString(e){const r=e.indexOf("~");if(r<0)throw new yr;const s=e.substring(0,r),o=xn.decodeString(e.substring(r+1));return new se(s,o)}static inflate(e){return Hi.decode(e)}toString(){return`${this.tag}~${xn.encodeToString(this.data)}`}valueOf(){return this.toString()}toJSON(){return this.toString()}}class qi{convert(e){if(typeof e!="string")throw new h(typeof e,"string");return se.fromString(e)}}class Ji{convert(e){return S(e,se),e.toString()}}class $i extends c{constructor(){super(...arguments);t(this,"encoder",new Ji);t(this,"decoder",new qi)}}const Hi=new $i,ut=["Residential","Mobile","Enterprise","AWS","Azure","GCP"],ht=["Espresso v1.0","Espresso v1.1","Espresso v1.2","Espresso v1.3","Espresso v1.4"],wt=["Linux","Unix","Windows","MacOS"],pt=[["Espresso","https://espressosys.com/"],["BlockDaemon","https://www.blockdaemon.com/"],["Unit 410","https://unit410.com/"],["Nethermind","https://www.nethermind.io/"],["Sub7","https://sub7.xyz/"],["KudasaiJP","https://kudasai.co.jp/"],["Informal Systems","https://informal.systems/"],["P2P","https://p2p.org/"],["LinkPool","https://linkpool.com/"],["ZKV","https://zkvalidator.com/"],["Figment","https://figment.io/"]],Be=2147483648,Vi=1103515245,Qi=12345;class ft{constructor(e){t(this,"state");this.state=e!==void 0?e:Math.floor(Math.random()*(Be-1))}nextInt(){return this.state=(Vi*this.state+Qi)%Be,this.state}nextFloat(){return this.nextInt()/(Be-1)}nextRange(e,r){const s=r-e,o=this.nextInt()/Be;return e+Math.floor(o*s)}fillBytes(e){const r=new ArrayBuffer(e),s=new DataView(r);let o=0;for(;o<e-4;o+=4)s.setUint32(o,this.nextRange(0,4294967295));for(let a=o;a<e;a++)s.setUint8(a,this.nextRange(0,256));return r}}const Gi=[[["Mexico City",19.4333,-99.1333,"MX"],["Guadalajara",20.6767,-103.3475,"MX"],["Monterrey",25.6667,-100.3,"MX"],["Guatemala City",14.6133,-90.5353,"GT"],["Tijuana",32.525,-117.0333,"MX"],["Ecatepec",19.6097,-99.06,"MX"],["Tegucigalpa",14.1058,-87.2047,"HN"],["León de los Aldama",21.1167,-101.6833,"MX"],["San José",9.9325,-84.08,"CR"],["Panama City",8.9833,-79.5167,"PA"],["Juárez",31.745,-106.485,"MX"],["Comayagüela",14.098,-87.21,"HN"],["Mexicali",32.6633,-115.4678,"MX"],["Nezahualcóyotl",19.4081,-99.0186,"MX"],["Managua",12.1364,-86.2514,"NI"],["Morelia",19.7683,-101.1894,"MX"],["Aguascalientes",21.876,-102.296,"MX"],["Mérida",20.97,-89.62,"MX"],["Saltillo",25.4231,-100.9919,"MX"],["Culiacán",24.8069,-107.3939,"MX"]],[["Havana",23.1367,-82.3589,"CU"],["San Juan",18.3985,-66.061,"PR"],["Santiago",19.4572,-70.6889,"DO"],["Santo Domingo",18.4667,-69.95,"DO"],["Port-au-Prince",18.5333,-72.3333,"HT"],["Santo Domingo Este",18.4855,-69.8734,"DO"],["Kingston",17.9714,-76.7931,"JM"],["Carrefour",18.5344,-72.4094,"HT"],["Santiago de Cuba",20.0217,-75.8294,"CU"],["Pétion-Ville",18.5128,-72.2864,"HT"],["Holguín",20.8869,-76.2592,"CU"],["Gonaïves",19.4456,-72.6883,"HT"],["Camagüey",21.3839,-77.9075,"CU"],["Puerto Plata",19.8,-70.6833,"DO"],["Croix-des-Bouquets",18.5761,-72.2269,"HT"],["Nassau",25.0781,-77.3386,"BS"],["Fort-de-France",14.6,-61.0667,"MQ"],["Higüey",18.6167,-68.7,"DO"],["Santa Clara",22.4069,-79.9649,"CU"],["Bayamo",20.3817,-76.6428,"CU"]],[["Cairo",30.0444,31.2358,"EG"],["Lagos",6.455,3.3841,"NG"],["Kinshasa",-4.3219,15.3119,"CD"],["Luanda",-8.8383,13.2344,"AO"],["Johannesburg",-26.2044,28.0456,"ZA"],["Dar es Salaam",-6.8161,39.2803,"TZ"],["Douala",4.05,9.7,"CM"],["Giza",29.987,31.2118,"EG"],["Abidjan",5.3167,-4.0333,"CI"],["Cape Town",-33.9253,18.4239,"ZA"],["Bamako",12.6392,-8.0028,"ML"],["Abuja",9.0667,7.4833,"NG"],["Ibadan",7.3964,3.9167,"NG"],["Addis Ababa",9.03,38.74,"ET"],["Mbuji-Mayi",-6.15,23.6,"CD"],["Mogadishu",2.0392,45.3419,"SO"],["Lusaka",-15.4167,28.2833,"ZM"],["Antananarivo",-18.91,47.525,"MG"],["Awka",6.2069,7.0678,"NG"],["Bamenda",5.9614,10.1517,"CM"]],[["Tokyo",35.6897,139.6922,"JP"],["Delhi",28.61,77.23,"IN"],["Manila",14.5958,120.9772,"PH"],["Dhaka",23.7639,90.3889,"BD"],["Moscow",55.7558,37.6172,"RU"],["Ho Chi Minh City",10.7756,106.7019,"VN"],["Xi’an",34.2611,108.9422,"CN"],["Dongguan",23.021,113.752,"CN"],["Tongshan",34.204,117.284,"CN"],["Jining",35.4151,116.5871,"CN"],["Cangzhou",38.3047,116.8387,"CN"],["Shaoyang",27.2395,111.4679,"CN"],["Dalian",38.9,121.6,"CN"],["Ankara",39.93,32.85,"TR"],["Zhangzhou",24.513,117.647,"CN"],["Changsha",28.228,112.939,"CN"],["Ürümqi",43.8225,87.6125,"CN"],["Ningbo",29.8603,121.6245,"CN"],["Suihua",46.654,126.969,"CN"],["Deyang",31.127,104.398,"CN"]],[["London",51.5072,-.1275,"GB"],["Madrid",40.4169,-3.7033,"ES"],["Berlin",52.52,13.405,"DE"],["Barcelona",41.3828,2.1769,"ES"],["Athens",37.9842,23.7281,"GR"],["Budapest",47.4925,19.0514,"HU"],["Birmingham",52.48,-1.9025,"GB"],["Stuttgart",48.7775,9.18,"DE"],["Munich",48.1375,11.575,"DE"],["Hamburg",53.55,10,"DE"],["Bucharest",44.4325,26.1039,"RO"],["Vienna",48.2083,16.3725,"AT"],["Stockholm",59.3294,18.0686,"SE"],["Minsk",53.9,27.5667,"BY"],["Warsaw",52.23,21.0111,"PL"],["Valencia",39.47,-.3764,"ES"],["Amsterdam",52.3728,4.8936,"NL"],["Copenhagen",55.6761,12.5683,"DK"],["Porto",41.1621,-8.622,"PT"],["Brussels",50.8467,4.3525,"BE"]],[["New York",40.6943,-73.9249,"US"],["Los Angeles",34.1141,-118.4068,"US"],["Chicago",41.8375,-87.6866,"US"],["Miami",25.784,-80.2101,"US"],["Dallas",32.7935,-96.7667,"US"],["Philadelphia",40.0077,-75.1339,"US"],["Atlanta",33.7628,-84.422,"US"],["Boston",42.3188,-71.0852,"US"],["Phoenix",33.5722,-112.0892,"US"],["Detroit",42.3834,-83.1024,"US"],["Seattle",47.6211,-122.3244,"US"],["San Francisco",37.7558,-122.4449,"US"],["San Diego",32.8313,-117.1222,"US"],["Minneapolis",44.9635,-93.2678,"US"],["Brooklyn",40.6501,-73.9496,"US"],["Vancouver",49.25,-123.1,"CA"],["Riverside",33.9381,-117.3949,"US"],["Baltimore",39.3051,-76.6144,"US"],["Portland",45.5371,-122.65,"US"],["Sacramento",38.5677,-121.4685,"US"]],[["Melbourne",-37.8142,144.9631,"AU"],["Sydney",-33.8678,151.21,"AU"],["Brisbane",-27.4678,153.0281,"AU"],["Perth",-31.9559,115.8606,"AU"],["Auckland",-36.8406,174.74,"NZ"],["Adelaide",-34.9275,138.6,"AU"],["Port Moresby",-9.4789,147.1494,"PG"],["Gold Coast",-28.0167,153.4,"AU"],["Cranbourne",-38.0996,145.2834,"AU"],["Christchurch",-43.531,172.6365,"NZ"],["Manukau City",-37,174.885,"NZ"],["Central Coast",-33.3,151.2,"AU"],["Wollongong",-34.4331,150.8831,"AU"],["Ipswich",-27.6144,152.7608,"AU"],["Wellington",-41.2889,174.7772,"NZ"],["Northcote",-36.8019,174.7494,"NZ"],["Hobart",-42.8806,147.325,"AU"],["Lae",-6.7303,147.0008,"PG"],["Suva",-18.1416,178.4419,"FJ"],["Nouméa",-22.2758,166.458,"NC"]],[["São Paulo",-23.55,-46.6333,"BR"],["Buenos Aires",-34.6033,-58.3817,"AR"],["Rio de Janeiro",-22.9111,-43.2056,"BR"],["Lima",-12.06,-77.0375,"PE"],["Bogotá",4.7111,-74.0722,"CO"],["Santiago",-33.4372,-70.6506,"CL"],["Belo Horizonte",-19.9167,-43.9333,"BR"],["Fortaleza",-3.7275,-38.5275,"BR"],["Santa Cruz de la Sierra",-17.7892,-63.1975,"BO"],["La Paz",-16.4958,-68.1333,"BO"],["Guayaquil",-2.19,-79.8875,"EC"],["Medellín",6.2308,-75.5906,"CO"],["Salvador",-12.9747,-38.4767,"BR"],["Caracas",10.4806,-66.9036,"VE"],["Córdoba",-31.4167,-64.1833,"AR"],["Santos",-23.9369,-46.325,"BR"],["Curitiba",-25.4297,-49.2711,"BR"],["Maracaibo",10.6333,-71.6333,"VE"],["Recife",-8.05,-34.9,"BR"],["Porto Alegre",-30.0331,-51.23,"BR"]]],gt=[0,0,5,26,28,26,9,6],Xi=gt.reduce((n,e)=>n+e,0),Zi=gt.reduce((n,e)=>{const r=n[n.length-1]??0;return n.push(r+e),n},[]),_i=Array.from(hc(Zi,Gi,(n,e)=>[n,e])),Wn=new Date,mt=new Date(Wn.getFullYear(),Wn.getMonth(),Wn.getDate()).valueOf();function Ki(){return mt}Array.from(zi.keys());function Yi(n){const e=n.nextRange(0,Xi),r=dc(_i,([u])=>u<=e),[,s]=Hr(r),o=n.nextRange(0,s.length);return s[o]}function ea(n){const e=n.nextRange(0,pt.length);return pt[e]}function na(n){const e=n.nextRange(0,wt.length);return wt[e]}function ra(n){const e=n.nextRange(0,ht.length);return ht[e]}function ta(n){const e=n.nextRange(0,ut.length);return ut[e]}function sa(n){const[e,r]=ea(n),[,s,o,a]=Yi(n),u=na(n),l=ra(n),C=ta(n);return{pubkey:new se("PUBKEY",n.fillBytes(32)),name:`${e} Node ${a} ${n.nextRange(0,100)}`,address:n.fillBytes(32),company:{name:e,website:r},location:{coords:[s,o],country:a},operatingSystem:u,networkType:C,nodeType:l}}function*oa(){const n=new ft(mt),e=n.nextRange(50,150);for(let r=0;r<e;r++)yield sa(n)}Array.from(oa());class Mn{constructor(e,r){t(this,"block");t(this,"offset");this.block=e,this.offset=r,Object.freeze(this)}toJSON(){return Tn.encode(this)}}class ca{convert(e){return{block:m.encode(e.block),offset:m.encode(e.offset)}}}class ia{convert(e){return d(e,"block","offset"),new Mn(m.decode(e.block),m.decode(e.offset))}}class aa extends c{constructor(){super(...arguments);t(this,"encoder",new ca);t(this,"decoder",new ia)}}const Tn=new aa;class Ct{constructor(e){t(this,"address");this.address=e,Object.freeze(this)}toJSON(){return Fn.encode(this)}}class da{convert(e){return N.encode(e.address)}}class la{convert(e){return new Ct(N.decode(e))}}class ua extends c{constructor(){super(...arguments);t(this,"encoder",new da);t(this,"decoder",new la)}}const Fn=new ua;class vt{constructor(e,r,s){t(this,"address");t(this,"time");t(this,"message");this.address=e,this.time=r,this.message=s,Object.freeze(this)}toJSON(){return L.encode(this)}}class ha{convert(e){return{address:Fn.encode(e.address),time:m.encode(Math.floor(e.time.valueOf()/1e3)),message:i.encode(e.message)}}}class wa{convert(e){return d(e,"address","time","message"),new vt(Fn.decode(e.address),new Date(m.decode(e.time)*1e3),i.decode(e.message))}}class pa extends c{constructor(){super(...arguments);t(this,"encoder",new ha);t(this,"decoder",new wa)}}const L=new pa;new F(new M(L),new T(L));class Pn{constructor(e,r){t(this,"inscription");t(this,"chainDetails");this.inscription=e,this.chainDetails=r,Object.freeze(this)}toJSON(){return oe.encode(this)}}class fa{convert(e){return{inscription:L.encode(e.inscription),chain_details:Tn.encode(e.chainDetails)}}}class ga{convert(e){return d(e,"inscription","chain_details"),new Pn(L.decode(e.inscription),Tn.decode(e.chain_details))}}class ma extends c{constructor(){super(...arguments);t(this,"encoder",new fa);t(this,"decoder",new ga)}}const oe=new ma,Ln=new F(new M(oe),new T(oe));class yt{static get big(){return Ae.instance}static get little(){return Ne.instance}get isLittleEndian(){return this===Ne.instance}get isBigEndian(){return this===Ae.instance}}const Fe=class Fe extends yt{};t(Fe,"instance",new Fe);let Ae=Fe;const Pe=class Pe extends yt{};t(Pe,"instance",new Pe);let Ne=Pe;class Ca{constructor(e,r){t(this,"inscription");t(this,"signature");this.inscription=e,this.signature=r,Object.freeze(this)}toJSON(){return jn.encode(this)}}class va{convert(e){return{inscription:L.encode(e.inscription),signature:N.encode(e.signature)}}}class ya{convert(e){return d(e,"inscription","signature"),new Ca(L.decode(e.inscription),N.decode(e.signature))}}class Sa extends c{constructor(){super(...arguments);t(this,"encoder",new va);t(this,"decoder",new ya)}}const jn=new Sa;class St{}const zn="PutInscription";class Ue extends St{constructor(r){super();t(this,"inscriptionAndSignature");this.inscriptionAndSignature=r,Object.freeze(this)}toJSON(){return qn.encode(this)}}class ba{convert(e){return{type:i.encode(zn),inscription_and_signature:jn.encode(e.inscriptionAndSignature)}}}class Ea{convert(e){return d(e,"type","inscription_and_signature"),tr(e,zn),new Ue(jn.decode(e.inscription_and_signature))}}class ka extends c{constructor(){super(...arguments);t(this,"encoder",new ba);t(this,"decoder",new Ea)}}const qn=new ka,Jn="RetrieveInscriptionsForAddress";class $n extends St{constructor(r){super();t(this,"address");this.address=r,Object.freeze(this)}toJSON(){return Hn.encode(this)}}class xa{convert(e){return{type:i.encode(Jn),address:i.encode(e.address)}}}class Ia{convert(e){return d(e,"type","address"),tr(e,Jn),new $n(i.decode(e.address))}}class Ra extends c{constructor(){super(...arguments);t(this,"encoder",new xa);t(this,"decoder",new Ia)}}const Hn=new Ra;class Da{convert(e){return e instanceof Ue?qn.encode(e):e instanceof $n?Hn.encode(e):e.toJSON()}}class Ba{convert(e){if(d(e,"type"),!z(e.type))throw new h(typeof e.type,"string");switch(e.type){case zn:return qn.decode(e);case Jn:return Hn.decode(e);default:throw new h(e.type,"CappuccinoInscriptionRequest")}}}class Aa extends c{constructor(){super(...arguments);t(this,"encoder",new Da);t(this,"decoder",new Ba)}}const bt=new Aa,ce="Inscription";class Vn extends Xr{constructor(r){super();t(this,"request");this.request=r}get type(){return ce}toJson(){return Et.encode(this)}}class Na{convert(e){return{[ce]:bt.encode(e.request)}}}class Ua{convert(e){d(e,ce);const r=e[ce];return new Vn(bt.decode(r))}}class Oa extends c{constructor(){super(...arguments);t(this,"encoder",new Na);t(this,"decoder",new Ua)}}const Et=new Oa;class Qn{}const Oe="LatestInscription";class ie extends Qn{constructor(r){super();t(this,"inscriptionAndChainDetails");this.inscriptionAndChainDetails=r}toJSON(){return Gn.encode(this)}}class Wa{convert(e){d(e,Oe);const r=e[Oe];return new ie(oe.decode(r))}}class Ma{convert(e){return{[Oe]:oe.encode(e.inscriptionAndChainDetails)}}}class Ta extends c{constructor(){super(...arguments);t(this,"encoder",new Ma);t(this,"decoder",new Wa)}}const Gn=new Ta,We="RetrievedInscriptionsForWalletAddress";class Xn extends Qn{constructor(r){super();t(this,"inscriptionAndChainDetails");this.inscriptionAndChainDetails=r}toJSON(){return Zn.encode(this)}}class Fa{convert(e){d(e,We);const r=e[We];return new Xn(Ln.decode(r))}}class Pa{convert(e){return{[We]:Ln.encode(e.inscriptionAndChainDetails)}}}class La extends c{constructor(){super(...arguments);t(this,"encoder",new Pa);t(this,"decoder",new Fa)}}const Zn=new La;class ja{constructor(e,r,s){t(this,"numBlocks");t(this,"numTransactions");t(this,"numInscriptions");this.numBlocks=e,this.numTransactions=r,this.numInscriptions=s}}class za{convert(e){return{num_blocks:m.encode(e.numBlocks),num_transactions:m.encode(e.numTransactions),num_inscriptions:m.encode(e.numInscriptions)}}}class qa{convert(e){return d(e,"num_blocks","num_transactions","num_inscriptions"),new ja(m.decode(e.num_blocks),m.decode(e.num_transactions),m.decode(e.num_inscriptions))}}class Ja extends c{constructor(){super(...arguments);t(this,"encoder",new za);t(this,"decoder",new qa)}}const kt=new Ja,Me="Stats";class xt extends Qn{constructor(r){super();t(this,"stats");this.stats=r}toJSON(){return _n.encode(this)}}class $a{convert(e){d(e,Me);const r=e[Me];return new xt(kt.decode(r))}}class Ha{convert(e){return{[Me]:kt.encode(e.stats)}}}class Va extends c{constructor(){super(...arguments);t(this,"encoder",new Ha);t(this,"decoder",new $a)}}const _n=new Va;class Qa{convert(e){if(Je(e,Oe))return Gn.decode(e);if(Je(e,Me))return _n.decode(e);if(Je(e,We))return Zn.decode(e);throw new b}}class Ga{convert(e){if(e instanceof ie)return Gn.encode(e);if(e instanceof xt)return _n.encode(e);if(e instanceof Xn)return Zn.encode(e);throw new b}}class Xa extends c{constructor(){super(...arguments);t(this,"encoder",new Ga);t(this,"decoder",new Qa)}}const Kn=new Xa,ae="InscriptionResponse";class It extends Dn{constructor(r){super();t(this,"response");this.response=r}get type(){return ae}toJson(){return Rt.encode(this)}}class Za{convert(e){return{[ae]:Kn.encode(e.response)}}}class _a{convert(e){d(e,ae);const r=e[ae];return new It(Kn.decode(r))}}class Ka extends c{constructor(){super(...arguments);t(this,"encoder",new Za);t(this,"decoder",new _a)}}const Rt=new Ka;class Ya{convert(e){return new It(e)}}const Dt=new Ya,ed="An Infinite Garden has no walls";function*nd(n){const e=new Date;let s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=0;for(;;){const a=sd(s,o,n);yield a,s=a.inscription.time,o=a.chainDetails.block}}function*rd(n){const e=new Date,r=n[Symbol.iterator]();for(let s=r.next();!s.done&&s.value.inscription.time.valueOf()<e.valueOf();s=r.next())yield s.value}async function*td(n){for(const e of n){const r=new Date,o=e.inscription.time.valueOf()-r.valueOf();o>0&&await ct(o),yield e}}function sd(n,e,r){const s=r.nextRange(5,10)*1e3,o=r.nextRange(1,20),a=r.nextRange(0,5),u=new vt(od(r),new Date(n.valueOf()+s),ed),l=new Mn(e+o,a);return new Pn(u,l)}function od(n){return new Ct(n.fillBytes(20))}class cd{constructor(e,r){t(this,"responseStream");t(this,"requestStream");t(this,"webSocketStatusSink");t(this,"inscriptionResponseSink");t(this,"prng",new ft(Ki()));t(this,"latestInscriptions",Pr(100));t(this,"allInscriptions",nd(this.prng));t(this,"isConnected",!1);this.requestStream=e,this.responseStream=r,this.webSocketStatusSink=te(V(r),ot),this.inscriptionResponseSink=te(V(r),Dt)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async initializeState(){for(const e of rd(this.allInscriptions))this.latestInscriptions.put(e)}async startProcessing(){await this.initializeState(),this.handleRequests(),this.streamInscriptions()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async streamInscriptions(){for await(const e of td(this.allInscriptions))this.latestInscriptions.put(e),this.isConnected&&this.inscriptionResponseSink.send(new ie(e))}async handleRequest(e){if(e instanceof Rn){try{await this.handleWebSocketCommand(e.command)}catch(r){console.error("failed to handle life cycle request",e,r)}return}if(e instanceof Vn){try{await this.handleInscriptionsRequest(e.request)}catch(r){console.error("failed to handle node validator request",e,r)}return}console.error("unrecognized request type",e)}async handleWebSocketCommand(e){if(e instanceof Ee){await this.handleConnect();return}if(e instanceof be){await this.handleClose();return}}async handleInscriptionsRequest(e){if(e instanceof Ue){await this.handlePutInscription(e);return}throw new b}async handleConnect(){if(this.isConnected)throw new Error("already connected to WebSocket");this.isConnected=!0,await this.webSocketStatusSink.send(new xe),await this.webSocketStatusSink.send(new Ie);for(const e of this.latestInscriptions.immutableIterable())this.inscriptionResponseSink.send(new ie(e))}async handleClose(){if(!this.isConnected)throw new Error("not connected to WebSocket");this.isConnected=!1,await this.webSocketStatusSink.send(new ke)}async handlePutInscription(e){const r=Hr(this.latestInscriptions.immutableIterable()),s=new Mn(r.chainDetails.block+1,0),o=new Pn(e.inscriptionAndSignature.inscription,s);this.latestInscriptions.put(o),await ct(1e3*20),await this.inscriptionResponseSink.send(new ie(o))}}const Yn="WebSocketError";class Te extends g{constructor(r,s=`websocket error: ${String(r)}`){super(s);t(this,"cause");this.cause=r,Object.freeze(this)}get code(){return Yn}}class id{convert(e){return d(e,"code","message"),p(e,Yn),new Te({},i.decode(e.message))}}class ad extends y{}class dd extends c{constructor(){super(...arguments);t(this,"encoder",new ad);t(this,"decoder",new id)}}const ld=new dd;f(Yn,ld);class ud{constructor(e,r,s,o){t(this,"responseStream");t(this,"requestStream");t(this,"serviceBaseWebSocketURL");t(this,"serviceBaseURL");t(this,"lifecycleResponseSink");t(this,"inscriptionResponseSink");t(this,"errorResponseSink");t(this,"webSocket",null);t(this,"webSocketCompleter",null);t(this,"retrieveInscriptionsForAddressCache",new Map);this.requestStream=e,this.responseStream=r,this.serviceBaseWebSocketURL=s,this.serviceBaseURL=o,this.lifecycleResponseSink=te(V(r),ot),this.inscriptionResponseSink=te(V(r),Dt),this.errorResponseSink=te(V(r),hi)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof Rn){try{await this.handleWebSocketRequest(e.command)}catch(r){console.error("failed to handle life cycle request",e,r)}return}if(e instanceof Vn){try{const r=await this.handleInscriptionsRequest(e.request);r&&await this.inscriptionResponseSink.send(r)}catch(r){if(!(r instanceof g)){console.error("unhandled error from put inscription request",e,r);return}await this.errorResponseSink.send(r)}return}console.error("unrecognized request type",e)}async handleWebSocketRequest(e){if(e instanceof Ee){await this.handleConnect();return}if(e instanceof be){await this.handleClose();return}}async handleInscriptionsRequest(e){if(e instanceof Ue){await this.webSocketCompleter.promise,await this.handlePutInscription(e);return}if(e instanceof $n)return await this.handleRetrieveInscriptionsForAddressMemoized(e);throw new b}assertNotConnected(){if(this.webSocket!==null)throw new Error("Already connected")}assertConnected(){if(this.webSocket===null)throw new Error("Not connected")}async handleConnect(){this.assertNotConnected(),await this.lifecycleResponseSink.send(new xe);const e=new URL("inscriptions/inscriptions",this.serviceBaseWebSocketURL),r=me();this.webSocketCompleter=r;try{const s=new hd(this.inscriptionResponseSink),o=new wd(r,this.lifecycleResponseSink),a=new pd(this.lifecycleResponseSink),u=new fd(this.errorResponseSink),l=new WebSocket(e);l.onerror,l.addEventListener("open",o),l.addEventListener("message",s),l.addEventListener("close",a),l.addEventListener("error",u),l.addEventListener("close",()=>{l.removeEventListener("open",o),l.removeEventListener("message",s),l.removeEventListener("close",a),l.removeEventListener("error",u),this.webSocket=null}),this.webSocket=l}catch(s){const o=new Te(s);this.errorResponseSink.send(o),r.completeError(o)}}async handleClose(){this.assertConnected(),this.webSocket.close(1e3,"done")}async handlePutInscriptionFetch(e){try{return await fetch(new URL("inscriptions/put_inscription",this.serviceBaseURL),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.inscriptionAndSignature)})}catch(r){throw new Ke(r)}}validateResponse(e){if(!e.ok)throw e.status>=400&&e.status<500?new ar(e.status,e):e.status>=500&&e.status<600?new hr(e.status,e):new lr(e.status,e);if(e.headers.get("content-type")!=="application/json")throw new H(e.headers.get("content-type")??"undefined",e.status,e)}async handlePutInscription(e){const r=await this.handlePutInscriptionFetch(e);return this.validateResponse(r),null}async handleRetrieveInscriptionsForAddressFetch(e){try{return await fetch(new URL(`inscriptions/inscriptions_for_wallet_address/${e.address}`,this.serviceBaseURL),{method:"GET",headers:{Accept:"application/json"}})}catch(r){throw new Ke(r)}}async handleRetrieveInscriptionsForAddress(e){const r=await this.handleRetrieveInscriptionsForAddressFetch(e);return this.validateResponse(r),new Xn(Ln.decode(await r.json()))}async handleRetrieveInscriptionsForAddressMemoized(e){if(this.retrieveInscriptionsForAddressCache.has(e.address))return this.retrieveInscriptionsForAddressCache.get(e.address);const r=await this.handleRetrieveInscriptionsForAddress(e);return this.retrieveInscriptionsForAddressCache.set(e.address,r),r}}class hd{constructor(e){t(this,"inscriptionResponseSink");this.inscriptionResponseSink=e}decodeMessage(e){return Kn.decode(JSON.parse(e.data))}async relayMessage(e){try{await this.inscriptionResponseSink.send(e)}catch(r){console.error("attempt to publish message to response stream failed",r)}}async handleEvent(e){try{const r=this.decodeMessage(e);this.relayMessage(r)}catch(r){console.error("Failed to decode server message from web socket",r);return}}}class wd{constructor(e,r){t(this,"completer");t(this,"lifecycleResponseSink");this.completer=e,this.lifecycleResponseSink=r}handleEvent(e){this.completer.complete(e.target),this.lifecycleResponseSink.send(new Ie)}}class pd{constructor(e){t(this,"lifecycleResponseSink");this.lifecycleResponseSink=e}async handleEvent(){await this.lifecycleResponseSink.send(new ke)}}class fd{constructor(e){t(this,"errorResponseSink");this.errorResponseSink=e}errorFromEvent(e){return"error"in e?new Te(e.error):new Te(null,"web socket error: unknown error")}handleEvent(e){this.errorResponseSink.send(this.errorFromEvent(e))}}di(ae,Rt),jc(ce,Et);async function gd(n){const e=new URL(n),r=new URL(`${e.protocol.replace(/^http?/,"ws")}//${e.host}${e.pathname}`),s=ve(1024),o=ve(1024),a=new ud(s,o,r,e);return a.startProcessing(),a}async function md(){try{const o=await(await fetch("/config.json")).json();if(o.inscription_service_url){const a=await gd(o.inscription_service_url);if(a!==null)return a}}catch(s){console.warn("error determining service implementation, from configuration file",s)}const n=ve(1024),e=ve(1024),r=new cd(n,e);return r.startProcessing(),r}async function Cd(){return new vd(await md())}class vd{constructor(e){t(this,"service");this.service=e}get stream(){return this.service.stream}async send(e){return this.service.send(e)}}async function yd(n,e){const r=await n;for await(const s of r.stream)e(li.encode(s))}class Sd{constructor(e){t(this,"service");const r=Cd();this.service=r,yd(r,e)}async handleEvent(e){const r=zc.decode(e.data);try{(await this.service).send(r)}catch(s){console.warn("error processing message from event",s)}}}self.addEventListener("message",new Sd(self.postMessage.bind(self)))})();
