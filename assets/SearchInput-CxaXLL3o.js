var F=Object.defineProperty;var _=(r,e,s)=>e in r?F(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var c=(r,e,s)=>_(r,typeof e!="symbol"?e+"":e,s);import{j as t}from"./jsx-runtime-BlAj40OV.js";import{P as E}from"./PromiseResolver-Bf61tBMF.js";import{P as V}from"./IconButton-DmUE976j.js";import{D as f,L as B,E as D}from"./LoadingProvider-BbWjDjJb.js";import{P as y}from"./PathResolverProvider-Xv58eOQd.js";import{a as U}from"./Card-RHc01-Zp.js";import{C as G,a as $}from"./Completer-4eUr9S2j.js";import{a as C,b,i as v,C as I}from"./CappuccinoHotShotQueryServiceAPIContext-CZXr4p-G.js";import{N as p}from"./NumberText-C4Z_0tU7.js";import{R as z}from"./RelativeTimeText-MUfD-2Qu.js";import{T as u}from"./Text-BU7JBOLk.js";import{j as N}from"./typography-D2UEeKZ7.js";import{S as A}from"./SearchGlass-BTYiCYPh.js";import{R as n}from"./index-Cs7sjTYM.js";import{a as W}from"./higher_order-DnPEgWEz.js";const g=r=>t.jsx("div",{className:W(r.className,"input-container"),role:r.role,children:r.children});try{g.displayName="InputContainer",g.__docgenInfo={description:"InputContainer is a `div` container that assists in styling `input` elements.\nTraditionally `input` elements are very difficult to style as they don't\nexactly follow the content box model or the border box model.\n\nIn order to normalize input elements it is helpful to have them follow some\nother element's sizing rules directly instead of allowing them to have their\nown.\n\nThis is the purpose of the `InputContainer` component. It provides a sizable\ncontainer that follows the border box model in which an `input` element\ncan be fitted, and that `input` will attempt to fill all of the available\nspace of the `InputContainer`.",displayName:"InputContainer",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"",name:"role",required:!1,type:{name:"string"}}}}}catch{}const R=N("div"),S=N("label");function x(r){r.stopPropagation(),r.preventDefault()}function H(r){const e=r.indexOf("~");if(e<0)return r.toLocaleUpperCase();const s=r.substring(0,e),a=r.substring(e+1);return`${s.toLocaleUpperCase()}~${a}`}function K(){if(typeof window>"u")return{href:""};let r=window;for(;r!==r.parent;)r=r.parent;return r.location}class Q{constructor(e){c(this,"pRawQuery");c(this,"pQuery");c(this,"pSearchResults");c(this,"pSearchResultsQuery");c(this,"pIsLoading");c(this,"pOffset");c(this,"pLocation");const{rawQuery:s="",query:a="",searchResults:o=new C(new b([],[])),searchResultsQuery:l="",isLoading:i=!1,offset:m=null,location:h=K()}=e||{};this.pRawQuery=s,this.pQuery=a,this.pSearchResultsQuery=l,this.pSearchResults=o,this.pIsLoading=i,this.pOffset=m,this.pLocation=h}get rawQuery(){return this.pRawQuery}get query(){return this.pQuery}get searchResults(){return this.pSearchResults}get searchResultsQuery(){return this.pSearchResultsQuery}get isLoading(){return this.pIsLoading}get offset(){return this.pOffset}get totalSearchResults(){return this.searchResults.searchResults.transactions.length+this.searchResults.searchResults.blocks.length}setQuery(e){this.pRawQuery=e,this.pQuery=H(e),this.pOffset=null}setSearchResults(e,s){this.pSearchResults=s,this.pSearchResultsQuery=e,this.pOffset=null}setSearchResultsEmpty(){this.pOffset=null,this.pQuery="",this.pRawQuery="",this.pSearchResultsQuery="",this.pSearchResults=new C(new b([],[]))}setLoading(e,s){this.pSearchResultsQuery=e,this.pIsLoading=s}setOffset(e){this.pOffset=e;const s=document.querySelector(`[data-index="${e}"]`);s&&"scrollIntoView"in s&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({block:"nearest",behavior:"smooth"})}navigateTo(e){this.pLocation.href=e}async activate(e,s){if(this.offset===null){if(this.query==="")return;if(/^\d+$/.test(this.query)){const o=Number(this.query);if(Number.isNaN(o)||!Number.isInteger(o))return;this.navigateTo(s.block(o));return}try{const o=await e.explorer.getSearchResult(new v(this.query));if(o.searchResults.blocks.length>0){this.navigateTo(s.block(o.searchResults.blocks[0].height));return}if(o.searchResults.transactions.length>0){const l=o.searchResults.transactions[0];this.navigateTo(s.transaction(l.height,l.offset));return}}catch{}return}const a=this.getResultForOffset(this.offset);if(a instanceof G){this.navigateTo(s.block(a.height));return}if(a instanceof $){this.navigateTo(s.transaction(a.height,a.offset));return}}getResultForOffset(e){const s=this.searchResults.searchResults;return e>=s.blocks.length?s.transactions[e-s.blocks.length]:s.blocks[e]}getValueForOffset(e){return this.getResultForOffset(e).hash.toString()}}const j=n.createContext(new Q),k=n.createContext(()=>{});function J(r){const[e]=n.useState(new Q(r)),[s,a]=n.useState(0);return[e,()=>a(s+1)]}const w=r=>{const[e,s]=J(r.initialState),a=n.useContext(I),o=n.useContext(y);return t.jsx(j.Provider,{value:e,children:t.jsx(k.Provider,{value:s,children:t.jsx(T.Provider,{value:e.offset,children:t.jsx(d.Provider,{value:e.query,children:t.jsxs(g,{className:"search",role:"search",children:[t.jsx("input",{type:"search",placeholder:"Search blocks, transactions, rollups or addresses...",value:e.offset===null?e.rawQuery:e.getValueForOffset(e.offset),onKeyDown:l=>{if(l.code==="Escape"){x(l),l.currentTarget.blur();return}if(l.code==="Enter"){x(l),e.activate(a,o);return}if(l.code==="ArrowDown"){if(x(l),e.totalSearchResults<=0)return;if(e.offset===null){e.setOffset(0),s();return}const i=e.totalSearchResults;if(e.offset===i-1){e.setOffset(null),s();return}e.setOffset(e.offset+1),s();return}if(l.code==="ArrowUp"){if(x(l),e.totalSearchResults<=0)return;const i=e.totalSearchResults;if(e.offset===null){e.setOffset(i-1),s();return}if(e.offset===0){e.setOffset(null),s();return}e.setOffset(e.offset-1),s();return}},onChange:async l=>{const i=l.currentTarget.value.trim();if(i!==e.query){if(i===""){e.setSearchResultsEmpty(),s();return}e.setQuery(i),s()}},"data-focused":r.forceFocusState?!0:void 0,"aria-label":"search text"}),t.jsx(M,{}),t.jsx(V,{children:t.jsx(A,{})}),t.jsx(X,{}),t.jsx(f.Provider,{value:e.searchResults,children:t.jsx(Z,{})})]})})})})})},d=n.createContext(""),M=()=>t.jsx("div",{className:"search-barrier"}),X=()=>{const r=n.useContext(I),e=n.useContext(j),s=n.useContext(d);return s===""?t.jsx(t.Fragment,{}):s!==e.query?t.jsx(t.Fragment,{}):e.query===e.searchResultsQuery?t.jsx(t.Fragment,{}):t.jsx(E,{promise:Promise.all([Promise.resolve(s),r.explorer.getSearchResult(new v(s))]),children:t.jsx(Y,{})})},Y=()=>{const r=n.useContext(j),e=n.useContext(B),s=n.useContext(D),a=n.useContext(f),o=n.useContext(k);return n.useEffect(()=>{if(!e&&!(r.isLoading||s)&&a[0]===r.query)return r.setLoading(a[0],!1),r.setSearchResults(a[0],a[1]),o(),()=>{}},[r,e,s,a,o]),t.jsx(t.Fragment,{})},Z=()=>{const r=n.useContext(f);return n.useContext(d).length<=0&&r.searchResults.blocks.length<=0&&r.searchResults.transactions.length<=0?t.jsx(t.Fragment,{}):t.jsx(ee,{})},ee=()=>t.jsx(U,{className:"search-results",children:t.jsxs("section",{"aria-label":"search results",className:"search-results-scroll-container",children:[t.jsx(te,{}),t.jsx(se,{}),t.jsx(ne,{})]})}),T=n.createContext(null),O=({children:r,index:e})=>{const s=n.useContext(T);return t.jsx("div",{"data-selected":s===e,"data-index":e,className:"result-row",children:t.jsx("div",{className:"result-row-content",children:r})})},q=n.createContext(null),te=()=>{const r=n.useContext(f),e=n.useContext(d);return r.searchResults.blocks.length>0||r.searchResults.transactions.length>0||e.length<=0?t.jsx(t.Fragment,{}):t.jsx("section",{"aria-label":"no-results",children:t.jsx(S,{className:"result-section-title",children:t.jsx(u,{text:"No results found"})})})},se=()=>{const r=n.useContext(y),e=n.useContext(f),{searchResults:s}=e,{blocks:a}=s;if(a.length<=0)return t.jsx(t.Fragment,{});const o=0;return t.jsxs("section",{"aria-label":"block-results",children:[t.jsx(S,{className:"result-section-title",children:t.jsx(u,{text:"Blocks"})}),a.map((l,i)=>t.jsx("a",{href:r.block(l.height),children:t.jsx(q.Provider,{value:[l,i+o],children:t.jsx(O,{index:i+o,children:t.jsx(re,{})},i+o)})},i+o))]})},L=r=>t.jsx("div",{className:"commit",children:r.children}),re=()=>{const r=n.useContext(d),[e]=n.useContext(q),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(L,{children:[t.jsx(u,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(u,{text:s.substring(r.length)})})]}),t.jsx(R,{children:t.jsx(p,{number:e.height})})]})},P=n.createContext(null),ne=()=>{const r=n.useContext(y),e=n.useContext(f),{searchResults:s}=e,{blocks:a,transactions:o}=s;if(o.length<=0)return t.jsx(t.Fragment,{});const l=a.length;return t.jsxs("section",{"aria-label":"transaction-results",children:[t.jsx(S,{className:"result-section-title",children:t.jsx(u,{text:"Transactions"})}),o.map((i,m)=>{const h=m+l;return t.jsx("a",{href:r.transaction(i.height,i.offset),children:t.jsx(P.Provider,{value:[i,h],children:t.jsx(O,{index:h,children:t.jsx(ae,{})})},h)},h)})]})},ae=()=>{const r=n.useContext(d),[e]=n.useContext(P),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(L,{children:[t.jsx(u,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(u,{text:s.substring(r.length)})})]}),t.jsxs(R,{children:["Transaction ",t.jsx(p,{number:e.offset+1})," of"," ",t.jsx(p,{number:e.numTransactions})," in Block"," ",t.jsx(p,{number:e.height})]}),t.jsx(R,{children:t.jsx(z,{date:e.time})})]})};try{w.displayName="SearchInput",w.__docgenInfo={description:`SearchInput is the component that will allow the user to search for blocks,
transactions, rollups, and addresses.

Right now it only supports searching for blocks and transactions.`,displayName:"SearchInput",props:{initialState:{defaultValue:null,description:"",name:"initialState",required:!1,type:{name:"InitialSearchState"}},forceFocusState:{defaultValue:null,description:"",name:"forceFocusState",required:!1,type:{name:"boolean"}}}}}catch{}export{w as S};
