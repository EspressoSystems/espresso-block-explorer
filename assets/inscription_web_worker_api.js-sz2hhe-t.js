var Ud=Object.defineProperty;var Nd=(W,R,j)=>R in W?Ud(W,R,{enumerable:!0,configurable:!0,writable:!0,value:j}):W[R]=j;var t=(W,R,j)=>Nd(W,typeof R!="symbol"?R+"":R,j);(function(){"use strict";class W{assert(){}}function R(){return new W}const j=R();function y(n,e){j.assert(n,e)}function rr(n,e){y(typeof n===e,`type assertion failed: expected "${e}", received "${typeof n}"`)}function Ut(n){y(n!==null,"expected a non-null value, received null")}function b(n,e){y(n instanceof e,`given value is not an instance of "${e.name}", specific type is "${typeof n=="object"&&n!==null?n.constructor.name:typeof n}"`)}class ze extends Error{constructor(r,s,o=`expected object with key: "${s}", instead found ${r}`){super(o);t(this,"key");t(this,"haveType");this.haveType=r,this.key=s,Object.freeze(this)}toJSON(){return{code:ze.name,message:this.message,have:this.haveType,key:this.key}}}class qe{encode(e){return this.encoder.convert(e)}decode(e){return this.decoder.convert(e)}}class c extends qe{}function Nt(n){return typeof n=="number"}function z(n){return typeof n=="string"}function Ot(n){return typeof n=="object"&&n!==null}function Wt(n){return n!==void 0}function Mt(n,e){return Array.isArray(n)&&n.every(e)}function Lt(n){return e=>Mt(e,n)}function Je(n,...e){return Ot(n)&&e.every(r=>r in n)}function d(n,...e){if(typeof n!="object")throw new Error("expected object");if(n===null)throw new Error("received null");for(const r of e)if(!(r in n))throw new ze("object",r)}function p(n,e){if(!z(n.code))throw new Error("code must be a string");if(n.code!==e)throw new Error(`expected code to be ${e}, got ${n.code}`)}function tr(n,e){if(!z(n.type))throw new Error("type must be a string");if(n.type!==e)throw new Error(`expected type to be ${e}, got ${n.type}`)}class g extends Error{constructor(e){super(e)}get code(){return this.constructor.name}toJSON(){return k.convert(this)}}class S{convert(e){return b(e,g),{code:e.code,message:e.message}}}const k=new S,Tt="NoCodecFoundError";class de extends Error{constructor(r,s=`no codec found for: "${r}"`){super(s);t(this,"codec");this.codec=r,Object.freeze(this);debugger}toJSON(){return{code:i.encode(de.name),message:i.encode(this.message),codec:i.encode(this.codec)}}get code(){return Tt}}const $e=new Map;class Ft{convert(e){d(e,"code");const r=i.decode(e.code),s=$e.get(r);if(!s)throw new de(r);return s.decode(e)}}class Pt{convert(e){const r=$e.get(e.code);if(!r)throw new de(e.code);return r.encode(e)}}class jt extends qe{constructor(){super(...arguments);t(this,"encoder",new Pt);t(this,"decoder",new Ft)}}const le=new jt;function f(n,e){$e.set(n,e)}const He="InvalidTypeError";class h extends g{constructor(r,s,o=`invalid type: have "${r}", want "${s}"`){super(o);t(this,"have");t(this,"want");this.have=r,this.want=s,Object.freeze(this)}toJSON(){return sr.encode(this)}get code(){return He}}class zt{convert(e){return d(e,"code","have","want","message"),p(e,He),new h(i.decode(e.have),i.decode(e.want),i.decode(e.message))}}class qt{convert(e){return b(e,h),{...k.convert(e),have:i.encode(e.have),want:i.encode(e.want)}}}class Jt extends c{constructor(){super(...arguments);t(this,"encoder",new qt);t(this,"decoder",new zt)}}const sr=new Jt;f(He,sr);const $t=Lt(Wt);class Ht{convert(e){return e}}const or=new Ht;class Vt extends qe{constructor(){super(...arguments);t(this,"encoder",or);t(this,"decoder",or)}}const ue=new Vt;class M{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){if(!$t(e)){const r=typeof e=="object"&&e!==null?e.constructor.name:typeof e,s="array";throw new Error(`invalid array value: have "${r}", want "${s}"`)}return e.map(r=>this.itemCodec.decode(r))}}class L{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){return b(e,Array),e.map(r=>this.itemCodec.encode(r))}}class T extends c{constructor(r,s){super();t(this,"encoder");t(this,"decoder");this.encoder=s,this.decoder=r}}class he{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){return e===null?null:this.itemCodec.decode(e)}}class we{constructor(e){t(this,"itemCodec");this.itemCodec=e}convert(e){return e===null?null:(Ut(e),this.itemCodec.encode(e))}}class pe extends c{constructor(r,s){super();t(this,"encoder");t(this,"decoder");this.encoder=s,this.decoder=r}}class Qt{convert(e){if(!z(e))throw new h(typeof e,"string");return e}}class Gt{convert(e){return rr(e,"string"),e}}class Xt extends c{constructor(){super(...arguments);t(this,"encoder",new Gt);t(this,"decoder",new Qt)}}const i=new Xt;new T(new M(i),new L(i)),new pe(new he(i),new we(i));class Ve extends g{constructor(e="completer has already been completed"){super(e),Object.freeze(this)}get code(){return cr}}const cr="CompleterAlreadyCompletedError";class Zt{convert(e){return d(e,"code","message"),p(e,cr),new Ve(i.decode(e.message))}}class _t extends S{}class Kt extends c{constructor(){super(...arguments);t(this,"encoder",new _t);t(this,"decoder",new Zt)}}const Yt=new Kt;f(Ve.name,Yt);function fe(){return y(!1,"completer is not ready, this should never be reached")}function ge(){throw new Ve}class es{constructor(){t(this,"resolve",fe);t(this,"reject",fe);t(this,"completed",!1);t(this,"promise");this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r}),y(this.resolve!==fe,"resolve should be set"),y(this.reject!==fe,"resolve should be set")}get isCompleted(){return this.completed}complete(e){const r=this.resolve,s=this.reject;if(this.completed=!0,this.resolve=ge,this.reject=ge,e instanceof Promise){e.then(r,s);return}r(e)}completeError(e){this.reject(e),this.completed=!0,this.resolve=ge,this.reject=ge}}function me(){return new es}class q extends g{constructor(r,s,o){super(o);t(this,"response");t(this,"status");this.status=r,this.response=s}toJSON(){return ir.convert(this)}}class Ce{convert(e){return b(e,q),{...k.convert(e),status:e.status}}}const ir=new Ce,Qe="BadResponseClientError";class ar extends q{constructor(e,r,s="bad server response: client error"){super(e,r,s),Object.freeze(this)}get code(){return Qe}toJSON(){return dr.encode(this)}}class ns{convert(e){return d(e,"code","message","status"),p(e,Qe),new ar(Number(e.status),null,i.decode(e.message))}}class rs extends Ce{}class ts extends c{constructor(){super(...arguments);t(this,"encoder",new rs);t(this,"decoder",new ns)}}const dr=new ts;f(Qe,dr);const Ge="BadResponseError";class lr extends q{constructor(e,r,s="bad server response"){super(e,r,s),Object.freeze(this)}get code(){return Ge}toJSON(){return ur.encode(this)}}class ss{convert(e){return d(e,"code","message","status"),p(e,Ge),new lr(Number(e.status),null,i.decode(e.message))}}class os extends Ce{}class cs extends c{constructor(){super(...arguments);t(this,"encoder",new os);t(this,"decoder",new ss)}}const ur=new cs;f(Ge,ur);class hr extends q{constructor(e,r,s="bad server response: server error"){super(e,r,s),Object.freeze(this)}get code(){return Xe}}const Xe="BadResponseServerError";class is{convert(e){return d(e,"code","message","status"),p(e,Xe),new hr(Number(e.status),null,i.decode(e.message))}}class as extends Ce{}class ds extends c{constructor(){super(...arguments);t(this,"encoder",new as);t(this,"decoder",new is)}}const ls=new ds;f(Xe,ls);const Ze="ChannelClosedError";class J extends g{constructor(e="channel closed"){super(e),Object.freeze(this)}get code(){return Ze}}class us{convert(e){return d(e,"code","message"),p(e,Ze),new J(i.decode(e.message))}}class hs extends S{}class ws extends c{constructor(){super(...arguments);t(this,"encoder",new hs);t(this,"decoder",new us)}}const ps=new ws;f(Ze,ps);const _e="FetchError";class Ke extends g{constructor(r,s=`fetch failed: ${String(r)}`){super(s);t(this,"cause");this.cause=r,Object.freeze(this)}get code(){return _e}}class fs{convert(e){return d(e,"code","message"),p(e,_e),new Ke({},i.decode(e.message))}}class gs extends S{}class ms extends c{constructor(){super(...arguments);t(this,"encoder",new gs);t(this,"decoder",new fs)}}const Cs=new ms;f(_e,Cs);const Ye="IncorrectBase64PaddingError";class wr extends g{constructor(e="incorrect padding"){super(e),Object.freeze(this)}get code(){return Ye}}class vs{convert(e){return d(e,"code","message"),p(e,Ye),new wr(i.decode(e.message))}}class ys extends S{}class Ss extends c{constructor(){super(...arguments);t(this,"encoder",new ys);t(this,"decoder",new vs)}}const bs=new Ss;f(Ye,bs);class Es{convert(e){if(!Nt(e))throw new h(typeof e,"number");return e}}class xs{convert(e){return rr(e,"number"),e}}class ks extends c{constructor(){super(...arguments);t(this,"encoder",new xs);t(this,"decoder",new Es)}}const m=new ks,pr=new pe(new he(m),new we(m));new T(new M(m),new L(m)),new T(new M(pr),new L(pr));const en="InvalidBase64AlphabetLengthError";class nn extends g{constructor(r,s=`alphabet needs to be 64 characters, received ${r}`){super(s);t(this,"length");this.length=r,Object.freeze(this)}toJSON(){return fr.encode(this)}get code(){return en}}class Rs{convert(e){return d(e,"code","length","message"),p(e,en),new nn(m.decode(e.length),i.decode(e.message))}}class Is{convert(e){return b(e,nn),{...k.convert(e),length:m.encode(e.length)}}}class Ds extends c{constructor(){super(...arguments);t(this,"encoder",new Is);t(this,"decoder",new Rs)}}const fr=new Ds;f(en,fr);const rn="InvalidHexStringError";class tn extends g{constructor(e="invalid hex string"){super(e),Object.freeze(this)}get code(){return rn}}class As{convert(e){return d(e,"code","message"),p(e,rn),new tn(i.decode(e.message))}}class Bs extends S{}class Us extends c{constructor(){super(...arguments);t(this,"encoder",new Bs);t(this,"decoder",new As)}}const Ns=new Us;f(rn,Ns);const sn="InvalidHexValueError";class gr extends g{constructor(r,s=`invalid hex value "${r}"`){super(s);t(this,"value");this.value=r,Object.freeze(this)}toJSON(){return mr.encode(this)}get code(){return sn}}class Os{convert(e){return d(e,"code","value","message"),p(e,sn),new gr(m.decode(e.value),i.decode(e.message))}}class Ws{convert(e){return{...k.convert(e),value:m.encode(e.value)}}}class Ms extends c{constructor(){super(...arguments);t(this,"encoder",new Ws);t(this,"decoder",new Os)}}const mr=new Ms;f(sn,mr);const on="InvalidInputError";class $ extends g{constructor(e="invalid input"){super(e),Object.freeze(this)}get code(){return on}}class Ls{convert(e){return d(e,"code","message"),p(e,on),new $(i.decode(e.message))}}class Ts extends S{}class Fs extends c{constructor(){super(...arguments);t(this,"encoder",new Ts);t(this,"decoder",new Ls)}}const Ps=new Fs;f(on,Ps);const cn="InvalidStringValueError";class Cr extends g{constructor(r,s,o=`invalid string value: have "${r}", want "${s}"`){super(o);t(this,"have");t(this,"want");this.have=r,this.want=s,Object.freeze(this)}toJSON(){return vr.encode(this)}get code(){return cn}}class js{convert(e){return d(e,"code","have","want","message"),p(e,cn),new Cr(i.decode(e.have),i.decode(e.want),i.decode(e.message))}}class zs{convert(e){return b(e,Cr),{...k.convert(e),have:i.encode(e.have),want:i.encode(e.want)}}}class qs extends c{constructor(){super(...arguments);t(this,"encoder",new zs);t(this,"decoder",new js)}}const vr=new qs;f(cn,vr);const an="InvalidTaggedBase64EncodingError";class yr extends g{constructor(e="invalid tagged base64 encoding"){super(e),Object.freeze(this)}toJSON(){return Sr.encode(this)}get code(){return an}}class Js{convert(e){return d(e,"code","message"),p(e,an),new yr(i.decode(e.message))}}class $s extends S{}class Hs extends c{constructor(){super(...arguments);t(this,"encoder",new $s);t(this,"decoder",new Js)}}const Sr=new Hs;f(an,Sr);const dn="MissingElementError";class ln extends g{constructor(e="missing element"){super(e),Object.freeze(this)}get code(){return dn}}class Vs{convert(e){return d(e,"code","message"),p(e,dn),new ln(i.decode(e.message))}}class Qs extends S{}class Gs extends c{constructor(){super(...arguments);t(this,"encoder",new Qs);t(this,"decoder",new Vs)}}const Xs=new Gs;f(dn,Xs);const un="NoCompleterFoundForRequestID";class br extends g{constructor(r,s=`no completer found for request id "${r}"`){super(s);t(this,"requestID");this.requestID=r,Object.freeze(this)}toJSON(){return Er.encode(this)}get code(){return un}}class Zs{convert(e){return d(e,"code","requestID","message"),p(e,un),new br(ue.decode(e.requestID),i.decode(e.message))}}class _s{convert(e){return b(e,br),{...k.convert(e),requestID:ue.encode(e.requestID)}}}class Ks extends c{constructor(){super(...arguments);t(this,"encoder",new _s);t(this,"decoder",new Zs)}}const Er=new Ks;f(un,Er);const hn="NotFoundError";class Ys extends g{constructor(r,s=`Not Found: ${r}`){super(s);t(this,"key");this.key=r,Object.freeze(this)}get code(){return hn}}class xr{constructor(e){t(this,"codec");this.codec=e}convert(e){return d(e,"code","key"),p(e,hn),new Ys(this.codec.decode(e.key))}}class kr{constructor(e){t(this,"codec");this.codec=e}convert(e){return{...k.convert(e),key:this.codec.encode(e.key)}}}class Rr extends c{constructor(r,s){super();t(this,"encoder");t(this,"decoder");this.encoder=r,this.decoder=s}}new Rr(new kr(i),new xr(i));const eo=new Rr(new kr(ue),new xr(ue));f(hn,eo);const wn="NoURLProvidedError";class no extends g{constructor(e="no url provided"){super(e),Object.freeze(this)}get code(){return wn}}class ro{convert(e){return d(e,"code","message"),p(e,wn),new no(i.decode(e.message))}}class to extends S{}class so extends c{constructor(){super(...arguments);t(this,"encoder",new to);t(this,"decoder",new ro)}}const oo=new so;f(wn,oo);const pn="UnimplementedError";class E extends g{constructor(e="unimplemented"){super(e),Object.freeze(this);debugger}get code(){return pn}}class co{convert(e){return d(e,"code","message"),p(e,pn),new E(i.decode(e.message))}}class io extends S{}class ao extends c{constructor(){super(...arguments);t(this,"encoder",new io);t(this,"decoder",new co)}}const lo=new ao;f(pn,lo);const fn="QUERY_ERROR";class uo extends g{constructor(r,s="missing element"){super(s);t(this,"error");this.error=r,Object.freeze(this)}get code(){return fn}}class ho{convert(e){return d(e,"code","error","message"),p(e,fn),new uo(Br.decode(e.error),i.decode(e.message))}}class wo{convert(e){return{code:e.code,error:Br.encode(e.error),message:i.encode(e.message)}}}class po extends c{constructor(){super(...arguments);t(this,"encoder",new wo);t(this,"decoder",new ho)}}const fo=new po;class gn{}const mn="NotFound";class Ir extends gn{constructor(){super(),Object.freeze(this)}valueOf(){return mn}toJSON(){return this.valueOf()}}const go=new Ir,Cn="Missing";class Dr extends gn{constructor(){super(),Object.freeze(this)}valueOf(){return Cn}toJSON(){return this.valueOf()}}const mo=new Dr;class Ar extends gn{constructor(r){super();t(this,"error");this.error=r,Object.freeze(this)}toJSON(){return yn.encode(this)}}class Co{constructor(e){t(this,"message");this.message=e,Object.freeze(this)}toJSON(){return vn.encode(this)}}class vo{convert(e){return d(e,"message"),new Co(i.decode(e.message))}}class yo{convert(e){return{message:i.encode(e.message)}}}class So extends c{constructor(){super(...arguments);t(this,"encoder",new yo);t(this,"decoder",new vo)}}const vn=new So;class bo{convert(e){return d(e,"Error"),new Ar(vn.decode(e.Error))}}class Eo{convert(e){return{Error:vn.encode(e.error)}}}class xo extends c{constructor(){super(...arguments);t(this,"encoder",new Eo);t(this,"decoder",new bo)}}const yn=new xo;class ko{convert(e){return e===mn?go:e===Cn?mo:yn.decode(e)}}class Ro{convert(e){if(e instanceof Ir)return mn;if(e instanceof Dr)return Cn;if(e instanceof Ar)return yn.encode(e);throw new E}}class Io extends c{constructor(){super(...arguments);t(this,"encoder",new Ro);t(this,"decoder",new ko)}}const Br=new Io;f(fn,fo);const Ur="ResponseContentTypeIsNotApplicationJSONError";class H extends q{constructor(r,s,o,a="response content type is not application/json"){super(s,o,a);t(this,"haveHeaderType");this.haveHeaderType=r,Object.freeze(this)}static fromResponse(r,s){return new H(r.headers.get("content-type")??"undefined",r.status,r,s)}toJSON(){return Nr.encode(this)}get code(){return Ur}}class Do{convert(e){return d(e,"code","status","have","want","message"),p(e,Ur),new H(i.decode(e.code),m.decode(e.status),null,i.decode(e.message))}}class Ao{convert(e){return{...ir.convert(e),have:i.encode(e.haveHeaderType),want:i.encode("application/json")}}}class Bo extends c{constructor(){super(...arguments);t(this,"encoder",new Ao);t(this,"decoder",new Do)}}const Nr=new Bo;f(H.name,Nr);const Sn="WebWorkerErrorResponse";class Uo extends g{constructor(r,s="error in web worker"){super(s);t(this,"error");this.error=r,Object.freeze(this)}toJSON(){return Or.encode(this)}get code(){return Sn}}class No{convert(e){return d(e,"code","error","message"),p(e,Sn),new Uo(le.decode(e.error),i.decode(e.message))}}class Oo{convert(e){return{...k.convert(e),error:le.encode(e.error)}}}class Wo extends c{constructor(){super(...arguments);t(this,"encoder",new Oo);t(this,"decoder",new No)}}const Or=new Wo;f(Sn,Or);var bn=(n=>(n[n.success=0]="success",n[n.full=1]="full",n[n.failed=2]="failed",n))(bn||{});class Mo{getFromEmpty(){}}class Lo{getFromEmpty(){return null}}class To{getFromEmpty(){throw new ln}}const Wr={returnNull:new Lo,returnUndefined:new Mo,throwMissingElement:new To};class Fo{constructor(e){t(this,"maxSize");y(!Number.isNaN(e),"maxSize must not be NaN"),y(Number.isInteger(e),"maxSize must be an integer"),y(e>0,"maxSize must be greater than 0"),this.maxSize=e}nextIndex(e){return y(e>=0,"index must be greater than or equal to 0"),(e+1)%this.maxSize}}class Po{constructor(e){t(this,"preComputedSizeMinus1");y(!Number.isNaN(e),"maxSize must not be NaN"),y(Number.isInteger(e),"maxSize must be an integer"),y(e>0,"maxSize must be greater than 0"),y(Mr(e),"maxSize must be a power of two"),this.preComputedSizeMinus1=e-1}nextIndex(e){return y(e>=0,"index must be greater than or equal to 0"),e+1&this.preComputedSizeMinus1}}function Mr(n){return(n&n-1)===0}const En="BufferFullError";class Lr extends g{constructor(e="buffer full"){super(e),Object.freeze(this)}get code(){return En}}class jo{convert(e){return d(e,"code","message"),p(e,En),new Lr(i.decode(e.message))}}class zo extends S{}class qo extends c{constructor(){super(...arguments);t(this,"encoder",new zo);t(this,"decoder",new jo)}}const Jo=new qo;f(En,Jo);class $o{putToFull(e,r){return e.get(),e.put(r)}}class Ho{putToFull(){return bn.full}}class Vo{putToFull(){throw new Lr}}const Tr={overwriteOldest:new $o,returnFull:new Ho,throw:new Vo};function Qo(n){return Mr(n)?new Po(n):new Fo(n)}class Go{constructor(e,r,s){t(this,"readIndex",0);t(this,"writeIndex",0);t(this,"buffer");t(this,"nextIndex");t(this,"getOnEmpty");t(this,"putOnFull");y(!Number.isNaN(e),"maxSize must not be NaN"),this.buffer=new Array(e),this.nextIndex=Qo(e),this.getOnEmpty=r,this.putOnFull=s}get maxSize(){return this.buffer.length}get length(){return this.writeIndex<this.readIndex?this.writeIndex+this.maxSize-this.readIndex:this.writeIndex-this.readIndex}put(e){const r=this.nextIndex.nextIndex(this.writeIndex);return r===this.readIndex?this.putOnFull.putToFull(this,e):(this.buffer[this.writeIndex]=e,this.writeIndex=r,bn.success)}get(){if(this.readIndex===this.writeIndex)return this.getOnEmpty.getFromEmpty(this);const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),e}[Symbol.iterator](){return new Xo(this)}immutableIterable(){return{[Symbol.iterator]:()=>this.immutableIterator()}}immutableIterator(){return new Zo(this.readIndex,this.writeIndex,this.buffer,this.nextIndex)}}class Xo{constructor(e){t(this,"buffer");this.buffer=e}next(){const e=this.buffer.get();return e==null?{value:void 0,done:!0}:{value:e,done:!1}}}class Zo{constructor(e,r,s,o){t(this,"readIndex");t(this,"writeIndex");t(this,"buffer");t(this,"nextIndex");this.readIndex=e,this.writeIndex=r,this.buffer=s,this.nextIndex=o}next(){if(this.readIndex===this.writeIndex)return{value:void 0,done:!0};const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),{value:e,done:!1}}}function Fr(n=32,e=Wr.returnUndefined,r=Tr.overwriteOldest){return new Go(n,e,r)}class _o{constructor(e){t(this,"publishQueue");t(this,"pollBlocked");t(this,"publishBlocked");t(this,"capacity");t(this,"closed",!1);this.publishQueue=Fr(Math.max(2,e),Wr.throwMissingElement,Tr.throw);const r=me();this.pollBlocked=r,this.publishBlocked=r,r.complete(),this.capacity=e-1}get isClosed(){return this.closed}close(){if(this.closed)throw new J;this.closed=!0}async drain(){for(;this.publishQueue.length>0;)this.publishQueue.get()}async publish(e){if(this.closed)throw new J;if(this.publishQueue.length>=this.capacity){if(this.publishBlocked.isCompleted){const r=me();this.publishBlocked=r,await r.promise}return await this.publishBlocked.promise,this.publish(e)}this.publishQueue.put(e),this.pollBlocked.isCompleted||this.pollBlocked.complete()}async poll(){if(this.publishQueue.length<=0){if(this.isClosed)throw new J;if(this.pollBlocked.isCompleted){const r=me();this.pollBlocked=r}return await this.pollBlocked.promise,this.poll()}const e=this.publishQueue.get();return this.publishBlocked.isCompleted||this.publishBlocked.complete(),e}[Symbol.asyncIterator](){return new Ko(this)}}class Ko{constructor(e){t(this,"channel");this.channel=e}async next(){try{return{done:!1,value:await this.channel.poll()}}catch(e){if(e instanceof J)return{done:!0,value:void 0};throw e}}}function ve(n){return new _o(n)}class Yo{constructor(e){t(this,"channel");this.channel=e}async send(e){await this.channel.publish(e)}}function V(n){return new Yo(n)}const xn="CorruptBase64InputError";class B extends g{constructor(r,s=`corrupt input error at ${r}`){super(s);t(this,"offset");this.offset=r,Object.freeze(this)}get code(){return xn}toJSON(){return Pr.encode(this)}}class ec{convert(e){return d(e,"code","offset","message"),p(e,xn),new B(m.decode(e.offset),i.decode(e.message))}}class nc{convert(e){return b(e,B),{...k.convert(e),offset:m.encode(e.offset),message:i.encode(e.message)}}}class rc extends c{constructor(){super(...arguments);t(this,"encoder",new nc);t(this,"decoder",new ec)}}const Pr=new rc;f(xn,Pr);const tc=new TextEncoder;function jr(n){return tc.encode(n)}const sc=new TextDecoder;function oc(n){return sc.decode(n)}function*zr(n){yield*jr(n)}function*cc(){for(let n=0;n<256;n++)yield 255}const Q=-1,ic=61;class G{constructor(e,r,s=ic,o=!1){t(this,"encodeMap");t(this,"decodeMap");t(this,"padChar");t(this,"strict");this.encodeMap=e,this.decodeMap=r,this.padChar=s,this.strict=o}static withAlphabet(e){const r=e.length;if(r!==64)throw new nn(r);const s=Array.from(zr(e)),o=Array.from(cc());for(let a=0;a<r;a++)o[s[a]]=a;return new G(s,o)}withPadding(e){return new G(this.encodeMap,this.decodeMap,e,this.strict)}encode(e){if(e.byteLength===0)return new ArrayBuffer(0);let r=0,s=0;const o=Math.floor(e.byteLength/3)*3,a=Math.ceil(e.byteLength/3)*4,u=new ArrayBuffer(a),l=new DataView(e),C=new DataView(u);for(;s<o;){const O=l.getUint8(s+0)<<16|l.getUint8(s+1)<<8|l.getUint8(s+2);C.setUint8(r+0,this.encodeMap[O>>18&63]),C.setUint8(r+1,this.encodeMap[O>>12&63]),C.setUint8(r+2,this.encodeMap[O>>6&63]),C.setUint8(r+3,this.encodeMap[O&63]),s+=3,r+=4}const w=e.byteLength-s;if(w===0)return u;let A=l.getUint8(s+0)<<16;switch(w===2&&(A|=l.getUint8(s+1)<<8),C.setUint8(r+0,this.encodeMap[A>>18&63]),C.setUint8(r+1,this.encodeMap[A>>12&63]),w){case 2:return C.setUint8(r+2,this.encodeMap[A>>6&63]),this.padChar!==Q?(C.setUint8(r+3,this.padChar),u.slice(0,r+4)):u.slice(0,r+3);case 1:if(this.padChar!==Q)return C.setUint8(r+2,this.padChar),C.setUint8(r+3,this.padChar),u.slice(0,r+4);break}return u.slice(0,r+2)}decode(e){const r=e.byteLength;if(r===0)return new ArrayBuffer(0);const s=new DataView(e),o=new ArrayBuffer(Math.floor(r/4*3)),a=new DataView(o),u=new ArrayBuffer(4),l=new DataView(u);let C=0,w=0,A=0,O=!1;for(;w<r&&!O;){let er=3,Pe=4;for(let x=0;x<4;x++){if(w===r){if(x===0)return o;if(x===1||this.padChar!==Q)throw new B(w-x);er=x-1,Pe=x,O=!0;break}const je=s.getUint8(w);w++;const Bt=this.decodeMap[je];if(Bt!==255){l.setUint8(x,Bt);continue}if(je===10||je===13){x--;continue}if(je===this.padChar){switch(x){case 0:case 1:throw new wr;case 2:for(;w<r&&(s.getUint8(w)===10||s.getUint8(w)===13);)w++;if(w===r)throw new B(r);w++}for(;w<r&&(s.getUint8(w)===10||s.getUint8(w)===13);)w++;if(w<r)throw new B(w);er=3,Pe=x,O=!0;break}throw new B(w-1)}const nr=l.getUint8(0)<<18|l.getUint8(1)<<12|l.getUint8(2)<<6|l.getUint8(3);switch(l.setUint8(2,nr>>0&255),l.setUint8(1,nr>>8&255),l.setUint8(0,nr>>16&255),Pe){case 4:a.setUint8(A+2,l.getUint8(2)),l.setUint8(2,0);case 3:if(a.setUint8(A+1,l.getUint8(1)),this.strict&&l.getUint8(2)!==0)throw new B(w-1);case 2:if(a.setUint8(A+0,l.getUint8(0)),this.strict&&(l.getUint8(1)!==0||l.getUint8(2)!==0))throw new B(w-2)}A+=er,C+=Pe-1}return o.slice(0,C)}decodeString(e){return this.decode(jr(e).buffer)}encodeToString(e){return oc(this.encode(e))}}const qr=G.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ac=qr.withPadding(Q),Jr=G.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),kn=Jr.withPadding(Q);function*dc(n,e){for(let r=n.next();!r.done;r=n.next())e(r.value)&&(yield r.value)}function lc(n,e){return dc(n[Symbol.iterator](),e)}function*$r(n,e){for(let r=n.next();!r.done;r=n.next())yield e(r.value)}function ye(n,e){return $r(n[Symbol.iterator](),e)}function uc(n){let e;for(let r=n.next();!r.done;r=n.next())e=r.value;if(e===void 0)throw new ln;return e}function Hr(n){return uc(n[Symbol.iterator]())}function*hc(n,e,r){for(let s=n.next(),o=e.next();!s.done&&!o.done;s=n.next(),o=e.next())yield r(s.value,o.value)}function wc(n,e,r){return hc(n[Symbol.iterator](),e[Symbol.iterator](),r)}function Vr(n){if(n.startsWith("0x"))return Vr(n.substring(2));if(n.length&1)throw new tn;const e=new ArrayBuffer(n.length/2);return pc(zr(n),e),e}function pc(n,e){const r=new DataView(e);let s=0;for(;s<e.byteLength;){const o=n.next(),a=n.next();if(o.done||a.done)throw new tn;const u=Qr(o.value),l=Qr(a.value),C=u<<4|l;r.setUint8(s,C),s++}}function Qr(n){if(n>=48&&n<=57)return n-48;if(n>=97&&n<=102)return n-97+10;if(n>=65&&n<=70)return n-65+10;throw new gr(n)}function fc(n){return n.toString(16).padStart(2,"0")}function*gc(n){yield*$r(n,fc)}function mc(n){return gc(n[Symbol.iterator]())}class Cc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");return Vr(e)}}class vc{convert(e){return b(e,ArrayBuffer),["0x",...mc(new Uint8Array(e))].join("")}}class yc extends c{constructor(){super(...arguments);t(this,"encoder",new vc);t(this,"decoder",new Cc)}}const U=new yc;new pe(new he(U),new we(U)),new T(new M(U),new L(U));class Sc{constructor(e){t(this,"encoding");this.encoding=e}convert(e){if(typeof e!="string")throw new h(typeof e,"string");return this.encoding.decodeString(e)}}class bc{constructor(e){t(this,"encoding");this.encoding=e}convert(e){return this.encoding.encodeToString(e)}}class Se extends c{constructor(r){super();t(this,"encoder");t(this,"decoder");this.encoder=new bc(r),this.decoder=new Sc(r)}}new Se(kn),new Se(ac),new Se(Jr),new Se(qr);class Ec{convert(e){if(!z(e))throw new h(typeof e,"string");return new URL(e)}}class xc{convert(e){return e.toString()}}class kc extends c{constructor(){super(...arguments);t(this,"encoder",new xc);t(this,"decoder",new Ec)}}const Gr=new kc;new pe(new he(Gr),new we(Gr));class Xr{}class Zr{}const X="Close";class be extends Zr{valueOf(){return X}}class Rc{convert(){return X}}class Ic{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==X)throw new h(e,X);return new be}}class Dc extends c{constructor(){super(...arguments);t(this,"encoder",new Rc);t(this,"decoder",new Ic)}}const _r=new Dc,Z="Connect";class Ee extends Zr{valueOf(){return Z}toJSON(){return Rn.encode(this)}}class Ac{convert(){return Z}}class Bc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==Z)throw new h(e,Z);return new Ee}}class Uc extends c{constructor(){super(...arguments);t(this,"encoder",new Ac);t(this,"decoder",new Bc)}}const Rn=new Uc;class Nc{convert(e){if(e===Z)return Rn.decode(e);if(e===X)return _r.decode(e);throw new E}}class Oc{convert(e){if(e instanceof Ee)return Rn.encode(e);if(e instanceof be)return _r.encode(e);throw new E}}class Wc extends c{constructor(){super(...arguments);t(this,"encoder",new Oc);t(this,"decoder",new Nc)}}const Kr=new Wc;class In extends Xr{constructor(r){super();t(this,"command");this.command=r}get type(){return _}toJson(){return Yr.encode(this)}}const _="WebSocket";class Mc{convert(e){return{[_]:Kr.encode(e.command)}}}class Lc{convert(e){return d(e,_),new In(Kr.decode(e[_]))}}class Tc extends c{constructor(){super(...arguments);t(this,"encoder",new Mc);t(this,"decoder",new Lc)}}const Yr=new Tc,F=new Map;F.set(_,Yr);class Fc{convert(e){const r=F.get(e.type);if(!r)throw new h(e.type,`one of ${Array.from(ye(F.keys(),s=>`"${s}"`)).join(", ")}`);return{[e.type]:r.encode(e)}}}class Pc{convert(e){if(typeof e!="object"||e===null)throw new h(typeof e,"object");const r=Object.keys(e);if(r.length!==1)throw new E("multiple values contained within the Request object, unexpected");const[s]=r,o=F.get(s);if(d(e,s),!o)throw new h(s,`one of ${Array.from(ye(F.keys(),a=>`"${a}"`)).join(", ")}`);return o.decode(e[s])}}class jc extends c{constructor(){super(...arguments);t(this,"encoder",new Fc);t(this,"decoder",new Pc)}}function zc(n,e){F.has(n)||F.set(n,e)}const qc=new jc;class Dn{}const K="Error";class et extends Dn{constructor(r){super();t(this,"error");this.error=r}get type(){return K}toJson(){return nt.encode(this)}}class Jc{convert(e){return{[K]:le.encode(e.error)}}}class $c{convert(e){return d(e,K),new et(le.decode(e[K]))}}class Hc extends c{constructor(){super(...arguments);t(this,"encoder",new Jc);t(this,"decoder",new $c)}}const nt=new Hc;class An{}const Y="Closed";class xe extends An{valueOf(){return Y}toJSON(){return Bn.encode(this)}}class Vc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==Y)throw new h(e,Y);return new xe}}class Qc{convert(){return Y}}class Gc extends c{constructor(){super(...arguments);t(this,"encoder",new Qc);t(this,"decoder",new Vc)}}const Bn=new Gc,ee="Connecting";class ke extends An{valueOf(){return ee}toJSON(){return Un.encode(this)}}class Xc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==ee)throw new h(e,ee);return new ke}}class Zc{convert(){return ee}}class _c extends c{constructor(){super(...arguments);t(this,"encoder",new Zc);t(this,"decoder",new Xc)}}const Un=new _c,ne="Opened";class Re extends An{valueOf(){return ne}toJSON(){return Nn.encode(this)}}class Kc{convert(e){if(typeof e!="string")throw new h(typeof e,"string");if(e!==ne)throw new h(e,ne);return new Re}}class Yc{convert(){return ne}}class ei extends c{constructor(){super(...arguments);t(this,"encoder",new Yc);t(this,"decoder",new Kc)}}const Nn=new ei;class ni{convert(e){if(e===ne)return Nn.decode(e);if(e===Y)return Bn.decode(e);if(e===ee)return Un.decode(e);throw new E}}class ri{convert(e){if(e instanceof Re)return Nn.encode(e);if(e instanceof xe)return Bn.encode(e);if(e instanceof ke)return Un.encode(e);throw new E}}class ti extends c{constructor(){super(...arguments);t(this,"encoder",new ri);t(this,"decoder",new ni)}}const rt=new ti;class tt extends Dn{constructor(r){super();t(this,"status");this.status=r}get type(){return re}toJson(){return st.encode(this)}}const re="WebSocket";class si{convert(e){return{[re]:rt.encode(e.status)}}}class oi{convert(e){return d(e,re),new tt(rt.decode(e[re]))}}class ci extends c{constructor(){super(...arguments);t(this,"encoder",new si);t(this,"decoder",new oi)}}const st=new ci,N=new Map;N.set(K,nt),N.set(re,st);class ii{convert(e){const r=N.get(e.type);if(!r)throw new h(e.type,`one of ${Array.from(ye(N.keys(),s=>`"${s}"`)).join(", ")}`);return{[e.type]:r.encode(e)}}}class ai{convert(e){if(typeof e!="object"||e===null)throw new h(typeof e,"object");const r=Object.keys(e);if(r.length!==1)throw new E("multiple values contained within the response object, unexpected");const[s]=r,o=N.get(s);if(d(e,s),!o)throw new h(s,`one of ${Array.from(ye(N.keys(),a=>`"${a}"`)).join(", ")}`);return o.decode(e[s])}}class di extends c{constructor(){super(...arguments);t(this,"encoder",new ii);t(this,"decoder",new ai)}}function li(n,e){N.has(n)||N.set(n,e)}const ui=new di;class hi{convert(e){return new et(e)}}const wi=new hi;class pi{convert(e){return new tt(e)}}const ot=new pi;class fi{constructor(e,r){this.sink=e,this.converter=r,this.sink=e,this.converter=r}async send(e){await this.sink.send(this.converter.convert(e))}}function te(n,e){return new fi(n,e)}async function ct(n){return new Promise(e=>{const r=setTimeout(()=>{clearTimeout(r),e()},n)})}class I{constructor(e,r,s){t(this,"significantDigitsMultiplier");this.alpha3Code=e,this.code=r,this.significantDigits=s,this.alpha3Code=e,this.code=r,this.significantDigits=s,this.significantDigitsMultiplier=BigInt(10)**BigInt(this.significantDigits)}toJSON(){return Ie.encode(this)}}const it=new I("JPY",392,0),gi=new I("GBP",826,2),at=new I("USD",840,2),mi=new I("EUR",978,2),Ci=new I("XXX",999,2),dt=new I("ETH",1001,18),On=new I("XBT",1002,8),lt=new I("ESP",10001,18),vi=[it,gi,at,mi,Ci,dt,On,lt],yi=new Map(vi.map(n=>[n.alpha3Code,n]));class Si{convert(e){if(typeof e!="string")throw new $("CurrencyCodeDecoder: expected string");if(e==="BTC")return On;const r=yi.get(e);if(r===void 0)throw new $(`CurrencyCodeDecoder: unknown currency: "${e}"`);return r}}class bi{convert(e){return b(e,I),e.alpha3Code}}class Ei extends c{constructor(){super(...arguments);t(this,"decoder",new Si);t(this,"encoder",new bi)}}const Ie=new Ei;class D{constructor(e,r){this.currency=e,this.value=r,this.currency=e,this.value=r}static USD(e){return new D(at,BigInt(e))}static ETH(e){return new D(dt,BigInt(e))}static ESP(e){return new D(lt,BigInt(e))}static JPY(e){return new D(it,BigInt(e))}static BTC(e){return new D(On,BigInt(e))}toString(){return De.encode(this)}toJSON(){return De.encode(this)}}function xi(n){return n==="."||n===","||n===" "}function ki(n,e){let r=-1;const s=n.length;for(let o=0;o<s;o++)e(n[o])&&(r=o);return r}class Ri{parseCurrencyCode(e){return Ie.decode(e)}parseValue(e,r){let s=1n;r[0]==="-"&&(s=-1n,r=r.substring(1));const o=ki(r,xi);if(o===-1){const w=BigInt(r.replace(/\D/g,""))*e.significantDigitsMultiplier;return s*w}const a=r.substring(0,o).replace(/\D/g,""),u=r.substring(o+1).replace(/\D/g,""),l=BigInt(a)*e.significantDigitsMultiplier,C=BigInt(u)*10n**BigInt(e.significantDigits-u.length);return s*(l+C)}convert(e){if(typeof e!="string")throw new $("MonetaryValueDecoder: expected string");const r=e.indexOf(" ");if(r<=-1)throw new $("MonetaryValueDecoder: missing non-breaking space");const s=e.substring(0,r),o=e.substring(r+1);if(/^-?[\d .,]+$/.test(s)){const u=this.parseCurrencyCode(o);return new D(u,this.parseValue(u,s))}const a=this.parseCurrencyCode(s);return new D(a,this.parseValue(a,o))}}class Ii{convert(e){b(e,D);const r=e.value<0n?"-":"",s=e.value<0n?-e.value:e.value,o=s%e.currency.significantDigitsMultiplier,a=s/e.currency.significantDigitsMultiplier,u=String(a),l=String(o);return/^0+$/.test(l)?`${Ie.encode(e.currency)} ${r}${u}`:`${Ie.encode(e.currency)} ${r}${a}.${String(o).padStart(e.currency.significantDigits,"0")}`}}class Di extends c{constructor(){super(...arguments);t(this,"decoder",new Ri);t(this,"encoder",new Ii)}}const De=new Di;new T(new M(De),new L(De));class v{constructor(e,r,s,o){t(this,"namespace");t(this,"name");t(this,"site");t(this,"blockExplorer");this.namespace=e,this.name=r,this.site=s,this.blockExplorer=o}}const Ai=new v(202374881,"Vienna",new URL("https://vienna.caldera.dev/"),new URL("https://vienna.calderaexplorer.xyz/")),Bi=new v(202374882,"OP Stack",new URL("https://stack.optimism.io/"),new URL("https://www.blockscout.com/")),Ui=new v(33914988448,"Arbitrum",new URL("https://arbitrum.io/"),new URL("https://arbiscan.io/")),Ni=new v(33914988449,"Eigen Layer",new URL("https://www.eigenlayer.xyz/"),new URL("https://www.blockscout.com/")),Oi=new v(33914988450,"Spire",new URL("https://www.spire.dev/"),new URL("https://www.blockscout.com/")),Wi=new v(33914988451,"Alt Layer",new URL("https://altlayer.io/"),new URL("https://www.blockscout.com/")),Mi=new v(33914988452,"Caldera",new URL("https://www.caldera.xyz/"),new URL("https://www.blockscout.com/")),Li=new v(33914988453,"Vistara Labs",new URL("https://vistara.dev/"),new URL("https://www.blockscout.com/")),Ti=new v(33914988454,"Polygon",new URL("https://polygon.technology/"),new URL("https://www.blockscout.com/")),Fi=new v(263,"Milan",new URL("https://milan.caldera.dev/"),new URL("https://milan-devnet.explorer.caldera.xyz/")),Pi=new v(41234687,"Kyoto",new URL("https://example.com/"),new URL("https://kyoto-explorer.altlayer.io/")),ji=new v(1918988905,"RARI",new URL("https://rarichain.org/"),new URL("https://explorer.rarichain.org/")),zi=new v(1380012617,"RARI",new URL("https://rarichain.org/"),new URL("https://mainnet.explorer.rarichain.org/")),qi=new v(9369,"LogX",new URL("https://logx.network/"),new URL("https://kartel-testnet-explorer.alt.technology/")),Ji=new v(936369,"LogX",new URL("https://logx.network/"),new URL("https://vzjuxmhfn70kgnlds27h-explorer.alt.technology")),$i=new v(4661,"AppChain",new URL("https://appchain.xyz/"),new URL("https://appchaintestnet.explorer.caldera.xyz/")),Hi=new v(360,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),Vi=new v(3609,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),Qi=1397311310,ut=new v(Qi,"Infinite Garden",new URL("https://infinitegarden.espressosys.com/"),new URL("https://explorer.main.net.espressosys.com/")),Gi=[ut,zi,Ji,Hi],Xi=[ut,ji,qi,$i,Vi],Zi=new Map([Ai,Bi,Ui,Ti,Ni,Oi,Wi,Mi,Li,Fi,Pi,...Gi,...Xi].map(n=>[n.namespace,n]));class se{constructor(e,r){t(this,"tag");t(this,"data");this.tag=e,this.data=r}static fromString(e){const r=e.indexOf("~");if(r<0)throw new yr;const s=e.substring(0,r),o=kn.decodeString(e.substring(r+1));return new se(s,o)}static inflate(e){return ea.decode(e)}toString(){return`${this.tag}~${kn.encodeToString(this.data)}`}valueOf(){return this.toString()}toJSON(){return this.toString()}}class _i{convert(e){if(typeof e!="string")throw new h(typeof e,"string");return se.fromString(e)}}class Ki{convert(e){return b(e,se),e.toString()}}class Yi extends c{constructor(){super(...arguments);t(this,"encoder",new Ki);t(this,"decoder",new _i)}}const ea=new Yi,ht=["Residential","Mobile","Enterprise","AWS","Azure","GCP"],wt=["Espresso v1.0","Espresso v1.1","Espresso v1.2","Espresso v1.3","Espresso v1.4"],pt=["Linux","Unix","Windows","MacOS"],ft=[["Espresso","https://espressosys.com/"],["BlockDaemon","https://www.blockdaemon.com/"],["Unit 410","https://unit410.com/"],["Nethermind","https://www.nethermind.io/"],["Sub7","https://sub7.xyz/"],["KudasaiJP","https://kudasai.co.jp/"],["Informal Systems","https://informal.systems/"],["P2P","https://p2p.org/"],["LinkPool","https://linkpool.com/"],["ZKV","https://zkvalidator.com/"],["Figment","https://figment.io/"]],Ae=2147483648,na=1103515245,ra=12345;class gt{constructor(e){t(this,"state");this.state=e!==void 0?e:Math.floor(Math.random()*(Ae-1))}nextInt(){return this.state=(na*this.state+ra)%Ae,this.state}nextFloat(){return this.nextInt()/(Ae-1)}nextRange(e,r){const s=r-e,o=this.nextInt()/Ae;return e+Math.floor(o*s)}fillBytes(e){const r=new ArrayBuffer(e),s=new DataView(r);let o=0;for(;o<e-4;o+=4)s.setUint32(o,this.nextRange(0,4294967295));for(let a=o;a<e;a++)s.setUint8(a,this.nextRange(0,256));return r}}const ta=[[["Mexico City",19.4333,-99.1333,"MX"],["Guadalajara",20.6767,-103.3475,"MX"],["Monterrey",25.6667,-100.3,"MX"],["Guatemala City",14.6133,-90.5353,"GT"],["Tijuana",32.525,-117.0333,"MX"],["Ecatepec",19.6097,-99.06,"MX"],["Tegucigalpa",14.1058,-87.2047,"HN"],["León de los Aldama",21.1167,-101.6833,"MX"],["San José",9.9325,-84.08,"CR"],["Panama City",8.9833,-79.5167,"PA"],["Juárez",31.745,-106.485,"MX"],["Comayagüela",14.098,-87.21,"HN"],["Mexicali",32.6633,-115.4678,"MX"],["Nezahualcóyotl",19.4081,-99.0186,"MX"],["Managua",12.1364,-86.2514,"NI"],["Morelia",19.7683,-101.1894,"MX"],["Aguascalientes",21.876,-102.296,"MX"],["Mérida",20.97,-89.62,"MX"],["Saltillo",25.4231,-100.9919,"MX"],["Culiacán",24.8069,-107.3939,"MX"]],[["Havana",23.1367,-82.3589,"CU"],["San Juan",18.3985,-66.061,"PR"],["Santiago",19.4572,-70.6889,"DO"],["Santo Domingo",18.4667,-69.95,"DO"],["Port-au-Prince",18.5333,-72.3333,"HT"],["Santo Domingo Este",18.4855,-69.8734,"DO"],["Kingston",17.9714,-76.7931,"JM"],["Carrefour",18.5344,-72.4094,"HT"],["Santiago de Cuba",20.0217,-75.8294,"CU"],["Pétion-Ville",18.5128,-72.2864,"HT"],["Holguín",20.8869,-76.2592,"CU"],["Gonaïves",19.4456,-72.6883,"HT"],["Camagüey",21.3839,-77.9075,"CU"],["Puerto Plata",19.8,-70.6833,"DO"],["Croix-des-Bouquets",18.5761,-72.2269,"HT"],["Nassau",25.0781,-77.3386,"BS"],["Fort-de-France",14.6,-61.0667,"MQ"],["Higüey",18.6167,-68.7,"DO"],["Santa Clara",22.4069,-79.9649,"CU"],["Bayamo",20.3817,-76.6428,"CU"]],[["Cairo",30.0444,31.2358,"EG"],["Lagos",6.455,3.3841,"NG"],["Kinshasa",-4.3219,15.3119,"CD"],["Luanda",-8.8383,13.2344,"AO"],["Johannesburg",-26.2044,28.0456,"ZA"],["Dar es Salaam",-6.8161,39.2803,"TZ"],["Douala",4.05,9.7,"CM"],["Giza",29.987,31.2118,"EG"],["Abidjan",5.3167,-4.0333,"CI"],["Cape Town",-33.9253,18.4239,"ZA"],["Bamako",12.6392,-8.0028,"ML"],["Abuja",9.0667,7.4833,"NG"],["Ibadan",7.3964,3.9167,"NG"],["Addis Ababa",9.03,38.74,"ET"],["Mbuji-Mayi",-6.15,23.6,"CD"],["Mogadishu",2.0392,45.3419,"SO"],["Lusaka",-15.4167,28.2833,"ZM"],["Antananarivo",-18.91,47.525,"MG"],["Awka",6.2069,7.0678,"NG"],["Bamenda",5.9614,10.1517,"CM"]],[["Tokyo",35.6897,139.6922,"JP"],["Delhi",28.61,77.23,"IN"],["Manila",14.5958,120.9772,"PH"],["Dhaka",23.7639,90.3889,"BD"],["Moscow",55.7558,37.6172,"RU"],["Ho Chi Minh City",10.7756,106.7019,"VN"],["Xi’an",34.2611,108.9422,"CN"],["Dongguan",23.021,113.752,"CN"],["Tongshan",34.204,117.284,"CN"],["Jining",35.4151,116.5871,"CN"],["Cangzhou",38.3047,116.8387,"CN"],["Shaoyang",27.2395,111.4679,"CN"],["Dalian",38.9,121.6,"CN"],["Ankara",39.93,32.85,"TR"],["Zhangzhou",24.513,117.647,"CN"],["Changsha",28.228,112.939,"CN"],["Ürümqi",43.8225,87.6125,"CN"],["Ningbo",29.8603,121.6245,"CN"],["Suihua",46.654,126.969,"CN"],["Deyang",31.127,104.398,"CN"]],[["London",51.5072,-.1275,"GB"],["Madrid",40.4169,-3.7033,"ES"],["Berlin",52.52,13.405,"DE"],["Barcelona",41.3828,2.1769,"ES"],["Athens",37.9842,23.7281,"GR"],["Budapest",47.4925,19.0514,"HU"],["Birmingham",52.48,-1.9025,"GB"],["Stuttgart",48.7775,9.18,"DE"],["Munich",48.1375,11.575,"DE"],["Hamburg",53.55,10,"DE"],["Bucharest",44.4325,26.1039,"RO"],["Vienna",48.2083,16.3725,"AT"],["Stockholm",59.3294,18.0686,"SE"],["Minsk",53.9,27.5667,"BY"],["Warsaw",52.23,21.0111,"PL"],["Valencia",39.47,-.3764,"ES"],["Amsterdam",52.3728,4.8936,"NL"],["Copenhagen",55.6761,12.5683,"DK"],["Porto",41.1621,-8.622,"PT"],["Brussels",50.8467,4.3525,"BE"]],[["New York",40.6943,-73.9249,"US"],["Los Angeles",34.1141,-118.4068,"US"],["Chicago",41.8375,-87.6866,"US"],["Miami",25.784,-80.2101,"US"],["Dallas",32.7935,-96.7667,"US"],["Philadelphia",40.0077,-75.1339,"US"],["Atlanta",33.7628,-84.422,"US"],["Boston",42.3188,-71.0852,"US"],["Phoenix",33.5722,-112.0892,"US"],["Detroit",42.3834,-83.1024,"US"],["Seattle",47.6211,-122.3244,"US"],["San Francisco",37.7558,-122.4449,"US"],["San Diego",32.8313,-117.1222,"US"],["Minneapolis",44.9635,-93.2678,"US"],["Brooklyn",40.6501,-73.9496,"US"],["Vancouver",49.25,-123.1,"CA"],["Riverside",33.9381,-117.3949,"US"],["Baltimore",39.3051,-76.6144,"US"],["Portland",45.5371,-122.65,"US"],["Sacramento",38.5677,-121.4685,"US"]],[["Melbourne",-37.8142,144.9631,"AU"],["Sydney",-33.8678,151.21,"AU"],["Brisbane",-27.4678,153.0281,"AU"],["Perth",-31.9559,115.8606,"AU"],["Auckland",-36.8406,174.74,"NZ"],["Adelaide",-34.9275,138.6,"AU"],["Port Moresby",-9.4789,147.1494,"PG"],["Gold Coast",-28.0167,153.4,"AU"],["Cranbourne",-38.0996,145.2834,"AU"],["Christchurch",-43.531,172.6365,"NZ"],["Manukau City",-37,174.885,"NZ"],["Central Coast",-33.3,151.2,"AU"],["Wollongong",-34.4331,150.8831,"AU"],["Ipswich",-27.6144,152.7608,"AU"],["Wellington",-41.2889,174.7772,"NZ"],["Northcote",-36.8019,174.7494,"NZ"],["Hobart",-42.8806,147.325,"AU"],["Lae",-6.7303,147.0008,"PG"],["Suva",-18.1416,178.4419,"FJ"],["Nouméa",-22.2758,166.458,"NC"]],[["São Paulo",-23.55,-46.6333,"BR"],["Buenos Aires",-34.6033,-58.3817,"AR"],["Rio de Janeiro",-22.9111,-43.2056,"BR"],["Lima",-12.06,-77.0375,"PE"],["Bogotá",4.7111,-74.0722,"CO"],["Santiago",-33.4372,-70.6506,"CL"],["Belo Horizonte",-19.9167,-43.9333,"BR"],["Fortaleza",-3.7275,-38.5275,"BR"],["Santa Cruz de la Sierra",-17.7892,-63.1975,"BO"],["La Paz",-16.4958,-68.1333,"BO"],["Guayaquil",-2.19,-79.8875,"EC"],["Medellín",6.2308,-75.5906,"CO"],["Salvador",-12.9747,-38.4767,"BR"],["Caracas",10.4806,-66.9036,"VE"],["Córdoba",-31.4167,-64.1833,"AR"],["Santos",-23.9369,-46.325,"BR"],["Curitiba",-25.4297,-49.2711,"BR"],["Maracaibo",10.6333,-71.6333,"VE"],["Recife",-8.05,-34.9,"BR"],["Porto Alegre",-30.0331,-51.23,"BR"]]],mt=[0,0,5,26,28,26,9,6],sa=mt.reduce((n,e)=>n+e,0),oa=mt.reduce((n,e)=>{const r=n[n.length-1]??0;return n.push(r+e),n},[]),ca=Array.from(wc(oa,ta,(n,e)=>[n,e])),Wn=new Date,Ct=new Date(Wn.getFullYear(),Wn.getMonth(),Wn.getDate()).valueOf();function ia(){return Ct}Array.from(Zi.keys());function aa(n){const e=n.nextRange(0,sa),r=lc(ca,([u])=>u<=e),[,s]=Hr(r),o=n.nextRange(0,s.length);return s[o]}function da(n){const e=n.nextRange(0,ft.length);return ft[e]}function la(n){const e=n.nextRange(0,pt.length);return pt[e]}function ua(n){const e=n.nextRange(0,wt.length);return wt[e]}function ha(n){const e=n.nextRange(0,ht.length);return ht[e]}function wa(n){const[e,r]=da(n),[,s,o,a]=aa(n),u=la(n),l=ua(n),C=ha(n);return{pubkey:new se("PUBKEY",n.fillBytes(32)),name:`${e} Node ${a} ${n.nextRange(0,100)}`,address:n.fillBytes(32),company:{name:e,website:r},location:{coords:[s,o],country:a},operatingSystem:u,networkType:C,nodeType:l}}function*pa(){const n=new gt(Ct),e=n.nextRange(50,150);for(let r=0;r<e;r++)yield wa(n)}Array.from(pa());class Mn{constructor(e,r){t(this,"block");t(this,"offset");this.block=e,this.offset=r,Object.freeze(this)}toJSON(){return Ln.encode(this)}}class fa{convert(e){return{block:m.encode(e.block),offset:m.encode(e.offset)}}}class ga{convert(e){return d(e,"block","offset"),new Mn(m.decode(e.block),m.decode(e.offset))}}class ma extends c{constructor(){super(...arguments);t(this,"encoder",new fa);t(this,"decoder",new ga)}}const Ln=new ma;class vt{constructor(e){t(this,"address");this.address=e,Object.freeze(this)}toJSON(){return Tn.encode(this)}}class Ca{convert(e){return U.encode(e.address)}}class va{convert(e){return new vt(U.decode(e))}}class ya extends c{constructor(){super(...arguments);t(this,"encoder",new Ca);t(this,"decoder",new va)}}const Tn=new ya;class yt{constructor(e,r,s){t(this,"address");t(this,"time");t(this,"message");this.address=e,this.time=r,this.message=s,Object.freeze(this)}toJSON(){return P.encode(this)}}class Sa{convert(e){return{address:Tn.encode(e.address),time:m.encode(Math.floor(e.time.valueOf()/1e3)),message:i.encode(e.message)}}}class ba{convert(e){return d(e,"address","time","message"),new yt(Tn.decode(e.address),new Date(m.decode(e.time)*1e3),i.decode(e.message))}}class Ea extends c{constructor(){super(...arguments);t(this,"encoder",new Sa);t(this,"decoder",new ba)}}const P=new Ea;new T(new M(P),new L(P));class Fn{constructor(e,r){t(this,"inscription");t(this,"chainDetails");this.inscription=e,this.chainDetails=r,Object.freeze(this)}toJSON(){return oe.encode(this)}}class xa{convert(e){return{inscription:P.encode(e.inscription),chain_details:Ln.encode(e.chainDetails)}}}class ka{convert(e){return d(e,"inscription","chain_details"),new Fn(P.decode(e.inscription),Ln.decode(e.chain_details))}}class Ra extends c{constructor(){super(...arguments);t(this,"encoder",new xa);t(this,"decoder",new ka)}}const oe=new Ra,Pn=new T(new M(oe),new L(oe));class St{static get big(){return Be.instance}static get little(){return Ue.instance}get isLittleEndian(){return this===Ue.instance}get isBigEndian(){return this===Be.instance}}const Te=class Te extends St{};t(Te,"instance",new Te);let Be=Te;const Fe=class Fe extends St{};t(Fe,"instance",new Fe);let Ue=Fe;class Ia{constructor(e,r){t(this,"inscription");t(this,"signature");this.inscription=e,this.signature=r,Object.freeze(this)}toJSON(){return jn.encode(this)}}class Da{convert(e){return{inscription:P.encode(e.inscription),signature:U.encode(e.signature)}}}class Aa{convert(e){return d(e,"inscription","signature"),new Ia(P.decode(e.inscription),U.decode(e.signature))}}class Ba extends c{constructor(){super(...arguments);t(this,"encoder",new Da);t(this,"decoder",new Aa)}}const jn=new Ba;class bt{}const zn="PutInscription";class Ne extends bt{constructor(r){super();t(this,"inscriptionAndSignature");this.inscriptionAndSignature=r,Object.freeze(this)}toJSON(){return qn.encode(this)}}class Ua{convert(e){return{type:i.encode(zn),inscription_and_signature:jn.encode(e.inscriptionAndSignature)}}}class Na{convert(e){return d(e,"type","inscription_and_signature"),tr(e,zn),new Ne(jn.decode(e.inscription_and_signature))}}class Oa extends c{constructor(){super(...arguments);t(this,"encoder",new Ua);t(this,"decoder",new Na)}}const qn=new Oa,Jn="RetrieveInscriptionsForAddress";class $n extends bt{constructor(r){super();t(this,"address");this.address=r,Object.freeze(this)}toJSON(){return Hn.encode(this)}}class Wa{convert(e){return{type:i.encode(Jn),address:i.encode(e.address)}}}class Ma{convert(e){return d(e,"type","address"),tr(e,Jn),new $n(i.decode(e.address))}}class La extends c{constructor(){super(...arguments);t(this,"encoder",new Wa);t(this,"decoder",new Ma)}}const Hn=new La;class Ta{convert(e){return e instanceof Ne?qn.encode(e):e instanceof $n?Hn.encode(e):e.toJSON()}}class Fa{convert(e){if(d(e,"type"),!z(e.type))throw new h(typeof e.type,"string");switch(e.type){case zn:return qn.decode(e);case Jn:return Hn.decode(e);default:throw new h(e.type,"CappuccinoInscriptionRequest")}}}class Pa extends c{constructor(){super(...arguments);t(this,"encoder",new Ta);t(this,"decoder",new Fa)}}const Et=new Pa,ce="Inscription";class Vn extends Xr{constructor(r){super();t(this,"request");this.request=r}get type(){return ce}toJson(){return xt.encode(this)}}class ja{convert(e){return{[ce]:Et.encode(e.request)}}}class za{convert(e){d(e,ce);const r=e[ce];return new Vn(Et.decode(r))}}class qa extends c{constructor(){super(...arguments);t(this,"encoder",new ja);t(this,"decoder",new za)}}const xt=new qa;class Qn{}const Oe="LatestInscription";class ie extends Qn{constructor(r){super();t(this,"inscriptionAndChainDetails");this.inscriptionAndChainDetails=r}toJSON(){return Gn.encode(this)}}class Ja{convert(e){d(e,Oe);const r=e[Oe];return new ie(oe.decode(r))}}class $a{convert(e){return{[Oe]:oe.encode(e.inscriptionAndChainDetails)}}}class Ha extends c{constructor(){super(...arguments);t(this,"encoder",new $a);t(this,"decoder",new Ja)}}const Gn=new Ha,We="RetrievedInscriptionsForWalletAddress";class Xn extends Qn{constructor(r){super();t(this,"inscriptionAndChainDetails");this.inscriptionAndChainDetails=r}toJSON(){return Zn.encode(this)}}class Va{convert(e){d(e,We);const r=e[We];return new Xn(Pn.decode(r))}}class Qa{convert(e){return{[We]:Pn.encode(e.inscriptionAndChainDetails)}}}class Ga extends c{constructor(){super(...arguments);t(this,"encoder",new Qa);t(this,"decoder",new Va)}}const Zn=new Ga;class Xa{constructor(e,r,s){t(this,"numBlocks");t(this,"numTransactions");t(this,"numInscriptions");this.numBlocks=e,this.numTransactions=r,this.numInscriptions=s}}class Za{convert(e){return{num_blocks:m.encode(e.numBlocks),num_transactions:m.encode(e.numTransactions),num_inscriptions:m.encode(e.numInscriptions)}}}class _a{convert(e){return d(e,"num_blocks","num_transactions","num_inscriptions"),new Xa(m.decode(e.num_blocks),m.decode(e.num_transactions),m.decode(e.num_inscriptions))}}class Ka extends c{constructor(){super(...arguments);t(this,"encoder",new Za);t(this,"decoder",new _a)}}const kt=new Ka,Me="Stats";class Rt extends Qn{constructor(r){super();t(this,"stats");this.stats=r}toJSON(){return _n.encode(this)}}class Ya{convert(e){d(e,Me);const r=e[Me];return new Rt(kt.decode(r))}}class ed{convert(e){return{[Me]:kt.encode(e.stats)}}}class nd extends c{constructor(){super(...arguments);t(this,"encoder",new ed);t(this,"decoder",new Ya)}}const _n=new nd;class rd{convert(e){if(Je(e,Oe))return Gn.decode(e);if(Je(e,Me))return _n.decode(e);if(Je(e,We))return Zn.decode(e);throw new E}}class td{convert(e){if(e instanceof ie)return Gn.encode(e);if(e instanceof Rt)return _n.encode(e);if(e instanceof Xn)return Zn.encode(e);throw new E}}class sd extends c{constructor(){super(...arguments);t(this,"encoder",new td);t(this,"decoder",new rd)}}const Kn=new sd,ae="InscriptionResponse";class It extends Dn{constructor(r){super();t(this,"response");this.response=r}get type(){return ae}toJson(){return Dt.encode(this)}}class od{convert(e){return{[ae]:Kn.encode(e.response)}}}class cd{convert(e){d(e,ae);const r=e[ae];return new It(Kn.decode(r))}}class id extends c{constructor(){super(...arguments);t(this,"encoder",new od);t(this,"decoder",new cd)}}const Dt=new id;class ad{convert(e){return new It(e)}}const At=new ad,dd="An Infinite Garden has no walls";function*ld(n){const e=new Date;let s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=0;for(;;){const a=wd(s,o,n);yield a,s=a.inscription.time,o=a.chainDetails.block}}function*ud(n){const e=new Date,r=n[Symbol.iterator]();for(let s=r.next();!s.done&&s.value.inscription.time.valueOf()<e.valueOf();s=r.next())yield s.value}async function*hd(n){for(const e of n){const r=new Date,o=e.inscription.time.valueOf()-r.valueOf();o>0&&await ct(o),yield e}}function wd(n,e,r){const s=r.nextRange(5,10)*1e3,o=r.nextRange(1,20),a=r.nextRange(0,5),u=new yt(pd(r),new Date(n.valueOf()+s),dd),l=new Mn(e+o,a);return new Fn(u,l)}function pd(n){return new vt(n.fillBytes(20))}class fd{constructor(e,r){t(this,"responseStream");t(this,"requestStream");t(this,"webSocketStatusSink");t(this,"inscriptionResponseSink");t(this,"prng",new gt(ia()));t(this,"latestInscriptions",Fr(100));t(this,"allInscriptions",ld(this.prng));t(this,"isConnected",!1);this.requestStream=e,this.responseStream=r,this.webSocketStatusSink=te(V(r),ot),this.inscriptionResponseSink=te(V(r),At)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async initializeState(){for(const e of ud(this.allInscriptions))this.latestInscriptions.put(e)}async startProcessing(){await this.initializeState(),this.handleRequests(),this.streamInscriptions()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async streamInscriptions(){for await(const e of hd(this.allInscriptions))this.latestInscriptions.put(e),this.isConnected&&this.inscriptionResponseSink.send(new ie(e))}async handleRequest(e){if(e instanceof In){try{await this.handleWebSocketCommand(e.command)}catch(r){console.error("failed to handle life cycle request",e,r)}return}if(e instanceof Vn){try{await this.handleInscriptionsRequest(e.request)}catch(r){console.error("failed to handle node validator request",e,r)}return}console.error("unrecognized request type",e)}async handleWebSocketCommand(e){if(e instanceof Ee){await this.handleConnect();return}if(e instanceof be){await this.handleClose();return}}async handleInscriptionsRequest(e){if(e instanceof Ne){await this.handlePutInscription(e);return}throw new E}async handleConnect(){if(this.isConnected)throw new Error("already connected to WebSocket");this.isConnected=!0,await this.webSocketStatusSink.send(new ke),await this.webSocketStatusSink.send(new Re);for(const e of this.latestInscriptions.immutableIterable())this.inscriptionResponseSink.send(new ie(e))}async handleClose(){if(!this.isConnected)throw new Error("not connected to WebSocket");this.isConnected=!1,await this.webSocketStatusSink.send(new xe)}async handlePutInscription(e){const r=Hr(this.latestInscriptions.immutableIterable()),s=new Mn(r.chainDetails.block+1,0),o=new Fn(e.inscriptionAndSignature.inscription,s);this.latestInscriptions.put(o),await ct(1e3*20),await this.inscriptionResponseSink.send(new ie(o))}}const Yn="WebSocketError";class Le extends g{constructor(r,s=`websocket error: ${String(r)}`){super(s);t(this,"cause");this.cause=r,Object.freeze(this)}get code(){return Yn}}class gd{convert(e){return d(e,"code","message"),p(e,Yn),new Le({},i.decode(e.message))}}class md extends S{}class Cd extends c{constructor(){super(...arguments);t(this,"encoder",new md);t(this,"decoder",new gd)}}const vd=new Cd;f(Yn,vd);class yd{constructor(e,r,s,o){t(this,"responseStream");t(this,"requestStream");t(this,"serviceBaseWebSocketURL");t(this,"serviceBaseURL");t(this,"lifecycleResponseSink");t(this,"inscriptionResponseSink");t(this,"errorResponseSink");t(this,"webSocket",null);t(this,"webSocketCompleter",null);t(this,"retrieveInscriptionsForAddressCache",new Map);this.requestStream=e,this.responseStream=r,this.serviceBaseWebSocketURL=s,this.serviceBaseURL=o,this.lifecycleResponseSink=te(V(r),ot),this.inscriptionResponseSink=te(V(r),At),this.errorResponseSink=te(V(r),wi)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof In){try{await this.handleWebSocketRequest(e.command)}catch(r){console.error("failed to handle life cycle request",e,r)}return}if(e instanceof Vn){try{const r=await this.handleInscriptionsRequest(e.request);r&&await this.inscriptionResponseSink.send(r)}catch(r){if(!(r instanceof g)){console.error("unhandled error from put inscription request",e,r);return}await this.errorResponseSink.send(r)}return}console.error("unrecognized request type",e)}async handleWebSocketRequest(e){if(e instanceof Ee){await this.handleConnect();return}if(e instanceof be){await this.handleClose();return}}async handleInscriptionsRequest(e){if(e instanceof Ne){await this.webSocketCompleter.promise,await this.handlePutInscription(e);return}if(e instanceof $n)return await this.handleRetrieveInscriptionsForAddressMemoized(e);throw new E}assertNotConnected(){if(this.webSocket!==null)throw new Error("Already connected")}assertConnected(){if(this.webSocket===null)throw new Error("Not connected")}async handleConnect(){this.assertNotConnected(),await this.lifecycleResponseSink.send(new ke);const e=new URL("inscriptions/inscriptions",this.serviceBaseWebSocketURL),r=me();this.webSocketCompleter=r;try{const s=new Sd(this.inscriptionResponseSink),o=new bd(r,this.lifecycleResponseSink),a=new Ed(this.lifecycleResponseSink),u=new xd(this.errorResponseSink),l=new WebSocket(e);l.onerror,l.addEventListener("open",o),l.addEventListener("message",s),l.addEventListener("close",a),l.addEventListener("error",u),l.addEventListener("close",()=>{l.removeEventListener("open",o),l.removeEventListener("message",s),l.removeEventListener("close",a),l.removeEventListener("error",u),this.webSocket=null}),this.webSocket=l}catch(s){const o=new Le(s);this.errorResponseSink.send(o),r.completeError(o)}}async handleClose(){this.assertConnected(),this.webSocket.close(1e3,"done")}async handlePutInscriptionFetch(e){try{return await fetch(new URL("inscriptions/put_inscription",this.serviceBaseURL),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.inscriptionAndSignature)})}catch(r){throw new Ke(r)}}validateResponse(e){if(!e.ok)throw e.status>=400&&e.status<500?new ar(e.status,e):e.status>=500&&e.status<600?new hr(e.status,e):new lr(e.status,e);if(e.headers.get("content-type")!=="application/json")throw new H(e.headers.get("content-type")??"undefined",e.status,e)}async handlePutInscription(e){const r=await this.handlePutInscriptionFetch(e);return this.validateResponse(r),null}async handleRetrieveInscriptionsForAddressFetch(e){try{return await fetch(new URL(`inscriptions/inscriptions_for_wallet_address/${e.address}`,this.serviceBaseURL),{method:"GET",headers:{Accept:"application/json"}})}catch(r){throw new Ke(r)}}async handleRetrieveInscriptionsForAddress(e){const r=await this.handleRetrieveInscriptionsForAddressFetch(e);return this.validateResponse(r),new Xn(Pn.decode(await r.json()))}async handleRetrieveInscriptionsForAddressMemoized(e){if(this.retrieveInscriptionsForAddressCache.has(e.address))return this.retrieveInscriptionsForAddressCache.get(e.address);const r=await this.handleRetrieveInscriptionsForAddress(e);return this.retrieveInscriptionsForAddressCache.set(e.address,r),r}}class Sd{constructor(e){t(this,"inscriptionResponseSink");this.inscriptionResponseSink=e}decodeMessage(e){return Kn.decode(JSON.parse(e.data))}async relayMessage(e){try{await this.inscriptionResponseSink.send(e)}catch(r){console.error("attempt to publish message to response stream failed",r)}}async handleEvent(e){try{const r=this.decodeMessage(e);this.relayMessage(r)}catch(r){console.error("Failed to decode server message from web socket",r);return}}}class bd{constructor(e,r){t(this,"completer");t(this,"lifecycleResponseSink");this.completer=e,this.lifecycleResponseSink=r}handleEvent(e){this.completer.complete(e.target),this.lifecycleResponseSink.send(new Re)}}class Ed{constructor(e){t(this,"lifecycleResponseSink");this.lifecycleResponseSink=e}async handleEvent(){await this.lifecycleResponseSink.send(new xe)}}class xd{constructor(e){t(this,"errorResponseSink");this.errorResponseSink=e}errorFromEvent(e){return"error"in e?new Le(e.error):new Le(null,"web socket error: unknown error")}handleEvent(e){this.errorResponseSink.send(this.errorFromEvent(e))}}li(ae,Dt),zc(ce,xt);async function kd(n){const e=new URL(n),r=new URL(`${e.protocol.replace(/^http?/,"ws")}//${e.host}${e.pathname}`),s=ve(1024),o=ve(1024),a=new yd(s,o,r,e);return a.startProcessing(),a}async function Rd(){try{const o=await(await fetch("/config.json")).json();if(o.inscription_service_url){const a=await kd(o.inscription_service_url);if(a!==null)return a}}catch(s){console.warn("error determining service implementation, from configuration file",s)}const n=ve(1024),e=ve(1024),r=new fd(n,e);return r.startProcessing(),r}async function Id(){return new Dd(await Rd())}class Dd{constructor(e){t(this,"service");this.service=e}get stream(){return this.service.stream}async send(e){return this.service.send(e)}}async function Ad(n,e){const r=await n;for await(const s of r.stream)e(ui.encode(s))}class Bd{constructor(e){t(this,"service");const r=Id();this.service=r,Ad(r,e)}async handleEvent(e){const r=qc.decode(e.data);try{(await this.service).send(r)}catch(s){console.warn("error processing message from event",s)}}}self.addEventListener("message",new Bd(self.postMessage.bind(self)))})();
