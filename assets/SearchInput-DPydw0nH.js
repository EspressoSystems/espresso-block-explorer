import{R as n,j as t}from"./iframe-Dz1tcGmB.js";import{P as q}from"./PromiseResolver-DkQ6sgKm.js";import{P as L}from"./IconButton-C7leDAVZ.js";import{L as g}from"./label-DWD3lJbf.js";import{D as h,L as P,E as F}from"./LoadingProvider-DCua2xWV.js";import{P as R}from"./PathResolverProvider-NY-UQiBR.js";import{a as E}from"./Card-T8Nlve6i.js";import{C as b,e as w,a as j,b as y,c as B,d as D}from"./CappuccinoHotShotQueryServiceAPIContext-JoU-L4bA.js";import{N as d}from"./NumberText-C9JeOSfX.js";import{R as V}from"./RelativeTimeText-Ch5UcHMA.js";import{T as i}from"./Text-BU7JBOLk.js";import{k as _}from"./typography-B0ztRi_u.js";import{S as U}from"./SearchGlass-CW66AL5Y.js";import{I as G}from"./Container-CE2_Zbv5.js";const m=_("div");function x(r){r.stopPropagation(),r.preventDefault()}function $(r){const e=r.indexOf("~");if(e<0)return r.toLocaleUpperCase();const s=r.substring(0,e),a=r.substring(e+1);return`${s.toLocaleUpperCase()}~${a}`}function A(){if(typeof window>"u")return{href:""};let r=window;for(;r!==r.parent;)r=r.parent;return r.location}class v{pRawQuery;pQuery;pSearchResults;pSearchResultsQuery;pIsLoading;pOffset;pLocation;constructor(e){const{rawQuery:s="",query:a="",searchResults:o=new j(new y([],[])),searchResultsQuery:c="",isLoading:l=!1,offset:p=null,location:u=A()}=e||{};this.pRawQuery=s,this.pQuery=a,this.pSearchResultsQuery=c,this.pSearchResults=o,this.pIsLoading=l,this.pOffset=p,this.pLocation=u}get rawQuery(){return this.pRawQuery}get query(){return this.pQuery}get searchResults(){return this.pSearchResults}get searchResultsQuery(){return this.pSearchResultsQuery}get isLoading(){return this.pIsLoading}get offset(){return this.pOffset}get totalSearchResults(){return this.searchResults.searchResults.transactions.length+this.searchResults.searchResults.blocks.length}setQuery(e){this.pRawQuery=e,this.pQuery=$(e),this.pOffset=null}setSearchResults(e,s){this.pSearchResults=s,this.pSearchResultsQuery=e,this.pOffset=null}setSearchResultsEmpty(){this.pOffset=null,this.pQuery="",this.pRawQuery="",this.pSearchResultsQuery="",this.pSearchResults=new j(new y([],[]))}setLoading(e,s){this.pSearchResultsQuery=e,this.pIsLoading=s}setOffset(e){this.pOffset=e;const s=document.querySelector(`[data-index="${e}"]`);s&&"scrollIntoView"in s&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({block:"nearest",behavior:"smooth"})}navigateTo(e){this.pLocation.href=e}async activate(e,s){if(this.offset===null){if(this.query==="")return;if(/^\d+$/.test(this.query)){const o=Number(this.query);if(Number.isNaN(o)||!Number.isInteger(o))return;this.navigateTo(s.block(o));return}try{const o=await e.explorer.getSearchResult(new w(this.query));if(o.searchResults.blocks.length>0){this.navigateTo(s.block(o.searchResults.blocks[0].height));return}if(o.searchResults.transactions.length>0){const c=o.searchResults.transactions[0];this.navigateTo(s.transaction(c.height,c.offset));return}}catch(o){console.error("encountered error while searching for query",o)}return}const a=this.getResultForOffset(this.offset);if(a instanceof B){this.navigateTo(s.block(a.height));return}if(a instanceof D){this.navigateTo(s.transaction(a.height,a.offset));return}}getResultForOffset(e){const s=this.searchResults.searchResults;return e>=s.blocks.length?s.transactions[e-s.blocks.length]:s.blocks[e]}getValueForOffset(e){return this.getResultForOffset(e).hash.toString()}}const S=n.createContext(new v),k=n.createContext(()=>{});function W(r){const[e]=n.useState(new v(r)),[s,a]=n.useState(0);return[e,()=>a(s+1)]}const C=r=>{const[e,s]=W(r.initialState),a=n.useContext(b),o=n.useContext(R);return t.jsx(S.Provider,{value:e,children:t.jsx(k.Provider,{value:s,children:t.jsx(Q.Provider,{value:e.offset,children:t.jsx(f.Provider,{value:e.query,children:t.jsxs(G,{className:"search",role:"search",children:[t.jsx("input",{type:"search",placeholder:"Search blocks, transactions, rollups or addresses...",value:e.offset===null?e.rawQuery:e.getValueForOffset(e.offset),onKeyDown:c=>{if(c.code==="Escape"){x(c),c.currentTarget.blur();return}if(c.code==="Enter"){x(c),e.activate(a,o);return}if(c.code==="ArrowDown"){if(x(c),e.totalSearchResults<=0)return;if(e.offset===null){e.setOffset(0),s();return}const l=e.totalSearchResults;if(e.offset===l-1){e.setOffset(null),s();return}e.setOffset(e.offset+1),s();return}if(c.code==="ArrowUp"){if(x(c),e.totalSearchResults<=0)return;const l=e.totalSearchResults;if(e.offset===null){e.setOffset(l-1),s();return}if(e.offset===0){e.setOffset(null),s();return}e.setOffset(e.offset-1),s();return}},onChange:async c=>{const l=c.currentTarget.value.trim();if(l!==e.query){if(l===""){e.setSearchResultsEmpty(),s();return}e.setQuery(l),s()}},"data-focused":r.forceFocusState?!0:void 0,"aria-label":"search text"}),t.jsx(H,{}),t.jsx(L,{children:t.jsx(U,{})}),t.jsx(K,{}),t.jsx(h.Provider,{value:e.searchResults,children:t.jsx(J,{})})]})})})})})},f=n.createContext(""),H=()=>t.jsx("div",{className:"search-barrier"}),K=()=>{const r=n.useContext(b),e=n.useContext(S),s=n.useContext(f);return s===""?t.jsx(t.Fragment,{}):s!==e.query?t.jsx(t.Fragment,{}):e.query===e.searchResultsQuery?t.jsx(t.Fragment,{}):t.jsx(q,{promise:Promise.all([Promise.resolve(s),r.explorer.getSearchResult(new w(s))]),children:t.jsx(z,{})})},z=()=>{const r=n.useContext(S),e=n.useContext(P),s=n.useContext(F),a=n.useContext(h),o=n.useContext(k);return n.useEffect(()=>{if(!e&&!(r.isLoading||s)&&a[0]===r.query)return r.setLoading(a[0],!1),r.setSearchResults(a[0],a[1]),o(),()=>{}},[r,e,s,a,o]),t.jsx(t.Fragment,{})},J=()=>{const r=n.useContext(h);return n.useContext(f).length<=0&&r.searchResults.blocks.length<=0&&r.searchResults.transactions.length<=0?t.jsx(t.Fragment,{}):t.jsx(M,{})},M=()=>t.jsx(E,{className:"search-results",children:t.jsxs("section",{"aria-label":"search results",className:"search-results-scroll-container",children:[t.jsx(X,{}),t.jsx(Y,{}),t.jsx(ee,{})]})}),Q=n.createContext(null),I=({children:r,index:e})=>{const s=n.useContext(Q);return t.jsx("div",{"data-selected":s===e,"data-index":e,className:"result-row",children:t.jsx("div",{className:"result-row-content",children:r})})},O=n.createContext(null),X=()=>{const r=n.useContext(h),e=n.useContext(f);return r.searchResults.blocks.length>0||r.searchResults.transactions.length>0||e.length<=0?t.jsx(t.Fragment,{}):t.jsx("section",{"aria-label":"no-results",children:t.jsx(g,{className:"type--ui--small result-section-title",children:t.jsx(i,{text:"No results found"})})})},Y=()=>{const r=n.useContext(R),e=n.useContext(h),{searchResults:s}=e,{blocks:a}=s;if(a.length<=0)return t.jsx(t.Fragment,{});const o=0;return t.jsxs("section",{"aria-label":"block-results",children:[t.jsx(g,{className:"type--ui--small result-section-title",children:t.jsx(i,{text:"Blocks"})}),a.map((c,l)=>t.jsx("a",{href:r.block(c.height),children:t.jsx(O.Provider,{value:[c,l+o],children:t.jsx(I,{index:l+o,children:t.jsx(Z,{})},l+o)})},l+o))]})},N=r=>t.jsx("div",{className:"commit",children:r.children}),Z=()=>{const r=n.useContext(f),[e]=n.useContext(O),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(N,{children:[t.jsx(i,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(i,{text:s.substring(r.length)})})]}),t.jsx(m,{children:t.jsx(d,{number:e.height})})]})},T=n.createContext(null),ee=()=>{const r=n.useContext(R),e=n.useContext(h),{searchResults:s}=e,{blocks:a,transactions:o}=s;if(o.length<=0)return t.jsx(t.Fragment,{});const c=a.length;return t.jsxs("section",{"aria-label":"transaction-results",children:[t.jsx(g,{className:"type--ui--small result-section-title",children:t.jsx(i,{text:"Transactions"})}),o.map((l,p)=>{const u=p+c;return t.jsx("a",{href:r.transaction(l.height,l.offset),children:t.jsx(T.Provider,{value:[l,u],children:t.jsx(I,{index:u,children:t.jsx(te,{})})},u)},u)})]})},te=()=>{const r=n.useContext(f),[e]=n.useContext(T),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(N,{children:[t.jsx(i,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(i,{text:s.substring(r.length)})})]}),t.jsxs(m,{children:["Transaction ",t.jsx(d,{number:e.offset+1})," of"," ",t.jsx(d,{number:e.numTransactions})," in Block"," ",t.jsx(d,{number:e.height})]}),t.jsx(m,{children:t.jsx(V,{date:e.time})})]})};try{C.displayName="SearchInput",C.__docgenInfo={description:`SearchInput is the component that will allow the user to search for blocks,
transactions, rollups, and addresses.

Right now it only supports searching for blocks and transactions.`,displayName:"SearchInput",props:{initialState:{defaultValue:null,description:"",name:"initialState",required:!1,type:{name:"InitialSearchState"}},forceFocusState:{defaultValue:null,description:"",name:"forceFocusState",required:!1,type:{name:"boolean"}}}}}catch{}export{C as S};
