var F=Object.defineProperty;var _=(r,e,s)=>e in r?F(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var c=(r,e,s)=>_(r,typeof e!="symbol"?e+"":e,s);import{j as t}from"./jsx-runtime-BlAj40OV.js";import{P as E}from"./PromiseResolver-PcuSBQi4.js";import{P as A}from"./IconButton-DmUE976j.js";import{D as f,L as B,E as D}from"./LoadingProvider-DpAvs9pm.js";import{P as R}from"./PathResolverProvider-Xv58eOQd.js";import{a as V}from"./Card-D_ektR-F.js";import{C as U,a as G}from"./CircularBuffer-DTeJHj1X.js";import{C,a as b,i as w,b as I}from"./CappuccinoHotShotQueryServiceAPIContext-DtXbM9Zs.js";import{N as x}from"./NumberText-C4Z_0tU7.js";import{R as $}from"./RelativeTimeText-MUfD-2Qu.js";import{T as u}from"./Text-BU7JBOLk.js";import{j as N}from"./typography-DHShmccC.js";import{S as z}from"./SearchGlass-BTYiCYPh.js";import{R as n}from"./index-Cs7sjTYM.js";import{a as W}from"./higher_order-DnPEgWEz.js";const g=r=>t.jsx("div",{className:W(r.className,"input-container"),role:r.role,children:r.children});try{g.displayName="InputContainer",g.__docgenInfo={description:"InputContainer is a `div` container that assists in styling `input` elements.\nTraditionally `input` elements are very difficult to style as they don't\nexactly follow the content box model or the border box model.\n\nIn order to normalize input elements it is helpful to have them follow some\nother element's sizing rules directly instead of allowing them to have their\nown.\n\nThis is the purpose of the `InputContainer` component. It provides a sizable\ncontainer that follows the border box model in which an `input` element\ncan be fitted, and that `input` will attempt to fill all of the available\nspace of the `InputContainer`.",displayName:"InputContainer",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"",name:"role",required:!1,type:{name:"string"}}}}}catch{}const y=N("div"),S=N("label");function p(r){r.stopPropagation(),r.preventDefault()}function H(r){const e=r.indexOf("~");if(e<0)return r.toLocaleUpperCase();const s=r.substring(0,e),o=r.substring(e+1);return`${s.toLocaleUpperCase()}~${o}`}class Q{constructor(e){c(this,"pRawQuery");c(this,"pQuery");c(this,"pLastActivity");c(this,"pSearchResults");c(this,"pSearchResultsQuery");c(this,"pIsLoading");c(this,"pOffset");const{rawQuery:s="",query:o="",lastActivity:l=new Date,searchResults:a=new C(new b([],[])),searchResultsQuery:i="",isLoading:m=!1,offset:h=null}=e||{};this.pRawQuery=s,this.pQuery=o,this.pSearchResultsQuery=i,this.pLastActivity=l,this.pSearchResults=a,this.pIsLoading=m,this.pOffset=h}get rawQuery(){return this.pRawQuery}get query(){return this.pQuery}get lastActivity(){return this.pLastActivity}get searchResults(){return this.pSearchResults}get searchResultsQuery(){return this.pSearchResultsQuery}get isLoading(){return this.pIsLoading}get offset(){return this.pOffset}get totalSearchResults(){return this.searchResults.searchResults.transactions.length+this.searchResults.searchResults.blocks.length}setQuery(e){this.pRawQuery=e,this.pQuery=H(e),this.pOffset=null}setLastActivity(e){this.pLastActivity=e}setSearchResults(e,s){this.pSearchResults=s,this.pSearchResultsQuery=e,this.pOffset=null}setSearchResultsEmpty(){this.pOffset=null,this.pQuery="",this.pRawQuery="",this.pSearchResultsQuery="",this.pSearchResults=new C(new b([],[]))}setLoading(e,s){this.pSearchResultsQuery=e,this.pIsLoading=s}setOffset(e){this.pOffset=e;const s=document.querySelector(`[data-index="${e}"]`);s&&s.scrollIntoView({block:"nearest",behavior:"smooth"})}navigateTo(e){let s=window;for(;s!==s.parent;)s=s.parent;s.location.href=e}async activate(e,s){if(this.offset===null){if(this.query==="")return;if(/^\d+$/.test(this.query)){const a=Number(this.query);if(Number.isNaN(a)||!Number.isInteger(a))return;this.navigateTo(s.block(a));return}try{const a=await e.explorer.getSearchResult(new w(this.query));if(a.searchResults.blocks.length>0){this.navigateTo(s.block(a.searchResults.blocks[0].height));return}if(a.searchResults.transactions.length>0){const i=a.searchResults.transactions[0];this.navigateTo(s.transaction(i.height,i.offset));return}}catch{}return}const o=this.getResultForOffset(this.offset);let l=window;for(;l!==l.parent;)l=l.parent;if(o instanceof U){this.navigateTo(s.block(o.height));return}if(o instanceof G){this.navigateTo(s.transaction(o.height,o.offset));return}}getResultForOffset(e){const s=this.searchResults.searchResults;return e>=s.blocks.length?s.transactions[e-s.blocks.length]:s.blocks[e]}getValueForOffset(e){return this.getResultForOffset(e).hash.toString()}}const j=n.createContext(new Q),k=n.createContext(()=>{});function K(r){const[e]=n.useState(new Q(r)),[s,o]=n.useState(0);return[e,()=>o(s+1)]}const v=r=>{const[e,s]=K(r.initialState),o=n.useContext(I),l=n.useContext(R);return t.jsx(j.Provider,{value:e,children:t.jsx(k.Provider,{value:s,children:t.jsx(T.Provider,{value:e.offset,children:t.jsx(d.Provider,{value:e.query,children:t.jsxs(g,{className:"search",role:"search",children:[t.jsx("input",{type:"search",placeholder:"Search blocks, transactions, rollups or addresses...",value:e.offset===null?e.rawQuery:e.getValueForOffset(e.offset),onKeyDown:a=>{if(a.code==="Escape"){p(a),a.currentTarget.blur();return}if(a.code==="Enter"){p(a),e.activate(o,l);return}if(a.code==="ArrowDown"){if(p(a),e.totalSearchResults<=0)return;if(e.offset===null){e.setOffset(0),s();return}const i=e.totalSearchResults;if(e.offset===i-1){e.setOffset(null),s();return}e.setOffset(e.offset+1),s();return}if(a.code==="ArrowUp"){if(p(a),e.totalSearchResults<=0)return;const i=e.totalSearchResults;if(e.offset===null){e.setOffset(i-1),s();return}if(e.offset===0){e.setOffset(null),s();return}e.setOffset(e.offset-1),s();return}},onChange:async a=>{const i=a.currentTarget.value.trim();if(i!==e.query){if(i===""){e.setSearchResultsEmpty(),s();return}e.setQuery(i),s()}},"data-focused":r.forceFocusState?!0:void 0,"aria-label":"search text"}),t.jsx(J,{}),t.jsx(A,{children:t.jsx(z,{})}),t.jsx(M,{}),t.jsx(f.Provider,{value:e.searchResults,children:t.jsx(Y,{})})]})})})})})},d=n.createContext(""),J=()=>t.jsx("div",{className:"search-barrier"}),M=()=>{const r=n.useContext(I),e=n.useContext(j),s=n.useContext(d);return s===""?t.jsx(t.Fragment,{}):s!==e.query?t.jsx(t.Fragment,{}):e.query===e.searchResultsQuery?t.jsx(t.Fragment,{}):t.jsx(E,{promise:Promise.all([Promise.resolve(s),r.explorer.getSearchResult(new w(s))]),children:t.jsx(X,{})})},X=()=>{const r=n.useContext(j),e=n.useContext(B),s=n.useContext(D),o=n.useContext(f),l=n.useContext(k);return n.useEffect(()=>{if(!e&&!(r.isLoading||s)&&o[0]===r.query)return r.setLoading(o[0],!1),r.setSearchResults(o[0],o[1]),l(),()=>{}},[r,e,s,o,l]),t.jsx(t.Fragment,{})},Y=()=>{const r=n.useContext(f);return n.useContext(d).length<=0&&r.searchResults.blocks.length<=0&&r.searchResults.transactions.length<=0?t.jsx(t.Fragment,{}):t.jsx(Z,{})},Z=()=>t.jsx(V,{className:"search-results",children:t.jsxs("section",{"aria-label":"search results",className:"search-results-scroll-container",children:[t.jsx(ee,{}),t.jsx(te,{}),t.jsx(re,{})]})}),T=n.createContext(null),O=({children:r,index:e})=>{const s=n.useContext(T);return t.jsx("div",{"data-selected":s===e,"data-index":e,className:"result-row",children:t.jsx("div",{className:"result-row-content",children:r})})},q=n.createContext(null),ee=()=>{const r=n.useContext(f),e=n.useContext(d);return r.searchResults.blocks.length>0||r.searchResults.transactions.length>0||e.length<=0?t.jsx(t.Fragment,{}):t.jsx("section",{"aria-label":"no-results",children:t.jsx(S,{className:"result-section-title",children:t.jsx(u,{text:"No results found"})})})},te=()=>{const r=n.useContext(R),e=n.useContext(f),{searchResults:s}=e,{blocks:o}=s;if(o.length<=0)return t.jsx(t.Fragment,{});const l=0;return t.jsxs("section",{"aria-label":"block-results",children:[t.jsx(S,{className:"result-section-title",children:t.jsx(u,{text:"Blocks"})}),o.map((a,i)=>t.jsx("a",{href:r.block(a.height),children:t.jsx(q.Provider,{value:[a,i+l],children:t.jsx(O,{index:i+l,children:t.jsx(se,{})},i+l)})},i+l))]})},L=r=>t.jsx("div",{className:"commit",children:r.children}),se=()=>{const r=n.useContext(d),[e]=n.useContext(q),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(L,{children:[t.jsx(u,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(u,{text:s.substring(r.length)})})]}),t.jsx(y,{children:t.jsx(x,{number:e.height})})]})},P=n.createContext(null),re=()=>{const r=n.useContext(R),e=n.useContext(f),{searchResults:s}=e,{blocks:o,transactions:l}=s;if(l.length<=0)return t.jsx(t.Fragment,{});const a=o.length;return t.jsxs("section",{"aria-label":"transaction-results",children:[t.jsx(S,{className:"result-section-title",children:t.jsx(u,{text:"Transactions"})}),l.map((i,m)=>{const h=m+a;return t.jsx("a",{href:r.transaction(i.height,i.offset),children:t.jsx(P.Provider,{value:[i,h],children:t.jsx(O,{index:h,children:t.jsx(ne,{})})},h)},h)})]})},ne=()=>{const r=n.useContext(d),[e]=n.useContext(P),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(L,{children:[t.jsx(u,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(u,{text:s.substring(r.length)})})]}),t.jsxs(y,{children:["Transaction ",t.jsx(x,{number:e.offset+1})," of"," ",t.jsx(x,{number:e.numTransactions})," in Block"," ",t.jsx(x,{number:e.height})]}),t.jsx(y,{children:t.jsx($,{date:e.time})})]})};try{v.displayName="SearchInput",v.__docgenInfo={description:`SearchInput is the component that will allow the user to search for blocks,
transactions, rollups, and addresses.

Right now it only supports searching for blocks and transactions.`,displayName:"SearchInput",props:{initialState:{defaultValue:null,description:"",name:"initialState",required:!1,type:{name:"InitialSearchState"}},forceFocusState:{defaultValue:null,description:"",name:"forceFocusState",required:!1,type:{name:"boolean"}}}}}catch{}export{v as S};
