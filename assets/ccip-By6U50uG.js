import{s as y,t as w,u as k,v as b,w as L,x as O,y as R,z as x,A as E,H as h}from"./en_US-RFN65H63-CX0hvJuS.js";import{B as l,i as M}from"./contexts-CuvyLAQc.js";import"./iframe-B_UBkTbs.js";import"./preload-helper-PPVm8Dsz.js";import"./environment_banner-CXDcbm7H.js";import"./higher_order-DgYhC1-i.js";import"./typography-CoEoGMVz.js";import"./Text-BU7JBOLk.js";import"./espresso-ie86eysq.js";import"./explorer-nZEEN2yV.js";import"./index-Do9tf19L.js";import"./index-D0XH7Lbi.js";import"./TransactionDetailLoader-BlWAFCEO.js";import"./string-DurhFPzJ.js";import"./assert-BI051aL8.js";import"./array_buffer-ChxgVYUa.js";import"./base64-CwylSrof.js";import"./functional-CtVX7zWU.js";import"./MissingElementError-C2wrrywP.js";import"./url-Cp1wsmOC.js";import"./UnimplementedError-DEXMe0kn.js";import"./LoadingProvider-DRkSo8Wr.js";import"./TaggedBase64-DTqtQPCE.js";import"./PromiseResolver-Cvk1eyw8.js";import"./ProvideAsyncStates-Clw91Vmm.js";import"./PathResolverProvider--Psz2VXI.js";import"./DataTable-DObPCn15.js";import"./ChevronUp-ERm60T88.js";import"./SVGIconBase-BHUxzGpP.js";import"./LabeledAnchorButton-CA1wC9sf.js";import"./AnchorButton-BpicjUg5.js";import"./DateTimeFormattersProvider-FGdD03H8.js";import"./LocaleProvider-0J8ELAGn.js";import"./PagePathProvider-BlRtpPfA.js";import"./NowProvider-Cmvro9JC.js";import"./NumberFormattersProvider-Bqe_gtsw.js";import"./AsyncIterableResolver-CJCJV8vT.js";import"./CappuccinoHotShotQueryServiceAPIContext-BA2B-W0R.js";import"./WebWorkerErrorResponse-DDmF8pSp.js";import"./monetary_value-D_JlCdWi.js";import"./generateFakeData-DW9myA_6.js";import"./sleep-CW-vxfof.js";import"./data-CeQBE4up.js";import"./FetchError-CshovAWm.js";import"./NotFoundError-BfMh7-IB.js";class S extends l{constructor({callbackSelector:a,cause:t,data:s,extraData:n,sender:i,urls:r}){super(t.shortMessage||"An error occurred while fetching for an offchain result.",{cause:t,metaMessages:[...t.metaMessages||[],t.metaMessages?.length?"":[],"Offchain Gateway Call:",r&&["  Gateway URL(s):",...r.map(p=>`    ${y(p)}`)],`  Sender: ${i}`,`  Data: ${s}`,`  Callback selector: ${a}`,`  Extra data: ${n}`].flat(),name:"OffchainLookupError"})}}class $ extends l{constructor({result:a,url:t}){super("Offchain gateway response is malformed. Response data must be a hex value.",{metaMessages:[`Gateway URL: ${y(t)}`,`Response: ${w(a)}`],name:"OffchainLookupResponseMalformedError"})}}class q extends l{constructor({sender:a,to:t}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${t}`,`OffchainLookup sender address: ${a}`],name:"OffchainLookupSenderMismatchError"})}}const Rt="0x556f1830",T={name:"OffchainLookup",type:"error",inputs:[{name:"sender",type:"address"},{name:"urls",type:"string[]"},{name:"callData",type:"bytes"},{name:"callbackFunction",type:"bytes4"},{name:"extraData",type:"bytes"}]};async function xt(c,{blockNumber:a,blockTag:t,data:s,to:n}){const{args:i}=k({data:s,abi:[T]}),[r,p,m,e,o]=i,{ccipRead:d}=c,u=d&&typeof d?.request=="function"?d.request:A;try{if(!b(n,r))throw new q({sender:r,to:n});const f=p.includes(L)?await O({data:m,ccipRequest:u}):await u({data:m,sender:r,urls:p}),{data:g}=await R(c,{blockNumber:a,blockTag:t,data:x([e,E([{type:"bytes"},{type:"bytes"}],[f,o])]),to:n});return g}catch(f){throw new S({callbackSelector:e,cause:f,data:s,extraData:o,sender:r,urls:p})}}async function A({data:c,sender:a,urls:t}){let s=new Error("An unknown error occurred.");for(let n=0;n<t.length;n++){const i=t[n],r=i.includes("{data}")?"GET":"POST",p=r==="POST"?{data:c,sender:a}:void 0,m=r==="POST"?{"Content-Type":"application/json"}:{};try{const e=await fetch(i.replace("{sender}",a.toLowerCase()).replace("{data}",c),{body:JSON.stringify(p),headers:m,method:r});let o;if(e.headers.get("Content-Type")?.startsWith("application/json")?o=(await e.json()).data:o=await e.text(),!e.ok){s=new h({body:p,details:o?.error?w(o.error):e.statusText,headers:e.headers,status:e.status,url:i});continue}if(!M(o)){s=new $({result:o,url:i});continue}return o}catch(e){s=new h({body:p,details:e.message,url:i})}}throw s}export{A as ccipRequest,xt as offchainLookup,T as offchainLookupAbiItem,Rt as offchainLookupSignature};
