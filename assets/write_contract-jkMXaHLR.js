import{R as s,j as r}from"./iframe-Cfh0eePN.js";import{s as H}from"./sleep-CW-vxfof.js";import{b as c,a as i}from"./ProvideAsyncStates-BwYWr8xv.js";import{C as I}from"./CopyHex-CMrw1j88.js";import{H as S}from"./HexText-BH0RdlRi.js";import{N as v}from"./NumberText-BeA3jcpj.js";import{T as l}from"./Text-BU7JBOLk.js";import{n as b}from"./string-DurhFPzJ.js";import{h as k}from"./array_buffer-C2KvbgUx.js";import"./url-Cp1wsmOC.js";import{U as N}from"./UnimplementedError-DEXMe0kn.js";import"./MissingElementError-C2wrrywP.js";import"./base64-C1KKyByM.js";import{g as R,b as F,c as P}from"./contexts-D-yxuTej.js";function $(t,a){const{chainId:e,...o}=a,p=t.getClient({chainId:e});return R(p,F,"getTransaction")(o)}async function D(t,a){const{chainId:e,...o}=a,p=t.getClient({chainId:e});return R(p,P,"getTransactionReceipt")(o)}const _=()=>{const t=s.useContext(x);if(t.transactionHash.asyncState===i.waiting)return r.jsx(l,{text:"Submitting..."});if(t.transactionHash.asyncState!==i.done)return null;if(t.transactionHash.hasError&&t.transactionHash.error){const o=t.transactionHash.error;return r.jsx(l,{text:`Error submitting transaction: ${o.toString()}`})}if(!t.transactionHash.data)throw new N;const a=t.transactionHash.data,e=k.decode(a);return r.jsxs(r.Fragment,{children:[r.jsx(l,{text:"Submitted, hash:"})," ",r.jsx(I,{value:e,children:r.jsx(S,{value:e})})]})},u=()=>{const t=s.useContext(x);if(t.receipt.asyncState===i.waiting)return r.jsx(l,{text:"Waiting for receipt..."});if(t.receipt.asyncState!==i.done)return null;if(t.receipt.hasError&&t.receipt.error){const a=t.receipt.error;return r.jsx(l,{text:`Error retrieving receipt: ${a.toString()}`})}if(!t.receipt.data)throw new N;return r.jsx(r.Fragment,{children:r.jsx(l,{text:"Received Receipt"})})},g=()=>{const t=s.useContext(x);if(t.transaction.asyncState===i.waiting)return r.jsx(l,{text:"Waiting for transaction..."});if(t.transaction.asyncState!==i.done)return null;if(t.transaction.hasError&&t.transaction.error){const e=t.transaction.error;return r.jsx(l,{text:`Error retrieving transaction: ${e.toString()}`})}if(!t.transaction.data)throw new N;const a=t.transaction.data;return r.jsxs(r.Fragment,{children:[r.jsx(l,{text:"Posted, block:"})," ",r.jsx(v,{number:a.blockNumber})]})},M=100,V=250;async function W(t,a=V,e=M){let o=null;for(let p=0;p<e;p++)try{await H(a);const n=await t();if(n)return n}catch(n){o=n}throw o}function rt(t,a,e,o,p=()=>{}){return async()=>{let n=a;n=n.withTransactionHash(c.waiting()),e(n);let y=null;try{y=await o()}catch(h){if(!b(h,"name")){n=n.withTransactionHash(c.withError(i.done,h)),e(n);return}if(typeof h!="object"||h===null){n=d.withNothing(),e(n);return}if(h.name==="ConnectorNotFoundError"){n=d.withNothing(),e(n);return}if(/user denied transaction/gi.test(String(h))){n=d.withNothing(),e(n);return}n=n.withTransactionHash(c.withError(i.done,h)),e(n);return}n=n.withTransactionHash(c.withData(i.done,y)),n=n.withTransactionReceipt(c.waiting()),e(n);let m=null;try{m=await W(()=>D(t,{hash:y}))}catch(h){n=n.withTransactionReceipt(c.withError(i.waiting,h)),e(n)}if(!m){n=n.withTransactionReceipt(c.withError(i.done,new Error("Failed to retrieve transaction receipt")));return}n=n.withTransactionReceipt(c.withData(i.done,m)),n=n.withTransaction(c.waiting()),e(n);let C=null;try{C=await W(()=>$(t,{hash:y}))}catch(h){n=n.withTransaction(c.withError(i.waiting,h)),e(n)}if(!C){n=n.withTransaction(c.withError(i.done,new Error("Failed to retrieve transaction"))),e(n);return}n=n.withTransaction(c.withData(i.done,C)),e(n),p(y,m,C)}}class d{transactionHash;receipt;transaction;constructor(a,e,o){this.transactionHash=a,this.receipt=e,this.transaction=o,Object.freeze(this)}static withNothing(){return new d(c.nothing(),c.nothing(),c.nothing())}with(a){const{transactionHash:e=this.transactionHash,receipt:o=this.receipt,transaction:p=this.transaction}=a;return new d(e,o,p)}withTransactionHash(a){return this.with({transactionHash:a})}withTransactionReceipt(a){return this.with({receipt:a})}withTransaction(a){return this.with({transaction:a})}}const x=s.createContext(d.withNothing()),w=s.createContext(()=>r.jsx(r.Fragment,{})),f=s.createContext(()=>{}),T=s.createContext(()=>r.jsx("ol",{children:r.jsx("li",{children:r.jsx(_,{})})})),j=s.createContext(()=>r.jsxs("ol",{children:[r.jsx("li",{children:r.jsx(_,{})}),r.jsx("li",{children:r.jsx(u,{})})]})),A=s.createContext(()=>r.jsxs("ol",{children:[r.jsx("li",{children:r.jsx(_,{})}),r.jsx("li",{children:r.jsx(u,{})}),r.jsx("li",{children:r.jsx(g,{})})]})),E=t=>{const{initialState:a=d.withNothing()}=t,[e,o]=s.useState(a);return r.jsx(x.Provider,{value:e,children:r.jsx(f.Provider,{value:o,children:r.jsx(U,{})})})},U=()=>{const t=s.useContext(x),a=s.useContext(w),e=s.useContext(T),o=s.useContext(j),p=s.useContext(A);return t.transaction.asyncState!==i.none?r.jsx(p,{}):t.receipt.asyncState!==i.none?r.jsx(o,{}):t.transactionHash.asyncState!==i.none?r.jsx(e,{}):r.jsx(a,{})};try{_.displayName="TransactionHashText",_.__docgenInfo={description:"",displayName:"TransactionHashText",props:{}}}catch{}try{u.displayName="TransactionReceiptText",u.__docgenInfo={description:"",displayName:"TransactionReceiptText",props:{}}}catch{}try{g.displayName="TransactionText",g.__docgenInfo={description:"",displayName:"TransactionText",props:{}}}catch{}try{d.displayName="WriteContractAsyncState",d.__docgenInfo={description:`We want to handle generic writeContract operations in more-or-less the
same way.  That way our processing logic can be shared, and have a
consistent unified representation that makes it easier to follow.`,displayName:"WriteContractAsyncState",props:{}}}catch{}try{x.displayName="WriteContractAsyncStateContext",x.__docgenInfo={description:"",displayName:"WriteContractAsyncStateContext",props:{}}}catch{}try{w.displayName="WriteContractAsyncComponentIdleContext",w.__docgenInfo={description:"",displayName:"WriteContractAsyncComponentIdleContext",props:{}}}catch{}try{f.displayName="WriteContractAsyncSetStateContext",f.__docgenInfo={description:"",displayName:"WriteContractAsyncSetStateContext",props:{}}}catch{}try{T.displayName="WriteContractAsyncComponentInvokingContext",T.__docgenInfo={description:"",displayName:"WriteContractAsyncComponentInvokingContext",props:{}}}catch{}try{j.displayName="WriteContractAsyncComponentReceiptContext",j.__docgenInfo={description:"",displayName:"WriteContractAsyncComponentReceiptContext",props:{}}}catch{}try{A.displayName="WriteContractAsyncComponentTransactionContext",A.__docgenInfo={description:"",displayName:"WriteContractAsyncComponentTransactionContext",props:{}}}catch{}try{E.displayName="WriteContractAsync",E.__docgenInfo={description:"",displayName:"WriteContractAsync",props:{initialState:{defaultValue:null,description:"",name:"initialState",required:!1,type:{name:"WriteContractAsyncState"}}}}}catch{}export{d as W,w as a,E as b,x as c,f as d,rt as e};
