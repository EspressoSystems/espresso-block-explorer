import{R as n,j as t}from"./iframe-B_UBkTbs.js";import{P}from"./PromiseResolver-Cvk1eyw8.js";import{P as q}from"./IconButton-DXT1SacT.js";import{L as m}from"./label-2Mfe7Pxx.js";import{D as f,L as F,E}from"./LoadingProvider-DRkSo8Wr.js";import{P as R}from"./PathResolverProvider--Psz2VXI.js";import{a as B}from"./Card-Bplc6Qy_.js";import{T as D}from"./TaggedBase64-DTqtQPCE.js";import{C as b,e as w,a as j,b as y,c as _,d as V}from"./CappuccinoHotShotQueryServiceAPIContext-BA2B-W0R.js";import{N as p}from"./NumberText-BmUK0MTT.js";import{R as U}from"./RelativeTimeText-CZ62dNGQ.js";import{T as i}from"./Text-BU7JBOLk.js";import{k as G}from"./typography-CoEoGMVz.js";import{S as A}from"./SearchGlass-C8bsQ0il.js";import{I as $}from"./Container-BALP0qhI.js";const g=G("div");function d(r){r.stopPropagation(),r.preventDefault()}function W(r){const e=r.indexOf("~");if(e<0)return r.toLocaleUpperCase();const s=r.substring(0,e),o=r.substring(e+1);return`${s.toLocaleUpperCase()}~${o}`}function H(){if(typeof window>"u")return{href:""};let r=window;for(;r!==r.parent;)r=r.parent;return r.location}function v(r){try{return D.fromString(r.trim())}catch{}return null}function K(r){const e=r.trim().replace(/[., _]/g,"");if(/\D/.test(e))return null;try{const s=parseInt(e,10);if(!Number.isNaN(s)&&Number.isInteger(s)&&s>=0)return s}catch{}return null}class k{pRawQuery;pQuery;pSearchResults;pSearchResultsQuery;pIsLoading;pOffset;pLocation;constructor(e){const{rawQuery:s="",query:o="",searchResults:l=new j(new y([],[])),searchResultsQuery:a="",isLoading:c=!1,offset:u=null,location:h=H()}=e||{};this.pRawQuery=s,this.pQuery=o,this.pSearchResultsQuery=a,this.pSearchResults=l,this.pIsLoading=c,this.pOffset=u,this.pLocation=h}get rawQuery(){return this.pRawQuery}get query(){return this.pQuery}get searchResults(){return this.pSearchResults}get searchResultsQuery(){return this.pSearchResultsQuery}get isLoading(){return this.pIsLoading}get offset(){return this.pOffset}get totalSearchResults(){return this.searchResults.searchResults.transactions.length+this.searchResults.searchResults.blocks.length}setQuery(e){this.pRawQuery=e,this.pQuery=W(e),this.pOffset=null}setSearchResults(e,s){this.pSearchResults=s,this.pSearchResultsQuery=e,this.pOffset=null}setSearchResultsEmpty(){this.pOffset=null,this.pQuery="",this.pRawQuery="",this.pSearchResultsQuery="",this.pSearchResults=new j(new y([],[]))}setLoading(e,s){this.pSearchResultsQuery=e,this.pIsLoading=s}setOffset(e){this.pOffset=e;const s=document.querySelector(`[data-index="${e}"]`);s&&"scrollIntoView"in s&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({block:"nearest",behavior:"smooth"})}navigateTo(e){this.pLocation.href=e}async activate(e,s){if(this.offset===null){const l=K(this.query);l!==null&&this.navigateTo(s.block(l));try{const a=v(this.query);if(a===null)return;const c=await e.explorer.getSearchResult(new w(a.toString()));if(c.searchResults.blocks.length>0){this.navigateTo(s.block(c.searchResults.blocks[0].height));return}if(c.searchResults.transactions.length>0){const u=c.searchResults.transactions[0];this.navigateTo(s.transaction(u.height,u.offset));return}}catch(a){console.error("encountered error while searching for query",a)}return}const o=this.getResultForOffset(this.offset);if(o instanceof _){this.navigateTo(s.block(o.height));return}if(o instanceof V){this.navigateTo(s.transaction(o.height,o.offset));return}}getResultForOffset(e){const s=this.searchResults.searchResults;return e>=s.blocks.length?s.transactions[e-s.blocks.length]:s.blocks[e]}getValueForOffset(e){return this.getResultForOffset(e).hash.toString()}}const S=n.createContext(new k),Q=n.createContext(()=>{});function z(r){const[e]=n.useState(new k(r)),[s,o]=n.useState(0);return[e,()=>o(s+1)]}const C=r=>{const[e,s]=z(r.initialState),o=n.useContext(b),l=n.useContext(R);return t.jsx(S.Provider,{value:e,children:t.jsx(Q.Provider,{value:s,children:t.jsx(I.Provider,{value:e.offset,children:t.jsx(x.Provider,{value:e.query,children:t.jsxs($,{className:"search",role:"search",children:[t.jsx("input",{type:"search",placeholder:"Search blocks, transactions, rollups or addresses...",value:e.offset===null?e.rawQuery:e.getValueForOffset(e.offset),onKeyDown:a=>{if(a.code==="Escape"){d(a),a.currentTarget.blur();return}if(a.code==="Enter"||a.code==="NumpadEnter"){d(a),e.activate(o,l);return}if(a.code==="ArrowDown"){if(d(a),e.totalSearchResults<=0)return;if(e.offset===null){e.setOffset(0),s();return}const c=e.totalSearchResults;if(e.offset===c-1){e.setOffset(null),s();return}e.setOffset(e.offset+1),s();return}if(a.code==="ArrowUp"){if(d(a),e.totalSearchResults<=0)return;const c=e.totalSearchResults;if(e.offset===null){e.setOffset(c-1),s();return}if(e.offset===0){e.setOffset(null),s();return}e.setOffset(e.offset-1),s();return}},onChange:async a=>{const c=a.currentTarget.value.trim();if(c!==e.query){if(c===""){e.setSearchResultsEmpty(),s();return}e.setQuery(c),s()}},"data-focused":r.forceFocusState?!0:void 0,"aria-label":"search text"}),t.jsx(J,{}),t.jsx(q,{children:t.jsx(A,{})}),t.jsx(M,{}),t.jsx(f.Provider,{value:e.searchResults,children:t.jsx(Y,{})})]})})})})})},x=n.createContext(""),J=()=>t.jsx("div",{className:"search-barrier"}),M=()=>{const r=n.useContext(b),e=n.useContext(S),s=n.useContext(x);if(s==="")return t.jsx(t.Fragment,{});if(s!==e.query)return t.jsx(t.Fragment,{});if(e.query===e.searchResultsQuery)return t.jsx(t.Fragment,{});const o=v(e.query);return o===null?t.jsx(t.Fragment,{}):t.jsx(P,{promise:Promise.all([Promise.resolve(s),r.explorer.getSearchResult(new w(o.toString()))]),children:t.jsx(X,{})})},X=()=>{const r=n.useContext(S),e=n.useContext(F),s=n.useContext(E),o=n.useContext(f),l=n.useContext(Q);return n.useEffect(()=>{if(!e&&!(r.isLoading||s)&&o[0]===r.query)return r.setLoading(o[0],!1),r.setSearchResults(o[0],o[1]),l(),()=>{}},[r,e,s,o,l]),t.jsx(t.Fragment,{})},Y=()=>{const r=n.useContext(f);return n.useContext(x).length<=0&&r.searchResults.blocks.length<=0&&r.searchResults.transactions.length<=0?t.jsx(t.Fragment,{}):t.jsx(Z,{})},Z=()=>t.jsx(B,{className:"search-results",children:t.jsxs("section",{"aria-label":"search results",className:"search-results-scroll-container",children:[t.jsx(ee,{}),t.jsx(te,{}),t.jsx(re,{})]})}),I=n.createContext(null),N=({children:r,index:e})=>{const s=n.useContext(I);return t.jsx("div",{"data-selected":s===e,"data-index":e,className:"result-row",children:t.jsx("div",{className:"result-row-content",children:r})})},O=n.createContext(null),ee=()=>{const r=n.useContext(f),e=n.useContext(x);return r.searchResults.blocks.length>0||r.searchResults.transactions.length>0||e.length<=0?t.jsx(t.Fragment,{}):t.jsx("section",{"aria-label":"no-results",children:t.jsx(m,{className:"type--ui--small result-section-title",children:t.jsx(i,{text:"No results found"})})})},te=()=>{const r=n.useContext(R),e=n.useContext(f),{searchResults:s}=e,{blocks:o}=s;if(o.length<=0)return t.jsx(t.Fragment,{});const l=0;return t.jsxs("section",{"aria-label":"block-results",children:[t.jsx(m,{className:"type--ui--small result-section-title",children:t.jsx(i,{text:"Blocks"})}),o.map((a,c)=>t.jsx("a",{href:r.block(a.height),children:t.jsx(O.Provider,{value:[a,c+l],children:t.jsx(N,{index:c+l,children:t.jsx(se,{})},c+l)})},c+l))]})},T=r=>t.jsx("div",{className:"commit",children:r.children}),se=()=>{const r=n.useContext(x),[e]=n.useContext(O),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(T,{children:[t.jsx(i,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(i,{text:s.substring(r.length)})})]}),t.jsx(g,{children:t.jsx(p,{number:e.height})})]})},L=n.createContext(null),re=()=>{const r=n.useContext(R),e=n.useContext(f),{searchResults:s}=e,{blocks:o,transactions:l}=s;if(l.length<=0)return t.jsx(t.Fragment,{});const a=o.length;return t.jsxs("section",{"aria-label":"transaction-results",children:[t.jsx(m,{className:"type--ui--small result-section-title",children:t.jsx(i,{text:"Transactions"})}),l.map((c,u)=>{const h=u+a;return t.jsx("a",{href:r.transaction(c.height,c.offset),children:t.jsx(L.Provider,{value:[c,h],children:t.jsx(N,{index:h,children:t.jsx(ne,{})})},h)},h)})]})},ne=()=>{const r=n.useContext(x),[e]=n.useContext(L),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(T,{children:[t.jsx(i,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(i,{text:s.substring(r.length)})})]}),t.jsxs(g,{children:["Transaction ",t.jsx(p,{number:e.offset+1})," of"," ",t.jsx(p,{number:e.numTransactions})," in Block"," ",t.jsx(p,{number:e.height})]}),t.jsx(g,{children:t.jsx(U,{date:e.time})})]})};try{C.displayName="SearchInput",C.__docgenInfo={description:`SearchInput is the component that will allow the user to search for blocks,
transactions, rollups, and addresses.

Right now it only supports searching for blocks and transactions.`,displayName:"SearchInput",props:{initialState:{defaultValue:null,description:"",name:"initialState",required:!1,type:{name:"InitialSearchState"}},forceFocusState:{defaultValue:null,description:"",name:"forceFocusState",required:!1,type:{name:"boolean"}}}}}catch{}export{C as S};
