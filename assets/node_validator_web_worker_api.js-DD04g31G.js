(function(){"use strict";class Yi{assert(){}}function Ki(){return new Yi}const Zi=Ki();function T(t,e){Zi.assert(t,e)}function Xt(t,e){T(typeof t===e,`type assertion failed: expected "${e}", received "${typeof t}"`)}function ed(t){T(t!==null,"expected a non-null value, received null")}function m(t,e){T(t instanceof e,`given value is not an instance of "${e.name}", specific type is "${typeof t=="object"&&t!==null?t.constructor.name:typeof t}"`)}class Yt extends Error{key;haveType;constructor(e,o,n=`expected object with key: "${o}", instead found ${e}`){super(n),this.haveType=e,this.key=o,Object.freeze(this)}toJSON(){return{code:Yt.name,message:this.message,have:this.haveType,key:this.key}}}class de{encode(e){return this.encoder.convert(e)}decode(e){return this.decoder.convert(e)}}class c extends de{}function lt(t){return typeof t=="number"}function ee(t){return typeof t=="string"}function td(t){return typeof t=="bigint"}function us(t){return typeof t=="object"&&t!==null}function ut(t){return t!==void 0}function od(t,e){return Array.isArray(t)&&t.every(e)}function nd(t){return e=>od(e,t)}function Kt(t,e,o){return us(t)&&e in t&&o(t[e])}function G(t,...e){return us(t)&&e.every(o=>o in t)}function i(t,...e){if(typeof t!="object")throw new Error("expected object");if(t===null)throw new Error("received null");for(const o of e)if(!(o in t))throw new Yt("object",o)}function b(t,e){if(!ee(t.code))throw new Error("code must be a string");if(t.code!==e)throw new Error(`expected code to be ${e}, got ${t.code}`)}function le(t,e){if(!ee(t.type))throw new Error("type must be a string");if(t.type!==e)throw new Error(`expected type to be ${e}, got ${t.type}`)}class k extends Error{constructor(e){super(e)}get code(){return this.constructor.name}toJSON(){return j.convert(this)}}class W{convert(e){return m(e,k),{code:e.code,message:e.message}}}const j=new W,rd="NoCodecFoundError";class Te extends Error{codec;constructor(e,o=`no codec found for: "${e}"`){super(o),this.codec=e,Object.freeze(this);debugger}toJSON(){return{code:l.encode(Te.name),message:l.encode(this.message),codec:l.encode(this.codec)}}get code(){return rd}}const Zt=new Map;class sd{convert(e){i(e,"code");const o=l.decode(e.code),n=Zt.get(o);if(!n)throw new Te(o);return n.decode(e)}}class cd{convert(e){const o=Zt.get(e.code);if(!o)throw new Te(e.code);return o.encode(e)}}class ad extends de{encoder=new cd;decoder=new sd}const ht=new ad;function S(t,e){Zt.set(t,e)}const eo="InvalidTypeError";class p extends k{have;want;constructor(e,o,n=`invalid type: have "${e}", want "${o}"`){super(n),this.have=e,this.want=o,Object.freeze(this)}toJSON(){return hs.encode(this)}get code(){return eo}}class id{convert(e){return i(e,"code","have","want","message"),b(e,eo),new p(l.decode(e.have),l.decode(e.want),l.decode(e.message))}}class dd{convert(e){return m(e,p),{...j.convert(e),have:l.encode(e.have),want:l.encode(e.want)}}}class ld extends c{encoder=new dd;decoder=new id}const hs=new ld;S(eo,hs);const ws=nd(ut);class ud{convert(e){return e}}const fs=new ud;class hd extends de{encoder=fs;decoder=fs}const wt=new hd;class v{itemCodec;constructor(e){this.itemCodec=e}convert(e){if(!ws(e)){const o=typeof e=="object"&&e!==null?e.constructor.name:typeof e,n="array";throw new Error(`invalid array value: have "${o}", want "${n}"`)}return e.map(o=>this.itemCodec.decode(o))}}class B{itemCodec;constructor(e){this.itemCodec=e}convert(e){return m(e,Array),e.map(o=>this.itemCodec.encode(o))}}class E extends c{encoder;decoder;constructor(e,o){super(),this.encoder=o,this.decoder=e}}class O{itemCodec;constructor(e){this.itemCodec=e}convert(e){return e===null?null:this.itemCodec.decode(e)}}class P{itemCodec;constructor(e){this.itemCodec=e}convert(e){return e===null?null:(ed(e),this.itemCodec.encode(e))}}class L extends c{encoder;decoder;constructor(e,o){super(),this.encoder=o,this.decoder=e}}class wd{convert(e){if(!ee(e))throw new p(typeof e,"string");return e}}class fd{convert(e){return Xt(e,"string"),e}}class pd extends c{encoder=new fd;decoder=new wd}const l=new pd;new E(new v(l),new B(l));const J=new L(new O(l),new P(l));function Se(t){return!t||!t.trim()?null:t}class to extends k{constructor(e="completer has already been completed"){super(e),Object.freeze(this)}get code(){return ps}}const ps="CompleterAlreadyCompletedError";class md{convert(e){return i(e,"code","message"),b(e,ps),new to(l.decode(e.message))}}class gd extends W{}class Ad extends c{encoder=new gd;decoder=new md}const Cd=new Ad;S(to.name,Cd);function ft(){T(!1,"completer is not ready, this should never be reached")}function pt(){throw new to}class yd{resolve=ft;reject=ft;completed=!1;promise;get isCompleted(){return this.completed}constructor(){this.promise=new Promise((e,o)=>{this.resolve=e,this.reject=o}),T(this.resolve!==ft,"resolve should be set"),T(this.reject!==ft,"resolve should be set")}complete(e){const o=this.resolve,n=this.reject;if(this.completed=!0,this.resolve=pt,this.reject=pt,e instanceof Promise){e.then(o,n);return}o(e)}completeError(e){this.reject(e),this.completed=!0,this.resolve=pt,this.reject=pt}}function ue(){return new yd}class Oe extends k{response;status;constructor(e,o,n){super(n),this.status=e,this.response=o}toJSON(){return ms.convert(this)}}class mt{convert(e){return m(e,Oe),{...j.convert(e),status:e.status}}}const ms=new mt,oo="BadResponseClientError";class bd extends Oe{constructor(e,o,n="bad server response: client error"){super(e,o,n),Object.freeze(this)}get code(){return oo}toJSON(){return gs.encode(this)}}class Sd{convert(e){return i(e,"code","message","status"),b(e,oo),new bd(Number(e.status),null,l.decode(e.message))}}class kd extends mt{}class vd extends c{encoder=new kd;decoder=new Sd}const gs=new vd;S(oo,gs);const no="BadResponseError";class Bd extends Oe{constructor(e,o,n="bad server response"){super(e,o,n),Object.freeze(this)}get code(){return no}toJSON(){return As.encode(this)}}class Ed{convert(e){return i(e,"code","message","status"),b(e,no),new Bd(Number(e.status),null,l.decode(e.message))}}class xd extends mt{}class Rd extends c{encoder=new xd;decoder=new Ed}const As=new Rd;S(no,As);class Nd extends Oe{constructor(e,o,n="bad server response: server error"){super(e,o,n),Object.freeze(this)}get code(){return ro}}const ro="BadResponseServerError";class Id{convert(e){return i(e,"code","message","status"),b(e,ro),new Nd(Number(e.status),null,l.decode(e.message))}}class Dd extends mt{}class Td extends c{encoder=new Dd;decoder=new Id}const Od=new Td;S(ro,Od);const so="ChannelClosedError";class Pe extends k{constructor(e="channel closed"){super(e),Object.freeze(this)}get code(){return so}}class Pd{convert(e){return i(e,"code","message"),b(e,so),new Pe(l.decode(e.message))}}class Ld extends W{}class Md extends c{encoder=new Ld;decoder=new Pd}const Vd=new Md;S(so,Vd);const co="FetchError";class Ud extends k{cause;constructor(e,o=`fetch failed: ${String(e)}`){super(o),this.cause=e,Object.freeze(this)}get code(){return co}}class Hd{convert(e){return i(e,"code","message"),b(e,co),new Ud({},l.decode(e.message))}}class Wd extends W{}class _d extends c{encoder=new Wd;decoder=new Hd}const zd=new _d;S(co,zd);const ao="IncorrectBase64PaddingError";class Cs extends k{constructor(e="incorrect padding"){super(e),Object.freeze(this)}get code(){return ao}}class Jd{convert(e){return i(e,"code","message"),b(e,ao),new Cs(l.decode(e.message))}}class Fd extends W{}class Gd extends c{encoder=new Fd;decoder=new Jd}const qd=new Gd;S(ao,qd);class Qd{convert(e){if(!lt(e))throw new p(typeof e,"number");return e}}class jd{convert(e){return Xt(e,"number"),e}}class $d extends c{encoder=new jd;decoder=new Qd}const u=new $d,ys=new L(new O(u),new P(u)),he=new E(new v(u),new B(u)),oe=new E(new v(ys),new B(ys)),io="InvalidBase64AlphabetLengthError";class lo extends k{length;constructor(e,o=`alphabet needs to be 64 characters, received ${e}`){super(o),this.length=e,Object.freeze(this)}toJSON(){return bs.encode(this)}get code(){return io}}class Xd{convert(e){return i(e,"code","length","message"),b(e,io),new lo(u.decode(e.length),l.decode(e.message))}}class Yd{convert(e){return m(e,lo),{...j.convert(e),length:u.encode(e.length)}}}class Kd extends c{encoder=new Yd;decoder=new Xd}const bs=new Kd;S(io,bs);const uo="InvalidHexStringError";class Ss extends k{constructor(e="invalid hex string"){super(e),Object.freeze(this)}get code(){return uo}}class Zd{convert(e){return i(e,"code","message"),b(e,uo),new Ss(l.decode(e.message))}}class el extends W{}class tl extends c{encoder=new el;decoder=new Zd}const ol=new tl;S(uo,ol);const ho="InvalidHexValueError";class ks extends k{value;constructor(e,o=`invalid hex value "${e}"`){super(o),this.value=e,Object.freeze(this)}toJSON(){return vs.encode(this)}get code(){return ho}}class nl{convert(e){return i(e,"code","value","message"),b(e,ho),new ks(u.decode(e.value),l.decode(e.message))}}class rl{convert(e){return{...j.convert(e),value:u.encode(e.value)}}}class sl extends c{encoder=new rl;decoder=new nl}const vs=new sl;S(ho,vs);const wo="InvalidInputError";class ne extends k{constructor(e="invalid input"){super(e),Object.freeze(this)}get code(){return wo}}class cl{convert(e){return i(e,"code","message"),b(e,wo),new ne(l.decode(e.message))}}class al extends W{}class il extends c{encoder=new al;decoder=new cl}const dl=new il;S(wo,dl);const fo="InvalidStringValueError";class Bs extends k{have;want;constructor(e,o,n=`invalid string value: have "${e}", want "${o}"`){super(n),this.have=e,this.want=o,Object.freeze(this)}toJSON(){return Es.encode(this)}get code(){return fo}}class ll{convert(e){return i(e,"code","have","want","message"),b(e,fo),new Bs(l.decode(e.have),l.decode(e.want),l.decode(e.message))}}class ul{convert(e){return m(e,Bs),{...j.convert(e),have:l.encode(e.have),want:l.encode(e.want)}}}class hl extends c{encoder=new ul;decoder=new ll}const Es=new hl;S(fo,Es);const po="InvalidTaggedBase64EncodingError";class xs extends k{constructor(e="invalid tagged base64 encoding"){super(e),Object.freeze(this)}toJSON(){return Rs.encode(this)}get code(){return po}}class wl{convert(e){return i(e,"code","message"),b(e,po),new xs(l.decode(e.message))}}class fl extends W{}class pl extends c{encoder=new fl;decoder=new wl}const Rs=new pl;S(po,Rs);const mo="MissingElementError";class gt extends k{constructor(e="missing element"){super(e),Object.freeze(this)}get code(){return mo}}class ml{convert(e){return i(e,"code","message"),b(e,mo),new gt(l.decode(e.message))}}class gl extends W{}class Al extends c{encoder=new gl;decoder=new ml}const Cl=new Al;S(mo,Cl);const go="NoCompleterFoundForRequestID";class Ns extends k{requestID;constructor(e,o=`no completer found for request id "${e}"`){super(o),this.requestID=e,Object.freeze(this)}toJSON(){return Is.encode(this)}get code(){return go}}class yl{convert(e){return i(e,"code","requestID","message"),b(e,go),new Ns(wt.decode(e.requestID),l.decode(e.message))}}class bl{convert(e){return m(e,Ns),{...j.convert(e),requestID:wt.encode(e.requestID)}}}class Sl extends c{encoder=new bl;decoder=new yl}const Is=new Sl;S(go,Is);const Ao="NotFoundError";class kl extends k{key;constructor(e,o=`Not Found: ${e}`){super(o),this.key=e,Object.freeze(this)}get code(){return Ao}}class Ds{codec;constructor(e){this.codec=e}convert(e){return i(e,"code","key"),b(e,Ao),new kl(this.codec.decode(e.key))}}class Ts{codec;constructor(e){this.codec=e}convert(e){return{...j.convert(e),key:this.codec.encode(e.key)}}}class Os extends c{encoder;decoder;constructor(e,o){super(),this.encoder=e,this.decoder=o}}new Os(new Ts(l),new Ds(l));const vl=new Os(new Ts(wt),new Ds(wt));S(Ao,vl);const Co="NoURLProvidedError";class Bl extends k{constructor(e="no url provided"){super(e),Object.freeze(this)}get code(){return Co}}class El{convert(e){return i(e,"code","message"),b(e,Co),new Bl(l.decode(e.message))}}class xl extends W{}class Rl extends c{encoder=new xl;decoder=new El}const Nl=new Rl;S(Co,Nl);const yo="UnimplementedError";class _ extends k{constructor(e="unimplemented"){super(e),Object.freeze(this);debugger}get code(){return yo}}class Il{convert(e){return i(e,"code","message"),b(e,yo),new _(l.decode(e.message))}}class Dl extends W{}class Tl extends c{encoder=new Dl;decoder=new Il}const Ol=new Tl;S(yo,Ol);const bo="QUERY_ERROR";class Pl extends k{error;constructor(e,o="missing element"){super(o),this.error=e,Object.freeze(this)}get code(){return bo}}class Ll{convert(e){return i(e,"code","error","message"),b(e,bo),new Pl(Vs.decode(e.error),l.decode(e.message))}}class Ml{convert(e){return{code:e.code,error:Vs.encode(e.error),message:l.encode(e.message)}}}class Vl extends c{encoder=new Ml;decoder=new Ll}const Ul=new Vl;class So{}const ko="NotFound";class Ps extends So{constructor(){super(),Object.freeze(this)}valueOf(){return ko}toJSON(){return this.valueOf()}}const Hl=new Ps,vo="Missing";class Ls extends So{constructor(){super(),Object.freeze(this)}valueOf(){return vo}toJSON(){return this.valueOf()}}const Wl=new Ls;class Ms extends So{error;constructor(e){super(),this.error=e,Object.freeze(this)}toJSON(){return Eo.encode(this)}}class _l{message;constructor(e){this.message=e,Object.freeze(this)}toJSON(){return Bo.encode(this)}}class zl{convert(e){return i(e,"message"),new _l(l.decode(e.message))}}class Jl{convert(e){return{message:l.encode(e.message)}}}class Fl extends c{encoder=new Jl;decoder=new zl}const Bo=new Fl;class Gl{convert(e){return i(e,"Error"),new Ms(Bo.decode(e.Error))}}class ql{convert(e){return{Error:Bo.encode(e.error)}}}class Ql extends c{encoder=new ql;decoder=new Gl}const Eo=new Ql;class jl{convert(e){return e===ko?Hl:e===vo?Wl:Eo.decode(e)}}class $l{convert(e){if(e instanceof Ps)return ko;if(e instanceof Ls)return vo;if(e instanceof Ms)return Eo.encode(e);throw new _}}class Xl extends c{encoder=new $l;decoder=new jl}const Vs=new Xl;S(bo,Ul);const Us="ResponseContentTypeIsNotApplicationJSONError";class At extends Oe{haveHeaderType;constructor(e,o,n,r="response content type is not application/json"){super(o,n,r),this.haveHeaderType=e,Object.freeze(this)}static fromResponse(e,o){return new At(e.headers.get("content-type")??"undefined",e.status,e,o)}toJSON(){return Hs.encode(this)}get code(){return Us}}class Yl{convert(e){return i(e,"code","status","have","want","message"),b(e,Us),new At(l.decode(e.code),u.decode(e.status),null,l.decode(e.message))}}class Kl{convert(e){return{...ms.convert(e),have:l.encode(e.haveHeaderType),want:l.encode("application/json")}}}class Zl extends c{encoder=new Kl;decoder=new Yl}const Hs=new Zl;S(At.name,Hs);const xo="WebWorkerErrorResponse";class eu extends k{error;constructor(e,o="error in web worker"){super(o),this.error=e,Object.freeze(this)}toJSON(){return Ws.encode(this)}get code(){return xo}}class tu{convert(e){return i(e,"code","error","message"),b(e,xo),new eu(ht.decode(e.error),l.decode(e.message))}}class ou{convert(e){return{...j.convert(e),error:ht.encode(e.error)}}}class nu extends c{encoder=new ou;decoder=new tu}const Ws=new nu;S(xo,Ws);var _s=(t=>(t[t.success=0]="success",t[t.full=1]="full",t[t.failed=2]="failed",t))(_s||{});class ru{getFromEmpty(){}}class su{getFromEmpty(){throw new gt}}const zs={returnUndefined:new ru,throwMissingElement:new su};class cu{maxSize;constructor(e){T(!Number.isNaN(e),"maxSize must not be NaN"),T(Number.isInteger(e),"maxSize must be an integer"),T(e>0,"maxSize must be greater than 0"),this.maxSize=e}nextIndex(e){return T(e>=0,"index must be greater than or equal to 0"),(e+1)%this.maxSize}}class au{preComputedSizeMinus1;constructor(e){T(!Number.isNaN(e),"maxSize must not be NaN"),T(Number.isInteger(e),"maxSize must be an integer"),T(e>0,"maxSize must be greater than 0"),T(Js(e),"maxSize must be a power of two"),this.preComputedSizeMinus1=e-1}nextIndex(e){return T(e>=0,"index must be greater than or equal to 0"),e+1&this.preComputedSizeMinus1}}function Js(t){return(t&t-1)===0}const Ro="BufferFullError";class Fs extends k{constructor(e="buffer full"){super(e),Object.freeze(this)}get code(){return Ro}}class iu{convert(e){return i(e,"code","message"),b(e,Ro),new Fs(l.decode(e.message))}}class du extends W{}class lu extends c{encoder=new du;decoder=new iu}const uu=new lu;S(Ro,uu);class hu{putToFull(e,o){return e.get(),e.put(o)}}class wu{putToFull(){throw new Fs}}const Gs={overwriteOldest:new hu,throw:new wu};function fu(t){return Js(t)?new au(t):new cu(t)}class pu{readIndex=0;writeIndex=0;buffer;nextIndex;getOnEmpty;putOnFull;constructor(e,o,n){T(!Number.isNaN(e),"maxSize must not be NaN"),this.buffer=new Array(e),this.nextIndex=fu(e),this.getOnEmpty=o,this.putOnFull=n}get maxSize(){return this.buffer.length}get length(){return this.writeIndex<this.readIndex?this.writeIndex+this.maxSize-this.readIndex:this.writeIndex-this.readIndex}put(e){const o=this.nextIndex.nextIndex(this.writeIndex);return o===this.readIndex?this.putOnFull.putToFull(this,e):(this.buffer[this.writeIndex]=e,this.writeIndex=o,_s.success)}get(){if(this.readIndex===this.writeIndex)return this.getOnEmpty.getFromEmpty(this);const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),e}[Symbol.iterator](){return new mu(this)}immutableIterable(){return{[Symbol.iterator]:()=>this.immutableIterator()}}immutableIterator(){return new gu(this.readIndex,this.writeIndex,this.buffer,this.nextIndex)}}class mu{buffer;constructor(e){this.buffer=e}next(){const e=this.buffer.get();return e==null?{value:void 0,done:!0}:{value:e,done:!1}}}class gu{readIndex;writeIndex;buffer;nextIndex;constructor(e,o,n,r){this.readIndex=e,this.writeIndex=o,this.buffer=n,this.nextIndex=r}next(){if(this.readIndex===this.writeIndex)return{value:void 0,done:!0};const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),{value:e,done:!1}}}function we(t=32,e=zs.returnUndefined,o=Gs.overwriteOldest){return new pu(t,e,o)}class Au{publishQueue;pollBlocked;publishBlocked;capacity;closed=!1;constructor(e){this.publishQueue=we(Math.max(2,e),zs.throwMissingElement,Gs.throw);const o=ue();this.pollBlocked=o,this.publishBlocked=o,o.complete(),this.capacity=e-1}get isClosed(){return this.closed}close(){if(this.closed)throw new Pe;this.closed=!0}async drain(){for(;this.publishQueue.length>0;)this.publishQueue.get()}async publish(e){if(this.closed)throw new Pe;if(this.publishQueue.length>=this.capacity){if(this.publishBlocked.isCompleted){const o=ue();this.publishBlocked=o,await o.promise}return await this.publishBlocked.promise,this.publish(e)}this.publishQueue.put(e),this.pollBlocked.isCompleted||this.pollBlocked.complete()}async poll(){if(this.publishQueue.length<=0){if(this.isClosed)throw new Pe;if(this.pollBlocked.isCompleted){const o=ue();this.pollBlocked=o}return await this.pollBlocked.promise,this.poll()}const e=this.publishQueue.get();return this.publishBlocked.isCompleted||this.publishBlocked.complete(),e}[Symbol.asyncIterator](){return new Cu(this)}}class Cu{channel;constructor(e){this.channel=e}async next(){try{return{done:!1,value:await this.channel.poll()}}catch(e){if(e instanceof Pe)return{done:!0,value:void 0};throw e}}}function fe(t){return new Au(t)}class yu{channel;constructor(e){this.channel=e}async send(e){await this.channel.publish(e)}}function pe(t){return new yu(t)}const No="CorruptBase64InputError";class re extends k{offset;constructor(e,o=`corrupt input error at ${e}`){super(o),this.offset=e,Object.freeze(this)}get code(){return No}toJSON(){return qs.encode(this)}}class bu{convert(e){return i(e,"code","offset","message"),b(e,No),new re(u.decode(e.offset),l.decode(e.message))}}class Su{convert(e){return m(e,re),{...j.convert(e),offset:u.encode(e.offset),message:l.encode(e.message)}}}class ku extends c{encoder=new Su;decoder=new bu}const qs=new ku;S(No,qs);class vu{convert(e){const o=new ArrayBuffer(e.byteLength);return new Uint8Array(o).set(e),o}}class Bu{convert(e){return new Uint8Array(e)}}class Eu extends c{encoder=new vu;decoder=new Bu}const Io=new Eu,xu=new TextEncoder;function Qs(t){return xu.encode(t)}const Ru=new TextDecoder;function Nu(t){return Ru.decode(t)}function*js(t){yield*Qs(t)}function*Iu(){for(let t=0;t<256;t++)yield 255}const Le=-1,Du=61;class Me{encodeMap;decodeMap;padChar;strict;constructor(e,o,n=Du,r=!1){this.encodeMap=e,this.decodeMap=o,this.padChar=n,this.strict=r}static withAlphabet(e){const o=e.length;if(o!==64)throw new lo(o);const n=Array.from(js(e)),r=Array.from(Iu());for(let s=0;s<o;s++)r[n[s]]=s;return new Me(n,r)}withPadding(e){return new Me(this.encodeMap,this.decodeMap,e,this.strict)}encode(e){if(e.byteLength===0)return new ArrayBuffer(0);let o=0,n=0;const r=Math.floor(e.byteLength/3)*3,s=Math.ceil(e.byteLength/3)*4,a=new ArrayBuffer(s),d=new DataView(e),w=new DataView(a);for(;n<r;){const D=d.getUint8(n+0)<<16|d.getUint8(n+1)<<8|d.getUint8(n+2);w.setUint8(o+0,this.encodeMap[D>>18&63]),w.setUint8(o+1,this.encodeMap[D>>12&63]),w.setUint8(o+2,this.encodeMap[D>>6&63]),w.setUint8(o+3,this.encodeMap[D&63]),n+=3,o+=4}const h=e.byteLength-n;if(h===0)return a;let y=d.getUint8(n+0)<<16;switch(h===2&&(y|=d.getUint8(n+1)<<8),w.setUint8(o+0,this.encodeMap[y>>18&63]),w.setUint8(o+1,this.encodeMap[y>>12&63]),h){case 2:return w.setUint8(o+2,this.encodeMap[y>>6&63]),this.padChar!==Le?(w.setUint8(o+3,this.padChar),a.slice(0,o+4)):a.slice(0,o+3);case 1:if(this.padChar!==Le)return w.setUint8(o+2,this.padChar),w.setUint8(o+3,this.padChar),a.slice(0,o+4);break}return a.slice(0,o+2)}decode(e){const o=e.byteLength;if(o===0)return new ArrayBuffer(0);const n=new DataView(e),r=new ArrayBuffer(Math.floor(o/4*3)),s=new DataView(r),a=new ArrayBuffer(4),d=new DataView(a);let w=0,h=0,y=0,D=!1;for(;h<o&&!D;){let g=3,f=4;for(let R=0;R<4;R++){if(h===o){if(R===0)return r;if(R===1||this.padChar!==Le)throw new re(h-R);g=R-1,f=R,D=!0;break}const z=n.getUint8(h);h++;const dt=this.decodeMap[z];if(dt!==255){d.setUint8(R,dt);continue}if(z===10||z===13){R--;continue}if(z===this.padChar){switch(R){case 0:case 1:throw new Cs;case 2:for(;h<o&&(n.getUint8(h)===10||n.getUint8(h)===13);)h++;if(h===o)throw new re(o);h++}for(;h<o&&(n.getUint8(h)===10||n.getUint8(h)===13);)h++;if(h<o)throw new re(h);g=3,f=R,D=!0;break}throw new re(h-1)}const U=d.getUint8(0)<<18|d.getUint8(1)<<12|d.getUint8(2)<<6|d.getUint8(3);switch(d.setUint8(2,U>>0&255),d.setUint8(1,U>>8&255),d.setUint8(0,U>>16&255),f){case 4:s.setUint8(y+2,d.getUint8(2)),d.setUint8(2,0);case 3:if(s.setUint8(y+1,d.getUint8(1)),this.strict&&d.getUint8(2)!==0)throw new re(h-1);case 2:if(s.setUint8(y+0,d.getUint8(0)),this.strict&&(d.getUint8(1)!==0||d.getUint8(2)!==0))throw new re(h-2)}y+=g,w+=f-1}return r.slice(0,w)}decodeString(e){return this.decode(Io.encode(Qs(e)))}encodeToString(e){return Nu(this.encode(e))}}const Do=Me.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Tu=Do.withPadding(Le),$s=Me.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),To=$s.withPadding(Le);function*Ou(t,e){for(let o=t.next();!o.done;o=t.next())e(o.value)&&(yield o.value)}function Oo(t,e){return Ou(t[Symbol.iterator](),e)}function*Xs(t,e){for(let o=t.next();!o.done;o=t.next())yield e(o.value)}function $(t,e){return Xs(t[Symbol.iterator](),e)}function*Pu(t,e){for(let o=0;o<e;o++){const n=t.next();if(n.done)return;yield n.value}}function Lu(t,e){return Pu(t[Symbol.iterator](),e)}function Ys(t){const e=t.next();if(e.done)throw new gt;return e.value}function Mu(t){let e;for(let o=t.next();!o.done;o=t.next())e=o.value;if(e===void 0)throw new gt;return e}function Vu(t){return Mu(t[Symbol.iterator]())}function*Uu(t,e){for(let o=t.next();!o.done;o=t.next())yield*e(o.value)}function Po(t,e){return Uu(t[Symbol.iterator](),e)}function*Hu(){let t=0;for(;;)yield t++}function Lo(t){return Lu(Hu(),Math.ceil(t))}function Ks(t,e,o){const n=o;let r=e;for(let s=n.next();!s.done;s=n.next())r=t(r,s.value);return r}function*Wu(t,e,o){for(let n=t.next(),r=e.next();!n.done&&!r.done;n=t.next(),r=e.next())yield o(n.value,r.value)}function Mo(t,e,o){return Wu(t[Symbol.iterator](),e[Symbol.iterator](),o)}function Vo(t){if(t.startsWith("0x"))return Vo(t.substring(2));if((t.length&1)!==0)return Vo("0"+t);const e=new ArrayBuffer(t.length/2);return _u(js(t),e),e}function _u(t,e){const o=new DataView(e);let n=0;for(;n<e.byteLength;){const r=t.next(),s=t.next();if(r.done||s.done)throw new Ss;const a=Zs(r.value),d=Zs(s.value),w=a<<4|d;o.setUint8(n,w),n++}}function Zs(t){if(t>=48&&t<=57)return t-48;if(t>=97&&t<=102)return t-97+10;if(t>=65&&t<=70)return t-65+10;throw new ks(t)}function zu(t){return t.toString(16).padStart(2,"0")}function*Ju(t){yield*Xs(t,zu)}function ec(t){return Ju(t[Symbol.iterator]())}class Fu{convert(e){if(typeof e!="string")throw new p(typeof e,"string");return Vo(e)}}class Gu{convert(e){return`0x${Array.from(ec(new Uint8Array(e))).join("")}`}}class qu extends c{encoder=new Gu;decoder=new Fu}const M=new qu;new L(new O(M),new P(M));const tc=new E(new v(M),new B(M));class Qu{convert(e){return e instanceof Array?tc.decode(e):[M.decode(e)]}}class ju{convert(e){return tc.encode(e)}}class $u extends c{encoder=new ju;decoder=new Qu}const se=new $u;class Xu{encoding;constructor(e){this.encoding=e}convert(e){if(typeof e!="string")throw new p(typeof e,"string");return this.encoding.decodeString(e)}}class Yu{encoding;constructor(e){this.encoding=e}convert(e){return this.encoding.encodeToString(e)}}class Ct extends c{encoder;decoder;constructor(e){super(),this.encoder=new Yu(e),this.decoder=new Xu(e)}}new Ct(To),new Ct(Tu);const oc=new Ct($s),yt=new Ct(Do);new L(new O(yt),new P(yt));class Ku{convert(e){if(td(e))return e;if(lt(e))return BigInt(e);if(!ee(e))throw new p(typeof e,"string | bigint | number");return BigInt(e)}}class Zu{convert(e){return Xt(e,"bigint"),`0x${e.toString(16)}`}}class eh extends c{encoder=new Zu;decoder=new Ku}const F=new eh,nc=new L(new O(F),new P(F));new E(new v(F),new B(F)),new E(new v(nc),new B(nc)),BigInt.prototype.toJSON=function(){return F.encode(this)};class th{convert(e){if(!ee(e))throw new p(typeof e,"string");const o=new Date(e);if(Number.isNaN(o.valueOf()))throw new p("NaN","number");return o}}class oh{convert(e){return m(e,Date),e.toISOString()}}class nh extends c{encoder=new oh;decoder=new th}const ke=new nh,rc=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648];function bt(t){for(let e=0;e<24;++e){const o=t[0]^t[10]^t[20]^t[30]^t[40],n=t[1]^t[11]^t[21]^t[31]^t[41],r=t[2]^t[12]^t[22]^t[32]^t[42],s=t[3]^t[13]^t[23]^t[33]^t[43],a=t[4]^t[14]^t[24]^t[34]^t[44],d=t[5]^t[15]^t[25]^t[35]^t[45],w=t[6]^t[16]^t[26]^t[36]^t[46],h=t[7]^t[17]^t[27]^t[37]^t[47],y=t[8]^t[18]^t[28]^t[38]^t[48],D=t[9]^t[19]^t[29]^t[39]^t[49];let g=y^(r<<1|s>>>31),f=D^(s<<1|r>>>31);const U=t[0]^g,R=t[1]^f,z=t[10]^g,dt=t[11]^f,si=t[20]^g,ci=t[21]^f,ai=t[30]^g,ii=t[31]^f,di=t[40]^g,li=t[41]^f;g=o^(a<<1|d>>>31),f=n^(d<<1|a>>>31);const ui=t[2]^g,hi=t[3]^f,wi=t[12]^g,fi=t[13]^f,pi=t[22]^g,mi=t[23]^f,gi=t[32]^g,Ai=t[33]^f,Ci=t[42]^g,yi=t[43]^f;g=r^(w<<1|h>>>31),f=s^(h<<1|w>>>31);const bi=t[4]^g,Si=t[5]^f,ki=t[14]^g,vi=t[15]^f,Bi=t[24]^g,Ei=t[25]^f,xi=t[34]^g,Ri=t[35]^f,Ni=t[44]^g,Ii=t[45]^f;g=a^(y<<1|D>>>31),f=d^(D<<1|y>>>31);const Di=t[6]^g,Ti=t[7]^f,Oi=t[16]^g,Pi=t[17]^f,Li=t[26]^g,Mi=t[27]^f,Vi=t[36]^g,Ui=t[37]^f,Hi=t[46]^g,Wi=t[47]^f;g=w^(o<<1|n>>>31),f=h^(n<<1|o>>>31);const _i=t[8]^g,zi=t[9]^f,Ji=t[18]^g,Fi=t[19]^f,Gi=t[28]^g,qi=t[29]^f,Qi=t[38]^g,ji=t[39]^f,$i=t[48]^g,Xi=t[49]^f,pr=U,mr=R,gr=dt<<4|z>>>28,Ar=z<<4|dt>>>28,Cr=si<<3|ci>>>29,yr=ci<<3|si>>>29,br=ii<<9|ai>>>23,Sr=ai<<9|ii>>>23,kr=di<<18|li>>>14,vr=li<<18|di>>>14,Br=ui<<1|hi>>>31,Er=hi<<1|ui>>>31,xr=fi<<12|wi>>>20,Rr=wi<<12|fi>>>20,Nr=pi<<10|mi>>>22,Ir=mi<<10|pi>>>22,Dr=Ai<<13|gi>>>19,Tr=gi<<13|Ai>>>19,Or=Ci<<2|yi>>>30,Pr=yi<<2|Ci>>>30,Lr=Si<<30|bi>>>2,Mr=bi<<30|Si>>>2,Vr=ki<<6|vi>>>26,Ur=vi<<6|ki>>>26,Hr=Ei<<11|Bi>>>21,Wr=Bi<<11|Ei>>>21,_r=xi<<15|Ri>>>17,zr=Ri<<15|xi>>>17,Jr=Ii<<29|Ni>>>3,Fr=Ni<<29|Ii>>>3,Gr=Di<<28|Ti>>>4,qr=Ti<<28|Di>>>4,Qr=Pi<<23|Oi>>>9,jr=Oi<<23|Pi>>>9,$r=Li<<25|Mi>>>7,Xr=Mi<<25|Li>>>7,Yr=Vi<<21|Ui>>>11,Kr=Ui<<21|Vi>>>11,Zr=Wi<<24|Hi>>>8,es=Hi<<24|Wi>>>8,ts=_i<<27|zi>>>5,os=zi<<27|_i>>>5,ns=Ji<<20|Fi>>>12,rs=Fi<<20|Ji>>>12,ss=qi<<7|Gi>>>25,cs=Gi<<7|qi>>>25,as=Qi<<8|ji>>>24,is=ji<<8|Qi>>>24,ds=$i<<14|Xi>>>18,ls=Xi<<14|$i>>>18;t[0]=pr^~xr&Hr,t[1]=mr^~Rr&Wr,t[10]=Gr^~ns&Cr,t[11]=qr^~rs&yr,t[20]=Br^~Vr&$r,t[21]=Er^~Ur&Xr,t[30]=ts^~gr&Nr,t[31]=os^~Ar&Ir,t[40]=Lr^~Qr&ss,t[41]=Mr^~jr&cs,t[2]=xr^~Hr&Yr,t[3]=Rr^~Wr&Kr,t[12]=ns^~Cr&Dr,t[13]=rs^~yr&Tr,t[22]=Vr^~$r&as,t[23]=Ur^~Xr&is,t[32]=gr^~Nr&_r,t[33]=Ar^~Ir&zr,t[42]=Qr^~ss&br,t[43]=jr^~cs&Sr,t[4]=Hr^~Yr&ds,t[5]=Wr^~Kr&ls,t[14]=Cr^~Dr&Jr,t[15]=yr^~Tr&Fr,t[24]=$r^~as&kr,t[25]=Xr^~is&vr,t[34]=Nr^~_r&Zr,t[35]=Ir^~zr&es,t[44]=ss^~br&Or,t[45]=cs^~Sr&Pr,t[6]=Yr^~ds&pr,t[7]=Kr^~ls&mr,t[16]=Dr^~Jr&Gr,t[17]=Tr^~Fr&qr,t[26]=as^~kr&Br,t[27]=is^~vr&Er,t[36]=_r^~Zr&ts,t[37]=zr^~es&os,t[46]=br^~Or&Lr,t[47]=Sr^~Pr&Mr,t[8]=ds^~pr&xr,t[9]=ls^~mr&Rr,t[18]=Jr^~Gr&ns,t[19]=Fr^~qr&rs,t[28]=kr^~Br&Vr,t[29]=vr^~Er&Ur,t[38]=Zr^~ts&gr,t[39]=es^~os&Ar,t[48]=Or^~Lr&Qr,t[49]=Pr^~Mr&jr,t[0]^=rc[e*2],t[1]^=rc[e*2+1]}}class rh{state=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];blockSize=0;count=0;squeezing=!1;initialize(e,o){for(let n=0;n<50;++n)this.state[n]=0;this.blockSize=e/8,this.count=0,this.squeezing=!1}absorb(e){for(let o=0;o<e.length;++o)this.state[~~(this.count/4)]^=e[o]<<8*(this.count%4),this.count+=1,this.count===this.blockSize&&(bt(this.state),this.count=0)}absorbLastFewBits(e){this.state[~~(this.count/4)]^=e<<8*(this.count%4),(e&128)!==0&&this.count===this.blockSize-1&&bt(this.state),this.state[~~((this.blockSize-1)/4)]^=128<<8*((this.blockSize-1)%4),bt(this.state),this.count=0,this.squeezing=!0}squeeze(e){this.squeezing||this.absorbLastFewBits(1);const o=new Uint8Array(e);for(let n=0;n<e;++n)o[n]=this.state[~~(this.count/4)]>>>8*(this.count%4)&255,this.count+=1,this.count===this.blockSize&&(bt(this.state),this.count=0);return o}copy(e){for(let o=0;o<50;++o)e.state[o]=this.state[o];e.blockSize=this.blockSize,e.count=this.count,e.squeezing=this.squeezing}}class ce{_rate;_capacity;_delimitedSuffix;_hashBitLength;_state;_finalized;constructor(e,o,n,r){this._rate=e,this._capacity=o,this._delimitedSuffix=n,this._hashBitLength=r,this._state=new rh,this._state.initialize(e,o),this._finalized=!1}update(e){if(this._finalized)throw new Error("Digest already called");return this._state.absorb(new Uint8Array(e)),this}digest(){if(this._finalized)throw new Error("Digest already called");this._finalized=!0,this._delimitedSuffix&&this._state.absorbLastFewBits(this._delimitedSuffix);const e=this._state.squeeze(this._hashBitLength/8);return this._resetState(),Io.encode(e)}_resetState(){return this._state.initialize(this._rate,this._capacity),this}}function sh(t){switch(t.toLowerCase()){case"keccak224":return new ce(1152,448,null,224);case"keccak256":return new ce(1088,512,null,256);case"keccak384":return new ce(832,768,null,384);case"keccak512":return new ce(576,1024,null,512);case"sha3-224":return new ce(1152,448,6,224);case"sha3-256":return new ce(1088,512,6,256);case"sha3-384":return new ce(832,768,6,384);case"sha3-512":return new ce(576,1024,6,512);default:throw new Error("invalid algorithm: "+t)}}const ch=48,ah=57,ih=97,dh=102;class lh{convert(e){if(m(e,ArrayBuffer),e.byteLength!==20)throw new p(typeof e,"20-byte ArrayBuffer");const n=[...Po(ec(new Uint8Array(e)),w=>w.split(""))],r=sh("keccak256"),s=new TextEncoder;r.update(Io.encode(s.encode(n.join(""))));const a=new Uint8Array(r.digest());return["0x",...$(Mo(Lo(e.byteLength*2),n,(w,h)=>[w,h]),([w,h])=>{const y=h.charCodeAt(0);if(y>=ch&&y<=ah)return h;if(y>=ih&&y<=dh){const D=Math.floor(w/2),g=w&1,f=a[D];return(g===0?f>>4:f&15)>7?h.toUpperCase():h}throw new _})].join("")}}const uh=new lh;class hh{keyCodec;valueCodec;constructor(e,o){this.keyCodec=e,this.valueCodec=o}convert(e){if(typeof e!="object"||e===null)throw new Error(`invalid map value: expected an object, got ${typeof e}`);const o=new Map;for(const[n,r]of Object.entries(e)){const s=this.keyCodec.decode(n),a=this.valueCodec.decode(r);o.set(s,a)}return o}}class wh{keyCodec;valueCodec;constructor(e,o){this.keyCodec=e,this.valueCodec=o}convert(e){m(e,Map);const o={};for(const[n,r]of e.entries()){const s=this.keyCodec.encode(n),a=this.valueCodec.encode(r);o[s]=a}return o}}class Uo extends c{encoder;decoder;constructor(e,o){super(),this.encoder=o,this.decoder=e}static keyStringCodec(e){return new Uo(new hh(l,e),new wh(l,e))}}class fh{convert(e){if(!ee(e))throw new p(typeof e,"string");return new URL(e)}}class ph{convert(e){return e.toString()}}class mh extends c{encoder=new ph;decoder=new fh}const sc=new mh,St=new L(new O(sc),new P(sc));class Ho{}const Ve="Set-Url";class Wo extends Ho{url;constructor(e){super(),this.url=e}valueOf(){return Ve}toJSON(){return _o.encode(this)}}class gh{convert(e){return{[Ve]:e.url}}}class Ah{convert(e){i(e,Ve);const o=e[Ve];if(typeof o!="string")throw new p(typeof o,"string");return new Wo(o)}}class Ch extends c{encoder=new gh;decoder=new Ah}const _o=new Ch;class cc{}const Ue="Close";class He extends Ho{valueOf(){return Ue}}class yh{convert(){return Ue}}class bh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==Ue)throw new p(e,Ue);return new He}}class Sh extends c{encoder=new yh;decoder=new bh}const ac=new Sh,We="Connect";class _e extends Ho{valueOf(){return We}toJSON(){return zo.encode(this)}}class kh{convert(){return We}}class vh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==We)throw new p(e,We);return new _e}}class Bh extends c{encoder=new kh;decoder=new vh}const zo=new Bh;class Eh{convert(e){if(e===We)return zo.decode(e);if(e===Ue)return ac.decode(e);if(typeof e=="object"&&e!==null&&Ve in e)return _o.decode(e);throw new _}}class xh{convert(e){if(e instanceof _e)return zo.encode(e);if(e instanceof He)return ac.encode(e);if(e instanceof Wo)return _o.encode(e);throw new _}}class Rh extends c{encoder=new xh;decoder=new Eh}const ic=new Rh;class ze extends cc{command;get type(){return Je}constructor(e){super(),this.command=e}toJSON(){return dc.encode(this)}}const Je="WebSocket";class Nh{convert(e){return{[Je]:ic.encode(e.command)}}}class Ih{convert(e){return i(e,Je),new ze(ic.decode(e[Je]))}}class Dh extends c{encoder=new Nh;decoder=new Ih}const dc=new Dh,me=new Map;me.set(Je,dc);class Th{convert(e){const o=me.get(e.type);if(!o)throw new p(e.type,`one of ${Array.from($(me.keys(),n=>`"${n}"`)).join(", ")}`);return{[e.type]:o.encode(e)}}}class Oh{convert(e){if(typeof e!="object"||e===null)throw new p(typeof e,"object");const o=Object.keys(e);if(o.length!==1)throw new _("multiple values contained within the Request object, unexpected");const[n]=o,r=me.get(n);if(i(e,n),!r)throw new p(n,`one of ${Array.from($(me.keys(),s=>`"${s}"`)).join(", ")}`);return r.decode(e[n])}}class Ph extends c{encoder=new Th;decoder=new Oh}function Lh(t,e){me.has(t)||me.set(t,e)}const Mh=new Ph;class Jo{}const Fe="Error";class lc extends Jo{error;get type(){return Fe}constructor(e){super(),this.error=e}toJSON(){return uc.encode(this)}}class Vh{convert(e){return{[Fe]:ht.encode(e.error)}}}class Uh{convert(e){return i(e,Fe),new lc(ht.decode(e[Fe]))}}class Hh extends c{encoder=new Vh;decoder=new Uh}const uc=new Hh;class Fo{}const Ge="Closed";class ve extends Fo{valueOf(){return Ge}toJSON(){return Go.encode(this)}}class Wh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==Ge)throw new p(e,Ge);return new ve}}class _h{convert(){return Ge}}class zh extends c{encoder=new _h;decoder=new Wh}const Go=new zh,qe="Connecting";class Qe extends Fo{valueOf(){return qe}toJSON(){return qo.encode(this)}}class Jh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==qe)throw new p(e,qe);return new Qe}}class Fh{convert(){return qe}}class Gh extends c{encoder=new Fh;decoder=new Jh}const qo=new Gh,je="Opened";class $e extends Fo{valueOf(){return je}toJSON(){return Qo.encode(this)}}class qh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==je)throw new p(e,je);return new $e}}class Qh{convert(){return je}}class jh extends c{encoder=new Qh;decoder=new qh}const Qo=new jh;class $h{convert(e){if(e===je)return Qo.decode(e);if(e===Ge)return Go.decode(e);if(e===qe)return qo.decode(e);throw new _}}class Xh{convert(e){if(e instanceof $e)return Qo.encode(e);if(e instanceof ve)return Go.encode(e);if(e instanceof Qe)return qo.encode(e);throw new _}}class Yh extends c{encoder=new Xh;decoder=new $h}const hc=new Yh;class wc extends Jo{status;get type(){return Xe}constructor(e){super(),this.status=e}toJSON(){return fc.encode(this)}}const Xe="WebSocket";class Kh{convert(e){return{[Xe]:hc.encode(e.status)}}}class Zh{convert(e){return i(e,Xe),new wc(hc.decode(e[Xe]))}}class ew extends c{encoder=new Kh;decoder=new Zh}const fc=new ew,ae=new Map;ae.set(Fe,uc),ae.set(Xe,fc);class tw{convert(e){const o=ae.get(e.type);if(!o)throw new p(e.type,`one of ${Array.from($(ae.keys(),n=>`"${n}"`)).join(", ")}`);return{[e.type]:o.encode(e)}}}class ow{convert(e){if(typeof e!="object"||e===null)throw new p(typeof e,"object");const o=Object.keys(e);if(o.length!==1)throw new _("multiple values contained within the response object, unexpected");const[n]=o,r=ae.get(n);if(i(e,n),!r)throw new p(n,`one of ${Array.from($(ae.keys(),s=>`"${s}"`)).join(", ")}`);return r.decode(e[n])}}class nw extends c{encoder=new tw;decoder=new ow}function rw(t,e){ae.has(t)||ae.set(t,e)}const sw=new nw;class cw{convert(e){return new lc(e)}}const aw=new cw;class iw{convert(e){return new wc(e)}}const jo=new iw;class dw{constructor(e,o){this.sink=e,this.converter=o,this.sink=e,this.converter=o}async send(e){await this.sink.send(this.converter.convert(e))}}function ge(t,e){return new dw(t,e)}async function $o(t){return new Promise(e=>{const o=setTimeout(()=>{clearTimeout(o),e()},t)})}class te{constructor(e,o,n){this.alpha3Code=e,this.code=o,this.significantDigits=n,this.alpha3Code=e,this.code=o,this.significantDigits=n,this.significantDigitsMultiplier=BigInt(10)**BigInt(this.significantDigits)}significantDigitsMultiplier;toJSON(){return kt.encode(this)}}const pc=new te("JPY",392,0),lw=new te("GBP",826,2),mc=new te("USD",840,2),uw=new te("EUR",978,2),hw=new te("XXX",999,2),gc=new te("ETH",1001,18),Xo=new te("XBT",1002,8),Ac=new te("ESP",10001,18),ww=[pc,lw,mc,uw,hw,gc,Xo,Ac],fw=new Map(ww.map(t=>[t.alpha3Code,t]));class pw{convert(e){if(typeof e!="string")throw new ne("CurrencyCodeDecoder: expected string");if(e==="BTC")return Xo;const o=fw.get(e);if(o===void 0)throw new ne(`CurrencyCodeDecoder: unknown currency: "${e}"`);return o}}class mw{convert(e){return m(e,te),e.alpha3Code}}class gw extends c{decoder=new pw;encoder=new mw}const kt=new gw;class X{constructor(e,o){this.currency=e,this.value=o,this.currency=e,this.value=o}static USD(e){return new X(mc,BigInt(e))}static ETH(e){return new X(gc,BigInt(e))}static ESP(e){return new X(Ac,BigInt(e))}static JPY(e){return new X(pc,BigInt(e))}static BTC(e){return new X(Xo,BigInt(e))}toString(){return vt.encode(this)}toJSON(){return vt.encode(this)}}function Aw(t){return t==="."||t===","||t===" "}function Cw(t,e){let o=-1;const n=t.length;for(let r=0;r<n;r++)e(t[r])&&(o=r);return o}class yw{parseCurrencyCode(e){return kt.decode(e)}parseValue(e,o){let n=1n;o[0]==="-"&&(n=-1n,o=o.substring(1));const r=Cw(o,Aw);if(r===-1){const h=BigInt(o.replace(/\D/g,""))*e.significantDigitsMultiplier;return n*h}const s=o.substring(0,r).replace(/\D/g,""),a=o.substring(r+1).replace(/\D/g,""),d=BigInt(s)*e.significantDigitsMultiplier,w=BigInt(a)*10n**BigInt(e.significantDigits-a.length);return n*(d+w)}convert(e){if(typeof e!="string")throw new ne("MonetaryValueDecoder: expected string");const o=e.indexOf(" ");if(o<=-1)throw new ne("MonetaryValueDecoder: missing non-breaking space");const n=e.substring(0,o),r=e.substring(o+1);if(/^-?[\d .,]+$/.test(n)){const a=this.parseCurrencyCode(r);return new X(a,this.parseValue(a,n))}const s=this.parseCurrencyCode(n);return new X(s,this.parseValue(s,r))}}class bw{convert(e){m(e,X);const o=e.value<0n?"-":"",n=e.value<0n?-e.value:e.value,r=n%e.currency.significantDigitsMultiplier,s=n/e.currency.significantDigitsMultiplier,a=String(s),d=String(r);return/^0+$/.test(d)?`${kt.encode(e.currency)} ${o}${a}`:`${kt.encode(e.currency)} ${o}${s}.${String(r).padStart(e.currency.significantDigits,"0")}`}}class Sw extends c{decoder=new yw;encoder=new bw}const vt=new Sw,Cc=new E(new v(vt),new B(vt));class C{namespace;name;site;blockExplorer;constructor(e,o,n,r){this.namespace=e,this.name=o,this.site=n,this.blockExplorer=r}}const kw=new C(202374881,"Vienna",new URL("https://vienna.caldera.dev/"),new URL("https://vienna.calderaexplorer.xyz/")),vw=new C(202374882,"OP Stack",new URL("https://stack.optimism.io/"),new URL("https://www.blockscout.com/")),Bw=new C(33914988448,"Arbitrum",new URL("https://arbitrum.io/"),new URL("https://arbiscan.io/")),Ew=new C(33914988449,"Eigen Layer",new URL("https://www.eigenlayer.xyz/"),new URL("https://www.blockscout.com/")),xw=new C(33914988450,"Spire",new URL("https://www.spire.dev/"),new URL("https://www.blockscout.com/")),Rw=new C(33914988451,"Alt Layer",new URL("https://altlayer.io/"),new URL("https://www.blockscout.com/")),Nw=new C(33914988452,"Caldera",new URL("https://www.caldera.xyz/"),new URL("https://www.blockscout.com/")),Iw=new C(33914988453,"Vistara Labs",new URL("https://vistara.dev/"),new URL("https://www.blockscout.com/")),Dw=new C(33914988454,"Polygon",new URL("https://polygon.technology/"),new URL("https://www.blockscout.com/")),Tw=new C(263,"Milan",new URL("https://milan.caldera.dev/"),new URL("https://milan-devnet.explorer.caldera.xyz/")),Ow=new C(41234687,"Kyoto",new URL("https://example.com/"),new URL("https://kyoto-explorer.altlayer.io/")),Pw=1918988905,Lw=new C(Pw,"RARI",new URL("https://rarichain.org/"),new URL("https://explorer.rarichain.org/")),Mw=1380012617,Vw=new C(Mw,"RARI",new URL("https://rarichain.org/"),new URL("https://mainnet.explorer.rarichain.org/")),Uw=9369,Hw=new C(Uw,"LogX",new URL("https://logx.network/"),new URL("https://kartel-testnet-explorer.alt.technology/")),Ww=936369,_w=new C(Ww,"LogX",new URL("https://logx.network/"),new URL("https://vzjuxmhfn70kgnlds27h-explorer.alt.technology")),zw=466,Jw=new C(zw,"AppChain",new URL("https://appchain.xyz/"),new URL("https://explorer.appchain.xyz/")),Fw=4661,Gw=new C(Fw,"AppChain",new URL("https://appchain.xyz/"),new URL("https://appchaintestnet.explorer.caldera.xyz/")),qw=360,Qw=new C(qw,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),jw=3609,$w=new C(jw,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),Xw=33139,Yw=new C(Xw,"APECHAIN",new URL("https://apechain.com/"),new URL("https://apescan.io/")),Kw=3313939,Zw=new C(Kw,"APECHAIN",new URL("https://apechain.com/"),new URL("https://apechain-testnet.explorer.caldera.xyz/")),ef=13107,tf=new C(ef,"t3rn",new URL("https://t3rn.io/"),new URL("https://brn-testnet.explorer.caldera.xyz/")),of=819,nf=new C(of,"t3rn",new URL("https://t3rn.io/"),new URL("https://exporer.t3rn.io/")),yc=21341,rf=new C(yc,"Rufus",new URL("https://l2beat.com/scaling/projects/rufus"),new URL("https://rufus-sepolia-testnet.explorer.caldera.xyz/")),sf=new C(yc,"Rufus",new URL("https://l2beat.com/scaling/projects/rufus"),new URL("https://rufus.calderaexplorer.xyz/")),cf=2524852,af=new C(cf,"Huddle01",new URL("https://huddle01.com/"),new URL("https://hudlscan.com/txs")),df=1397311310,bc=new C(df,"Infinite Garden",new URL("https://infinitegarden.espressosys.com/"),new URL("https://explorer.main.net.espressosys.com/")),lf=10101,uf=new C(lf,"Timeboost Decaf",new URL("https://espressosys.com/"),new URL("https://explorer.decaf.testnet.espresso.network/")),hf=[bc,Vw,_w,Qw,Jw,Yw,nf,sf],wf=[bc,Lw,Hw,Gw,$w,Zw,tf,rf,af,uf],ff=new Map([kw,vw,Bw,Dw,Ew,xw,Rw,Nw,Iw,Tw,Ow,...hf,...wf].map(t=>[t.namespace,t]));class Y{tag;data;constructor(e,o){this.tag=e,this.data=o}static fromString(e){const o=e.indexOf("~");if(o<0)throw new xs;const n=e.substring(0,o),r=To.decodeString(e.substring(o+1));return new Y(n,r)}static inflate(e){return A.decode(e)}toString(){return`${this.tag}~${To.encodeToString(this.data)}`}valueOf(){return this.toString()}toJSON(){return this.toString()}}class pf{convert(e){if(typeof e!="string")throw new p(typeof e,"string");return Y.fromString(e)}}class mf{convert(e){return m(e,Y),e.toString()}}class gf extends c{encoder=new mf;decoder=new pf}const A=new gf,Ye=2147483648,Af=1103515245,Cf=12345;class ie{state;constructor(e){this.state=e!==void 0?e:Math.floor(Math.random()*(Ye-1))}nextInt(){return this.state=(Af*this.state+Cf)%Ye,this.state}nextFloat(){return this.nextInt()/(Ye-1)}nextRange(e,o){const n=o-e,r=this.nextInt()/Ye;return e+Math.floor(r*n)}nextRangeBigInt(e,o){const n=o-e,r=BigInt(this.nextInt())*1000000n/BigInt(Ye);return e+r*n/1000000n}fillBytes(e){const o=new ArrayBuffer(e),n=new DataView(o);let r=0;for(;r<e-4;r+=4)n.setUint32(r,this.nextRange(0,4294967295));for(let s=r;s<e;s++)n.setUint8(s,this.nextRange(0,256));return o}}const Bt=new Date,yf=new Date(Bt.getFullYear(),Bt.getMonth(),Bt.getDate()).valueOf();function bf(){return Bt.valueOf()}function Et(){return yf}const Sc=["Residential","Mobile","Enterprise","AWS","Azure","GCP"],kc=["Espresso v1.0","Espresso v1.1","Espresso v1.2","Espresso v1.3","Espresso v1.4"],vc=["Linux","Unix","Windows","MacOS"],Bc=[["Espresso","https://espressosys.com/"],["BlockDaemon","https://www.blockdaemon.com/"],["Unit 410","https://unit410.com/"],["Nethermind","https://www.nethermind.io/"],["Sub7","https://sub7.xyz/"],["KudasaiJP","https://kudasai.co.jp/"],["Informal Systems","https://informal.systems/"],["P2P","https://p2p.org/"],["LinkPool","https://linkpool.com/"],["ZKV","https://zkvalidator.com/"],["Figment","https://figment.io/"]],Sf=[[["Mexico City",19.4333,-99.1333,"MX"],["Guadalajara",20.6767,-103.3475,"MX"],["Monterrey",25.6667,-100.3,"MX"],["Guatemala City",14.6133,-90.5353,"GT"],["Tijuana",32.525,-117.0333,"MX"],["Ecatepec",19.6097,-99.06,"MX"],["Tegucigalpa",14.1058,-87.2047,"HN"],["León de los Aldama",21.1167,-101.6833,"MX"],["San José",9.9325,-84.08,"CR"],["Panama City",8.9833,-79.5167,"PA"],["Juárez",31.745,-106.485,"MX"],["Comayagüela",14.098,-87.21,"HN"],["Mexicali",32.6633,-115.4678,"MX"],["Nezahualcóyotl",19.4081,-99.0186,"MX"],["Managua",12.1364,-86.2514,"NI"],["Morelia",19.7683,-101.1894,"MX"],["Aguascalientes",21.876,-102.296,"MX"],["Mérida",20.97,-89.62,"MX"],["Saltillo",25.4231,-100.9919,"MX"],["Culiacán",24.8069,-107.3939,"MX"]],[["Havana",23.1367,-82.3589,"CU"],["San Juan",18.3985,-66.061,"PR"],["Santiago",19.4572,-70.6889,"DO"],["Santo Domingo",18.4667,-69.95,"DO"],["Port-au-Prince",18.5333,-72.3333,"HT"],["Santo Domingo Este",18.4855,-69.8734,"DO"],["Kingston",17.9714,-76.7931,"JM"],["Carrefour",18.5344,-72.4094,"HT"],["Santiago de Cuba",20.0217,-75.8294,"CU"],["Pétion-Ville",18.5128,-72.2864,"HT"],["Holguín",20.8869,-76.2592,"CU"],["Gonaïves",19.4456,-72.6883,"HT"],["Camagüey",21.3839,-77.9075,"CU"],["Puerto Plata",19.8,-70.6833,"DO"],["Croix-des-Bouquets",18.5761,-72.2269,"HT"],["Nassau",25.0781,-77.3386,"BS"],["Fort-de-France",14.6,-61.0667,"MQ"],["Higüey",18.6167,-68.7,"DO"],["Santa Clara",22.4069,-79.9649,"CU"],["Bayamo",20.3817,-76.6428,"CU"]],[["Cairo",30.0444,31.2358,"EG"],["Lagos",6.455,3.3841,"NG"],["Kinshasa",-4.3219,15.3119,"CD"],["Luanda",-8.8383,13.2344,"AO"],["Johannesburg",-26.2044,28.0456,"ZA"],["Dar es Salaam",-6.8161,39.2803,"TZ"],["Douala",4.05,9.7,"CM"],["Giza",29.987,31.2118,"EG"],["Abidjan",5.3167,-4.0333,"CI"],["Cape Town",-33.9253,18.4239,"ZA"],["Bamako",12.6392,-8.0028,"ML"],["Abuja",9.0667,7.4833,"NG"],["Ibadan",7.3964,3.9167,"NG"],["Addis Ababa",9.03,38.74,"ET"],["Mbuji-Mayi",-6.15,23.6,"CD"],["Mogadishu",2.0392,45.3419,"SO"],["Lusaka",-15.4167,28.2833,"ZM"],["Antananarivo",-18.91,47.525,"MG"],["Awka",6.2069,7.0678,"NG"],["Bamenda",5.9614,10.1517,"CM"]],[["Tokyo",35.6897,139.6922,"JP"],["Delhi",28.61,77.23,"IN"],["Manila",14.5958,120.9772,"PH"],["Dhaka",23.7639,90.3889,"BD"],["Moscow",55.7558,37.6172,"RU"],["Ho Chi Minh City",10.7756,106.7019,"VN"],["Xi’an",34.2611,108.9422,"CN"],["Dongguan",23.021,113.752,"CN"],["Tongshan",34.204,117.284,"CN"],["Jining",35.4151,116.5871,"CN"],["Cangzhou",38.3047,116.8387,"CN"],["Shaoyang",27.2395,111.4679,"CN"],["Dalian",38.9,121.6,"CN"],["Ankara",39.93,32.85,"TR"],["Zhangzhou",24.513,117.647,"CN"],["Changsha",28.228,112.939,"CN"],["Ürümqi",43.8225,87.6125,"CN"],["Ningbo",29.8603,121.6245,"CN"],["Suihua",46.654,126.969,"CN"],["Deyang",31.127,104.398,"CN"]],[["London",51.5072,-.1275,"GB"],["Madrid",40.4169,-3.7033,"ES"],["Berlin",52.52,13.405,"DE"],["Barcelona",41.3828,2.1769,"ES"],["Athens",37.9842,23.7281,"GR"],["Budapest",47.4925,19.0514,"HU"],["Birmingham",52.48,-1.9025,"GB"],["Stuttgart",48.7775,9.18,"DE"],["Munich",48.1375,11.575,"DE"],["Hamburg",53.55,10,"DE"],["Bucharest",44.4325,26.1039,"RO"],["Vienna",48.2083,16.3725,"AT"],["Stockholm",59.3294,18.0686,"SE"],["Minsk",53.9,27.5667,"BY"],["Warsaw",52.23,21.0111,"PL"],["Valencia",39.47,-.3764,"ES"],["Amsterdam",52.3728,4.8936,"NL"],["Copenhagen",55.6761,12.5683,"DK"],["Porto",41.1621,-8.622,"PT"],["Brussels",50.8467,4.3525,"BE"]],[["New York",40.6943,-73.9249,"US"],["Los Angeles",34.1141,-118.4068,"US"],["Chicago",41.8375,-87.6866,"US"],["Miami",25.784,-80.2101,"US"],["Dallas",32.7935,-96.7667,"US"],["Philadelphia",40.0077,-75.1339,"US"],["Atlanta",33.7628,-84.422,"US"],["Boston",42.3188,-71.0852,"US"],["Phoenix",33.5722,-112.0892,"US"],["Detroit",42.3834,-83.1024,"US"],["Seattle",47.6211,-122.3244,"US"],["San Francisco",37.7558,-122.4449,"US"],["San Diego",32.8313,-117.1222,"US"],["Minneapolis",44.9635,-93.2678,"US"],["Brooklyn",40.6501,-73.9496,"US"],["Vancouver",49.25,-123.1,"CA"],["Riverside",33.9381,-117.3949,"US"],["Baltimore",39.3051,-76.6144,"US"],["Portland",45.5371,-122.65,"US"],["Sacramento",38.5677,-121.4685,"US"]],[["Melbourne",-37.8142,144.9631,"AU"],["Sydney",-33.8678,151.21,"AU"],["Brisbane",-27.4678,153.0281,"AU"],["Perth",-31.9559,115.8606,"AU"],["Auckland",-36.8406,174.74,"NZ"],["Adelaide",-34.9275,138.6,"AU"],["Port Moresby",-9.4789,147.1494,"PG"],["Gold Coast",-28.0167,153.4,"AU"],["Cranbourne",-38.0996,145.2834,"AU"],["Christchurch",-43.531,172.6365,"NZ"],["Manukau City",-37,174.885,"NZ"],["Central Coast",-33.3,151.2,"AU"],["Wollongong",-34.4331,150.8831,"AU"],["Ipswich",-27.6144,152.7608,"AU"],["Wellington",-41.2889,174.7772,"NZ"],["Northcote",-36.8019,174.7494,"NZ"],["Hobart",-42.8806,147.325,"AU"],["Lae",-6.7303,147.0008,"PG"],["Suva",-18.1416,178.4419,"FJ"],["Nouméa",-22.2758,166.458,"NC"]],[["São Paulo",-23.55,-46.6333,"BR"],["Buenos Aires",-34.6033,-58.3817,"AR"],["Rio de Janeiro",-22.9111,-43.2056,"BR"],["Lima",-12.06,-77.0375,"PE"],["Bogotá",4.7111,-74.0722,"CO"],["Santiago",-33.4372,-70.6506,"CL"],["Belo Horizonte",-19.9167,-43.9333,"BR"],["Fortaleza",-3.7275,-38.5275,"BR"],["Santa Cruz de la Sierra",-17.7892,-63.1975,"BO"],["La Paz",-16.4958,-68.1333,"BO"],["Guayaquil",-2.19,-79.8875,"EC"],["Medellín",6.2308,-75.5906,"CO"],["Salvador",-12.9747,-38.4767,"BR"],["Caracas",10.4806,-66.9036,"VE"],["Córdoba",-31.4167,-64.1833,"AR"],["Santos",-23.9369,-46.325,"BR"],["Curitiba",-25.4297,-49.2711,"BR"],["Maracaibo",10.6333,-71.6333,"VE"],["Recife",-8.05,-34.9,"BR"],["Porto Alegre",-30.0331,-51.23,"BR"]]],Ec=[0,0,5,26,28,26,9,6],kf=Ec.reduce((t,e)=>t+e,0),vf=Ec.reduce((t,e)=>{const o=t[t.length-1]??0;return t.push(o+e),t},[]),Bf=Array.from(Mo(vf,Sf,(t,e)=>[t,e]));function Ef(t){const e=t.nextRange(0,kf),o=Oo(Bf,([a])=>a<=e),[,n]=Vu(o),r=t.nextRange(0,n.length);return n[r]}function xf(t){const e=t.nextRange(0,Bc.length);return Bc[e]}function Rf(t){const e=t.nextRange(0,vc.length);return vc[e]}function Nf(t){const e=t.nextRange(0,kc.length);return kc[e]}function If(t){const e=t.nextRange(0,Sc.length);return Sc[e]}function Df(t){const[e,o]=xf(t),[,n,r,s]=Ef(t),a=Rf(t),d=Nf(t),w=If(t);return{pubkey:new Y("PUBKEY",t.fillBytes(32)),stateVerKey:new Y("STATE_VER_KEY",t.fillBytes(32)),stake:t.nextRangeBigInt(0n,1000n)*1000000000000000000n,commission:t.nextRange(0,5e3),name:`${e} Node ${s} ${t.nextRange(0,100)}`,address:t.fillBytes(32),company:{name:e,website:o},location:{coords:[n,r],country:s},operatingSystem:a,networkType:w,nodeType:d}}function*Tf(t=new ie(Et())){const e=t.nextRange(100,350);for(let o=0;o<e;o++)yield Df(new ie(o))}const Ae=Array.from(Tf());async function*Of(){}function xc(){const t=new Uint8Array(new Array(20).map(()=>0)).buffer;return{hash:new Y("BLOCK",t),height:0,time:new Date(0),genTime:0,transactions:Of(),numTransactions:0,proposer:[],size:0,fees:[]}}async function*Pf(t){let e=1,o=Et();const n=bf();for(;o<n;){const r=Math.floor(t.nextFloat()*14*1e3);yield Rc(new ie(e+r),e,o,o+r),o+=r,e++}}async function*Lf(t=new ie(Et())){yield xc(),yield*Pf(t)}async function*Mf(t,e,o){let n=e,r=o;for(;;){const s=Math.floor(t.nextFloat()*14*1e3),a=n+s-Date.now();await $o(a),yield Rc(new ie(r+s),r,n,n+s),n+=s,r++}}function Rc(t,e,o,n){const r=Math.floor(t.nextRange(0,5)),s=t.nextRange(0,Ae.length),a=Ae[s];return{hash:new Y("BLOCK",t.fillBytes(32)),height:e,genTime:n-o,time:new Date(n),numTransactions:r,transactions:Uf(new ie(e+o),e,o,n,r),proposer:[a.address],size:Math.floor(t.nextFloat()*1024*r)+8,fees:[X.ESP(BigInt(t.nextRange(0,1e9)*1e3))]}}const Nc=Array.from(ff.keys());function Vf(t){return t.nextFloat()>.98?1:Nc[t.nextRange(0,Nc.length)]}async function*Uf(t,e,o,n,r){const s=(n-o)/r;for(let a=0,d=o;d<n;d+=s,a++){const w=Vf(t),h=Math.floor(1024*t.nextFloat());yield{block:e,index:a,size:h,hash:new Y("COMMIT",t.fillBytes(32)),time:new Date(d),sender:new Y("PUBKEY",t.fillBytes(32)),tree:{namespace:w,data:t.fillBytes(h)}}}}const Yo=1e4,Ic=0,Hf="PercentageOutOfRange";class Wf extends k{value;constructor(e,o=`the commission percentage is outside of the range [${Ic}, ${Yo}], have ${e}`){super(o),this.value=e,Object.freeze(this)}get code(){return Hf}}class Ko{value;constructor(e){if(e<Ic||e>Yo)throw new Wf(e);this.value=e}toString(){return`${this.value/100}%`}toJSON(){return this.value}valueOf(){return this.value/Yo}}class _f{convert(e){if(typeof e!="number")throw new p(typeof e,"number");return new Ko(e)}}class zf{convert(e){if(!(e instanceof Ko))throw new p(e,"CommissionPercent");return Math.floor(e.value)}}class Jf extends c{encoder=new zf;decoder=new _f}const Dc=new Jf;class Zo{stakeKey;stakeAmount;constructor(e,o){this.stakeKey=e,this.stakeAmount=o}}class Ff{convert(e){return i(e,"stake_key","stake_amount"),new Zo(A.decode(e.stake_key),F.decode(e.stake_amount))}}class Gf{convert(e){return m(e,Zo),{stake_key:A.encode(e.stakeKey),stake_amount:F.encode(e.stakeAmount)}}}class qf extends c{encoder=new Gf;decoder=new Ff}const Be=new qf;new L(new O(Be),new P(Be)),new E(new v(Be),new B(Be));class en{stakeTableEntry;stateVerKey;constructor(e,o){this.stakeTableEntry=e,this.stateVerKey=o}}class Qf{convert(e){return i(e,"stake_table_entry","state_ver_key"),new en(Be.decode(e.stake_table_entry),A.decode(e.state_ver_key))}}class jf{convert(e){return m(e,en),{stake_table_entry:Be.encode(e.stakeTableEntry),state_ver_key:A.encode(e.stateVerKey)}}}class $f extends c{encoder=new jf;decoder=new Qf}const xt=new $f;new L(new O(xt),new P(xt));const Rt=new E(new v(xt),new B(xt));class Tc{address;constructor(e){this.address=e,Object.freeze(this)}toJSON(){return Ee.encode(this)}toString(){return Ee.encode(this)}}class Xf{convert(e){return e.address.byteLength!==20?M.encode(e.address):uh.convert(e.address)}}class Yf{convert(e){return new Tc(M.decode(e))}}class Kf extends c{encoder=new Xf;decoder=new Yf}const Ee=new Kf;new L(new O(Ee),new P(Ee));const Oc=Uo.keyStringCodec(F);class tn{account;stakeTableKey;stateVerKey;stake;commission;delegators;constructor(e,o,n,r,s,a){this.account=e,this.stakeTableKey=o,this.stateVerKey=n,this.stake=r,this.commission=s,this.delegators=a}}class Zf{convert(e){return i(e,"account","stake_table_key","state_ver_key","stake","commission","delegators"),new tn(Ee.decode(e.account),A.decode(e.stake_table_key),A.decode(e.state_ver_key),F.decode(e.stake),Dc.decode(e.commission),Oc.decode(e.delegators))}}class ep{convert(e){return m(e,tn),{account:Ee.encode(e.account),stake_table_key:A.encode(e.stakeTableKey),state_ver_key:A.encode(e.stateVerKey),stake:F.encode(e.stake),commission:Dc.encode(e.commission),delegators:Oc.encode(e.delegators)}}}class tp extends c{encoder=new ep;decoder=new Zf}const xe=new tp;new L(new O(xe),new P(xe));const Pc=new E(new v(xe),new B(xe));class Ke{constructor(e){this.value=e,this.value=e}valueOf(){return Number(this.value)}toString(){return Number(this.value).toString()}}function on(t,e){return t.valueOf()<e.valueOf()}function op(t,e){return t.valueOf()<=e.valueOf()}function Nt(t,e){return t.valueOf()>e.valueOf()}function Lc(t,e){return op(t,e)?t:e}function Mc(t,e){return Nt(t,e)?t:e}class nn{min;max;constructor(e,o){this.min=e,this.max=o}contains(e){return!(on(e.lat,this.min.lat)||Nt(e.lat,this.max.lat)||on(e.lng,this.min.lng)||Nt(e.lng,this.max.lng))}}function Ze(t){const e=t[Symbol.iterator](),o=Ys(e),[n,r]=Ks(([s,a],d)=>[s.min(d.bbox.min),a.max(d.bbox.max)],[o.bbox.min,o.bbox.max],e);return new nn(n,r)}function np(t){const e=t[Symbol.iterator](),o=Ys(e),[n,r]=Ks(([s,a],d)=>[s.min(d),a.max(d)],[o,o],e);return new nn(n,r)}class Ce{}const Vc=new Map;function ye(t,e){Vc.set(t,e)}function Uc(t){const e=Vc.get(t);if(!e)throw new Te(t);return e}class rp{convert(e){return Uc(e.type).encode(e)}}class sp{convert(e){if(i(e,"type","coordinates"),!ee(e.type))throw new p(typeof e.type,"string");return Uc(e.type).decode(e)}}class cp extends c{encoder;decoder;constructor(){super(),this.encoder=new rp,this.decoder=new sp}}const Hc=new cp,Wc=new E(new v(Hc),new B(Hc)),rn="GeometryCollection";class ap extends Ce{type=rn;geometries;bbox;constructor(e){super(),this.geometries=e,this.bbox=Ze(e)}toJSON(){return _c.encode(this)}}class ip{listGeometryCodec;constructor(e){this.listGeometryCodec=e}convert(e){return{type:e.type,geometries:this.listGeometryCodec.encode(e.geometries)}}}class dp{listGeometryCodec;constructor(e){this.listGeometryCodec=e}convert(e){return i(e,"type","geometries"),le(e,rn),new ap(this.listGeometryCodec.decode(e.geometries))}}class lp extends c{encoder=new ip(Wc);decoder=new dp(Wc)}const _c=new lp;ye(rn,_c);class H extends Ke{toString(){return`${Number(this)}°`}}class up{convert(e){return Number(e)}}class hp{convert(e){if(!lt(e))throw new p(typeof e,"number");return new H(e)}}class wp extends c{encoder;decoder;constructor(){super(),this.encoder=new up,this.decoder=new hp}}const fp=new wp;class N extends Ke{toString(){return`${String(this.value)} lat`}}class I extends Ke{toString(){return`${String(this.value)} lng`}}class K extends Ke{toString(){return`${Number(this)} rad`}}class pp{convert(e){return Number(e)}}class mp{convert(e){if(!lt(e))throw new p(typeof e,"number");return new K(e)}}class gp extends c{encoder;decoder;constructor(){super(),this.encoder=new pp,this.decoder=new mp}}const Ap=new gp;class x{constructor(e,o){this.lat=e,this.lng=o,this.lat=e,this.lng=o}min(e){return new x(Lc(this.lat,e.lat),Lc(this.lng,e.lng))}max(e){return new x(Mc(this.lat,e.lat),Mc(this.lng,e.lng))}toString(){return`${this.lat}, ${this.lng}`}}class Cp{unitCodec;constructor(e){this.unitCodec=e}convert(e){return[this.unitCodec.encode(e.lat.value),this.unitCodec.encode(e.lng.value)]}}class yp{unitCodec;constructor(e){this.unitCodec=e}convert(e){if(!(e instanceof Array))throw new p(typeof e,"Array");if(e.length!==2)throw new TypeError(`Expected array of length 2, got ${e.length}`);const[o,n]=e;return new x(new N(this.unitCodec.decode(o)),new I(this.unitCodec.decode(n)))}}class zc extends c{encoder;decoder;constructor(e){super(),this.encoder=new Cp(e),this.decoder=new yp(e)}}const Jc=new zc(fp),Fc=new zc(Ap),Gc=new L(new O(Jc),new P(Jc));new L(new O(Fc),new P(Fc));class bp{convert(e){return[Number(e.lng),Number(e.lat)]}}class Sp{convert(e){if(!(e instanceof Array))throw new p(typeof e,"Array");if(e.length!==2)throw new TypeError(`Expected array of length 2, got ${e.length}`);return new x(new N(new H(e[1])),new I(new H(e[0])))}}class kp extends c{encoder=new bp;decoder=new Sp}const It=new kp,Re=new E(new v(It),new B(It)),Ne=new E(new v(Re),new B(Re)),qc=new E(new v(Ne),new B(Ne)),sn="LineString";class Qc extends Ce{type=sn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=np(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return jc.encode(this)}}class vp{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates)}}}class Bp{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,sn);const o=this.codec.decode(e.coordinates);return new Qc(o)}}class Ep extends c{encoder=new vp(Re);decoder=new Bp(Re)}const jc=new Ep;ye(sn,jc);const cn="MultiLineString";class xp extends Ce{type=cn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=Ze(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return $c.encode(this)}}class Rp{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates))}}}class Np{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,cn);const o=this.codec.decode(e.coordinates);return new xp(o.map(n=>new Qc(n)))}}class Ip extends c{encoder=new Rp(Ne);decoder=new Np(Ne)}const $c=new Ip;ye(cn,$c);const an="Point";class Dt extends Ce{type=an;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=new nn(this.coordinates,this.coordinates)}toJSON(){return Xc.encode(this)}}class Dp{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates)}}}class Tp{codec;constructor(e){this.codec=e}convert(e){return i(e,"type","coordinates"),le(e,an),new Dt(this.codec.decode(e.coordinates))}}class Op extends c{encoder=new Dp(It);decoder=new Tp(It)}const Xc=new Op;ye(an,Xc);const dn="MultiPoint";class ln extends Ce{type=dn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=Ze(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return Yc.encode(this)}}class Pp{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates))}}}class Lp{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,dn);const o=this.codec.decode(e.coordinates);return new ln(o.map(n=>new Dt(n)))}}class Mp extends c{encoder=new Pp(Re);decoder=new Lp(Re)}const Yc=new Mp;ye(dn,Yc);const un="Polygon";class Kc extends Ce{type=un;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=Ze(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return Zc.encode(this)}}class Vp{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates.map(n=>n.coordinates)))}}}class Up{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,un);const o=this.codec.decode(e.coordinates);return new Kc(o.map(n=>new ln(n.map(r=>new Dt(r)))))}}class Hp extends c{encoder=new Vp(Ne);decoder=new Up(Ne)}const Zc=new Hp;ye(un,Zc);const hn="MultiPolygon";class Wp extends Ce{type=hn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=Ze(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return ea.encode(this)}}class _p{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates.map(n=>n.coordinates.map(r=>r.coordinates))))}}}class zp{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,hn);const o=this.codec.decode(e.coordinates);return new Wp(o.map(n=>new Kc(n.map(r=>new ln(r.map(s=>new Dt(s)))))))}}class Jp extends c{encoder=new _p(qc);decoder=new zp(qc)}const ea=new Jp;ye(hn,ea);class Ie{inputMin;inputMax;outputMin;outputMax;inputRangeInv;outputRange;constructor(e,o,n,r){this.inputMin=e,this.inputMax=o,this.outputMin=n,this.outputMax=r,this.inputRangeInv=1/(this.inputMax-this.inputMin),this.outputRange=this.outputMax-this.outputMin}transform(e){return(e-this.inputMin)*this.inputRangeInv*this.outputRange+this.outputMin}static identity=new Ie(0,1,0,1)}class Z extends Ke{toString(){return`${Number(this)} dp`}}class Fp{minInput;maxInput;minOutput;maxOutput;horizontalAffine;inverseHorizontalAffine;verticalAffine;inverseVerticalAffine;constructor(e,o,n,r){this.minInput=e,this.maxInput=o,this.minOutput=n,this.maxOutput=r,this.horizontalAffine=new Ie(Number(e.lat),Number(o.lat),Number(n.lat),Number(r.lat)),this.inverseHorizontalAffine=new Ie(Number(n.lat),Number(r.lat),Number(e.lat),Number(o.lat)),this.verticalAffine=new Ie(Number(e.lng),Number(o.lng),Number(n.lng),Number(r.lng)),this.inverseVerticalAffine=new Ie(Number(n.lng),Number(r.lng),Number(e.lng),Number(o.lng))}project(e){return new x(new N(new Z(this.horizontalAffine.transform(Number(e.lat)))),new I(new Z(this.verticalAffine.transform(Number(e.lng)))))}inverseProject(e){const o=new K(this.inverseHorizontalAffine.transform(Number(e.lat))),n=new K(this.inverseVerticalAffine.transform(Number(e.lng)));return new x(new N(o),new I(n))}}class Gp{minInput=new x(new N(new H(-90)),new I(new H(-180)));maxInput=new x(new N(new H(90)),new I(new H(180)));minOutput=new x(new N(new K(-Math.PI/2)),new I(new K(-Math.PI)));maxOutput=new x(new N(new K(Math.PI/2)),new I(new K(Math.PI)));projectLatitude(e){return new N(this.convertDegreesToRadians(e))}convertDegreesToRadians(e){return new K(Number(e)*(Math.PI/180))}convertRadiansToDegrees(e){return new H(Number(e)*(180/Math.PI))}projectLongitude(e){return new I(this.convertDegreesToRadians(e))}inverseProjectLatitude(e){return new N(this.convertRadiansToDegrees(e))}inverseProjectLongitude(e){return new I(this.convertRadiansToDegrees(e))}project(e){return new x(this.projectLatitude(e.lat),this.projectLongitude(e.lng))}inverseProject(e){return new x(this.inverseProjectLatitude(e.lat),this.inverseProjectLongitude(e.lng))}}const ta=new Gp,oa=85.05133;class V{static min=ta.project(new x(new N(new H(-oa)),new I(new H(-180))));static max=ta.project(new x(new N(new H(oa)),new I(new H(180))));static minProjection=V.staticProject(V.min);static maxProjection=V.staticProject(V.max);minInput=V.min;maxInput=V.max;minOutput=V.minProjection;maxOutput=V.maxProjection;static projectLongitude(e){return new I(Number(e))}static ensureLatitudeBounds(e){return Nt(e,V.max.lat)?V.max.lat:on(e,V.min.lat)?V.min.lat:e}static projectLatitude(e){return new N(Math.log(Math.tan(Math.PI/4+Number(this.ensureLatitudeBounds(e))/2)))}static inverseProjectLongitude(e){return new I(new K(Number(e)))}static inverseProjectLatitude(e){return new N(new K(2*Math.atan(Math.exp(Number(e)))-Math.PI/2))}static staticProject(e){return new x(this.projectLatitude(e.lat),this.projectLongitude(e.lng))}project(e){return V.staticProject(e)}static staticInverseProject(e){return new x(this.inverseProjectLatitude(e.lat),this.inverseProjectLongitude(e.lng))}inverseProject(e){return V.staticInverseProject(e)}}const qp="AwABAQEcDQABDA0AAQYNAAEEDgABgAwAAQINAAEWAWEMAAF6AfgMAAH/AfIMAAH/AfwMAAH/AfgMAAH/AeAMAAF/AdAMAAF/AfAMAAF/AeAMAAF/AeAMAAE/AfAMAAEfAfAMAAEfAfwMAAE/AfwMAAF/Af4MAAF/Af8BgAsAAT8B/wHgCgABHwE/Av8BgAkAAZ8BPwL/AeAIAAEDAUwBPwL/AfAIAAEDAU8B3wL/AfgIAAEFAUMBzwL/AfoIAAEMAWMB7wL/Af0IAAEBAaMB7wP/CQABZwHPA/8BgAcAATgBoAHvA/8B4AcAARwBQAFvA/8B4AcAAYQB7gEPA/8B8AcAAQwBDgEvAv8B/gEwBgABAwGBAS8BzwHvAf8B/AEQBgABAwH4AYwBfwGDAf8B/AEYBgABCAHyAeMBHwEDAf8B/AE4BgABHgF9AS8BhgEBAf8B/AEIBgABKwHXAWwBvQGBAf8B/AEOBgABHgH/AW8B+QEBAf8B/gcAAe4B/wEHAYABQAE/AfABAAEYBQABfwH8AQcBwQHpAf8B8AHBAT4FAAH/AdgBAwHgAX8B/wHAAQMB/wGAAQABoAIAAf8BwAEBAfcBPwH/AQABAwH/AcABHQH8AgAB/gEIAQABfwGfAfYBAAEjAf8BxwH/AfgCAAH+AR8BgAFfAUcB7AEAAQMD/wHkAgABfQGfAYABDQGPAf4BAAEDAv8B/gMAATEB/wEAAQQBDwHkAQABAwL/AfgDAAEPAf8BgAEAAQEB4AEAAQEC/wHwAwABFwH/AYABAAEBAdACAAL/AfADAAEfAf8B8AIAAZACAAL/AcADAAEHAf8B/gFMBAAC/wHAAwABDwL/AV8EAAF/Af8BgAMAAT8D/wHAAwABHwH+BAABfwP/AeADAAEfAfgEAAFfA/8B8AMAAQ8B8AQABP8BgAMAAQ8B8AQAAX8C/wH8BAABDwHAAwABAwP/AfwEAAEGBAABAwF/Av8B+AkAAQMD/wHgCQABAwHvAv8B8AkAAQEC/wH+AeAKAAFnAf8B+wFACgABXwH+AbgBgAoAAQ8BogFQAQMKAAEGAQABIAEDCgABDgIAAQMDAAH8BgABDAUAAQEB/wwAAQMB/woAAQEBgQHPAf8BgAkAAQYBAQL/AYAJAAEFAdEB3wH/AYAKAALfAf8LAAI/Af8LAAF+AT8B/woAAXgB/gE/Af8BgAkAAXsB/QG/Af8BgAYAAWABAAEBAfkB/gEPAf8B+AYAATwBAAEXAf4B/QEPAv8B8AUAAXsBAAEfAfwB/gHHAv8B/gUAAZgBAAE/AZQB/gEHA/8BwAQAAZgBAAE/AQMB/wGPA/8BwAQAAeQBAAF8AesB/wFHA/8BwAQAAcABAAF/Ae8B/wFHA/8BwAYAAX8B7wH+AccD/wGABgABPwH/AfgBxwP/BwABPwH/Af0B5QL/AfwHAAE8Af8B+AHOAX8B/wHgBwABHQH/AfwB/wEfAf8BwAcAAQ8B/wH+Af8BzwHxAYAHAAEHA/8B9wHgCAABFwP/AfsBwAF8BQABgAEAAQcB/wH5Af8B+wGAAXgEAAEDAYABAAEvAf8B+AE8AfoBAAGABgABAQEfAf8B+wE+AfAIAAEPAY8C/wH+AfAGAAEGAQABOAGfA/8BYAYAAQEBAAFgAV8D/wkAAcABPwP/BwABAgEAAYABPwP/CAABAQGAAV8D/wkAAQME/wGACAABAwH7A/8BwAgAAQUBbwP/AfgIAAEBAd8D/wH+CAABBwT/Af4IAAEFBP8B8QgAAQcE/wHgCAABDwT/AcAIAAE/BP8BgAgAAX8E/wGABgABAwGAAX8E/wHABgABAwFgBf8B8AGABgABcAF/BP8B+AFABgABCAX/AfgBoAYAARsF/wH8AVgGAAEDBf8B/gEcBwAF/wHMAQQHAAHvBP8B4AEwBwABfwT/AcABcAcAAQcE/wGAAXABDwYAAQcE/wGAAeABHwHABQABAwP/Ab4BAAEYAR8BwAUAAQMD/wGAAQEBKAE/AcAFAAEPA/8BgAEFARIBfwGABQABBwP/AeACAAF/AYAGAAP/AwABfwGABgAC/wH+ARABAAEQAf8BgAYAAv8B/gMAAf8BgAYAAf8B/gH8ATABAAEIAf8BwAUAAWIB/wH8AfABIAEAAQwBPwHgBQABawH/AfABAgGAAQABDgH/AfAFAAFDAf8B8AECAgABDAF/AfAFAAEBAf8B8AMAAQQBHwH2BQABIQH/AfADAAECAQ8B8AYAAf8B8AQAAQcBwAYAAf8B8AwAAf8B4wGACwAB/wHHAYALAAE/Ae8DAAECCAABPwGQDAABPwHgDAABfwHgBQABAQYAAV8B4AUAAQMGAAE/AcAFAAEGBgABPwHABQABHAYAAT4BgAgA";function Qp(t){const e=new DataView(t),o=new Array(t.byteLength*8),n=t.byteLength;for(let r=0;r<n;r++){const s=e.getUint8(r);for(let a=0;a<8;a++){const d=7-a,w=r;o[w*8+a]=!!(s&1<<d)}}return o}function jp(t){const e=new DataView(t),o=t.byteLength;let n=0;for(let a=0;a<o;a+=2)n+=e.getUint8(a);const r=new ArrayBuffer(n),s=new DataView(r);for(let a=0,d=0;a<o;a+=2){const w=e.getUint8(a),h=e.getUint8(a+1);for(let y=0;y<w;y++)s.setUint8(d++,h)}return r}const Tt=new Z(1344),$p=new Z(Math.floor(Number(Tt)*.75)),et=new Z(9),Xp=Tt,Yp=Tt;new Fp(V.minProjection,V.maxProjection,new x(new N(Yp),new I(new Z(0))),new x(new N(new Z(0)),new I(Xp)));const Kp=Tt,Zp=$p,na=new Z(Math.floor(Number(et)/2)),em=Math.floor(Number(Kp)/Number(et)),tm=Math.floor(Number(Zp)/Number(et)),om=Array.from($(Lo(tm),t=>new N(new Z(t*Number(et)+Number(na))))),nm=Array.from($(Lo(em),t=>new I(new Z(t*Number(et)+Number(na))))),ra=Array.from(Po(nm,t=>$(om,e=>new x(e,t))));Math.ceil(ra.length/8);const rm=Do.decodeString(qp),sm=jp(rm),cm=Qp(sm),am=Mo(ra,cm,(t,e)=>[t,e]),im=Oo(am,([,t])=>t),dm=$(im,([t])=>t);Array.from(dm);class wn{width;index;constructor(e,o){this.width=e,this.index=o}toJSON(){return fn.encode(this)}}class lm{convert(e){return i(e,"width","index"),new wn(u.decode(e.width),u.decode(e.index))}}class um{convert(e){return m(e,wn),{width:u.encode(e.width),index:u.encode(e.index)}}}class hm extends c{encoder=new um;decoder=new lm}const fn=new hm;class De{static get lsb0(){return fm}static get msb0(){return mm}valueOf(){return this.toString()}toJSON(){return this.toString()}}const sa="bitvec::order::Lsb0",ca="bitvec::order::Msb0";class wm extends De{toString(){return sa}}const fm=new wm;class pm extends De{toString(){return ca}}const mm=new pm;class gm{convert(e){if(typeof e!="string")throw new p(typeof e,"string");switch(e){case sa:return De.lsb0;case ca:return De.msb0;default:throw new p(e,"CappuccinoAPIBitVecOrder")}}}class Am{convert(e){return e.toString()}}class Cm extends c{encoder=new Am;decoder=new gm}const aa=new Cm;class pn{order;head;bits;data;constructor(e,o,n,r){this.order=e,this.head=o,this.bits=n,this.data=r}getBitVecIndexIterable(){return this.order===De.lsb0?new Bm(this.head.width,this.bits):new xm(this.head.width,this.bits)}[Symbol.iterator](){const e=this.getBitVecIndexIterable();return $(e,o=>km(this.data,o))[Symbol.iterator]()}toJSON(){return be.encode(this)}}class ym{convert(e){return i(e,"order","head","bits","data"),new pn(aa.decode(e.order),fn.decode(e.head),u.decode(e.bits),he.decode(e.data))}}class bm{convert(e){return m(e,pn),{order:aa.encode(e.order),head:fn.encode(e.head),bits:u.encode(e.bits),data:he.encode(e.data)}}}class Sm extends c{encoder=new bm;decoder=new ym}const be=new Sm,ia=new E(new v(be),new B(be));function km(t,e){return(t[e.bucket]>>e.bitOffset&1)===1}class da{bucket;bitOffset;constructor(e,o){this.bucket=e,this.bitOffset=o}}function la(t){switch(T(t===8||t===16||t===32,"bit width should be a power of two that is supported"),t){case 8:return 3;case 16:return 4;case 32:return 5;default:throw new _}}class vm{totalBits;bitWidthMask;bitWidthShift;offset=0;constructor(e,o){this.totalBits=o;const n=la(e);this.bitWidthMask=e-1,this.bitWidthShift=n}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,o=this.offset&this.bitWidthMask;return this.offset+=1,{done:!1,value:new da(e,o)}}}class Bm{bitWidth;totalBits;constructor(e,o){this.bitWidth=e,this.totalBits=o}[Symbol.iterator](){return new vm(this.bitWidth,this.totalBits)}}class Em{bitWidth;totalBits;bitWidthMask;bitWidthShift;offset=0;constructor(e,o){this.bitWidth=e,this.totalBits=o;const n=la(e);this.bitWidthMask=e-1,this.bitWidthShift=n}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,o=this.bitWidth-1-(this.offset&this.bitWidthMask);return this.offset+=1,{done:!1,value:new da(e,o)}}}class xm{bitWidth;totalBits;constructor(e,o){this.bitWidth=e,this.totalBits=o}[Symbol.iterator](){return new Em(this.bitWidth,this.totalBits)}}class ua{r;s;v;constructor(e,o,n){this.r=e,this.s=o,this.v=n}toJSON(){return mn.encode(this)}}class Rm{convert(e){return i(e,"r","s","v"),new ua(M.decode(e.r),M.decode(e.s),u.decode(e.v))}}class Nm{convert(e){return m(e,ua),{r:M.encode(e.r),s:M.encode(e.s),v:u.encode(e.v)}}}class Im extends c{encoder=new Nm;decoder=new Rm}const mn=new Im;class ha{account;amount;constructor(e,o){this.account=e,this.amount=o}toJSON(){return gn.encode(this)}}class Dm{convert(e){return i(e,"account","amount"),new ha(M.decode(e.account),M.decode(e.amount))}}class Tm{convert(e){return m(e,ha),{account:M.encode(e.account),amount:M.encode(e.amount)}}}class Om extends c{encoder=new Tm;decoder=new Dm}const gn=new Om;class wa{number;timestamp;hash;constructor(e,o,n){this.number=e,this.timestamp=o,this.hash=n}toJSON(){return An.encode(this)}}class Pm{convert(e){return i(e,"number","timestamp","hash"),new wa(u.decode(e.number),l.decode(e.timestamp),l.decode(e.hash))}}class Lm{convert(e){return m(e,wa),{number:u.encode(e.number),timestamp:l.encode(e.timestamp),hash:l.encode(e.hash)}}}class Mm extends c{encoder=new Lm;decoder=new Pm}const An=new Mm,fa=new L(new O(An),new P(An));class pa{bytes;constructor(e){this.bytes=e}toJSON(){return Cn.encode(this)}}class Vm{convert(e){return i(e,"bytes"),new pa(oc.decode(e.bytes))}}class Um{convert(e){return m(e,pa),{bytes:oc.encode(e.bytes)}}}class Hm extends c{encoder=new Um;decoder=new Vm}const Cn=new Hm;class ma{height;timestamp;l1_head;l1_finalized;payload_commitment;ns_table;block_merkle_root;fee_merkle_root;builder_signature;fee_info;constructor(e,o,n,r,s,a,d,w,h,y){this.height=e,this.timestamp=o,this.l1_head=n,this.l1_finalized=r,this.payload_commitment=s,this.ns_table=a,this.block_merkle_root=d,this.fee_merkle_root=w,this.builder_signature=h,this.fee_info=y}toJSON(){return tt.encode(this)}}class Wm{convert(e){return i(e,"height","timestamp","l1_head","l1_finalized","payload_commitment","ns_table","block_merkle_root","fee_merkle_root","builder_signature","fee_info"),new ma(u.decode(e.height),u.decode(e.timestamp),u.decode(e.l1_head),fa.decode(e.l1_finalized),he.decode(e.payload_commitment),Cn.decode(e.ns_table),A.decode(e.block_merkle_root),A.decode(e.fee_merkle_root),mn.decode(e.builder_signature),gn.decode(e.fee_info))}}class _m{convert(e){return m(e,ma),{height:u.encode(e.height),timestamp:u.encode(e.timestamp),l1_head:u.encode(e.l1_head),l1_finalized:fa.encode(e.l1_finalized),payload_commitment:he.encode(e.payload_commitment),ns_table:Cn.encode(e.ns_table),block_merkle_root:A.encode(e.block_merkle_root),fee_merkle_root:A.encode(e.fee_merkle_root),builder_signature:mn.encode(e.builder_signature),fee_info:gn.encode(e.fee_info)}}}class zm extends c{encoder=new _m;decoder=new Wm}const tt=new zm;class ga{vm;payload;constructor(e,o){this.vm=e,this.payload=o}toJSON(){return ot.encode(this)}}class Jm{convert(e){return i(e,"vm","payload"),new ga(u.decode(e.vm),he.decode(e.payload))}}class Fm{convert(e){return m(e,ga),{vm:u.encode(e.vm),payload:he.encode(e.payload)}}}class Gm extends c{encoder=new Fm;decoder=new Jm}const ot=new Gm;new E(new v(ot),new B(ot));class Aa{header;hash;size;num_transactions;proposer_id;constructor(e,o,n,r,s){this.header=e,this.hash=o,this.size=n,this.num_transactions=r,this.proposer_id=s}toJSON(){return yn.encode(this)}}class qm{convert(e){return i(e,"header","hash","size","num_transactions","proposer_id"),new Aa(tt.decode(e.header),A.decode(e.hash),u.decode(e.size),u.decode(e.num_transactions),se.decode(e.proposer_id))}}class Qm{convert(e){return m(e,Aa),{header:tt.encode(e.header),hash:A.encode(e.hash),size:u.encode(e.size),num_transactions:u.encode(e.num_transactions),proposer_id:se.encode(e.proposer_id)}}}class jm extends c{encoder=new Qm;decoder=new qm}const yn=new jm;new E(new v(yn),new B(yn));class Ca{hash;header;offset;transaction;constructor(e,o,n,r){this.hash=e,this.header=o,this.offset=n,this.transaction=r}toJSON(){return bn.encode(this)}}class $m{convert(e){return i(e,"hash","header","offset","transaction"),new Ca(A.decode(e.hash),tt.decode(e.header),u.decode(e.offset),ot.decode(e.transaction))}}class Xm{convert(e){return m(e,Ca),{hash:A.encode(e.hash),header:tt.encode(e.header),offset:u.encode(e.offset),transaction:ot.encode(e.transaction)}}}class Ym extends c{encoder=new Xm;decoder=new $m}const bn=new Ym;new E(new v(bn),new B(bn));class ya{signature;bitvec;constructor(e,o){this.signature=e,this.bitvec=o}toJSON(){return Sn.encode(this)}}class Km{convert(e){if(!ws(e)||e.length!==2)throw new p(typeof e,"Array");return new ya(A.decode(e[0]),be.decode(e[1]))}}class Zm{convert(e){return m(e,ya),[A.encode(e.signature),be.encode(e.bitvec)]}}class eg extends c{encoder=new Zm;decoder=new Km}const Sn=new eg;new L(new O(Sn),new P(Sn));class nt{}class kn extends nt{toJSON(){return vn.encode(this)}}class tg{convert(e){if(!ee(e)||e!=="Empty")throw new ne;return new kn}}class og{convert(e){return m(e,kn),"Empty"}}class ng extends c{encoder=new og;decoder=new tg}const vn=new ng;class Bn extends nt{value;pos;elem;constructor(e,o,n){super(),this.value=e,this.pos=o,this.elem=n}toJSON(){return En.encode(this)}}class rg{convert(e){i(e,"Leaf");const o=e.Leaf;return i(o,"value","pos","elem"),new Bn(A.decode(o.value),A.decode(o.pos),A.decode(o.elem))}}class sg{convert(e){return m(e,Bn),{Leaf:{value:A.encode(e.value),pos:A.encode(e.pos),elem:A.encode(e.elem)}}}}class cg extends de{encoder=new sg;decoder=new rg}const En=new cg;class xn extends nt{value;constructor(e){super(),this.value=e}toJSON(){return Rn.encode(this)}}class ag{convert(e){i(e,"ForgettenSubtree");const o=e.ForgettenSubtree;return i(o,"value"),new xn(A.decode(o.value))}}class ig{convert(e){return m(e,xn),{ForgettenSubtree:{value:A.encode(e.value)}}}}class dg extends de{encoder=new ig;decoder=new ag}const Rn=new dg;class Nn extends nt{value;children;constructor(e,o){super(),this.value=e,this.children=o}toJSON(){return In.encode(this)}}class lg{convert(e){i(e,"Branch");const o=e.Branch;return i(o,"value","children"),new Nn(A.decode(o.value),Sa.decode(o.children))}}class ug{convert(e){return m(e,Nn),{Branch:{value:A.encode(e.value),children:Sa.encode(e.children)}}}}class hg extends c{encoder=new ug;decoder=new lg}const In=new hg;class wg{convert(e){if(Kt(e,"Leaf",ut))return En.decoder.convert(e);if(Kt(e,"Branch",ut))return In.decoder.convert(e);if(Kt(e,"ForgettenSubtree",ut))return Rn.decoder.convert(e);if(ee(e))return vn.decoder.convert(e);throw new ne}}class fg{convert(e){if(m(e,nt),e instanceof Bn)return En.encode(e);if(e instanceof Nn)return In.encode(e);if(e instanceof xn)return Rn.encode(e);if(e instanceof kn)return vn.encode(e);throw new ne}}class pg extends c{encoder=new fg;decoder=new wg}const ba=new pg,Sa=new E(new v(ba),new B(ba));new Promise(()=>{});class Dn{hash;height;time;numTransactions;proposerID;feeRecipient;size;blockReward;constructor(e,o,n,r,s,a,d,w){this.hash=e,this.height=o,this.time=n,this.numTransactions=r,this.proposerID=s,this.feeRecipient=a,this.size=d,this.blockReward=w}toJSON(){return rt.encode(this)}}class mg{convert(e){return i(e,"hash","height","time","num_transactions","proposer_id","fee_recipient","size","block_reward"),new Dn(A.decode(e.hash),u.decode(e.height),ke.decode(e.time),u.decode(e.num_transactions),se.decode(e.proposer_id),se.decode(e.fee_recipient),u.decode(e.size),Cc.decode(e.block_reward))}}class gg{convert(e){return m(e,Dn),{hash:A.encode(e.hash),height:u.encode(e.height),time:ke.encode(e.time),num_transactions:u.encode(e.numTransactions),proposer_id:se.encode(e.proposerID),fee_recipient:se.encode(e.feeRecipient),size:u.encode(e.size),block_reward:Cc.encode(e.blockReward)}}}class Ag extends de{encoder=new gg;decoder=new mg}const rt=new Ag,ka=new E(new v(rt),new B(rt));class va{hash;height;proposerID;numTransactions;size;time;constructor(e,o,n,r,s,a){this.hash=e,this.height=o,this.proposerID=n,this.numTransactions=r,this.size=s,this.time=a}toJSON(){return Tn.encode(this)}}class Cg{convert(e){return i(e,"hash","height","proposer_id","num_transactions","size","time"),new va(A.decode(e.hash),u.decode(e.height),se.decode(e.proposer_id),u.decode(e.num_transactions),u.decode(e.size),ke.decode(e.time))}}class yg{convert(e){return m(e,va),{hash:A.encode(e.hash),height:u.encode(e.height),proposer_id:se.encode(e.proposerID),num_transactions:u.encode(e.numTransactions),size:u.encode(e.size),time:ke.encode(e.time)}}}class bg extends de{encoder=new yg;decoder=new Cg}const Tn=new bg;new E(new v(Tn),new B(Tn));function Sg(t,e){return t.blockHeights-e.blockHeights}class Ot{blockTime;blockSize;blockTransactions;blockHeights;constructor(e,o,n,r){const s=[],a=Math.min(e.length,o.length,n.length,r.length);for(let U=0;U<a;U++){const R=r[U];R!==null&&s.push({blockTime:e[U],blockSize:o[U],blockTransactions:n[U],blockHeights:R})}s.sort(Sg);const d=s[0].blockHeights,w=s[s.length-1].blockHeights,h=[],y=[],D=[],g=[];for(let U=d,R=0;U<=w;U++){const z=s[R];if(z.blockHeights!==U){h.push(null),y.push(null),D.push(null),g.push(null);continue}h.push(z.blockTime),y.push(z.blockSize),D.push(z.blockTransactions),g.push(z.blockHeights),R++}const f=Math.max(0,g.length-50);this.blockTime=h.slice(f),this.blockSize=y.slice(f),this.blockTransactions=D.slice(f),this.blockHeights=g.slice(f)}toJSON(){return On.encode(this)}}class kg{convert(e){return i(e,"block_time","block_size","block_transactions","block_heights"),new Ot(oe.decode(e.block_time),oe.decode(e.block_size),oe.decode(e.block_transactions),oe.decode(e.block_heights))}}class vg{convert(e){return m(e,Ot),{block_time:oe.encode(e.blockTime),block_size:oe.encode(e.blockSize),block_transactions:oe.encode(e.blockTransactions),block_heights:oe.encode(e.blockHeights)}}}class Bg extends c{encoder=new vg;decoder=new kg}const On=new Bg,Ba=he;class Ea{hash;rollups;height;time;offset;numTransactions;constructor(e,o,n,r,s,a){this.hash=e,this.rollups=o,this.height=n,this.time=r,this.offset=s,this.numTransactions=a}toJSON(){return Pn.encode(this)}}class Eg{convert(e){return i(e,"hash","rollups","height","time","offset","num_transactions"),new Ea(A.decode(e.hash),Ba.decode(e.rollups),u.decode(e.height),ke.decode(e.time),u.decode(e.offset),u.decode(e.num_transactions))}}class xg{convert(e){return m(e,Ea),{hash:A.encode(e.hash),rollups:Ba.encode(e.rollups),height:u.encode(e.height),time:ke.encode(e.time),offset:u.encode(e.offset),num_transactions:u.encode(e.numTransactions)}}}class Rg extends c{encoder=new xg;decoder=new Eg}const Pn=new Rg;new E(new v(Pn),new B(Pn));const xa=u;class Ra{namespace;payload;constructor(e,o){this.namespace=e,this.payload=o}toJSON(){return Ln.encode(this)}}class Ng{convert(e){return i(e,"namespace","payload"),new Ra(xa.decode(e.namespace),yt.decode(e.payload))}}class Ig{convert(e){return m(e,Ra),{namespace:xa.encode(e.namespace),payload:yt.encode(e.payload)}}}class Dg extends c{encoder=new Ig;decoder=new Ng}const Ln=new Dg;new E(new v(Ln),new B(Ln));class Na{constructor(e,o){this.height=e,this.address=o,Object.freeze(this)}toJSON(){return Mn.encode(this)}}class Tg{convert(e){return i(e,"height","address"),new Na(u.decode(e.height),l.decode(e.address))}}class Og{convert(e){return m(e,Na),{height:u.encode(e.height),address:l.encode(e.address)}}}class Pg extends c{encoder=new Og;decoder=new Tg}const Mn=new Pg;new L(new O(Mn),new P(Mn));class Ia{constructor(e,o){this.lifetimeRewards=e,this.authData=o,Object.freeze(this)}toJSON(){return Vn.encode(this)}}class Lg{convert(e){return i(e,"lifetime_rewards","auth_data"),new Ia(F.decode(e.lifetime_rewards),M.decode(e.auth_data))}}class Mg{convert(e){return m(e,Ia),{lifetime_rewards:F.encode(e.lifetimeRewards),auth_data:M.encode(e.authData)}}}class Vg extends c{encoder=new Mg;decoder=new Lg}const Vn=new Vg;new L(new O(Vn),new P(Vn));class Da{coords;country;constructor(e,o){this.coords=e,this.country=o}toJSON(){return Un.encode(this)}}class Ug{convert(e){return{coords:Gc.encode(e.coords),country:J.encode(e.country)}}}class Hg{convert(e){return i(e,"coords","country"),new Da(Gc.decode(e.coords),Se(J.decode(e.country)))}}class Wg extends c{encoder=new Ug;decoder=new Hg}const Un=new Wg,Ta=new L(new O(Un),new P(Un));class Oa{publicKey;name;publicURL;company;companyWebsite;location;operatingSystem;nodeType;networkType;constructor(e,o,n,r,s,a,d,w,h){this.publicKey=e,this.name=o,this.publicURL=n,this.company=r,this.companyWebsite=s,this.location=a,this.operatingSystem=d,this.nodeType=w,this.networkType=h}toJSON(){return st.encode(this)}}class _g{convert(e){return{public_key:A.encode(e.publicKey),name:J.encode(e.name),public_url:St.encode(e.publicURL),company:J.encode(e.company),company_website:St.encode(e.companyWebsite),location:Ta.encode(e.location),operating_system:J.encode(e.operatingSystem),node_type:J.encode(e.nodeType),network_type:J.encode(e.networkType)}}}class zg{convert(e){return i(e,"public_key","name","public_url","company","company_website","location","operating_system","node_type","network_type"),new Oa(A.decode(e.public_key),Se(J.decode(e.name)),St.decode(e.public_url),Se(J.decode(e.company)),St.decode(e.company_website),Ta.decode(e.location),Se(J.decode(e.operating_system)),Se(J.decode(e.node_type)),Se(J.decode(e.network_type)))}}class Jg extends c{encoder=new _g;decoder=new zg}const st=new Jg,Pa=new E(new v(st),new B(st));class q{}const La="SubscribeNodeIdentity";class Hn extends q{valueOf(){return La}}const Ma="SubscribeLatestBlock";class Wn extends q{valueOf(){return Ma}}const Va="SubscribeVoters";class _n extends q{valueOf(){return Va}}const Ua="SubscribeValidators";class Fg extends q{valueOf(){return Ua}}const Ha="SubscribeStakeTables";class Gg extends q{valueOf(){return Ha}}const Wa="RequestNodeIdentitySnapshot";class zn extends q{valueOf(){return Wa}}const _a="RequestBlocksSnapshot";class Jn extends q{valueOf(){return _a}}const za="RequestHistogramSnapshot";class Fn extends q{valueOf(){return za}}const Ja="RequestVotersSnapshot";class Gn extends q{valueOf(){return Ja}}const Fa="RequestValidatorsSnapshot";class Ga extends q{valueOf(){return Fa}}const qa="RequestStakeTableSnapshot";class Qa extends q{valueOf(){return qa}}class qg{convert(e){return e.valueOf()}}class Qg{convert(e){if(typeof e!="string")throw new p(typeof e,"string");switch(e){case La:return new Hn;case Ma:return new Wn;case Va:return new _n;case Wa:return new zn;case _a:return new Jn;case za:return new Fn;case Ja:return new Gn;case Ua:return new Fg;case Ha:return new Gg;case Fa:return new Ga;case qa:return new Qa;default:throw new p(e,"CappuccinoNodeValidatorRequest")}}}class jg extends c{encoder=new qg;decoder=new Qg}const qn=new jg,ct="NodeValidatorRequest";class Pt extends cc{request;get type(){return ct}constructor(e){super(),this.request=e}toJSON(){return ja.encode(this)}}class $g{convert(e){return{[ct]:qn.encode(e.request)}}}class Xg{convert(e){return i(e,ct),new Pt(qn.decode(e[ct]))}}class Yg extends c{encoder=new $g;decoder=new Xg}const ja=new Yg;class Q{}const Lt="BlocksSnapshot";class Qn extends Q{blocks;constructor(e){super(),this.blocks=e}toJSON(){return jn.encode(this)}}class Kg{convert(e){i(e,Lt);const o=e[Lt];return new Qn(ka.decode(o))}}class Zg{convert(e){return{[Lt]:ka.encode(e.blocks)}}}class eA extends c{encoder=new Zg;decoder=new Kg}const jn=new eA,Mt="HistogramSnapshot";class Vt extends Q{histograms;constructor(e){super(),this.histograms=e}toJSON(){return $n.encode(this)}}class tA{convert(e){return i(e,Mt),new Vt(On.decode(e[Mt]))}}class oA{convert(e){return{[Mt]:On.encode(e.histograms)}}}class nA extends c{encoder=new oA;decoder=new tA}const $n=new nA,Ut="LatestBlock";class Ht extends Q{latestBlock;constructor(e){super(),this.latestBlock=e}toJSON(){return Xn.encode(this)}}class rA{convert(e){return i(e,Ut),new Ht(rt.decode(e[Ut]))}}class sA{convert(e){return{[Ut]:rt.encode(e.latestBlock)}}}class cA extends c{encoder=new sA;decoder=new rA}const Xn=new cA,Wt="LatestStakeTable";class Yn extends Q{stakeTable;constructor(e){super(),this.stakeTable=e}toJSON(){return Kn.encode(this)}}class aA{convert(e){return i(e,Wt),new Yn(Rt.decode(e[Wt]))}}class iA{convert(e){return{[Wt]:Rt.encode(e.stakeTable)}}}class dA extends c{encoder=new iA;decoder=new aA}const Kn=new dA,_t="LatestVoters";class Zn extends Q{latestVoter;constructor(e){super(),this.latestVoter=e}toJSON(){return er.encode(this)}}class lA{convert(e){return i(e,_t),new Zn(be.decode(e[_t]))}}class uA{convert(e){return{[_t]:be.encode(e.latestVoter)}}}class hA extends c{encoder=new uA;decoder=new lA}const er=new hA,zt="NodeIdentitySnapshot";class Jt extends Q{nodes;constructor(e){super(),this.nodes=e}toJSON(){return tr.encode(this)}}class wA{convert(e){i(e,zt);const o=e[zt];return new Jt(Pa.decode(o))}}class fA{convert(e){return{[zt]:Pa.encode(e.nodes)}}}class pA extends c{encoder=new fA;decoder=new wA}const tr=new pA,Ft="LatestNodeIdentity";class $a extends Q{nodeIdentity;constructor(e){super(),this.nodeIdentity=e}toJSON(){return or.encode(this)}}class mA{convert(e){return i(e,Ft),new $a(st.decode(e[Ft]))}}class gA{convert(e){return{[Ft]:st.encode(e.nodeIdentity)}}}class AA extends c{encoder=new gA;decoder=new mA}const or=new AA,Gt="LatestValidator";class Xa extends Q{validator;constructor(e){super(),this.validator=e}toJSON(){return nr.encode(this)}}class CA{convert(e){return i(e,Gt),new Xa(xe.decode(e[Gt]))}}class yA{convert(e){return{[Gt]:xe.encode(e.validator)}}}class bA extends c{encoder=new yA;decoder=new CA}const nr=new bA,qt="StakeTableSnapshot";class Ya extends Q{stakeTable;constructor(e){super(),this.stakeTable=e}toJSON(){return rr.encode(this)}}class SA{convert(e){i(e,qt);const o=e[qt];return new Ya(Rt.decode(o))}}class kA{convert(e){return{[qt]:Rt.encode(e.stakeTable)}}}class vA extends c{encoder=new kA;decoder=new SA}const rr=new vA,Qt="ValidatorsSnapshot";class sr extends Q{validators;constructor(e){super(),this.validators=e}toJSON(){return cr.encode(this)}}class BA{convert(e){i(e,Qt);const o=e[Qt];return new sr(Pc.decode(o))}}class EA{convert(e){return{[Qt]:Pc.encode(e.validators)}}}class xA extends c{encoder=new EA;decoder=new BA}const cr=new xA,jt="VotersSnapshot";class ar extends Q{voters;constructor(e){super(),this.voters=e}toJSON(){return ir.encode(this)}}class RA{convert(e){i(e,jt);const o=e[jt];return new ar(ia.decode(o))}}class NA{convert(e){return{[jt]:ia.encode(e.voters)}}}class IA extends c{encoder=new NA;decoder=new RA}const ir=new IA;class DA{convert(e){if(G(e,Lt))return jn.decode(e);if(G(e,Mt))return $n.decode(e);if(G(e,Ut))return Xn.decode(e);if(G(e,Ft))return or.decode(e);if(G(e,_t))return er.decode(e);if(G(e,Gt))return nr.decode(e);if(G(e,Wt))return Kn.decode(e);if(G(e,zt))return tr.decode(e);if(G(e,jt))return ir.decode(e);if(G(e,Qt))return cr.decode(e);if(G(e,qt))return rr.decode(e);throw new _}}class TA{convert(e){if(e instanceof Qn)return jn.encode(e);if(e instanceof Vt)return $n.encode(e);if(e instanceof Ht)return Xn.encode(e);if(e instanceof $a)return or.encode(e);if(e instanceof Zn)return er.encode(e);if(e instanceof Xa)return nr.encode(e);if(e instanceof Yn)return Kn.encode(e);if(e instanceof Jt)return tr.encode(e);if(e instanceof ar)return ir.encode(e);if(e instanceof sr)return cr.encode(e);if(e instanceof Ya)return rr.encode(e);throw new _}}class OA extends c{encoder=new TA;decoder=new DA}const $t=new OA,at="NodeValidatorResponse";class Ka extends Jo{response;get type(){return at}constructor(e){super(),this.response=e}toJSON(){return Za.encode(this)}}class PA{convert(e){return{[at]:$t.encode(e.response)}}}class LA{convert(e){i(e,at);const o=e[at];return new Ka($t.decode(o))}}class MA extends c{encoder=new PA;decoder=new LA}const Za=new MA;class VA{convert(e){return new Ka(e)}}const dr=new VA;function lr(t){return new Dn(t.hash,t.height,t.time,t.numTransactions,t.proposer,t.proposer,t.size,t.fees)}function ei(t){return new Oa(t.pubkey,t.name,null,t.company.name,new URL(t.company.website),new Da(new x(new N(new H(t.location.coords[0])),new I(new H(t.location.coords[1]))),t.location.country),t.operatingSystem,t.nodeType,t.networkType)}class ur{responseStream;requestStream;lifecycleResponseSink;nodeValidatorResponseSink;constructor(e,o){this.requestStream=e,this.responseStream=o,this.lifecycleResponseSink=ge(pe(o),jo),this.nodeValidatorResponseSink=ge(pe(o),dr)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}prng=new ie(Et());latestBlock=lr(xc());latestBlocks=we(50);latestVoters=we(50);histogramBlockTimeData=we(50);histogramBlockSizeData=we(50);histogramBlockTransactionData=we(50);generateVotersFromBlockDetail(e){const o=new ie(e.time.valueOf()),n=Ae.length,r=Math.ceil(n/16),s=new Uint16Array(o.fillBytes(r*2));return new pn(De.lsb0,new wn(16,0),n,Array.from(s))}histogramBlockHeightData=we(50);async updateBlockDetails(e){const o=this.latestBlock,n=(e.time.valueOf()-o.time.valueOf())/1e3,r=this.generateVotersFromBlockDetail(e);this.latestBlock=e,this.latestBlocks.put(e),this.latestVoters.put(r),this.histogramBlockTimeData.put(n),this.histogramBlockSizeData.put(e.size),this.histogramBlockTransactionData.put(e.numTransactions),this.histogramBlockHeightData.put(e.height),this.isConnected&&(this.isSubscribedToLatestBlock&&await this.nodeValidatorResponseSink.send(new Ht(e)),this.isSubscribedToVoters&&this.nodeValidatorResponseSink.send(new Zn(r)))}async initializeState(){for await(const e of Lf(this.prng))this.updateBlockDetails(lr(e));await this.nodeValidatorResponseSink.send(new Ht(this.latestBlock)),await this.nodeValidatorResponseSink.send(new Vt(new Ot(Array.from(this.histogramBlockTimeData.immutableIterable()),Array.from(this.histogramBlockSizeData.immutableIterable()),Array.from(this.histogramBlockTransactionData.immutableIterable()),Array.from(this.histogramBlockHeightData.immutableIterable())))),this.nodeValidatorResponseSink.send(new Jt(Ae.map(ei)))}async startProcessing(){await this.initializeState(),this.handleRequests(),this.streamBlocks()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async streamBlocks(){const e=this.latestBlock;for await(const o of Mf(this.prng,e.time.valueOf(),e.height)){const n=lr(o);this.updateBlockDetails(n)}}async handleRequest(e){if(e instanceof ze){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof Pt){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unrecognized request type",e)}async handleWebSocketCommand(e){if(e instanceof _e){await this.handleConnect();return}if(e instanceof He){await this.handleClose();return}}async handleNodeValidatorRequest(e){if(e instanceof Wn){await this.handleSubscribeLatestBlock();return}if(e instanceof Hn){await this.handleSubscribeNodeIdentity();return}if(e instanceof _n){await this.handleSubscribeVoters();return}if(e instanceof Jn){await this.handleRequestBlocksSnapshot();return}if(e instanceof Fn){await this.handleRequestHistogramSnapshot();return}if(e instanceof zn){await this.handleRequestNodeIdentitySnapshot();return}if(e instanceof Gn){await this.handleRequestVotersSnapshot();return}if(e instanceof Ga){await this.handleRequestValidatorsSnapshot();return}if(e instanceof Qa){await this.handleRequestStakeTableSnapshot();return}}isConnected=!1;isSubscribedToLatestBlock=!1;isSubscribedToVoters=!1;async handleConnect(){if(this.isConnected)throw new Error("already connected to WebSocket");this.isConnected=!0,await this.lifecycleResponseSink.send(new Qe),await this.lifecycleResponseSink.send(new $e)}async handleClose(){if(!this.isConnected)throw new Error("not connected to WebSocket");this.isConnected=!1,this.isSubscribedToLatestBlock=!1,this.isSubscribedToVoters=!1,await this.lifecycleResponseSink.send(new ve)}async assertIsConnected(){if(!this.isConnected)throw new Error("not connected to WebSocket")}async handleSubscribeLatestBlock(){await this.assertIsConnected(),this.isSubscribedToLatestBlock=!0}async handleSubscribeNodeIdentity(){await this.assertIsConnected()}async handleSubscribeVoters(){await this.assertIsConnected(),this.isSubscribedToVoters=!0}async handleRequestBlocksSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Qn(Array.from(this.latestBlocks.immutableIterable())))}async handleRequestHistogramSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Vt(new Ot(Array.from(this.histogramBlockTimeData.immutableIterable()),Array.from(this.histogramBlockSizeData.immutableIterable()),Array.from(this.histogramBlockTransactionData.immutableIterable()),Array.from(this.histogramBlockHeightData.immutableIterable()))))}async handleRequestNodeIdentitySnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Jt(Ae.map(ei)))}async handleRequestVotersSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new ar(Array.from(this.latestVoters.immutableIterable())))}async handleRequestValidatorsSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new sr(Ae.map(e=>{const o=new Tc(e.address);return new tn(o,e.pubkey,e.stateVerKey,e.stake,new Ko(e.commission),new Map([[o.toString(),e.stake]]))})))}async handleRequestStakeTableSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Yn(Ae.map(e=>new en(new Zo(e.pubkey,e.stake),e.stateVerKey))))}}class hr{responseStream;requestStream;capturedHAR;lifecycleResponseSink;nodeValidatorResponseSink;constructor(e,o,n){this.requestStream=e,this.responseStream=o,this.capturedHAR=n,this.lifecycleResponseSink=ge(pe(o),jo),this.nodeValidatorResponseSink=ge(pe(o),dr)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof ze){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof Pt){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unknown request type",e)}async handleWebSocketCommand(e){if(e instanceof _e){await this.handleConnect();return}if(e instanceof He){await this.handleClose();return}}async handleNodeValidatorRequest(e){if(e instanceof Wn){await this.handleSubscribeLatestBlock();return}if(e instanceof Hn){await this.handleSubscribeNodeIdentity();return}if(e instanceof _n){await this.handleSubscribeVoters();return}if(e instanceof Jn){await this.handleRequestBlocksSnapshot();return}if(e instanceof Fn){await this.handleRequestHistogramSnapshot();return}if(e instanceof zn){await this.handleRequestNodeIdentitySnapshot();return}if(e instanceof Gn){await this.handleRequestVotersSnapshot();return}}async handleConnect(){await this.lifecycleResponseSink.send(new Qe),await this.lifecycleResponseSink.send(new $e);const e=Po(this.capturedHAR.log.entries,r=>"_webSocketMessages"in r?r._webSocketMessages:[]),o=Oo(e,r=>r.type==="receive");let n=0;for(const r of o){if(n>0){const s=r.time*1e3-n*1e3;await $o(s)}n=r.time;try{const s=$t.decode(JSON.parse(r.data));await this.nodeValidatorResponseSink.send(s)}catch(s){console.error(`Failed to decode message: ${r.data}`,s);continue}}await this.lifecycleResponseSink.send(new ve)}async handleClose(){}async handleSubscribeLatestBlock(){}async handleSubscribeNodeIdentity(){}async handleSubscribeVoters(){}async handleRequestBlocksSnapshot(){}async handleRequestHistogramSnapshot(){}async handleRequestNodeIdentitySnapshot(){}async handleRequestVotersSnapshot(){}}const wr="WebSocketError";class it extends k{cause;constructor(e,o=`websocket error: ${String(e)}`){super(o),this.cause=e,Object.freeze(this)}get code(){return wr}}class UA{convert(e){return i(e,"code","message"),b(e,wr),new it({},l.decode(e.message))}}class HA extends W{}class WA extends c{encoder=new HA;decoder=new UA}const _A=new WA;S(wr,_A);class zA{completer;lifecycleResponseSink;onClose;constructor(e,o,n){this.completer=e,this.lifecycleResponseSink=o,this.onClose=n}async handleEvent(){await this.lifecycleResponseSink.send(new ve),this.completer.isCompleted||this.completer.completeError(new it(null,"web socket error: unknown error")),this.onClose()}}class JA{completer;errorResponseSink;constructor(e,o){this.completer=e,this.errorResponseSink=o}errorFromEvent(e){return"error"in e?new it(e.error):new it(null,"web socket error: unknown error")}handleEvent(e){const o=this.errorFromEvent(e);this.errorResponseSink.send(o),this.completer.isCompleted||this.completer.completeError(o)}}class FA{nodeValidatorResponseSink;constructor(e){this.nodeValidatorResponseSink=e}decodeMessage(e){return $t.decode(JSON.parse(e.data))}async relayMessage(e){try{await this.nodeValidatorResponseSink.send(e)}catch(o){console.error("attempt to publish message to response stream failed",o)}}async handleEvent(e){try{const o=this.decodeMessage(e);this.relayMessage(o)}catch(o){console.error("Failed to decode server message from web socket",o);return}}}class GA{completer;lifecycleResponseSink;constructor(e,o){this.completer=e,this.lifecycleResponseSink=o}handleEvent(e){this.completer.complete(e.target),this.lifecycleResponseSink.send(new $e)}}class qA{webSocket=null;constructor(e,o,n,r,s,a=d=>new WebSocket(d)){const d=a(e);d.addEventListener("open",n),d.addEventListener("message",o),d.addEventListener("close",r),d.addEventListener("error",s),d.addEventListener("close",()=>{d.removeEventListener("open",n),d.removeEventListener("message",o),d.removeEventListener("close",r),d.removeEventListener("error",s),this.webSocket=null}),this.webSocket=d}send(e){if(this.webSocket===null)throw new Error("WebSocket is not connected");this.webSocket.send(e)}async close(e=1e3,o="done"){if(this.webSocket===null)return;const n=ue();return this.webSocket.addEventListener("close",()=>{n.complete()}),this.webSocket.close(e,o),n.promise}}function QA(t,e,o,n,r,s=a=>new WebSocket(a)){return new qA(t,e,o,n,r,s)}const jA=1e3,$A=250,XA=5e3;class fr{responseStream;requestStream;serviceBaseURL;webSocketCreator;lifecycleResponseSink;nodeValidatorResponseSink;errorResponseSink;constructor(e,o,n,r=s=>new WebSocket(s)){this.requestStream=e,this.responseStream=o,this.serviceBaseURL=n,this.webSocketCreator=r,this.lifecycleResponseSink=ge(pe(o),jo),this.nodeValidatorResponseSink=ge(pe(o),dr),this.errorResponseSink=ge(pe(o),aw)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof ze){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof Pt){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unrecognized request",e)}async handleWebSocketCommand(e){if(e instanceof _e){await this.handleConnect();return}if(e instanceof He){await this.handleClose();return}}async handleNodeValidatorRequest(e){this.assertConnected(),this.webSocket.send(JSON.stringify(qn.encode(e)))}assertConnected(){if(this.webSocket===null)throw new Error("Not connected")}lastConnectTime=null;rapidConnectCount=0;async rapidReconnectProtection(){if(this.lastConnectTime===null){this.lastConnectTime=new Date;return}if(new Date().getTime()-this.lastConnectTime.getTime()<jA?this.rapidConnectCount++:this.rapidConnectCount=0,this.rapidConnectCount<=0)return;const n=2**(this.rapidConnectCount-1),r=Math.min($A*n,XA);console.info("Delaying connection attempt due to rapid connects:",this.rapidConnectCount,n,r),await $o(r),this.lastConnectTime=new Date}webSocket=null;async handleConnect(){if(this.webSocket!==null)return;const e=new URL("node-validator/details",this.serviceBaseURL),o=ue();try{const n=new Qe;await this.lifecycleResponseSink.send(n),await this.rapidReconnectProtection();const r=new FA(this.nodeValidatorResponseSink),s=new GA(o,this.lifecycleResponseSink),a=new zA(o,this.lifecycleResponseSink,()=>this.webSocket=null),d=new JA(o,this.errorResponseSink);this.webSocket=QA(e,r,s,a,d,this.webSocketCreator)}catch(n){const r=new it(n);this.errorResponseSink.send(r),o.completeError(r)}await o.promise}async handleClose(){const e=this.webSocket;if(e===null){this.lifecycleResponseSink.send(new ve);return}await e.close()}}Lh(ct,ja),rw(at,Za);async function YA(t){const e=t.pathname,o=await fetch(e);if(!o.ok)throw new _;const n=await o.json(),r=fe(1024),s=fe(1024),a=new hr(r,s,n);return a.startProcessing(),a}async function ti(t){const e=new URL(t);if(e.protocol==="replay:")return YA(e);if(e.protocol==="ws:"||e.protocol==="wss:"){const o=fe(1024),n=fe(1024),r=new fr(o,n,e);return r.startProcessing(),r}return null}async function KA(){try{const r=await(await fetch("/config.json")).json();if(r.node_validator_service_url){const s=await ti(r.node_validator_service_url);if(s!==null)return s}}catch(n){let r=!1;n instanceof TypeError&&/failed to parse url/i.test(n.toString())&&(r=!0),r||console.warn("error determining service implementation, from configuration file",n)}const t=fe(1024),e=fe(1024),o=new ur(t,e);return o.startProcessing(),o}async function ZA(){return new oi(await KA())}class oi{service;constructor(e){this.service=e}get stream(){return this.service.stream}async send(e){return this.service.send(e)}}class ni{}async function ri(t,e,o){const r=(await t).stream[Symbol.asyncIterator]();for(;;){const s=await Promise.race([e,r.next()]);if(s instanceof ni||s.done)return;const a=s.value;o(sw.encode(a))}}class eC{service;stopPublishingResponses;postMessage;requestChannel;constructor(e){const o=ZA();this.service=o;const n=ue();this.stopPublishingResponses=n,this.requestChannel=fe(1024),this.postMessage=e,this.processRequests(),ri(o,n.promise,this.postMessage)}async setURL(e){try{switch(new URL(e).protocol){case"replay:":case"ws:":case"wss:":break;default:return console.warn("Invalid protocol for node validator URL:",e),!1}const n=await this.service;this.stopPublishingResponses.complete(new ni),(n instanceof ur||n instanceof hr||n instanceof fr)&&n.responseStream.close(),(n instanceof ur||n instanceof hr||n instanceof fr)&&n.requestStream.close();const r=await ti(e);if(r===null)return console.warn("Unable to determine service implementation from URL:",e),!1;const s=new oi(r),a=ue();return this.service=Promise.resolve(s),this.stopPublishingResponses=a,ri(Promise.resolve(s),a.promise,this.postMessage),!0}catch(o){return console.warn("error setting URL for node validator",e,o),!1}}async processRequests(){for await(const e of this.requestChannel)try{const o=await this.service;if(e instanceof ze&&e.command instanceof Wo){await this.setURL(e.command.url);continue}o.send(e)}catch(o){console.warn("error processing message from event",o)}}async handleEvent(e){const o=Mh.decode(e.data);await this.requestChannel.publish(o)}}self.addEventListener("message",new eC(self.postMessage.bind(self)))})();
