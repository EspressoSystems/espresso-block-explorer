var A=Object.defineProperty;var C=(o,e,t)=>e in o?A(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var g=(o,e,t)=>(C(o,typeof e!="symbol"?e+"":e,t),t);const $=new TextEncoder;function S(o){return $.encode(o)}const x=new TextDecoder;function m(o){return x.decode(o)}function*B(o){yield*S(o)}function*D(){for(let o=0;o<256;o++)yield 255}const l=-1,L=61;class U{constructor(e,t,n=L,a=!1){g(this,"encodeMap");g(this,"decodeMap");g(this,"padChar");g(this,"strict");this.encodeMap=e,this.decodeMap=t,this.padChar=n,this.strict=a}static withAlphabet(e){const t=e.length;if(t!==64)throw new TypeError(`alphabet needs to be 64 chars, got ${t}`);const n=Array.from(B(e)),a=Array.from(D());for(let d=0;d<t;d++)a[n[d]]=d;return new U(n,a)}withPadding(e){return new U(this.encodeMap,this.decodeMap,e,this.strict)}encode(e){if(e.byteLength===0)return new ArrayBuffer(0);let t=0,n=0;const a=Math.floor(e.byteLength/3)*3,d=Math.ceil(e.byteLength/3)*4,f=new ArrayBuffer(d),i=new DataView(e),s=new DataView(f);for(;n<a;){const w=i.getUint8(n+0)<<16|i.getUint8(n+1)<<8|i.getUint8(n+2);s.setUint8(t+0,this.encodeMap[w>>18&63]),s.setUint8(t+1,this.encodeMap[w>>12&63]),s.setUint8(t+2,this.encodeMap[w>>6&63]),s.setUint8(t+3,this.encodeMap[w&63]),n+=3,t+=4}const r=e.byteLength-n;if(r===0)return f;let h=i.getUint8(n+0)<<16;switch(r===2&&(h|=i.getUint8(n+1)<<8),s.setUint8(t+0,this.encodeMap[h>>18&63]),s.setUint8(t+1,this.encodeMap[h>>12&63]),r){case 2:return s.setUint8(t+2,this.encodeMap[h>>6&63]),this.padChar!==l?(s.setUint8(t+3,this.padChar),f.slice(0,t+4)):f.slice(0,t+3);case 1:if(this.padChar!==l)return s.setUint8(t+2,this.padChar),s.setUint8(t+3,this.padChar),f.slice(0,t+4);break}return f.slice(0,t+2)}decode(e){const t=e.byteLength;if(t===0)return new ArrayBuffer(0);const n=new DataView(e),a=new ArrayBuffer(Math.floor(t/4*3)),d=new DataView(a),f=new ArrayBuffer(4),i=new DataView(f);let s=0,r=0,h=0,w=!1;for(;r<t&&!w;){let y=3,u=4;for(let c=0;c<4;c++){if(r===t){if(c===0)return a;if(c===1||this.padChar!==l)throw new TypeError(`corrupted input error at ${r-c}`);y=c-1,u=c,w=!0;break}const p=n.getUint8(r);r++;const T=this.decodeMap[p];if(T!==255){i.setUint8(c,T);continue}if(p===10||p===13){c--;continue}if(p===this.padChar){switch(c){case 0:case 1:throw new Error("Incorrect padding");case 2:for(;r<t&&(n.getUint8(r)===10||n.getUint8(r)===13);)r++;if(r===t)throw new TypeError(`corrupt input error at ${t}`);if(n.getUint8(r)!==this.padChar)throw new Error(`corrupt input error at ${r-1}`);r++}for(;r<t&&(n.getUint8(r)===10||n.getUint8(r)===13);)r++;if(r<t)throw new TypeError(`corrupt input error at ${r}`);y=3,u=c,w=!0;break}throw new TypeError(`corrupt input error ${r-1}`)}const M=i.getUint8(0)<<18|i.getUint8(1)<<12|i.getUint8(2)<<6|i.getUint8(3);switch(i.setUint8(2,M>>0&255),i.setUint8(1,M>>8&255),i.setUint8(0,M>>16&255),u){case 4:d.setUint8(h+2,i.getUint8(2)),i.setUint8(2,0);case 3:if(d.setUint8(h+1,i.getUint8(1)),this.strict&&i.getUint8(2)!==0)throw new TypeError(`corrupt input error at ${r-1}`);i.setUint8(1,0);case 2:if(d.setUint8(h+0,i.getUint8(0)),this.strict&&(i.getUint8(1)!==0||i.getUint8(2)!==0))throw new TypeError(`corrupt input error at ${r-2}`)}h+=y,s+=u-1}return a.slice(0,s)}decodeString(e){return this.decode(S(e).buffer)}encodeToString(e){return m(this.encode(e))}}const V=U.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),E=V.withPadding(l);class b{constructor(e,t){g(this,"tag");g(this,"data");this.tag=e,this.data=t}static fromString(e){const t=e.indexOf("~");if(t<0)throw new TypeError("unable to find ~ within string");const n=e.substring(0,t),a=E.decodeString(e.substring(t+1));return new b(n,a)}static inflate(e){if(typeof e!="string")throw new TypeError(`expected a string, instead received ${typeof e}`);return b.fromString(e)}toString(){return`${this.tag}~${E.encodeToString(this.data)}`}valueOf(){return this.toString()}toJSON(){return this.toString()}}export{b as T,B as c,E as r};
