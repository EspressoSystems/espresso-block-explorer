import{j as t,R as n}from"./iframe-DhalQE6g.js";import{P as L}from"./PromiseResolver-BKLn-jPG.js";import{P}from"./IconButton-Dc0AehUt.js";import{L as y}from"./label-DgW09f9Z.js";import{D as h,L as F,E as _}from"./LoadingProvider-plSsL9kW.js";import{P as R}from"./PathResolverProvider-OkjeJArZ.js";import{a as E}from"./Card-CS_siqkV.js";import{C as w,e as v,a as j,b as C,c as V,d as B}from"./CappuccinoHotShotQueryServiceAPIContext-CrpNrgzo.js";import{N as p}from"./NumberText-CqlUb8qk.js";import{R as D}from"./RelativeTimeText-DO2x2upw.js";import{T as c}from"./Text-BU7JBOLk.js";import{k as U}from"./typography-BVAXx6mN.js";import{S as G}from"./SearchGlass-DcfnpZ-j.js";import{a as $}from"./higher_order-rjCqB3wU.js";const m=r=>t.jsx("div",{className:$(r.className,"input-container"),role:r.role,children:r.children});try{m.displayName="InputContainer",m.__docgenInfo={description:"InputContainer is a `div` container that assists in styling `input` elements.\nTraditionally `input` elements are very difficult to style as they don't\nexactly follow the content box model or the border box model.\n\nIn order to normalize input elements it is helpful to have them follow some\nother element's sizing rules directly instead of allowing them to have their\nown.\n\nThis is the purpose of the `InputContainer` component. It provides a sizable\ncontainer that follows the border box model in which an `input` element\ncan be fitted, and that `input` will attempt to fill all of the available\nspace of the `InputContainer`.",displayName:"InputContainer",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"",name:"role",required:!1,type:{name:"string"}}}}}catch{}const g=U("div");function d(r){r.stopPropagation(),r.preventDefault()}function z(r){const e=r.indexOf("~");if(e<0)return r.toLocaleUpperCase();const s=r.substring(0,e),o=r.substring(e+1);return`${s.toLocaleUpperCase()}~${o}`}function A(){if(typeof window>"u")return{href:""};let r=window;for(;r!==r.parent;)r=r.parent;return r.location}class I{pRawQuery;pQuery;pSearchResults;pSearchResultsQuery;pIsLoading;pOffset;pLocation;constructor(e){const{rawQuery:s="",query:o="",searchResults:a=new j(new C([],[])),searchResultsQuery:l="",isLoading:i=!1,offset:x=null,location:u=A()}=e||{};this.pRawQuery=s,this.pQuery=o,this.pSearchResultsQuery=l,this.pSearchResults=a,this.pIsLoading=i,this.pOffset=x,this.pLocation=u}get rawQuery(){return this.pRawQuery}get query(){return this.pQuery}get searchResults(){return this.pSearchResults}get searchResultsQuery(){return this.pSearchResultsQuery}get isLoading(){return this.pIsLoading}get offset(){return this.pOffset}get totalSearchResults(){return this.searchResults.searchResults.transactions.length+this.searchResults.searchResults.blocks.length}setQuery(e){this.pRawQuery=e,this.pQuery=z(e),this.pOffset=null}setSearchResults(e,s){this.pSearchResults=s,this.pSearchResultsQuery=e,this.pOffset=null}setSearchResultsEmpty(){this.pOffset=null,this.pQuery="",this.pRawQuery="",this.pSearchResultsQuery="",this.pSearchResults=new j(new C([],[]))}setLoading(e,s){this.pSearchResultsQuery=e,this.pIsLoading=s}setOffset(e){this.pOffset=e;const s=document.querySelector(`[data-index="${e}"]`);s&&"scrollIntoView"in s&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({block:"nearest",behavior:"smooth"})}navigateTo(e){this.pLocation.href=e}async activate(e,s){if(this.offset===null){if(this.query==="")return;if(/^\d+$/.test(this.query)){const a=Number(this.query);if(Number.isNaN(a)||!Number.isInteger(a))return;this.navigateTo(s.block(a));return}try{const a=await e.explorer.getSearchResult(new v(this.query));if(a.searchResults.blocks.length>0){this.navigateTo(s.block(a.searchResults.blocks[0].height));return}if(a.searchResults.transactions.length>0){const l=a.searchResults.transactions[0];this.navigateTo(s.transaction(l.height,l.offset));return}}catch(a){console.error("encountered error while searching for query",a)}return}const o=this.getResultForOffset(this.offset);if(o instanceof V){this.navigateTo(s.block(o.height));return}if(o instanceof B){this.navigateTo(s.transaction(o.height,o.offset));return}}getResultForOffset(e){const s=this.searchResults.searchResults;return e>=s.blocks.length?s.transactions[e-s.blocks.length]:s.blocks[e]}getValueForOffset(e){return this.getResultForOffset(e).hash.toString()}}const S=n.createContext(new I),N=n.createContext(()=>{});function W(r){const[e]=n.useState(new I(r)),[s,o]=n.useState(0);return[e,()=>o(s+1)]}const b=r=>{const[e,s]=W(r.initialState),o=n.useContext(w),a=n.useContext(R);return t.jsx(S.Provider,{value:e,children:t.jsx(N.Provider,{value:s,children:t.jsx(k.Provider,{value:e.offset,children:t.jsx(f.Provider,{value:e.query,children:t.jsxs(m,{className:"search",role:"search",children:[t.jsx("input",{type:"search",placeholder:"Search blocks, transactions, rollups or addresses...",value:e.offset===null?e.rawQuery:e.getValueForOffset(e.offset),onKeyDown:l=>{if(l.code==="Escape"){d(l),l.currentTarget.blur();return}if(l.code==="Enter"){d(l),e.activate(o,a);return}if(l.code==="ArrowDown"){if(d(l),e.totalSearchResults<=0)return;if(e.offset===null){e.setOffset(0),s();return}const i=e.totalSearchResults;if(e.offset===i-1){e.setOffset(null),s();return}e.setOffset(e.offset+1),s();return}if(l.code==="ArrowUp"){if(d(l),e.totalSearchResults<=0)return;const i=e.totalSearchResults;if(e.offset===null){e.setOffset(i-1),s();return}if(e.offset===0){e.setOffset(null),s();return}e.setOffset(e.offset-1),s();return}},onChange:async l=>{const i=l.currentTarget.value.trim();if(i!==e.query){if(i===""){e.setSearchResultsEmpty(),s();return}e.setQuery(i),s()}},"data-focused":r.forceFocusState?!0:void 0,"aria-label":"search text"}),t.jsx(H,{}),t.jsx(P,{children:t.jsx(G,{})}),t.jsx(K,{}),t.jsx(h.Provider,{value:e.searchResults,children:t.jsx(M,{})})]})})})})})},f=n.createContext(""),H=()=>t.jsx("div",{className:"search-barrier"}),K=()=>{const r=n.useContext(w),e=n.useContext(S),s=n.useContext(f);return s===""?t.jsx(t.Fragment,{}):s!==e.query?t.jsx(t.Fragment,{}):e.query===e.searchResultsQuery?t.jsx(t.Fragment,{}):t.jsx(L,{promise:Promise.all([Promise.resolve(s),r.explorer.getSearchResult(new v(s))]),children:t.jsx(J,{})})},J=()=>{const r=n.useContext(S),e=n.useContext(F),s=n.useContext(_),o=n.useContext(h),a=n.useContext(N);return n.useEffect(()=>{if(!e&&!(r.isLoading||s)&&o[0]===r.query)return r.setLoading(o[0],!1),r.setSearchResults(o[0],o[1]),a(),()=>{}},[r,e,s,o,a]),t.jsx(t.Fragment,{})},M=()=>{const r=n.useContext(h);return n.useContext(f).length<=0&&r.searchResults.blocks.length<=0&&r.searchResults.transactions.length<=0?t.jsx(t.Fragment,{}):t.jsx(X,{})},X=()=>t.jsx(E,{className:"search-results",children:t.jsxs("section",{"aria-label":"search results",className:"search-results-scroll-container",children:[t.jsx(Y,{}),t.jsx(Z,{}),t.jsx(te,{})]})}),k=n.createContext(null),Q=({children:r,index:e})=>{const s=n.useContext(k);return t.jsx("div",{"data-selected":s===e,"data-index":e,className:"result-row",children:t.jsx("div",{className:"result-row-content",children:r})})},T=n.createContext(null),Y=()=>{const r=n.useContext(h),e=n.useContext(f);return r.searchResults.blocks.length>0||r.searchResults.transactions.length>0||e.length<=0?t.jsx(t.Fragment,{}):t.jsx("section",{"aria-label":"no-results",children:t.jsx(y,{className:"type--ui--small result-section-title",children:t.jsx(c,{text:"No results found"})})})},Z=()=>{const r=n.useContext(R),e=n.useContext(h),{searchResults:s}=e,{blocks:o}=s;if(o.length<=0)return t.jsx(t.Fragment,{});const a=0;return t.jsxs("section",{"aria-label":"block-results",children:[t.jsx(y,{className:"type--ui--small result-section-title",children:t.jsx(c,{text:"Blocks"})}),o.map((l,i)=>t.jsx("a",{href:r.block(l.height),children:t.jsx(T.Provider,{value:[l,i+a],children:t.jsx(Q,{index:i+a,children:t.jsx(ee,{})},i+a)})},i+a))]})},O=r=>t.jsx("div",{className:"commit",children:r.children}),ee=()=>{const r=n.useContext(f),[e]=n.useContext(T),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(O,{children:[t.jsx(c,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(c,{text:s.substring(r.length)})})]}),t.jsx(g,{children:t.jsx(p,{number:e.height})})]})},q=n.createContext(null),te=()=>{const r=n.useContext(R),e=n.useContext(h),{searchResults:s}=e,{blocks:o,transactions:a}=s;if(a.length<=0)return t.jsx(t.Fragment,{});const l=o.length;return t.jsxs("section",{"aria-label":"transaction-results",children:[t.jsx(y,{className:"type--ui--small result-section-title",children:t.jsx(c,{text:"Transactions"})}),a.map((i,x)=>{const u=x+l;return t.jsx("a",{href:r.transaction(i.height,i.offset),children:t.jsx(q.Provider,{value:[i,u],children:t.jsx(Q,{index:u,children:t.jsx(se,{})})},u)},u)})]})},se=()=>{const r=n.useContext(f),[e]=n.useContext(q),s=e.hash.toString();return t.jsxs(t.Fragment,{children:[t.jsxs(O,{children:[t.jsx(c,{text:s.substring(0,r.length)}),t.jsx("strong",{children:t.jsx(c,{text:s.substring(r.length)})})]}),t.jsxs(g,{children:["Transaction ",t.jsx(p,{number:e.offset+1})," of"," ",t.jsx(p,{number:e.numTransactions})," in Block"," ",t.jsx(p,{number:e.height})]}),t.jsx(g,{children:t.jsx(D,{date:e.time})})]})};try{b.displayName="SearchInput",b.__docgenInfo={description:`SearchInput is the component that will allow the user to search for blocks,
transactions, rollups, and addresses.

Right now it only supports searching for blocks and transactions.`,displayName:"SearchInput",props:{initialState:{defaultValue:null,description:"",name:"initialState",required:!1,type:{name:"InitialSearchState"}},forceFocusState:{defaultValue:null,description:"",name:"forceFocusState",required:!1,type:{name:"boolean"}}}}}catch{}export{m as I,b as S};
