(function(){"use strict";class ad{breakpoint(){}}function id(){return new ad}const dd=id();function ut(){dd.breakpoint()}class ld{assert(){}}function ud(){return new ld}const hd=ud();function P(t,e){hd.assert(t,e)}function Yt(t,e){P(typeof t===e,`type assertion failed: expected "${e}", received "${typeof t}"`)}function wd(t){P(t!=null,"expected a non-null value, received null")}function g(t,e){P(t instanceof e,`given value is not an instance of "${e.name}", specific type is "${typeof t=="object"&&t!==null?t.constructor.name:typeof t}"`)}class Zt extends Error{key;haveType;constructor(e,o,n=`expected object with key: "${o}", instead found ${e}`){super(n),this.haveType=e,this.key=o,Object.freeze(this),ut()}toJSON(){return{code:Zt.name,message:this.message,have:this.haveType,key:this.key}}}class de{encode(e){return this.encoder.convert(e)}decode(e){return this.decoder.convert(e)}}class c extends de{}function ht(t){return typeof t=="number"}function ee(t){return typeof t=="string"}function fd(t){return typeof t=="bigint"}function gs(t){return typeof t=="object"&&t!==null}function wt(t){return t!==void 0}function md(t,e){return Array.isArray(t)&&t.every(e)}function pd(t){return e=>md(e,t)}function eo(t,e,o){return gs(t)&&e in t&&o(t[e])}function G(t,...e){return gs(t)&&e.every(o=>o in t)}function i(t,...e){if(typeof t!="object")throw new Error("expected object");if(t===null)throw new Error("received null");for(const o of e)if(!(o in t))throw new Zt("object",o)}function b(t,e){if(!ee(t.code))throw new Error("code must be a string");if(t.code!==e)throw new Error(`expected code to be ${e}, got ${t.code}`)}function le(t,e){if(!ee(t.type))throw new Error("type must be a string");if(t.type!==e)throw new Error(`expected type to be ${e}, got ${t.type}`)}class B extends Error{constructor(e){super(e)}get code(){return this.constructor.name}toJSON(){return $.convert(this)}}class W{convert(e){return g(e,B),{code:e.code,message:e.message}}}const $=new W,gd="NoCodecFoundError";class De extends Error{codec;constructor(e,o=`no codec found for: "${e}"`){super(o),this.codec=e,Object.freeze(this),ut()}toJSON(){return{code:l.encode(De.name),message:l.encode(this.message),codec:l.encode(this.codec)}}get code(){return gd}}const to=new Map;class Ad{convert(e){i(e,"code");const o=l.decode(e.code),n=to.get(o);if(!n)throw new De(o);return n.decode(e)}}class yd{convert(e){const o=to.get(e.code);if(!o)throw new De(e.code);return o.encode(e)}}class Cd extends de{encoder=new yd;decoder=new Ad}const ft=new Cd;function S(t,e){to.set(t,e)}const oo="InvalidTypeError";class p extends B{have;want;constructor(e,o,n=`invalid type: have "${e}", want "${o}"`){super(n),this.have=e,this.want=o,Object.freeze(this)}toJSON(){return As.encode(this)}get code(){return oo}}class bd{convert(e){return i(e,"code","have","want","message"),b(e,oo),new p(l.decode(e.have),l.decode(e.want),l.decode(e.message))}}class Sd{convert(e){return g(e,p),{...$.convert(e),have:l.encode(e.have),want:l.encode(e.want)}}}class kd extends c{encoder=new Sd;decoder=new bd}const As=new kd;S(oo,As);const ys=pd(wt);class vd{convert(e){return e}}const Cs=new vd;class Ed extends de{encoder=Cs;decoder=Cs}const mt=new Ed;class k{itemCodec;constructor(e){this.itemCodec=e}convert(e){if(!ys(e)){const o=typeof e=="object"&&e!==null?e.constructor.name:typeof e,n="array";throw new Error(`invalid array value: have "${o}", want "${n}"`)}return e.map(o=>this.itemCodec.decode(o))}}class v{itemCodec;constructor(e){this.itemCodec=e}convert(e){return g(e,Array),e.map(o=>this.itemCodec.encode(o))}}class E extends c{encoder;decoder;constructor(e,o){super(),this.encoder=o,this.decoder=e}}class L{itemCodec;constructor(e){this.itemCodec=e}convert(e){return e===null?null:this.itemCodec.decode(e)}}class M{itemCodec;constructor(e){this.itemCodec=e}convert(e){return e===null?null:(wd(e),this.itemCodec.encode(e))}}class V extends c{encoder;decoder;constructor(e,o){super(),this.encoder=o,this.decoder=e}}class Bd{convert(e){if(!ee(e))throw new p(typeof e,"string");return e}}class xd{convert(e){return Yt(e,"string"),e}}class Rd extends c{encoder=new xd;decoder=new Bd}const l=new Rd;new E(new k(l),new v(l));const J=new V(new L(l),new M(l));function be(t){return!t||!t.trim()?null:t}class no extends B{constructor(e="completer has already been completed"){super(e),Object.freeze(this)}get code(){return bs}}const bs="CompleterAlreadyCompletedError";class Nd{convert(e){return i(e,"code","message"),b(e,bs),new no(l.decode(e.message))}}class Id extends W{}class Dd extends c{encoder=new Id;decoder=new Nd}const Td=new Dd;S(no.name,Td);function pt(){P(!1,"completer is not ready, this should never be reached")}function gt(){throw new no}class Od{resolve=pt;reject=pt;completed=!1;promise;get isCompleted(){return this.completed}constructor(){this.promise=new Promise((e,o)=>{this.resolve=e,this.reject=o}),P(this.resolve!==pt,"resolve should be set"),P(this.reject!==pt,"resolve should be set")}complete(e){const o=this.resolve,n=this.reject;if(this.completed=!0,this.resolve=gt,this.reject=gt,e instanceof Promise){e.then(o,n);return}o(e)}completeError(e){this.reject(e),this.completed=!0,this.resolve=gt,this.reject=gt}}function ue(){return new Od}class Te extends B{response;status;constructor(e,o,n){super(n),this.status=e,this.response=o}toJSON(){return Ss.convert(this)}}class At{convert(e){return g(e,Te),{...$.convert(e),status:e.status}}}const Ss=new At,ro="BadResponseClientError";class Pd extends Te{constructor(e,o,n="bad server response: client error"){super(e,o,n),Object.freeze(this)}get code(){return ro}toJSON(){return ks.encode(this)}}class Ld{convert(e){return i(e,"code","message","status"),b(e,ro),new Pd(Number(e.status),null,l.decode(e.message))}}class Md extends At{}class Vd extends c{encoder=new Md;decoder=new Ld}const ks=new Vd;S(ro,ks);const so="BadResponseError";class Ud extends Te{constructor(e,o,n="bad server response"){super(e,o,n),Object.freeze(this)}get code(){return so}toJSON(){return vs.encode(this)}}class Hd{convert(e){return i(e,"code","message","status"),b(e,so),new Ud(Number(e.status),null,l.decode(e.message))}}class _d extends At{}class Wd extends c{encoder=new _d;decoder=new Hd}const vs=new Wd;S(so,vs);class zd extends Te{constructor(e,o,n="bad server response: server error"){super(e,o,n),Object.freeze(this)}get code(){return co}}const co="BadResponseServerError";class Fd{convert(e){return i(e,"code","message","status"),b(e,co),new zd(Number(e.status),null,l.decode(e.message))}}class Jd extends At{}class Gd extends c{encoder=new Jd;decoder=new Fd}const qd=new Gd;S(co,qd);const ao="ChannelClosedError";class Oe extends B{constructor(e="channel closed"){super(e),Object.freeze(this)}get code(){return ao}}class Qd{convert(e){return i(e,"code","message"),b(e,ao),new Oe(l.decode(e.message))}}class jd extends W{}class $d extends c{encoder=new jd;decoder=new Qd}const Kd=new $d;S(ao,Kd);const io="FetchError";class Xd extends B{cause;constructor(e,o=`fetch failed: ${String(e)}`){super(o),this.cause=e,Object.freeze(this)}get code(){return io}}class Yd{convert(e){return i(e,"code","message"),b(e,io),new Xd({},l.decode(e.message))}}class Zd extends W{}class el extends c{encoder=new Zd;decoder=new Yd}const tl=new el;S(io,tl);const lo="IncorrectBase64PaddingError";class Es extends B{constructor(e="incorrect padding"){super(e),Object.freeze(this)}get code(){return lo}}class ol{convert(e){return i(e,"code","message"),b(e,lo),new Es(l.decode(e.message))}}class nl extends W{}class rl extends c{encoder=new nl;decoder=new ol}const sl=new rl;S(lo,sl);class cl{convert(e){if(!ht(e))throw new p(typeof e,"number");return e}}class al{convert(e){return Yt(e,"number"),e}}class il extends c{encoder=new al;decoder=new cl}const u=new il,Bs=new V(new L(u),new M(u)),Pe=new E(new k(u),new v(u)),oe=new E(new k(Bs),new v(Bs)),uo="InvalidBase64AlphabetLengthError";class ho extends B{length;constructor(e,o=`alphabet needs to be 64 characters, received ${e}`){super(o),this.length=e,Object.freeze(this)}toJSON(){return xs.encode(this)}get code(){return uo}}class dl{convert(e){return i(e,"code","length","message"),b(e,uo),new ho(u.decode(e.length),l.decode(e.message))}}class ll{convert(e){return g(e,ho),{...$.convert(e),length:u.encode(e.length)}}}class ul extends c{encoder=new ll;decoder=new dl}const xs=new ul;S(uo,xs);const wo="InvalidHexStringError";class Rs extends B{constructor(e="invalid hex string"){super(e),Object.freeze(this)}get code(){return wo}}class hl{convert(e){return i(e,"code","message"),b(e,wo),new Rs(l.decode(e.message))}}class wl extends W{}class fl extends c{encoder=new wl;decoder=new hl}const ml=new fl;S(wo,ml);const fo="InvalidHexValueError";class Ns extends B{value;constructor(e,o=`invalid hex value "${e}"`){super(o),this.value=e,Object.freeze(this)}toJSON(){return Is.encode(this)}get code(){return fo}}class pl{convert(e){return i(e,"code","value","message"),b(e,fo),new Ns(u.decode(e.value),l.decode(e.message))}}class gl{convert(e){return{...$.convert(e),value:u.encode(e.value)}}}class Al extends c{encoder=new gl;decoder=new pl}const Is=new Al;S(fo,Is);const mo="InvalidInputError";class ne extends B{constructor(e="invalid input"){super(e),Object.freeze(this),ut()}get code(){return mo}}class yl{convert(e){return i(e,"code","message"),b(e,mo),new ne(l.decode(e.message))}}class Cl extends W{}class bl extends c{encoder=new Cl;decoder=new yl}const Sl=new bl;S(mo,Sl);const po="InvalidStringValueError";class Ds extends B{have;want;constructor(e,o,n=`invalid string value: have "${e}", want "${o}"`){super(n),this.have=e,this.want=o,Object.freeze(this)}toJSON(){return Ts.encode(this)}get code(){return po}}class kl{convert(e){return i(e,"code","have","want","message"),b(e,po),new Ds(l.decode(e.have),l.decode(e.want),l.decode(e.message))}}class vl{convert(e){return g(e,Ds),{...$.convert(e),have:l.encode(e.have),want:l.encode(e.want)}}}class El extends c{encoder=new vl;decoder=new kl}const Ts=new El;S(po,Ts);const go="InvalidTaggedBase64EncodingError";class Os extends B{constructor(e="invalid tagged base64 encoding"){super(e),Object.freeze(this)}toJSON(){return Ps.encode(this)}get code(){return go}}class Bl{convert(e){return i(e,"code","message"),b(e,go),new Os(l.decode(e.message))}}class xl extends W{}class Rl extends c{encoder=new xl;decoder=new Bl}const Ps=new Rl;S(go,Ps);const Ao="MissingElementError";class yt extends B{constructor(e="missing element"){super(e),Object.freeze(this)}get code(){return Ao}}class Nl{convert(e){return i(e,"code","message"),b(e,Ao),new yt(l.decode(e.message))}}class Il extends W{}class Dl extends c{encoder=new Il;decoder=new Nl}const Tl=new Dl;S(Ao,Tl);const yo="NoCompleterFoundForRequestID";class Ls extends B{requestID;constructor(e,o=`no completer found for request id "${e}"`){super(o),this.requestID=e,Object.freeze(this)}toJSON(){return Ms.encode(this)}get code(){return yo}}class Ol{convert(e){return i(e,"code","requestID","message"),b(e,yo),new Ls(mt.decode(e.requestID),l.decode(e.message))}}class Pl{convert(e){return g(e,Ls),{...$.convert(e),requestID:mt.encode(e.requestID)}}}class Ll extends c{encoder=new Pl;decoder=new Ol}const Ms=new Ll;S(yo,Ms);const Co="NotFoundError";class Ml extends B{key;constructor(e,o=`Not Found: ${e}`){super(o),this.key=e,Object.freeze(this)}get code(){return Co}}class Vs{codec;constructor(e){this.codec=e}convert(e){return i(e,"code","key"),b(e,Co),new Ml(this.codec.decode(e.key))}}class Us{codec;constructor(e){this.codec=e}convert(e){return{...$.convert(e),key:this.codec.encode(e.key)}}}class Hs extends c{encoder;decoder;constructor(e,o){super(),this.encoder=e,this.decoder=o}}new Hs(new Us(l),new Vs(l));const Vl=new Hs(new Us(mt),new Vs(mt));S(Co,Vl);const bo="NoURLProvidedError";class Ul extends B{constructor(e="no url provided"){super(e),Object.freeze(this)}get code(){return bo}}class Hl{convert(e){return i(e,"code","message"),b(e,bo),new Ul(l.decode(e.message))}}class _l extends W{}class Wl extends c{encoder=new _l;decoder=new Hl}const zl=new Wl;S(bo,zl);const So="UnimplementedError";class z extends B{constructor(e="unimplemented"){super(e),Object.freeze(this),ut()}get code(){return So}}class Fl{convert(e){return i(e,"code","message"),b(e,So),new z(l.decode(e.message))}}class Jl extends W{}class Gl extends c{encoder=new Jl;decoder=new Fl}const ql=new Gl;S(So,ql);const ko="QUERY_ERROR";class Ql extends B{error;constructor(e,o="missing element"){super(o),this.error=e,Object.freeze(this)}get code(){return ko}}class jl{convert(e){return i(e,"code","error","message"),b(e,ko),new Ql(Fs.decode(e.error),l.decode(e.message))}}class $l{convert(e){return{code:e.code,error:Fs.encode(e.error),message:l.encode(e.message)}}}class Kl extends c{encoder=new $l;decoder=new jl}const Xl=new Kl;class vo{}const Eo="NotFound";class _s extends vo{constructor(){super(),Object.freeze(this)}valueOf(){return Eo}toJSON(){return this.valueOf()}}const Yl=new _s,Bo="Missing";class Ws extends vo{constructor(){super(),Object.freeze(this)}valueOf(){return Bo}toJSON(){return this.valueOf()}}const Zl=new Ws;class zs extends vo{error;constructor(e){super(),this.error=e,Object.freeze(this)}toJSON(){return Ro.encode(this)}}class eu{message;constructor(e){this.message=e,Object.freeze(this)}toJSON(){return xo.encode(this)}}class tu{convert(e){return i(e,"message"),new eu(l.decode(e.message))}}class ou{convert(e){return{message:l.encode(e.message)}}}class nu extends c{encoder=new ou;decoder=new tu}const xo=new nu;class ru{convert(e){return i(e,"Error"),new zs(xo.decode(e.Error))}}class su{convert(e){return{Error:xo.encode(e.error)}}}class cu extends c{encoder=new su;decoder=new ru}const Ro=new cu;class au{convert(e){return e===Eo?Yl:e===Bo?Zl:Ro.decode(e)}}class iu{convert(e){if(e instanceof _s)return Eo;if(e instanceof Ws)return Bo;if(e instanceof zs)return Ro.encode(e);throw new z}}class du extends c{encoder=new iu;decoder=new au}const Fs=new du;S(ko,Xl);const Js="ResponseContentTypeIsNotApplicationJSONError";class Ct extends Te{haveHeaderType;constructor(e,o,n,r="response content type is not application/json"){super(o,n,r),this.haveHeaderType=e,Object.freeze(this)}static fromResponse(e,o){return new Ct(e.headers.get("content-type")??"undefined",e.status,e,o)}toJSON(){return Gs.encode(this)}get code(){return Js}}class lu{convert(e){return i(e,"code","status","have","want","message"),b(e,Js),new Ct(l.decode(e.code),u.decode(e.status),null,l.decode(e.message))}}class uu{convert(e){return{...Ss.convert(e),have:l.encode(e.haveHeaderType),want:l.encode("application/json")}}}class hu extends c{encoder=new uu;decoder=new lu}const Gs=new hu;S(Ct.name,Gs);const No="WebWorkerErrorResponse";class wu extends B{error;constructor(e,o="error in web worker"){super(o),this.error=e,Object.freeze(this)}toJSON(){return qs.encode(this)}get code(){return No}}class fu{convert(e){return i(e,"code","error","message"),b(e,No),new wu(ft.decode(e.error),l.decode(e.message))}}class mu{convert(e){return{...$.convert(e),error:ft.encode(e.error)}}}class pu extends c{encoder=new mu;decoder=new fu}const qs=new pu;S(No,qs);var Qs=(t=>(t[t.success=0]="success",t[t.full=1]="full",t[t.failed=2]="failed",t))(Qs||{});class gu{getFromEmpty(){}}class Au{getFromEmpty(){throw new yt}}const js={returnUndefined:new gu,throwMissingElement:new Au};class yu{maxSize;constructor(e){P(!Number.isNaN(e),"maxSize must not be NaN"),P(Number.isInteger(e),"maxSize must be an integer"),P(e>0,"maxSize must be greater than 0"),this.maxSize=e}nextIndex(e){return P(e>=0,"index must be greater than or equal to 0"),(e+1)%this.maxSize}}class Cu{preComputedSizeMinus1;constructor(e){P(!Number.isNaN(e),"maxSize must not be NaN"),P(Number.isInteger(e),"maxSize must be an integer"),P(e>0,"maxSize must be greater than 0"),P($s(e),"maxSize must be a power of two"),this.preComputedSizeMinus1=e-1}nextIndex(e){return P(e>=0,"index must be greater than or equal to 0"),e+1&this.preComputedSizeMinus1}}function $s(t){return(t&t-1)===0}const Io="BufferFullError";class Ks extends B{constructor(e="buffer full"){super(e),Object.freeze(this)}get code(){return Io}}class bu{convert(e){return i(e,"code","message"),b(e,Io),new Ks(l.decode(e.message))}}class Su extends W{}class ku extends c{encoder=new Su;decoder=new bu}const vu=new ku;S(Io,vu);class Eu{putToFull(e,o){return e.get(),e.put(o)}}class Bu{putToFull(){throw new Ks}}const Xs={overwriteOldest:new Eu,throw:new Bu};function xu(t){return $s(t)?new Cu(t):new yu(t)}class Ru{readIndex=0;writeIndex=0;buffer;nextIndex;getOnEmpty;putOnFull;constructor(e,o,n){P(!Number.isNaN(e),"maxSize must not be NaN"),this.buffer=new Array(e),this.nextIndex=xu(e),this.getOnEmpty=o,this.putOnFull=n}get maxSize(){return this.buffer.length}get length(){return this.writeIndex<this.readIndex?this.writeIndex+this.maxSize-this.readIndex:this.writeIndex-this.readIndex}put(e){const o=this.nextIndex.nextIndex(this.writeIndex);return o===this.readIndex?this.putOnFull.putToFull(this,e):(this.buffer[this.writeIndex]=e,this.writeIndex=o,Qs.success)}get(){if(this.readIndex===this.writeIndex)return this.getOnEmpty.getFromEmpty(this);const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),e}[Symbol.iterator](){return new Nu(this)}immutableIterable(){return{[Symbol.iterator]:()=>this.immutableIterator()}}immutableIterator(){return new Iu(this.readIndex,this.writeIndex,this.buffer,this.nextIndex)}}class Nu{buffer;constructor(e){this.buffer=e}next(){const e=this.buffer.get();return e==null?{value:void 0,done:!0}:{value:e,done:!1}}}class Iu{readIndex;writeIndex;buffer;nextIndex;constructor(e,o,n,r){this.readIndex=e,this.writeIndex=o,this.buffer=n,this.nextIndex=r}next(){if(this.readIndex===this.writeIndex)return{value:void 0,done:!0};const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),{value:e,done:!1}}}function he(t=32,e=js.returnUndefined,o=Xs.overwriteOldest){return new Ru(t,e,o)}class Du{publishQueue;pollBlocked;publishBlocked;capacity;closed=!1;constructor(e){this.publishQueue=he(Math.max(2,e),js.throwMissingElement,Xs.throw);const o=ue();this.pollBlocked=o,this.publishBlocked=o,o.complete(),this.capacity=e-1}get isClosed(){return this.closed}close(){if(this.closed)throw new Oe;this.closed=!0}async drain(){for(;this.publishQueue.length>0;)this.publishQueue.get()}async publish(e){if(this.closed)throw new Oe;if(this.publishQueue.length>=this.capacity){if(this.publishBlocked.isCompleted){const o=ue();this.publishBlocked=o,await o.promise}return await this.publishBlocked.promise,this.publish(e)}this.publishQueue.put(e),this.pollBlocked.isCompleted||this.pollBlocked.complete()}async poll(){if(this.publishQueue.length<=0){if(this.isClosed)throw new Oe;if(this.pollBlocked.isCompleted){const o=ue();this.pollBlocked=o}return await this.pollBlocked.promise,this.poll()}const e=this.publishQueue.get();return this.publishBlocked.isCompleted||this.publishBlocked.complete(),e}[Symbol.asyncIterator](){return new Tu(this)}}class Tu{channel;constructor(e){this.channel=e}async next(){try{return{done:!1,value:await this.channel.poll()}}catch(e){if(e instanceof Oe)return{done:!0,value:void 0};throw e}}}function we(t){return new Du(t)}class Ou{channel;constructor(e){this.channel=e}async send(e){await this.channel.publish(e)}}function fe(t){return new Ou(t)}const Do="CorruptBase64InputError";class re extends B{offset;constructor(e,o=`corrupt input error at ${e}`){super(o),this.offset=e,Object.freeze(this)}get code(){return Do}toJSON(){return Ys.encode(this)}}class Pu{convert(e){return i(e,"code","offset","message"),b(e,Do),new re(u.decode(e.offset),l.decode(e.message))}}class Lu{convert(e){return g(e,re),{...$.convert(e),offset:u.encode(e.offset),message:l.encode(e.message)}}}class Mu extends c{encoder=new Lu;decoder=new Pu}const Ys=new Mu;S(Do,Ys);class Vu{convert(e){const o=new ArrayBuffer(e.byteLength);return new Uint8Array(o).set(e),o}}class Uu{convert(e){return new Uint8Array(e)}}class Hu extends c{encoder=new Vu;decoder=new Uu}const To=new Hu,_u=new TextEncoder;function Zs(t){return _u.encode(t)}const Wu=new TextDecoder;function zu(t){return Wu.decode(t)}function*ec(t){yield*Zs(t)}function*Fu(){for(let t=0;t<256;t++)yield 255}const Le=-1,Ju=61;class Me{encodeMap;decodeMap;padChar;strict;constructor(e,o,n=Ju,r=!1){this.encodeMap=e,this.decodeMap=o,this.padChar=n,this.strict=r}static withAlphabet(e){const o=e.length;if(o!==64)throw new ho(o);const n=Array.from(ec(e)),r=Array.from(Fu());for(let s=0;s<o;s++)r[n[s]]=s;return new Me(n,r)}withPadding(e){return new Me(this.encodeMap,this.decodeMap,e,this.strict)}encode(e){if(e.byteLength===0)return new ArrayBuffer(0);let o=0,n=0;const r=Math.floor(e.byteLength/3)*3,s=Math.ceil(e.byteLength/3)*4,a=new ArrayBuffer(s),d=new DataView(e),f=new DataView(a);for(;n<r;){const O=d.getUint8(n+0)<<16|d.getUint8(n+1)<<8|d.getUint8(n+2);f.setUint8(o+0,this.encodeMap[O>>18&63]),f.setUint8(o+1,this.encodeMap[O>>12&63]),f.setUint8(o+2,this.encodeMap[O>>6&63]),f.setUint8(o+3,this.encodeMap[O&63]),n+=3,o+=4}const h=e.byteLength-n;if(h===0)return a;let C=d.getUint8(n+0)<<16;switch(h===2&&(C|=d.getUint8(n+1)<<8),f.setUint8(o+0,this.encodeMap[C>>18&63]),f.setUint8(o+1,this.encodeMap[C>>12&63]),h){case 2:return f.setUint8(o+2,this.encodeMap[C>>6&63]),this.padChar!==Le?(f.setUint8(o+3,this.padChar),a.slice(0,o+4)):a.slice(0,o+3);case 1:if(this.padChar!==Le)return f.setUint8(o+2,this.padChar),f.setUint8(o+3,this.padChar),a.slice(0,o+4);break}return a.slice(0,o+2)}decode(e){const o=e.byteLength;if(o===0)return new ArrayBuffer(0);const n=new DataView(e),r=new ArrayBuffer(Math.floor(o/4*3)),s=new DataView(r),a=new ArrayBuffer(4),d=new DataView(a);let f=0,h=0,C=0,O=!1;for(;h<o&&!O;){let A=3,m=4;for(let I=0;I<4;I++){if(h===o){if(I===0)return r;if(I===1||this.padChar!==Le)throw new re(h-I);A=I-1,m=I,O=!0;break}const F=n.getUint8(h);h++;const lt=this.decodeMap[F];if(lt!==255){d.setUint8(I,lt);continue}if(F===10||F===13){I--;continue}if(F===this.padChar){switch(I){case 0:case 1:throw new Es;case 2:for(;h<o&&(n.getUint8(h)===10||n.getUint8(h)===13);)h++;if(h===o)throw new re(o);h++}for(;h<o&&(n.getUint8(h)===10||n.getUint8(h)===13);)h++;if(h<o)throw new re(h);A=3,m=I,O=!0;break}throw new re(h-1)}const H=d.getUint8(0)<<18|d.getUint8(1)<<12|d.getUint8(2)<<6|d.getUint8(3);switch(d.setUint8(2,H>>0&255),d.setUint8(1,H>>8&255),d.setUint8(0,H>>16&255),m){case 4:s.setUint8(C+2,d.getUint8(2)),d.setUint8(2,0);case 3:if(s.setUint8(C+1,d.getUint8(1)),this.strict&&d.getUint8(2)!==0)throw new re(h-1);case 2:if(s.setUint8(C+0,d.getUint8(0)),this.strict&&(d.getUint8(1)!==0||d.getUint8(2)!==0))throw new re(h-2)}C+=A,f+=m-1}return r.slice(0,f)}decodeString(e){return this.decode(To.encode(Zs(e)))}encodeToString(e){return zu(this.encode(e))}}const Oo=Me.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Gu=Oo.withPadding(Le),tc=Me.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Po=tc.withPadding(Le);function*qu(t,e){for(let o=t.next();!o.done;o=t.next())e(o.value)&&(yield o.value)}function Lo(t,e){return qu(t[Symbol.iterator](),e)}function*oc(t,e){for(let o=t.next();!o.done;o=t.next())yield e(o.value)}function q(t,e){return oc(t[Symbol.iterator](),e)}function*Qu(t,e){for(let o=0;o<e;o++){const n=t.next();if(n.done)return;yield n.value}}function ju(t,e){return Qu(t[Symbol.iterator](),e)}function nc(t){const e=t.next();if(e.done)throw new yt;return e.value}function $u(t){let e;for(let o=t.next();!o.done;o=t.next())e=o.value;if(e===void 0)throw new yt;return e}function Ku(t){return $u(t[Symbol.iterator]())}function*Xu(t,e){for(let o=t.next();!o.done;o=t.next())yield*e(o.value)}function Mo(t,e){return Xu(t[Symbol.iterator](),e)}function*Yu(){let t=0;for(;;)yield t++}function Vo(t){return ju(Yu(),Math.ceil(t))}function rc(t,e,o){const n=o;let r=e;for(let s=n.next();!s.done;s=n.next())r=t(r,s.value);return r}function*Zu(t,e,o){for(let n=t.next(),r=e.next();!n.done&&!r.done;n=t.next(),r=e.next())yield o(n.value,r.value)}function Uo(t,e,o){return Zu(t[Symbol.iterator](),e[Symbol.iterator](),o)}function Ho(t){if(t.startsWith("0x"))return Ho(t.substring(2));if((t.length&1)!==0)return Ho("0"+t);const e=new ArrayBuffer(t.length/2);return eh(ec(t),e),e}function eh(t,e){const o=new DataView(e);let n=0;for(;n<e.byteLength;){const r=t.next(),s=t.next();if(r.done||s.done)throw new Rs;const a=sc(r.value),d=sc(s.value),f=a<<4|d;o.setUint8(n,f),n++}}function sc(t){if(t>=48&&t<=57)return t-48;if(t>=97&&t<=102)return t-97+10;if(t>=65&&t<=70)return t-65+10;throw new Ns(t)}function th(t){return t.toString(16).padStart(2,"0")}function*oh(t){yield*oc(t,th)}function cc(t){return oh(t[Symbol.iterator]())}class nh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");return Ho(e)}}class rh{convert(e){return`0x${Array.from(cc(new Uint8Array(e))).join("")}`}}class sh extends c{encoder=new rh;decoder=new nh}const R=new sh;new V(new L(R),new M(R));const ac=new E(new k(R),new v(R));class ch{convert(e){return e instanceof Array?ac.decode(e):[R.decode(e)]}}class ah{convert(e){return ac.encode(e)}}class ih extends c{encoder=new ah;decoder=new ch}const se=new ih;class dh{encoding;constructor(e){this.encoding=e}convert(e){if(typeof e!="string")throw new p(typeof e,"string");return this.encoding.decodeString(e)}}class lh{encoding;constructor(e){this.encoding=e}convert(e){return this.encoding.encodeToString(e)}}class bt extends c{encoder;decoder;constructor(e){super(),this.encoder=new lh(e),this.decoder=new dh(e)}}new bt(Po),new bt(Gu);const ic=new bt(tc),St=new bt(Oo);new V(new L(St),new M(St));class uh{convert(e){if(fd(e))return e;if(ht(e))return BigInt(e);if(!ee(e))throw new p(typeof e,"string | bigint | number");return BigInt(e)}}class hh{convert(e){return Yt(e,"bigint"),`0x${e.toString(16)}`}}class wh extends c{encoder=new hh;decoder=new uh}const N=new wh,dc=new V(new L(N),new M(N)),lc=new E(new k(N),new v(N));new E(new k(dc),new v(dc)),BigInt.prototype.toJSON=function(){return N.encode(this)};class fh{convert(e){if(!ee(e))throw new p(typeof e,"string");const o=new Date(e);if(Number.isNaN(o.valueOf()))throw new p("NaN","number");return o}}class mh{convert(e){return g(e,Date),e.toISOString()}}class ph extends c{encoder=new mh;decoder=new fh}const Se=new ph,uc=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648];function kt(t){for(let e=0;e<24;++e){const o=t[0]^t[10]^t[20]^t[30]^t[40],n=t[1]^t[11]^t[21]^t[31]^t[41],r=t[2]^t[12]^t[22]^t[32]^t[42],s=t[3]^t[13]^t[23]^t[33]^t[43],a=t[4]^t[14]^t[24]^t[34]^t[44],d=t[5]^t[15]^t[25]^t[35]^t[45],f=t[6]^t[16]^t[26]^t[36]^t[46],h=t[7]^t[17]^t[27]^t[37]^t[47],C=t[8]^t[18]^t[28]^t[38]^t[48],O=t[9]^t[19]^t[29]^t[39]^t[49];let A=C^(r<<1|s>>>31),m=O^(s<<1|r>>>31);const H=t[0]^A,I=t[1]^m,F=t[10]^A,lt=t[11]^m,mi=t[20]^A,pi=t[21]^m,gi=t[30]^A,Ai=t[31]^m,yi=t[40]^A,Ci=t[41]^m;A=o^(a<<1|d>>>31),m=n^(d<<1|a>>>31);const bi=t[2]^A,Si=t[3]^m,ki=t[12]^A,vi=t[13]^m,Ei=t[22]^A,Bi=t[23]^m,xi=t[32]^A,Ri=t[33]^m,Ni=t[42]^A,Ii=t[43]^m;A=r^(f<<1|h>>>31),m=s^(h<<1|f>>>31);const Di=t[4]^A,Ti=t[5]^m,Oi=t[14]^A,Pi=t[15]^m,Li=t[24]^A,Mi=t[25]^m,Vi=t[34]^A,Ui=t[35]^m,Hi=t[44]^A,_i=t[45]^m;A=a^(C<<1|O>>>31),m=d^(O<<1|C>>>31);const Wi=t[6]^A,zi=t[7]^m,Fi=t[16]^A,Ji=t[17]^m,Gi=t[26]^A,qi=t[27]^m,Qi=t[36]^A,ji=t[37]^m,$i=t[46]^A,Ki=t[47]^m;A=f^(o<<1|n>>>31),m=h^(n<<1|o>>>31);const Xi=t[8]^A,Yi=t[9]^m,Zi=t[18]^A,ed=t[19]^m,td=t[28]^A,od=t[29]^m,nd=t[38]^A,rd=t[39]^m,sd=t[48]^A,cd=t[49]^m,br=H,Sr=I,kr=lt<<4|F>>>28,vr=F<<4|lt>>>28,Er=mi<<3|pi>>>29,Br=pi<<3|mi>>>29,xr=Ai<<9|gi>>>23,Rr=gi<<9|Ai>>>23,Nr=yi<<18|Ci>>>14,Ir=Ci<<18|yi>>>14,Dr=bi<<1|Si>>>31,Tr=Si<<1|bi>>>31,Or=vi<<12|ki>>>20,Pr=ki<<12|vi>>>20,Lr=Ei<<10|Bi>>>22,Mr=Bi<<10|Ei>>>22,Vr=Ri<<13|xi>>>19,Ur=xi<<13|Ri>>>19,Hr=Ni<<2|Ii>>>30,_r=Ii<<2|Ni>>>30,Wr=Ti<<30|Di>>>2,zr=Di<<30|Ti>>>2,Fr=Oi<<6|Pi>>>26,Jr=Pi<<6|Oi>>>26,Gr=Mi<<11|Li>>>21,qr=Li<<11|Mi>>>21,Qr=Vi<<15|Ui>>>17,jr=Ui<<15|Vi>>>17,$r=_i<<29|Hi>>>3,Kr=Hi<<29|_i>>>3,Xr=Wi<<28|zi>>>4,Yr=zi<<28|Wi>>>4,Zr=Ji<<23|Fi>>>9,es=Fi<<23|Ji>>>9,ts=Gi<<25|qi>>>7,os=qi<<25|Gi>>>7,ns=Qi<<21|ji>>>11,rs=ji<<21|Qi>>>11,ss=Ki<<24|$i>>>8,cs=$i<<24|Ki>>>8,as=Xi<<27|Yi>>>5,is=Yi<<27|Xi>>>5,ds=Zi<<20|ed>>>12,ls=ed<<20|Zi>>>12,us=od<<7|td>>>25,hs=td<<7|od>>>25,ws=nd<<8|rd>>>24,fs=rd<<8|nd>>>24,ms=sd<<14|cd>>>18,ps=cd<<14|sd>>>18;t[0]=br^~Or&Gr,t[1]=Sr^~Pr&qr,t[10]=Xr^~ds&Er,t[11]=Yr^~ls&Br,t[20]=Dr^~Fr&ts,t[21]=Tr^~Jr&os,t[30]=as^~kr&Lr,t[31]=is^~vr&Mr,t[40]=Wr^~Zr&us,t[41]=zr^~es&hs,t[2]=Or^~Gr&ns,t[3]=Pr^~qr&rs,t[12]=ds^~Er&Vr,t[13]=ls^~Br&Ur,t[22]=Fr^~ts&ws,t[23]=Jr^~os&fs,t[32]=kr^~Lr&Qr,t[33]=vr^~Mr&jr,t[42]=Zr^~us&xr,t[43]=es^~hs&Rr,t[4]=Gr^~ns&ms,t[5]=qr^~rs&ps,t[14]=Er^~Vr&$r,t[15]=Br^~Ur&Kr,t[24]=ts^~ws&Nr,t[25]=os^~fs&Ir,t[34]=Lr^~Qr&ss,t[35]=Mr^~jr&cs,t[44]=us^~xr&Hr,t[45]=hs^~Rr&_r,t[6]=ns^~ms&br,t[7]=rs^~ps&Sr,t[16]=Vr^~$r&Xr,t[17]=Ur^~Kr&Yr,t[26]=ws^~Nr&Dr,t[27]=fs^~Ir&Tr,t[36]=Qr^~ss&as,t[37]=jr^~cs&is,t[46]=xr^~Hr&Wr,t[47]=Rr^~_r&zr,t[8]=ms^~br&Or,t[9]=ps^~Sr&Pr,t[18]=$r^~Xr&ds,t[19]=Kr^~Yr&ls,t[28]=Nr^~Dr&Fr,t[29]=Ir^~Tr&Jr,t[38]=ss^~as&kr,t[39]=cs^~is&vr,t[48]=Hr^~Wr&Zr,t[49]=_r^~zr&es,t[0]^=uc[e*2],t[1]^=uc[e*2+1]}}class gh{state=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];blockSize=0;count=0;squeezing=!1;initialize(e,o){for(let n=0;n<50;++n)this.state[n]=0;this.blockSize=e/8,this.count=0,this.squeezing=!1}absorb(e){for(let o=0;o<e.length;++o)this.state[~~(this.count/4)]^=e[o]<<8*(this.count%4),this.count+=1,this.count===this.blockSize&&(kt(this.state),this.count=0)}absorbLastFewBits(e){this.state[~~(this.count/4)]^=e<<8*(this.count%4),(e&128)!==0&&this.count===this.blockSize-1&&kt(this.state),this.state[~~((this.blockSize-1)/4)]^=128<<8*((this.blockSize-1)%4),kt(this.state),this.count=0,this.squeezing=!0}squeeze(e){this.squeezing||this.absorbLastFewBits(1);const o=new Uint8Array(e);for(let n=0;n<e;++n)o[n]=this.state[~~(this.count/4)]>>>8*(this.count%4)&255,this.count+=1,this.count===this.blockSize&&(kt(this.state),this.count=0);return o}copy(e){for(let o=0;o<50;++o)e.state[o]=this.state[o];e.blockSize=this.blockSize,e.count=this.count,e.squeezing=this.squeezing}}class ce{_rate;_capacity;_delimitedSuffix;_hashBitLength;_state;_finalized;constructor(e,o,n,r){this._rate=e,this._capacity=o,this._delimitedSuffix=n,this._hashBitLength=r,this._state=new gh,this._state.initialize(e,o),this._finalized=!1}update(e){if(this._finalized)throw new Error("Digest already called");return this._state.absorb(new Uint8Array(e)),this}digest(){if(this._finalized)throw new Error("Digest already called");this._finalized=!0,this._delimitedSuffix&&this._state.absorbLastFewBits(this._delimitedSuffix);const e=this._state.squeeze(this._hashBitLength/8);return this._resetState(),To.encode(e)}_resetState(){return this._state.initialize(this._rate,this._capacity),this}}function Ah(t){switch(t.toLowerCase()){case"keccak224":return new ce(1152,448,null,224);case"keccak256":return new ce(1088,512,null,256);case"keccak384":return new ce(832,768,null,384);case"keccak512":return new ce(576,1024,null,512);case"sha3-224":return new ce(1152,448,6,224);case"sha3-256":return new ce(1088,512,6,256);case"sha3-384":return new ce(832,768,6,384);case"sha3-512":return new ce(576,1024,6,512);default:throw new Error("invalid algorithm: "+t)}}const yh=48,Ch=57,bh=97,Sh=102;class kh{convert(e){if(g(e,ArrayBuffer),e.byteLength!==20)throw new p(typeof e,"20-byte ArrayBuffer");const n=[...Mo(cc(new Uint8Array(e)),f=>f.split(""))],r=Ah("keccak256"),s=new TextEncoder;r.update(To.encode(s.encode(n.join(""))));const a=new Uint8Array(r.digest());return["0x",...q(Uo(Vo(e.byteLength*2),n,(f,h)=>[f,h]),([f,h])=>{const C=h.charCodeAt(0);if(C>=yh&&C<=Ch)return h;if(C>=bh&&C<=Sh){const O=Math.floor(f/2),A=f&1,m=a[O];return(A===0?m>>4:m&15)>7?h.toUpperCase():h}throw new z})].join("")}}const vh=new kh;class _o{keyCodec;valueCodec;constructor(e,o){this.keyCodec=e,this.valueCodec=o}convert(e){if(typeof e!="object"||e===null)throw new Error(`invalid map value: expected an object, got ${typeof e}`);const o=new Map;for(const[n,r]of Object.entries(e)){const s=this.keyCodec.decode(n),a=this.valueCodec.decode(r);o.set(s,a)}return o}}class Wo{keyCodec;valueCodec;constructor(e,o){this.keyCodec=e,this.valueCodec=o}convert(e){g(e,Map);const o={};for(const[n,r]of e.entries()){const s=this.keyCodec.encode(n),a=this.valueCodec.encode(r);o[s]=a}return o}}class Ve extends c{encoder;decoder;constructor(e,o){super(),this.encoder=o,this.decoder=e}static keyStringCodec(e){return new Ve(new _o(l,e),new Wo(l,e))}}class Eh{convert(e){if(!ee(e))throw new p(typeof e,"string");return new URL(e)}}class Bh{convert(e){return e.toString()}}class xh extends c{encoder=new Bh;decoder=new Eh}const hc=new xh,vt=new V(new L(hc),new M(hc));class zo{}const Ue="Set-Url";class Fo extends zo{url;constructor(e){super(),this.url=e}valueOf(){return Ue}toJSON(){return Jo.encode(this)}}class Rh{convert(e){return{[Ue]:e.url}}}class Nh{convert(e){i(e,Ue);const o=e[Ue];if(typeof o!="string")throw new p(typeof o,"string");return new Fo(o)}}class Ih extends c{encoder=new Rh;decoder=new Nh}const Jo=new Ih;class wc{}const He="Close";class _e extends zo{valueOf(){return He}}class Dh{convert(){return He}}class Th{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==He)throw new p(e,He);return new _e}}class Oh extends c{encoder=new Dh;decoder=new Th}const fc=new Oh,We="Connect";class ze extends zo{valueOf(){return We}toJSON(){return Go.encode(this)}}class Ph{convert(){return We}}class Lh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==We)throw new p(e,We);return new ze}}class Mh extends c{encoder=new Ph;decoder=new Lh}const Go=new Mh;class Vh{convert(e){if(e===We)return Go.decode(e);if(e===He)return fc.decode(e);if(typeof e=="object"&&e!==null&&Ue in e)return Jo.decode(e);throw new z}}class Uh{convert(e){if(e instanceof ze)return Go.encode(e);if(e instanceof _e)return fc.encode(e);if(e instanceof Fo)return Jo.encode(e);throw new z}}class Hh extends c{encoder=new Uh;decoder=new Vh}const mc=new Hh;class Fe extends wc{command;get type(){return Je}constructor(e){super(),this.command=e}toJSON(){return pc.encode(this)}}const Je="WebSocket";class _h{convert(e){return{[Je]:mc.encode(e.command)}}}class Wh{convert(e){return i(e,Je),new Fe(mc.decode(e[Je]))}}class zh extends c{encoder=new _h;decoder=new Wh}const pc=new zh,me=new Map;me.set(Je,pc);class Fh{convert(e){const o=me.get(e.type);if(!o)throw new p(e.type,`one of ${Array.from(q(me.keys(),n=>`"${n}"`)).join(", ")}`);return{[e.type]:o.encode(e)}}}class Jh{convert(e){if(typeof e!="object"||e===null)throw new p(typeof e,"object");const o=Object.keys(e);if(o.length!==1)throw new z("multiple values contained within the Request object, unexpected");const[n]=o,r=me.get(n);if(i(e,n),!r)throw new p(n,`one of ${Array.from(q(me.keys(),s=>`"${s}"`)).join(", ")}`);return r.decode(e[n])}}class Gh extends c{encoder=new Fh;decoder=new Jh}function qh(t,e){me.has(t)||me.set(t,e)}const Qh=new Gh;class qo{}const Ge="Error";class gc extends qo{error;get type(){return Ge}constructor(e){super(),this.error=e}toJSON(){return Ac.encode(this)}}class jh{convert(e){return{[Ge]:ft.encode(e.error)}}}class $h{convert(e){return i(e,Ge),new gc(ft.decode(e[Ge]))}}class Kh extends c{encoder=new jh;decoder=new $h}const Ac=new Kh;class Qo{}const qe="Closed";class ke extends Qo{valueOf(){return qe}toJSON(){return jo.encode(this)}}class Xh{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==qe)throw new p(e,qe);return new ke}}class Yh{convert(){return qe}}class Zh extends c{encoder=new Yh;decoder=new Xh}const jo=new Zh,Qe="Connecting";class je extends Qo{valueOf(){return Qe}toJSON(){return $o.encode(this)}}class ew{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==Qe)throw new p(e,Qe);return new je}}class tw{convert(){return Qe}}class ow extends c{encoder=new tw;decoder=new ew}const $o=new ow,$e="Opened";class Ke extends Qo{valueOf(){return $e}toJSON(){return Ko.encode(this)}}class nw{convert(e){if(typeof e!="string")throw new p(typeof e,"string");if(e!==$e)throw new p(e,$e);return new Ke}}class rw{convert(){return $e}}class sw extends c{encoder=new rw;decoder=new nw}const Ko=new sw;class cw{convert(e){if(e===$e)return Ko.decode(e);if(e===qe)return jo.decode(e);if(e===Qe)return $o.decode(e);throw new z}}class aw{convert(e){if(e instanceof Ke)return Ko.encode(e);if(e instanceof ke)return jo.encode(e);if(e instanceof je)return $o.encode(e);throw new z}}class iw extends c{encoder=new aw;decoder=new cw}const yc=new iw;class Cc extends qo{status;get type(){return Xe}constructor(e){super(),this.status=e}toJSON(){return bc.encode(this)}}const Xe="WebSocket";class dw{convert(e){return{[Xe]:yc.encode(e.status)}}}class lw{convert(e){return i(e,Xe),new Cc(yc.decode(e[Xe]))}}class uw extends c{encoder=new dw;decoder=new lw}const bc=new uw,ae=new Map;ae.set(Ge,Ac),ae.set(Xe,bc);class hw{convert(e){const o=ae.get(e.type);if(!o)throw new p(e.type,`one of ${Array.from(q(ae.keys(),n=>`"${n}"`)).join(", ")}`);return{[e.type]:o.encode(e)}}}class ww{convert(e){if(typeof e!="object"||e===null)throw new p(typeof e,"object");const o=Object.keys(e);if(o.length!==1)throw new z("multiple values contained within the response object, unexpected");const[n]=o,r=ae.get(n);if(i(e,n),!r)throw new p(n,`one of ${Array.from(q(ae.keys(),s=>`"${s}"`)).join(", ")}`);return r.decode(e[n])}}class fw extends c{encoder=new hw;decoder=new ww}function mw(t,e){ae.has(t)||ae.set(t,e)}const pw=new fw;class gw{convert(e){return new gc(e)}}const Aw=new gw;class yw{convert(e){return new Cc(e)}}const Xo=new yw;class Cw{constructor(e,o){this.sink=e,this.converter=o,this.sink=e,this.converter=o}async send(e){await this.sink.send(this.converter.convert(e))}}function pe(t,e){return new Cw(t,e)}async function Yo(t){return new Promise(e=>{const o=setTimeout(()=>{clearTimeout(o),e()},t)})}class te{constructor(e,o,n){this.alpha3Code=e,this.code=o,this.significantDigits=n,this.alpha3Code=e,this.code=o,this.significantDigits=n,this.significantDigitsMultiplier=BigInt(10)**BigInt(this.significantDigits)}significantDigitsMultiplier;toJSON(){return en.encode(this)}}const Sc=new te("JPY",392,0),bw=new te("GBP",826,2),kc=new te("USD",840,2),Sw=new te("EUR",978,2),kw=new te("XXX",999,2),vc=new te("ETH",1001,18),Zo=new te("XBT",1002,8),Ec=new te("ESP",10001,18),vw=[Sc,bw,kc,Sw,kw,vc,Zo,Ec],Ew=new Map(vw.map(t=>[t.alpha3Code,t]));class Bw{convert(e){if(typeof e!="string")throw new ne("CurrencyCodeDecoder: expected string");if(e==="BTC")return Zo;const o=Ew.get(e);if(o===void 0)throw new ne(`CurrencyCodeDecoder: unknown currency: "${e}"`);return o}}class xw{convert(e){return g(e,te),e.alpha3Code}}class Rw extends c{decoder=new Bw;encoder=new xw}const en=new Rw;class K{constructor(e,o){this.currency=e,this.value=o,this.currency=e,this.value=o}static USD(e){return new K(kc,BigInt(e))}static ETH(e){return new K(vc,BigInt(e))}static ESP(e){return new K(Ec,BigInt(e))}static JPY(e){return new K(Sc,BigInt(e))}static BTC(e){return new K(Zo,BigInt(e))}toString(){return Et.encode(this)}toISOString(){return this.toString()}toNumericLiteralString(){return Bc.convert(this)}toHexString(){return N.encode(this.value)}toJSON(){return Et.encode(this)}}function Nw(t){return t==="."||t===","||t===" "}function Iw(t,e){let o=-1;const n=t.length;for(let r=0;r<n;r++)e(t[r])&&(o=r);return o}class Dw{parseCurrencyCode(e){return en.decode(e)}parseValue(e,o){let n=1n;o[0]==="-"&&(n=-1n,o=o.substring(1));const r=Iw(o,Nw);if(r===-1){const h=BigInt(o.replace(/\D/g,""))*e.significantDigitsMultiplier;return n*h}const s=o.substring(0,r).replace(/\D/g,""),a=o.substring(r+1).replace(/\D/g,""),d=BigInt(s)*e.significantDigitsMultiplier,f=BigInt(a)*10n**BigInt(e.significantDigits-a.length);return n*(d+f)}convert(e){if(typeof e!="string")throw new ne("MonetaryValueDecoder: expected string");const o=e.indexOf(" ");if(o<=-1)throw new ne("MonetaryValueDecoder: missing non-breaking space");const n=e.substring(0,o),r=e.substring(o+1);if(/^-?[\d .,]+$/.test(n)){const a=this.parseCurrencyCode(r);return new K(a,this.parseValue(a,n))}const s=this.parseCurrencyCode(n);return new K(s,this.parseValue(s,r))}}class Tw{convert(e){const o=e.value<0n?"-":"",n=e.value<0n?-e.value:e.value,r=n%e.currency.significantDigitsMultiplier,s=n/e.currency.significantDigitsMultiplier,a=String(s),d=String(r);return/^0+$/.test(d)?`${o}${a}`:`${o}${s}.${String(r).padStart(e.currency.significantDigits,"0")}`}}const Bc=new Tw;class Ow{convert(e){g(e,K);const o=Bc.convert(e);return`${en.encode(e.currency)} ${o}`}}class Pw extends c{decoder=new Dw;encoder=new Ow}const Et=new Pw,xc=new E(new k(Et),new v(Et));class y{namespace;name;site;blockExplorer;constructor(e,o,n,r){this.namespace=e,this.name=o,this.site=n,this.blockExplorer=r}}const Lw=new y(202374881,"Vienna",new URL("https://vienna.caldera.dev/"),new URL("https://vienna.calderaexplorer.xyz/")),Mw=new y(202374882,"OP Stack",new URL("https://stack.optimism.io/"),new URL("https://www.blockscout.com/")),Vw=new y(33914988448,"Arbitrum",new URL("https://arbitrum.io/"),new URL("https://arbiscan.io/")),Uw=new y(33914988449,"Eigen Layer",new URL("https://www.eigenlayer.xyz/"),new URL("https://www.blockscout.com/")),Hw=new y(33914988450,"Spire",new URL("https://www.spire.dev/"),new URL("https://www.blockscout.com/")),_w=new y(33914988451,"Alt Layer",new URL("https://altlayer.io/"),new URL("https://www.blockscout.com/")),Ww=new y(33914988452,"Caldera",new URL("https://www.caldera.xyz/"),new URL("https://www.blockscout.com/")),zw=new y(33914988453,"Vistara Labs",new URL("https://vistara.dev/"),new URL("https://www.blockscout.com/")),Fw=new y(33914988454,"Polygon",new URL("https://polygon.technology/"),new URL("https://www.blockscout.com/")),Jw=new y(263,"Milan",new URL("https://milan.caldera.dev/"),new URL("https://milan-devnet.explorer.caldera.xyz/")),Gw=new y(41234687,"Kyoto",new URL("https://example.com/"),new URL("https://kyoto-explorer.altlayer.io/")),qw=1918988905,Qw=new y(qw,"RARI",new URL("https://rarichain.org/"),new URL("https://explorer.rarichain.org/")),jw=1380012617,$w=new y(jw,"RARI",new URL("https://rarichain.org/"),new URL("https://mainnet.explorer.rarichain.org/")),Kw=9369,Xw=new y(Kw,"LogX",new URL("https://logx.network/"),new URL("https://kartel-testnet-explorer.alt.technology/")),Yw=936369,Zw=new y(Yw,"LogX",new URL("https://logx.network/"),new URL("https://vzjuxmhfn70kgnlds27h-explorer.alt.technology")),ef=466,tf=new y(ef,"AppChain",new URL("https://appchain.xyz/"),new URL("https://explorer.appchain.xyz/")),of=4661,nf=new y(of,"AppChain",new URL("https://appchain.xyz/"),new URL("https://appchaintestnet.explorer.caldera.xyz/")),rf=360,sf=new y(rf,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),cf=3609,af=new y(cf,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),df=33139,lf=new y(df,"APECHAIN",new URL("https://apechain.com/"),new URL("https://apescan.io/")),uf=3313939,hf=new y(uf,"APECHAIN",new URL("https://apechain.com/"),new URL("https://apechain-testnet.explorer.caldera.xyz/")),wf=13107,ff=new y(wf,"t3rn",new URL("https://t3rn.io/"),new URL("https://brn-testnet.explorer.caldera.xyz/")),mf=819,pf=new y(mf,"t3rn",new URL("https://t3rn.io/"),new URL("https://exporer.t3rn.io/")),Rc=21341,gf=new y(Rc,"Rufus",new URL("https://l2beat.com/scaling/projects/rufus"),new URL("https://rufus-sepolia-testnet.explorer.caldera.xyz/")),Af=new y(Rc,"Rufus",new URL("https://l2beat.com/scaling/projects/rufus"),new URL("https://rufus.calderaexplorer.xyz/")),yf=2524852,Cf=new y(yf,"Huddle01",new URL("https://huddle01.com/"),new URL("https://hudlscan.com/txs")),bf=1397311310,Nc=new y(bf,"Infinite Garden",new URL("https://infinitegarden.espressosys.com/"),new URL("https://explorer.main.net.espressosys.com/")),Sf=10101,kf=new y(Sf,"Timeboost Decaf",new URL("https://espressosys.com/"),new URL("https://explorer.decaf.testnet.espresso.network/")),vf=[Nc,$w,Zw,sf,tf,lf,pf,Af],Ef=[Nc,Qw,Xw,nf,af,hf,ff,gf,Cf,kf],Bf=new Map([Lw,Mw,Vw,Fw,Uw,Hw,_w,Ww,zw,Jw,Gw,...vf,...Ef].map(t=>[t.namespace,t]));class X{tag;data;constructor(e,o){this.tag=e,this.data=o}static fromString(e){const o=e.indexOf("~");if(o<0)throw new Os;const n=e.substring(0,o),r=Po.decodeString(e.substring(o+1));return new X(n,r)}static inflate(e){return w.decode(e)}toString(){return`${this.tag}~${Po.encodeToString(this.data)}`}valueOf(){return this.toString()}toJSON(){return this.toString()}}class xf{convert(e){if(typeof e!="string")throw new p(typeof e,"string");return X.fromString(e)}}class Rf{convert(e){return g(e,X),e.toString()}}class Nf extends c{encoder=new Rf;decoder=new xf}const w=new Nf,Ye=2147483648,If=1103515245,Df=12345;class ie{state;constructor(e){this.state=e!==void 0?e:Math.floor(Math.random()*(Ye-1))}nextInt(){return this.state=(If*this.state+Df)%Ye,this.state}nextFloat(){return this.nextInt()/(Ye-1)}nextRange(e,o){const n=o-e,r=this.nextInt()/Ye;return e+Math.floor(r*n)}nextRangeBigInt(e,o){const n=o-e,r=BigInt(this.nextInt())*1000000n/BigInt(Ye);return e+r*n/1000000n}fillBytes(e){const o=new ArrayBuffer(e),n=new DataView(o);let r=0;for(;r<e-4;r+=4)n.setUint32(r,this.nextRange(0,4294967295));for(let s=r;s<e;s++)n.setUint8(s,this.nextRange(0,256));return o}}const Bt=new Date,Tf=new Date(Bt.getFullYear(),Bt.getMonth(),Bt.getDate()).valueOf();function Ic(){return Bt.valueOf()}function xt(){return Tf}const Dc=["Residential","Mobile","Enterprise","AWS","Azure","GCP"],Tc=["Espresso v1.0","Espresso v1.1","Espresso v1.2","Espresso v1.3","Espresso v1.4"],Oc=["Linux","Unix","Windows","MacOS"],Pc=[["Espresso","https://espressosys.com/"],["BlockDaemon","https://www.blockdaemon.com/"],["Unit 410","https://unit410.com/"],["Nethermind","https://www.nethermind.io/"],["Sub7","https://sub7.xyz/"],["KudasaiJP","https://kudasai.co.jp/"],["Informal Systems","https://informal.systems/"],["P2P","https://p2p.org/"],["LinkPool","https://linkpool.com/"],["ZKV","https://zkvalidator.com/"],["Figment","https://figment.io/"]],Of=[[["Mexico City",19.4333,-99.1333,"MX"],["Guadalajara",20.6767,-103.3475,"MX"],["Monterrey",25.6667,-100.3,"MX"],["Guatemala City",14.6133,-90.5353,"GT"],["Tijuana",32.525,-117.0333,"MX"],["Ecatepec",19.6097,-99.06,"MX"],["Tegucigalpa",14.1058,-87.2047,"HN"],["León de los Aldama",21.1167,-101.6833,"MX"],["San José",9.9325,-84.08,"CR"],["Panama City",8.9833,-79.5167,"PA"],["Juárez",31.745,-106.485,"MX"],["Comayagüela",14.098,-87.21,"HN"],["Mexicali",32.6633,-115.4678,"MX"],["Nezahualcóyotl",19.4081,-99.0186,"MX"],["Managua",12.1364,-86.2514,"NI"],["Morelia",19.7683,-101.1894,"MX"],["Aguascalientes",21.876,-102.296,"MX"],["Mérida",20.97,-89.62,"MX"],["Saltillo",25.4231,-100.9919,"MX"],["Culiacán",24.8069,-107.3939,"MX"]],[["Havana",23.1367,-82.3589,"CU"],["San Juan",18.3985,-66.061,"PR"],["Santiago",19.4572,-70.6889,"DO"],["Santo Domingo",18.4667,-69.95,"DO"],["Port-au-Prince",18.5333,-72.3333,"HT"],["Santo Domingo Este",18.4855,-69.8734,"DO"],["Kingston",17.9714,-76.7931,"JM"],["Carrefour",18.5344,-72.4094,"HT"],["Santiago de Cuba",20.0217,-75.8294,"CU"],["Pétion-Ville",18.5128,-72.2864,"HT"],["Holguín",20.8869,-76.2592,"CU"],["Gonaïves",19.4456,-72.6883,"HT"],["Camagüey",21.3839,-77.9075,"CU"],["Puerto Plata",19.8,-70.6833,"DO"],["Croix-des-Bouquets",18.5761,-72.2269,"HT"],["Nassau",25.0781,-77.3386,"BS"],["Fort-de-France",14.6,-61.0667,"MQ"],["Higüey",18.6167,-68.7,"DO"],["Santa Clara",22.4069,-79.9649,"CU"],["Bayamo",20.3817,-76.6428,"CU"]],[["Cairo",30.0444,31.2358,"EG"],["Lagos",6.455,3.3841,"NG"],["Kinshasa",-4.3219,15.3119,"CD"],["Luanda",-8.8383,13.2344,"AO"],["Johannesburg",-26.2044,28.0456,"ZA"],["Dar es Salaam",-6.8161,39.2803,"TZ"],["Douala",4.05,9.7,"CM"],["Giza",29.987,31.2118,"EG"],["Abidjan",5.3167,-4.0333,"CI"],["Cape Town",-33.9253,18.4239,"ZA"],["Bamako",12.6392,-8.0028,"ML"],["Abuja",9.0667,7.4833,"NG"],["Ibadan",7.3964,3.9167,"NG"],["Addis Ababa",9.03,38.74,"ET"],["Mbuji-Mayi",-6.15,23.6,"CD"],["Mogadishu",2.0392,45.3419,"SO"],["Lusaka",-15.4167,28.2833,"ZM"],["Antananarivo",-18.91,47.525,"MG"],["Awka",6.2069,7.0678,"NG"],["Bamenda",5.9614,10.1517,"CM"]],[["Tokyo",35.6897,139.6922,"JP"],["Delhi",28.61,77.23,"IN"],["Manila",14.5958,120.9772,"PH"],["Dhaka",23.7639,90.3889,"BD"],["Moscow",55.7558,37.6172,"RU"],["Ho Chi Minh City",10.7756,106.7019,"VN"],["Xi’an",34.2611,108.9422,"CN"],["Dongguan",23.021,113.752,"CN"],["Tongshan",34.204,117.284,"CN"],["Jining",35.4151,116.5871,"CN"],["Cangzhou",38.3047,116.8387,"CN"],["Shaoyang",27.2395,111.4679,"CN"],["Dalian",38.9,121.6,"CN"],["Ankara",39.93,32.85,"TR"],["Zhangzhou",24.513,117.647,"CN"],["Changsha",28.228,112.939,"CN"],["Ürümqi",43.8225,87.6125,"CN"],["Ningbo",29.8603,121.6245,"CN"],["Suihua",46.654,126.969,"CN"],["Deyang",31.127,104.398,"CN"]],[["London",51.5072,-.1275,"GB"],["Madrid",40.4169,-3.7033,"ES"],["Berlin",52.52,13.405,"DE"],["Barcelona",41.3828,2.1769,"ES"],["Athens",37.9842,23.7281,"GR"],["Budapest",47.4925,19.0514,"HU"],["Birmingham",52.48,-1.9025,"GB"],["Stuttgart",48.7775,9.18,"DE"],["Munich",48.1375,11.575,"DE"],["Hamburg",53.55,10,"DE"],["Bucharest",44.4325,26.1039,"RO"],["Vienna",48.2083,16.3725,"AT"],["Stockholm",59.3294,18.0686,"SE"],["Minsk",53.9,27.5667,"BY"],["Warsaw",52.23,21.0111,"PL"],["Valencia",39.47,-.3764,"ES"],["Amsterdam",52.3728,4.8936,"NL"],["Copenhagen",55.6761,12.5683,"DK"],["Porto",41.1621,-8.622,"PT"],["Brussels",50.8467,4.3525,"BE"]],[["New York",40.6943,-73.9249,"US"],["Los Angeles",34.1141,-118.4068,"US"],["Chicago",41.8375,-87.6866,"US"],["Miami",25.784,-80.2101,"US"],["Dallas",32.7935,-96.7667,"US"],["Philadelphia",40.0077,-75.1339,"US"],["Atlanta",33.7628,-84.422,"US"],["Boston",42.3188,-71.0852,"US"],["Phoenix",33.5722,-112.0892,"US"],["Detroit",42.3834,-83.1024,"US"],["Seattle",47.6211,-122.3244,"US"],["San Francisco",37.7558,-122.4449,"US"],["San Diego",32.8313,-117.1222,"US"],["Minneapolis",44.9635,-93.2678,"US"],["Brooklyn",40.6501,-73.9496,"US"],["Vancouver",49.25,-123.1,"CA"],["Riverside",33.9381,-117.3949,"US"],["Baltimore",39.3051,-76.6144,"US"],["Portland",45.5371,-122.65,"US"],["Sacramento",38.5677,-121.4685,"US"]],[["Melbourne",-37.8142,144.9631,"AU"],["Sydney",-33.8678,151.21,"AU"],["Brisbane",-27.4678,153.0281,"AU"],["Perth",-31.9559,115.8606,"AU"],["Auckland",-36.8406,174.74,"NZ"],["Adelaide",-34.9275,138.6,"AU"],["Port Moresby",-9.4789,147.1494,"PG"],["Gold Coast",-28.0167,153.4,"AU"],["Cranbourne",-38.0996,145.2834,"AU"],["Christchurch",-43.531,172.6365,"NZ"],["Manukau City",-37,174.885,"NZ"],["Central Coast",-33.3,151.2,"AU"],["Wollongong",-34.4331,150.8831,"AU"],["Ipswich",-27.6144,152.7608,"AU"],["Wellington",-41.2889,174.7772,"NZ"],["Northcote",-36.8019,174.7494,"NZ"],["Hobart",-42.8806,147.325,"AU"],["Lae",-6.7303,147.0008,"PG"],["Suva",-18.1416,178.4419,"FJ"],["Nouméa",-22.2758,166.458,"NC"]],[["São Paulo",-23.55,-46.6333,"BR"],["Buenos Aires",-34.6033,-58.3817,"AR"],["Rio de Janeiro",-22.9111,-43.2056,"BR"],["Lima",-12.06,-77.0375,"PE"],["Bogotá",4.7111,-74.0722,"CO"],["Santiago",-33.4372,-70.6506,"CL"],["Belo Horizonte",-19.9167,-43.9333,"BR"],["Fortaleza",-3.7275,-38.5275,"BR"],["Santa Cruz de la Sierra",-17.7892,-63.1975,"BO"],["La Paz",-16.4958,-68.1333,"BO"],["Guayaquil",-2.19,-79.8875,"EC"],["Medellín",6.2308,-75.5906,"CO"],["Salvador",-12.9747,-38.4767,"BR"],["Caracas",10.4806,-66.9036,"VE"],["Córdoba",-31.4167,-64.1833,"AR"],["Santos",-23.9369,-46.325,"BR"],["Curitiba",-25.4297,-49.2711,"BR"],["Maracaibo",10.6333,-71.6333,"VE"],["Recife",-8.05,-34.9,"BR"],["Porto Alegre",-30.0331,-51.23,"BR"]]],Lc=[0,0,5,26,28,26,9,6],Pf=Lc.reduce((t,e)=>t+e,0),Lf=Lc.reduce((t,e)=>{const o=t[t.length-1]??0;return t.push(o+e),t},[]),Mf=Array.from(Uo(Lf,Of,(t,e)=>[t,e]));function Vf(t){const e=t.nextRange(0,Pf),o=Lo(Mf,([a])=>a<=e),[,n]=Ku(o),r=t.nextRange(0,n.length);return n[r]}function Uf(t){const e=t.nextRange(0,Pc.length);return Pc[e]}function Hf(t){const e=t.nextRange(0,Oc.length);return Oc[e]}function _f(t){const e=t.nextRange(0,Tc.length);return Tc[e]}function Wf(t){const e=t.nextRange(0,Dc.length);return Dc[e]}function zf(t){const[e,o]=Uf(t),[,n,r,s]=Vf(t),a=Hf(t),d=_f(t),f=Wf(t);return{pubkey:new X("PUBKEY",t.fillBytes(32)),stateVerKey:new X("STATE_VER_KEY",t.fillBytes(32)),stake:t.nextRangeBigInt(0n,1000n)*1000000000000000000n,commission:t.nextRange(0,5e3),name:`${e} Node ${s} ${t.nextRange(0,100)}`,address:t.fillBytes(32),company:{name:e,website:o},location:{coords:[n,r],country:s},operatingSystem:a,networkType:f,nodeType:d}}function*Ff(t=new ie(xt())){const e=t.nextRange(100,350);for(let o=0;o<e;o++)yield zf(new ie(o))}const ge=Array.from(Ff());async function*Jf(){}function Mc(){const t=new Uint8Array(new Array(20).map(()=>0)).buffer;return{hash:new X("BLOCK",t),height:0,time:new Date(0),genTime:0,transactions:Jf(),numTransactions:0,proposer:[],size:0,fees:[]}}async function*Gf(t,e=Ic()){let o=1,n=xt();for(;n<e;){const r=Math.floor(t.nextFloat()*14*1e3);yield Vc(new ie(o+r),o,n,n+r),n+=r,o++}}async function*qf(t=new ie(xt()),e=Ic()){yield Mc(),yield*Gf(t,e)}async function*Qf(t,e,o,n=!0){let r=e,s=o;for(;;){const a=Math.floor(t.nextFloat()*14*1e3),d=r+a-Date.now();n&&d>0&&await Yo(d),yield Vc(new ie(s+a),s,r,r+a),r+=a,s++}}function Vc(t,e,o,n){const r=Math.floor(t.nextRange(0,5)),s=t.nextRange(0,ge.length),a=ge[s];return{hash:new X("BLOCK",t.fillBytes(32)),height:e,genTime:n-o,time:new Date(n),numTransactions:r,transactions:$f(new ie(e+o),e,o,n,r),proposer:[a.address],size:Math.floor(t.nextFloat()*1024*r)+8,fees:[K.ESP(BigInt(t.nextRange(0,1e9)*1e3))]}}const Uc=Array.from(Bf.keys());function jf(t){return t.nextFloat()>.98?1:Uc[t.nextRange(0,Uc.length)]}async function*$f(t,e,o,n,r){const s=(n-o)/r;for(let a=0,d=o;d<n;d+=s,a++){const f=jf(t),h=Math.floor(1024*t.nextFloat());yield{block:e,index:a,size:h,hash:new X("COMMIT",t.fillBytes(32)),time:new Date(d),sender:new X("PUBKEY",t.fillBytes(32)),tree:{namespace:f,data:t.fillBytes(h)}}}}const tn=1e4,Hc=0,Kf="PercentageOutOfRange";class Xf extends B{value;constructor(e,o=`the commission percentage is outside of the range [${Hc}, ${tn}], have ${e}`){super(o),this.value=e,Object.freeze(this)}get code(){return Kf}}class on{value;constructor(e){if(e<Hc||e>tn)throw new Xf(e);this.value=e}toString(){return`${this.value/100}%`}toJSON(){return this.value}valueOf(){return this.value/tn}}class Yf{convert(e){if(typeof e!="number")throw new p(typeof e,"number");return new on(e)}}class Zf{convert(e){if(!(e instanceof on))throw new p(e,"CommissionPercent");return Math.floor(e.value)}}class em extends c{encoder=new Zf;decoder=new Yf}const Rt=new em;let nn=class{stakeKey;stakeAmount;constructor(e,o){this.stakeKey=e,this.stakeAmount=o}},tm=class{convert(e){return i(e,"stake_key","stake_amount"),new nn(w.decode(e.stake_key),N.decode(e.stake_amount))}},om=class{convert(e){return g(e,nn),{stake_key:w.encode(e.stakeKey),stake_amount:N.encode(e.stakeAmount)}}},nm=class extends c{encoder=new om;decoder=new tm};const ve=new nm;new V(new L(ve),new M(ve)),new E(new k(ve),new v(ve));class rn{stakeTableEntry;stateVerKey;constructor(e,o){this.stakeTableEntry=e,this.stateVerKey=o}}class rm{convert(e){return i(e,"stake_table_entry","state_ver_key"),new rn(ve.decode(e.stake_table_entry),w.decode(e.state_ver_key))}}class sm{convert(e){return g(e,rn),{stake_table_entry:ve.encode(e.stakeTableEntry),state_ver_key:w.encode(e.stateVerKey)}}}class cm extends c{encoder=new sm;decoder=new rm}const Nt=new cm;new V(new L(Nt),new M(Nt));const It=new E(new k(Nt),new v(Nt));class _c{address;constructor(e){this.address=e,Object.freeze(this)}toJSON(){return Ee.encode(this)}toString(){return Ee.encode(this)}}class am{convert(e){return e.address.byteLength!==20?R.encode(e.address):vh.convert(e.address)}}class im{convert(e){return new _c(R.decode(e))}}class dm extends c{encoder=new am;decoder=new im}const Ee=new dm;new V(new L(Ee),new M(Ee));const Wc=Ve.keyStringCodec(N);class sn{account;stakeTableKey;stateVerKey;stake;commission;delegators;constructor(e,o,n,r,s,a){this.account=e,this.stakeTableKey=o,this.stateVerKey=n,this.stake=r,this.commission=s,this.delegators=a}}class lm{convert(e){return i(e,"account","stake_table_key","state_ver_key","stake","commission","delegators"),new sn(Ee.decode(e.account),w.decode(e.stake_table_key),w.decode(e.state_ver_key),N.decode(e.stake),Rt.decode(e.commission),Wc.decode(e.delegators))}}class um{convert(e){return g(e,sn),{account:Ee.encode(e.account),stake_table_key:w.encode(e.stakeTableKey),state_ver_key:w.encode(e.stateVerKey),stake:N.encode(e.stake),commission:Rt.encode(e.commission),delegators:Wc.encode(e.delegators)}}}class hm extends c{encoder=new um;decoder=new lm}const Be=new hm;new V(new L(Be),new M(Be));const zc=new E(new k(Be),new v(Be));class Ze{constructor(e){this.value=e,this.value=e}valueOf(){return Number(this.value)}toString(){return Number(this.value).toString()}}function cn(t,e){return t.valueOf()<e.valueOf()}function wm(t,e){return t.valueOf()<=e.valueOf()}function Dt(t,e){return t.valueOf()>e.valueOf()}function Fc(t,e){return wm(t,e)?t:e}function Jc(t,e){return Dt(t,e)?t:e}class an{min;max;constructor(e,o){this.min=e,this.max=o}contains(e){return!(cn(e.lat,this.min.lat)||Dt(e.lat,this.max.lat)||cn(e.lng,this.min.lng)||Dt(e.lng,this.max.lng))}}function et(t){const e=t[Symbol.iterator](),o=nc(e),[n,r]=rc(([s,a],d)=>[s.min(d.bbox.min),a.max(d.bbox.max)],[o.bbox.min,o.bbox.max],e);return new an(n,r)}function fm(t){const e=t[Symbol.iterator](),o=nc(e),[n,r]=rc(([s,a],d)=>[s.min(d),a.max(d)],[o,o],e);return new an(n,r)}class Ae{}const Gc=new Map;function ye(t,e){Gc.set(t,e)}function qc(t){const e=Gc.get(t);if(!e)throw new De(t);return e}class mm{convert(e){return qc(e.type).encode(e)}}class pm{convert(e){if(i(e,"type","coordinates"),!ee(e.type))throw new p(typeof e.type,"string");return qc(e.type).decode(e)}}class gm extends c{encoder;decoder;constructor(){super(),this.encoder=new mm,this.decoder=new pm}}const Qc=new gm,jc=new E(new k(Qc),new v(Qc)),dn="GeometryCollection";class Am extends Ae{type=dn;geometries;bbox;constructor(e){super(),this.geometries=e,this.bbox=et(e)}toJSON(){return $c.encode(this)}}class ym{listGeometryCodec;constructor(e){this.listGeometryCodec=e}convert(e){return{type:e.type,geometries:this.listGeometryCodec.encode(e.geometries)}}}class Cm{listGeometryCodec;constructor(e){this.listGeometryCodec=e}convert(e){return i(e,"type","geometries"),le(e,dn),new Am(this.listGeometryCodec.decode(e.geometries))}}class bm extends c{encoder=new ym(jc);decoder=new Cm(jc)}const $c=new bm;ye(dn,$c);class _ extends Ze{toString(){return`${Number(this)}°`}}class Sm{convert(e){return Number(e)}}class km{convert(e){if(!ht(e))throw new p(typeof e,"number");return new _(e)}}class vm extends c{encoder;decoder;constructor(){super(),this.encoder=new Sm,this.decoder=new km}}const Em=new vm;class D extends Ze{toString(){return`${String(this.value)} lat`}}class T extends Ze{toString(){return`${String(this.value)} lng`}}class Y extends Ze{toString(){return`${Number(this)} rad`}}class Bm{convert(e){return Number(e)}}class xm{convert(e){if(!ht(e))throw new p(typeof e,"number");return new Y(e)}}class Rm extends c{encoder;decoder;constructor(){super(),this.encoder=new Bm,this.decoder=new xm}}const Nm=new Rm;class x{constructor(e,o){this.lat=e,this.lng=o,this.lat=e,this.lng=o}min(e){return new x(Fc(this.lat,e.lat),Fc(this.lng,e.lng))}max(e){return new x(Jc(this.lat,e.lat),Jc(this.lng,e.lng))}toString(){return`${this.lat}, ${this.lng}`}}class Im{unitCodec;constructor(e){this.unitCodec=e}convert(e){return[this.unitCodec.encode(e.lat.value),this.unitCodec.encode(e.lng.value)]}}class Dm{unitCodec;constructor(e){this.unitCodec=e}convert(e){if(!(e instanceof Array))throw new p(typeof e,"Array");if(e.length!==2)throw new TypeError(`Expected array of length 2, got ${e.length}`);const[o,n]=e;return new x(new D(this.unitCodec.decode(o)),new T(this.unitCodec.decode(n)))}}class Kc extends c{encoder;decoder;constructor(e){super(),this.encoder=new Im(e),this.decoder=new Dm(e)}}const Xc=new Kc(Em),Yc=new Kc(Nm),Zc=new V(new L(Xc),new M(Xc));new V(new L(Yc),new M(Yc));class Tm{convert(e){return[Number(e.lng),Number(e.lat)]}}class Om{convert(e){if(!(e instanceof Array))throw new p(typeof e,"Array");if(e.length!==2)throw new TypeError(`Expected array of length 2, got ${e.length}`);return new x(new D(new _(e[1])),new T(new _(e[0])))}}class Pm extends c{encoder=new Tm;decoder=new Om}const Tt=new Pm,xe=new E(new k(Tt),new v(Tt)),Re=new E(new k(xe),new v(xe)),ea=new E(new k(Re),new v(Re)),ln="LineString";class ta extends Ae{type=ln;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=fm(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return oa.encode(this)}}class Lm{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates)}}}class Mm{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,ln);const o=this.codec.decode(e.coordinates);return new ta(o)}}class Vm extends c{encoder=new Lm(xe);decoder=new Mm(xe)}const oa=new Vm;ye(ln,oa);const un="MultiLineString";class Um extends Ae{type=un;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=et(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return na.encode(this)}}class Hm{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates))}}}class _m{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,un);const o=this.codec.decode(e.coordinates);return new Um(o.map(n=>new ta(n)))}}class Wm extends c{encoder=new Hm(Re);decoder=new _m(Re)}const na=new Wm;ye(un,na);const hn="Point";class Ot extends Ae{type=hn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=new an(this.coordinates,this.coordinates)}toJSON(){return ra.encode(this)}}class zm{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates)}}}class Fm{codec;constructor(e){this.codec=e}convert(e){return i(e,"type","coordinates"),le(e,hn),new Ot(this.codec.decode(e.coordinates))}}class Jm extends c{encoder=new zm(Tt);decoder=new Fm(Tt)}const ra=new Jm;ye(hn,ra);const wn="MultiPoint";class fn extends Ae{type=wn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=et(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return sa.encode(this)}}class Gm{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates))}}}class qm{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,wn);const o=this.codec.decode(e.coordinates);return new fn(o.map(n=>new Ot(n)))}}class Qm extends c{encoder=new Gm(xe);decoder=new qm(xe)}const sa=new Qm;ye(wn,sa);const mn="Polygon";class ca extends Ae{type=mn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=et(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return aa.encode(this)}}class jm{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates.map(n=>n.coordinates)))}}}class $m{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,mn);const o=this.codec.decode(e.coordinates);return new ca(o.map(n=>new fn(n.map(r=>new Ot(r)))))}}class Km extends c{encoder=new jm(Re);decoder=new $m(Re)}const aa=new Km;ye(mn,aa);const pn="MultiPolygon";class Xm extends Ae{type=pn;coordinates;bbox;constructor(e){super(),this.coordinates=e,this.bbox=et(e)}[Symbol.iterator](){return this.coordinates[Symbol.iterator]()}toJSON(){return ia.encode(this)}}class Ym{codec;constructor(e){this.codec=e}convert(e){return{type:e.type,coordinates:this.codec.encode(e.coordinates.map(o=>o.coordinates.map(n=>n.coordinates.map(r=>r.coordinates))))}}}class Zm{codec;constructor(e){this.codec=e}convert(e){i(e,"type","coordinates"),le(e,pn);const o=this.codec.decode(e.coordinates);return new Xm(o.map(n=>new ca(n.map(r=>new fn(r.map(s=>new Ot(s)))))))}}class ep extends c{encoder=new Ym(ea);decoder=new Zm(ea)}const ia=new ep;ye(pn,ia);class Ne{inputMin;inputMax;outputMin;outputMax;inputRangeInv;outputRange;constructor(e,o,n,r){this.inputMin=e,this.inputMax=o,this.outputMin=n,this.outputMax=r,this.inputRangeInv=1/(this.inputMax-this.inputMin),this.outputRange=this.outputMax-this.outputMin}transform(e){return(e-this.inputMin)*this.inputRangeInv*this.outputRange+this.outputMin}static identity=new Ne(0,1,0,1)}class Z extends Ze{toString(){return`${Number(this)} dp`}}class tp{minInput;maxInput;minOutput;maxOutput;horizontalAffine;inverseHorizontalAffine;verticalAffine;inverseVerticalAffine;constructor(e,o,n,r){this.minInput=e,this.maxInput=o,this.minOutput=n,this.maxOutput=r,this.horizontalAffine=new Ne(Number(e.lat),Number(o.lat),Number(n.lat),Number(r.lat)),this.inverseHorizontalAffine=new Ne(Number(n.lat),Number(r.lat),Number(e.lat),Number(o.lat)),this.verticalAffine=new Ne(Number(e.lng),Number(o.lng),Number(n.lng),Number(r.lng)),this.inverseVerticalAffine=new Ne(Number(n.lng),Number(r.lng),Number(e.lng),Number(o.lng))}project(e){return new x(new D(new Z(this.horizontalAffine.transform(Number(e.lat)))),new T(new Z(this.verticalAffine.transform(Number(e.lng)))))}inverseProject(e){const o=new Y(this.inverseHorizontalAffine.transform(Number(e.lat))),n=new Y(this.inverseVerticalAffine.transform(Number(e.lng)));return new x(new D(o),new T(n))}}class op{minInput=new x(new D(new _(-90)),new T(new _(-180)));maxInput=new x(new D(new _(90)),new T(new _(180)));minOutput=new x(new D(new Y(-Math.PI/2)),new T(new Y(-Math.PI)));maxOutput=new x(new D(new Y(Math.PI/2)),new T(new Y(Math.PI)));projectLatitude(e){return new D(this.convertDegreesToRadians(e))}convertDegreesToRadians(e){return new Y(Number(e)*(Math.PI/180))}convertRadiansToDegrees(e){return new _(Number(e)*(180/Math.PI))}projectLongitude(e){return new T(this.convertDegreesToRadians(e))}inverseProjectLatitude(e){return new D(this.convertRadiansToDegrees(e))}inverseProjectLongitude(e){return new T(this.convertRadiansToDegrees(e))}project(e){return new x(this.projectLatitude(e.lat),this.projectLongitude(e.lng))}inverseProject(e){return new x(this.inverseProjectLatitude(e.lat),this.inverseProjectLongitude(e.lng))}}const da=new op,la=85.05133;class U{static min=da.project(new x(new D(new _(-la)),new T(new _(-180))));static max=da.project(new x(new D(new _(la)),new T(new _(180))));static minProjection=U.staticProject(U.min);static maxProjection=U.staticProject(U.max);minInput=U.min;maxInput=U.max;minOutput=U.minProjection;maxOutput=U.maxProjection;static projectLongitude(e){return new T(Number(e))}static ensureLatitudeBounds(e){return Dt(e,U.max.lat)?U.max.lat:cn(e,U.min.lat)?U.min.lat:e}static projectLatitude(e){return new D(Math.log(Math.tan(Math.PI/4+Number(this.ensureLatitudeBounds(e))/2)))}static inverseProjectLongitude(e){return new T(new Y(Number(e)))}static inverseProjectLatitude(e){return new D(new Y(2*Math.atan(Math.exp(Number(e)))-Math.PI/2))}static staticProject(e){return new x(this.projectLatitude(e.lat),this.projectLongitude(e.lng))}project(e){return U.staticProject(e)}static staticInverseProject(e){return new x(this.inverseProjectLatitude(e.lat),this.inverseProjectLongitude(e.lng))}inverseProject(e){return U.staticInverseProject(e)}}const np="AwABAQEcDQABDA0AAQYNAAEEDgABgAwAAQINAAEWAWEMAAF6AfgMAAH/AfIMAAH/AfwMAAH/AfgMAAH/AeAMAAF/AdAMAAF/AfAMAAF/AeAMAAF/AeAMAAE/AfAMAAEfAfAMAAEfAfwMAAE/AfwMAAF/Af4MAAF/Af8BgAsAAT8B/wHgCgABHwE/Av8BgAkAAZ8BPwL/AeAIAAEDAUwBPwL/AfAIAAEDAU8B3wL/AfgIAAEFAUMBzwL/AfoIAAEMAWMB7wL/Af0IAAEBAaMB7wP/CQABZwHPA/8BgAcAATgBoAHvA/8B4AcAARwBQAFvA/8B4AcAAYQB7gEPA/8B8AcAAQwBDgEvAv8B/gEwBgABAwGBAS8BzwHvAf8B/AEQBgABAwH4AYwBfwGDAf8B/AEYBgABCAHyAeMBHwEDAf8B/AE4BgABHgF9AS8BhgEBAf8B/AEIBgABKwHXAWwBvQGBAf8B/AEOBgABHgH/AW8B+QEBAf8B/gcAAe4B/wEHAYABQAE/AfABAAEYBQABfwH8AQcBwQHpAf8B8AHBAT4FAAH/AdgBAwHgAX8B/wHAAQMB/wGAAQABoAIAAf8BwAEBAfcBPwH/AQABAwH/AcABHQH8AgAB/gEIAQABfwGfAfYBAAEjAf8BxwH/AfgCAAH+AR8BgAFfAUcB7AEAAQMD/wHkAgABfQGfAYABDQGPAf4BAAEDAv8B/gMAATEB/wEAAQQBDwHkAQABAwL/AfgDAAEPAf8BgAEAAQEB4AEAAQEC/wHwAwABFwH/AYABAAEBAdACAAL/AfADAAEfAf8B8AIAAZACAAL/AcADAAEHAf8B/gFMBAAC/wHAAwABDwL/AV8EAAF/Af8BgAMAAT8D/wHAAwABHwH+BAABfwP/AeADAAEfAfgEAAFfA/8B8AMAAQ8B8AQABP8BgAMAAQ8B8AQAAX8C/wH8BAABDwHAAwABAwP/AfwEAAEGBAABAwF/Av8B+AkAAQMD/wHgCQABAwHvAv8B8AkAAQEC/wH+AeAKAAFnAf8B+wFACgABXwH+AbgBgAoAAQ8BogFQAQMKAAEGAQABIAEDCgABDgIAAQMDAAH8BgABDAUAAQEB/wwAAQMB/woAAQEBgQHPAf8BgAkAAQYBAQL/AYAJAAEFAdEB3wH/AYAKAALfAf8LAAI/Af8LAAF+AT8B/woAAXgB/gE/Af8BgAkAAXsB/QG/Af8BgAYAAWABAAEBAfkB/gEPAf8B+AYAATwBAAEXAf4B/QEPAv8B8AUAAXsBAAEfAfwB/gHHAv8B/gUAAZgBAAE/AZQB/gEHA/8BwAQAAZgBAAE/AQMB/wGPA/8BwAQAAeQBAAF8AesB/wFHA/8BwAQAAcABAAF/Ae8B/wFHA/8BwAYAAX8B7wH+AccD/wGABgABPwH/AfgBxwP/BwABPwH/Af0B5QL/AfwHAAE8Af8B+AHOAX8B/wHgBwABHQH/AfwB/wEfAf8BwAcAAQ8B/wH+Af8BzwHxAYAHAAEHA/8B9wHgCAABFwP/AfsBwAF8BQABgAEAAQcB/wH5Af8B+wGAAXgEAAEDAYABAAEvAf8B+AE8AfoBAAGABgABAQEfAf8B+wE+AfAIAAEPAY8C/wH+AfAGAAEGAQABOAGfA/8BYAYAAQEBAAFgAV8D/wkAAcABPwP/BwABAgEAAYABPwP/CAABAQGAAV8D/wkAAQME/wGACAABAwH7A/8BwAgAAQUBbwP/AfgIAAEBAd8D/wH+CAABBwT/Af4IAAEFBP8B8QgAAQcE/wHgCAABDwT/AcAIAAE/BP8BgAgAAX8E/wGABgABAwGAAX8E/wHABgABAwFgBf8B8AGABgABcAF/BP8B+AFABgABCAX/AfgBoAYAARsF/wH8AVgGAAEDBf8B/gEcBwAF/wHMAQQHAAHvBP8B4AEwBwABfwT/AcABcAcAAQcE/wGAAXABDwYAAQcE/wGAAeABHwHABQABAwP/Ab4BAAEYAR8BwAUAAQMD/wGAAQEBKAE/AcAFAAEPA/8BgAEFARIBfwGABQABBwP/AeACAAF/AYAGAAP/AwABfwGABgAC/wH+ARABAAEQAf8BgAYAAv8B/gMAAf8BgAYAAf8B/gH8ATABAAEIAf8BwAUAAWIB/wH8AfABIAEAAQwBPwHgBQABawH/AfABAgGAAQABDgH/AfAFAAFDAf8B8AECAgABDAF/AfAFAAEBAf8B8AMAAQQBHwH2BQABIQH/AfADAAECAQ8B8AYAAf8B8AQAAQcBwAYAAf8B8AwAAf8B4wGACwAB/wHHAYALAAE/Ae8DAAECCAABPwGQDAABPwHgDAABfwHgBQABAQYAAV8B4AUAAQMGAAE/AcAFAAEGBgABPwHABQABHAYAAT4BgAgA";function rp(t){const e=new DataView(t),o=new Array(t.byteLength*8),n=t.byteLength;for(let r=0;r<n;r++){const s=e.getUint8(r);for(let a=0;a<8;a++){const d=7-a,f=r;o[f*8+a]=!!(s&1<<d)}}return o}function sp(t){const e=new DataView(t),o=t.byteLength;let n=0;for(let a=0;a<o;a+=2)n+=e.getUint8(a);const r=new ArrayBuffer(n),s=new DataView(r);for(let a=0,d=0;a<o;a+=2){const f=e.getUint8(a),h=e.getUint8(a+1);for(let C=0;C<f;C++)s.setUint8(d++,h)}return r}const Pt=new Z(1344),cp=new Z(Math.floor(Number(Pt)*.75)),tt=new Z(9),ap=Pt,ip=Pt;new tp(U.minProjection,U.maxProjection,new x(new D(ip),new T(new Z(0))),new x(new D(new Z(0)),new T(ap)));const dp=Pt,lp=cp,ua=new Z(Math.floor(Number(tt)/2)),up=Math.floor(Number(dp)/Number(tt)),hp=Math.floor(Number(lp)/Number(tt)),wp=Array.from(q(Vo(hp),t=>new D(new Z(t*Number(tt)+Number(ua))))),fp=Array.from(q(Vo(up),t=>new T(new Z(t*Number(tt)+Number(ua))))),ha=Array.from(Mo(fp,t=>q(wp,e=>new x(e,t))));Math.ceil(ha.length/8);const mp=Oo.decodeString(np),pp=sp(mp),gp=rp(pp),Ap=Uo(ha,gp,(t,e)=>[t,e]),yp=Lo(Ap,([,t])=>t),Cp=q(yp,([t])=>t);Array.from(Cp);class gn{width;index;constructor(e,o){this.width=e,this.index=o}toJSON(){return An.encode(this)}}class bp{convert(e){return i(e,"width","index"),new gn(u.decode(e.width),u.decode(e.index))}}class Sp{convert(e){return g(e,gn),{width:u.encode(e.width),index:u.encode(e.index)}}}class kp extends c{encoder=new Sp;decoder=new bp}const An=new kp;class Ie{static get lsb0(){return Ep}static get msb0(){return xp}valueOf(){return this.toString()}toJSON(){return this.toString()}}const wa="bitvec::order::Lsb0",fa="bitvec::order::Msb0";class vp extends Ie{toString(){return wa}}const Ep=new vp;class Bp extends Ie{toString(){return fa}}const xp=new Bp;class Rp{convert(e){if(typeof e!="string")throw new p(typeof e,"string");switch(e){case wa:return Ie.lsb0;case fa:return Ie.msb0;default:throw new p(e,"CappuccinoAPIBitVecOrder")}}}class Np{convert(e){return e.toString()}}class Ip extends c{encoder=new Np;decoder=new Rp}const ma=new Ip;class yn{order;head;bits;data;constructor(e,o,n,r){this.order=e,this.head=o,this.bits=n,this.data=r}getBitVecIndexIterable(){return this.order===Ie.lsb0?new Mp(this.head.width,this.bits):new Up(this.head.width,this.bits)}[Symbol.iterator](){const e=this.getBitVecIndexIterable();return q(e,o=>Pp(this.data,o))[Symbol.iterator]()}toJSON(){return Ce.encode(this)}}class Dp{convert(e){return i(e,"order","head","bits","data"),new yn(ma.decode(e.order),An.decode(e.head),u.decode(e.bits),lc.decode(e.data))}}class Tp{convert(e){return g(e,yn),{order:ma.encode(e.order),head:An.encode(e.head),bits:u.encode(e.bits),data:lc.encode(e.data)}}}class Op extends c{encoder=new Tp;decoder=new Dp}const Ce=new Op,pa=new E(new k(Ce),new v(Ce));function Pp(t,e){return(t[e.bucket]>>e.bitOffset&1n)===1n}class ga{constructor(e,o){this.bucket=e,this.bitOffset=o}}function Aa(t){switch(P(t===8||t===16||t===32||t===64,"bit width should be a power of two that is supported"),t){case 8:return 3;case 16:return 4;case 32:return 5;case 64:return 6;default:throw new z}}class Lp{totalBits;bitWidthMask;bitWidthShift;offset=0n;constructor(e,o){this.totalBits=o;const n=BigInt(Aa(e));this.bitWidthMask=BigInt(e)-1n,this.bitWidthShift=n}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,o=this.offset&this.bitWidthMask;return this.offset+=1n,{done:!1,value:new ga(Number(e),o)}}}class Mp{bitWidth;totalBits;constructor(e,o){this.bitWidth=e,this.totalBits=o}[Symbol.iterator](){return new Lp(this.bitWidth,this.totalBits)}}class Vp{bitWidth;totalBits;bitWidthMask;bitWidthShift;offset=0n;constructor(e,o){this.bitWidth=BigInt(e),this.totalBits=BigInt(o);const n=BigInt(Aa(e));this.bitWidthMask=BigInt(e)-1n,this.bitWidthShift=n}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,o=this.bitWidth-1n-(this.offset&this.bitWidthMask);return this.offset+=1n,{done:!1,value:new ga(Number(e),o)}}}class Up{bitWidth;totalBits;constructor(e,o){this.bitWidth=e,this.totalBits=o}[Symbol.iterator](){return new Vp(this.bitWidth,this.totalBits)}}class ya{r;s;v;constructor(e,o,n){this.r=e,this.s=o,this.v=n}toJSON(){return Cn.encode(this)}}class Hp{convert(e){return i(e,"r","s","v"),new ya(R.decode(e.r),R.decode(e.s),u.decode(e.v))}}class _p{convert(e){return g(e,ya),{r:R.encode(e.r),s:R.encode(e.s),v:u.encode(e.v)}}}class Wp extends c{encoder=new _p;decoder=new Hp}const Cn=new Wp;class Ca{account;amount;constructor(e,o){this.account=e,this.amount=o}toJSON(){return bn.encode(this)}}class zp{convert(e){return i(e,"account","amount"),new Ca(R.decode(e.account),R.decode(e.amount))}}class Fp{convert(e){return g(e,Ca),{account:R.encode(e.account),amount:R.encode(e.amount)}}}class Jp extends c{encoder=new Fp;decoder=new zp}const bn=new Jp;class ba{number;timestamp;hash;constructor(e,o,n){this.number=e,this.timestamp=o,this.hash=n}toJSON(){return Sn.encode(this)}}class Gp{convert(e){return i(e,"number","timestamp","hash"),new ba(u.decode(e.number),l.decode(e.timestamp),l.decode(e.hash))}}class qp{convert(e){return g(e,ba),{number:u.encode(e.number),timestamp:l.encode(e.timestamp),hash:l.encode(e.hash)}}}class Qp extends c{encoder=new qp;decoder=new Gp}const Sn=new Qp,Sa=new V(new L(Sn),new M(Sn));class ka{bytes;constructor(e){this.bytes=e}toJSON(){return kn.encode(this)}}class jp{convert(e){return i(e,"bytes"),new ka(ic.decode(e.bytes))}}class $p{convert(e){return g(e,ka),{bytes:ic.encode(e.bytes)}}}class Kp extends c{encoder=new $p;decoder=new jp}const kn=new Kp;class va{height;timestamp;l1_head;l1_finalized;payload_commitment;ns_table;block_merkle_root;fee_merkle_root;builder_signature;fee_info;constructor(e,o,n,r,s,a,d,f,h,C){this.height=e,this.timestamp=o,this.l1_head=n,this.l1_finalized=r,this.payload_commitment=s,this.ns_table=a,this.block_merkle_root=d,this.fee_merkle_root=f,this.builder_signature=h,this.fee_info=C}toJSON(){return ot.encode(this)}}class Xp{convert(e){return i(e,"height","timestamp","l1_head","l1_finalized","payload_commitment","ns_table","block_merkle_root","fee_merkle_root","builder_signature","fee_info"),new va(u.decode(e.height),u.decode(e.timestamp),u.decode(e.l1_head),Sa.decode(e.l1_finalized),Pe.decode(e.payload_commitment),kn.decode(e.ns_table),w.decode(e.block_merkle_root),w.decode(e.fee_merkle_root),Cn.decode(e.builder_signature),bn.decode(e.fee_info))}}class Yp{convert(e){return g(e,va),{height:u.encode(e.height),timestamp:u.encode(e.timestamp),l1_head:u.encode(e.l1_head),l1_finalized:Sa.encode(e.l1_finalized),payload_commitment:Pe.encode(e.payload_commitment),ns_table:kn.encode(e.ns_table),block_merkle_root:w.encode(e.block_merkle_root),fee_merkle_root:w.encode(e.fee_merkle_root),builder_signature:Cn.encode(e.builder_signature),fee_info:bn.encode(e.fee_info)}}}class Zp extends c{encoder=new Yp;decoder=new Xp}const ot=new Zp;class Ea{vm;payload;constructor(e,o){this.vm=e,this.payload=o}toJSON(){return nt.encode(this)}}class eg{convert(e){return i(e,"vm","payload"),new Ea(u.decode(e.vm),Pe.decode(e.payload))}}class tg{convert(e){return g(e,Ea),{vm:u.encode(e.vm),payload:Pe.encode(e.payload)}}}class og extends c{encoder=new tg;decoder=new eg}const nt=new og;new E(new k(nt),new v(nt));class Ba{header;hash;size;num_transactions;proposer_id;constructor(e,o,n,r,s){this.header=e,this.hash=o,this.size=n,this.num_transactions=r,this.proposer_id=s}toJSON(){return vn.encode(this)}}class ng{convert(e){return i(e,"header","hash","size","num_transactions","proposer_id"),new Ba(ot.decode(e.header),w.decode(e.hash),u.decode(e.size),u.decode(e.num_transactions),se.decode(e.proposer_id))}}class rg{convert(e){return g(e,Ba),{header:ot.encode(e.header),hash:w.encode(e.hash),size:u.encode(e.size),num_transactions:u.encode(e.num_transactions),proposer_id:se.encode(e.proposer_id)}}}class sg extends c{encoder=new rg;decoder=new ng}const vn=new sg;new E(new k(vn),new v(vn));class xa{hash;header;offset;transaction;constructor(e,o,n,r){this.hash=e,this.header=o,this.offset=n,this.transaction=r}toJSON(){return En.encode(this)}}class cg{convert(e){return i(e,"hash","header","offset","transaction"),new xa(w.decode(e.hash),ot.decode(e.header),u.decode(e.offset),nt.decode(e.transaction))}}class ag{convert(e){return g(e,xa),{hash:w.encode(e.hash),header:ot.encode(e.header),offset:u.encode(e.offset),transaction:nt.encode(e.transaction)}}}class ig extends c{encoder=new ag;decoder=new cg}const En=new ig;new E(new k(En),new v(En));class Ra{signature;bitvec;constructor(e,o){this.signature=e,this.bitvec=o}toJSON(){return Bn.encode(this)}}class dg{convert(e){if(!ys(e)||e.length!==2)throw new p(typeof e,"Array");return new Ra(w.decode(e[0]),Ce.decode(e[1]))}}class lg{convert(e){return g(e,Ra),[w.encode(e.signature),Ce.encode(e.bitvec)]}}class ug extends c{encoder=new lg;decoder=new dg}const Bn=new ug;new V(new L(Bn),new M(Bn));class rt{}class xn extends rt{toJSON(){return Rn.encode(this)}}class hg{convert(e){if(!ee(e)||e!=="Empty")throw new ne;return new xn}}class wg{convert(e){return g(e,xn),"Empty"}}class fg extends c{encoder=new wg;decoder=new hg}const Rn=new fg;class Nn extends rt{value;pos;elem;constructor(e,o,n){super(),this.value=e,this.pos=o,this.elem=n}toJSON(){return In.encode(this)}}class mg{convert(e){i(e,"Leaf");const o=e.Leaf;return i(o,"value","pos","elem"),new Nn(w.decode(o.value),w.decode(o.pos),w.decode(o.elem))}}class pg{convert(e){return g(e,Nn),{Leaf:{value:w.encode(e.value),pos:w.encode(e.pos),elem:w.encode(e.elem)}}}}class gg extends de{encoder=new pg;decoder=new mg}const In=new gg;class Dn extends rt{value;constructor(e){super(),this.value=e}toJSON(){return Tn.encode(this)}}class Ag{convert(e){i(e,"ForgettenSubtree");const o=e.ForgettenSubtree;return i(o,"value"),new Dn(w.decode(o.value))}}class yg{convert(e){return g(e,Dn),{ForgettenSubtree:{value:w.encode(e.value)}}}}class Cg extends de{encoder=new yg;decoder=new Ag}const Tn=new Cg;class On extends rt{value;children;constructor(e,o){super(),this.value=e,this.children=o}toJSON(){return Pn.encode(this)}}class bg{convert(e){i(e,"Branch");const o=e.Branch;return i(o,"value","children"),new On(w.decode(o.value),Ia.decode(o.children))}}class Sg{convert(e){return g(e,On),{Branch:{value:w.encode(e.value),children:Ia.encode(e.children)}}}}class kg extends c{encoder=new Sg;decoder=new bg}const Pn=new kg;class vg{convert(e){if(eo(e,"Leaf",wt))return In.decoder.convert(e);if(eo(e,"Branch",wt))return Pn.decoder.convert(e);if(eo(e,"ForgettenSubtree",wt))return Tn.decoder.convert(e);if(ee(e))return Rn.decoder.convert(e);throw new ne}}class Eg{convert(e){if(g(e,rt),e instanceof Nn)return In.encode(e);if(e instanceof On)return Pn.encode(e);if(e instanceof Dn)return Tn.encode(e);if(e instanceof xn)return Rn.encode(e);throw new ne}}class Bg extends c{encoder=new Eg;decoder=new vg}const Na=new Bg,Ia=new E(new k(Na),new v(Na));new Promise(()=>{});class Ln{hash;height;time;numTransactions;proposerID;feeRecipient;size;blockReward;constructor(e,o,n,r,s,a,d,f){this.hash=e,this.height=o,this.time=n,this.numTransactions=r,this.proposerID=s,this.feeRecipient=a,this.size=d,this.blockReward=f}toJSON(){return st.encode(this)}}class xg{convert(e){return i(e,"hash","height","time","num_transactions","proposer_id","fee_recipient","size","block_reward"),new Ln(w.decode(e.hash),u.decode(e.height),Se.decode(e.time),u.decode(e.num_transactions),se.decode(e.proposer_id),se.decode(e.fee_recipient),u.decode(e.size),xc.decode(e.block_reward))}}class Rg{convert(e){return g(e,Ln),{hash:w.encode(e.hash),height:u.encode(e.height),time:Se.encode(e.time),num_transactions:u.encode(e.numTransactions),proposer_id:se.encode(e.proposerID),fee_recipient:se.encode(e.feeRecipient),size:u.encode(e.size),block_reward:xc.encode(e.blockReward)}}}class Ng extends de{encoder=new Rg;decoder=new xg}const st=new Ng,Da=new E(new k(st),new v(st));class Ta{hash;height;proposerID;numTransactions;size;time;constructor(e,o,n,r,s,a){this.hash=e,this.height=o,this.proposerID=n,this.numTransactions=r,this.size=s,this.time=a}toJSON(){return Mn.encode(this)}}class Ig{convert(e){return i(e,"hash","height","proposer_id","num_transactions","size","time"),new Ta(w.decode(e.hash),u.decode(e.height),se.decode(e.proposer_id),u.decode(e.num_transactions),u.decode(e.size),Se.decode(e.time))}}class Dg{convert(e){return g(e,Ta),{hash:w.encode(e.hash),height:u.encode(e.height),proposer_id:se.encode(e.proposerID),num_transactions:u.encode(e.numTransactions),size:u.encode(e.size),time:Se.encode(e.time)}}}class Tg extends de{encoder=new Dg;decoder=new Ig}const Mn=new Tg;new E(new k(Mn),new v(Mn));function Og(t,e){return t.blockHeights-e.blockHeights}class Lt{blockTime;blockSize;blockTransactions;blockHeights;constructor(e,o,n,r){const s=[],a=Math.min(e.length,o.length,n.length,r.length);for(let H=0;H<a;H++){const I=r[H];I!==null&&s.push({blockTime:e[H],blockSize:o[H],blockTransactions:n[H],blockHeights:I})}s.sort(Og);const d=s[0].blockHeights,f=s[s.length-1].blockHeights,h=[],C=[],O=[],A=[];for(let H=d,I=0;H<=f;H++){const F=s[I];if(F.blockHeights!==H){h.push(null),C.push(null),O.push(null),A.push(null);continue}h.push(F.blockTime),C.push(F.blockSize),O.push(F.blockTransactions),A.push(F.blockHeights),I++}const m=Math.max(0,A.length-50);this.blockTime=h.slice(m),this.blockSize=C.slice(m),this.blockTransactions=O.slice(m),this.blockHeights=A.slice(m)}toJSON(){return Vn.encode(this)}}class Pg{convert(e){return i(e,"block_time","block_size","block_transactions","block_heights"),new Lt(oe.decode(e.block_time),oe.decode(e.block_size),oe.decode(e.block_transactions),oe.decode(e.block_heights))}}class Lg{convert(e){return g(e,Lt),{block_time:oe.encode(e.blockTime),block_size:oe.encode(e.blockSize),block_transactions:oe.encode(e.blockTransactions),block_heights:oe.encode(e.blockHeights)}}}class Mg extends c{encoder=new Lg;decoder=new Pg}const Vn=new Mg,Oa=Pe;class Pa{hash;rollups;height;time;offset;numTransactions;constructor(e,o,n,r,s,a){this.hash=e,this.rollups=o,this.height=n,this.time=r,this.offset=s,this.numTransactions=a}toJSON(){return Un.encode(this)}}class Vg{convert(e){return i(e,"hash","rollups","height","time","offset","num_transactions"),new Pa(w.decode(e.hash),Oa.decode(e.rollups),u.decode(e.height),Se.decode(e.time),u.decode(e.offset),u.decode(e.num_transactions))}}class Ug{convert(e){return g(e,Pa),{hash:w.encode(e.hash),rollups:Oa.encode(e.rollups),height:u.encode(e.height),time:Se.encode(e.time),offset:u.encode(e.offset),num_transactions:u.encode(e.numTransactions)}}}class Hg extends c{encoder=new Ug;decoder=new Vg}const Un=new Hg;new E(new k(Un),new v(Un));const La=u;class Ma{namespace;payload;constructor(e,o){this.namespace=e,this.payload=o}toJSON(){return Hn.encode(this)}}class _g{convert(e){return i(e,"namespace","payload"),new Ma(La.decode(e.namespace),St.decode(e.payload))}}class Wg{convert(e){return g(e,Ma),{namespace:La.encode(e.namespace),payload:St.encode(e.payload)}}}class zg extends c{encoder=new Wg;decoder=new _g}const Hn=new zg;new E(new k(Hn),new v(Hn));class Fg{constructor(e,o,n,r,s,a){this.address=e,this.stakeTableKey=o,this.stakeKey=n,this.stake=r,this.comission=s,this.delegators=a,Object.freeze(this)}toJSON(){return _n.encode(this)}}const Va=new Ve(new _o(l,N),new Wo(l,N));class Jg{convert(e){return i(e,"account","stake_table_key","state_ver_key","stake","commission","delegators"),new Fg(R.decode(e.account),w.decode(e.stake_table_key),w.decode(e.state_ver_key),N.decode(e.stake),Rt.decode(e.commission),Va.decode(e.delegators))}}class Gg{convert(e){return{account:R.encode(e.address),stake_table_key:w.encode(e.stakeTableKey),state_ver_key:w.encode(e.stakeKey),stake:N.encode(e.stake),commission:Rt.encode(e.comission),delegators:Va.encode(e.delegators)}}}class qg extends c{encoder=new Gg;decoder=new Jg}const _n=new qg;new Ve(new _o(l,_n),new Wo(l,_n));class Qg{constructor(e,o){this.stakeKey=e,this.stakeAmount=o,Object.freeze(this)}toJSON(){return Wn.encode(this)}}class jg{convert(e){return i(e,"stake_key","stake_amount"),new Qg(w.decode(e.stake_key),N.decode(e.stake_amount))}}class $g{convert(e){return{stake_key:w.encode(e.stakeKey),stake_amount:N.encode(e.stakeAmount)}}}class Kg extends c{encoder=new $g;decoder=new jg}const Wn=new Kg;class Xg{constructor(e,o){this.stakeTableEntry=e,this.stateVerKey=o,Object.freeze(this)}}class Yg{convert(e){return i(e,"stake_table_entry","state_ver_key"),new Xg(Wn.decode(e.stake_table_entry),w.decode(e.state_ver_key))}}class Zg{convert(e){return{stake_table_entry:Wn.encode(e.stakeTableEntry),state_ver_key:w.encode(e.stateVerKey)}}}class eA extends c{encoder=new Zg;decoder=new Yg}const Ua=new eA;new E(new k(Ua),new v(Ua));class Ha{constructor(e,o){this.lifetimeRewards=e,this.authData=o,Object.freeze(this)}toJSON(){return zn.encode(this)}}class tA{convert(e){return i(e,"lifetime_rewards","auth_data"),new Ha(N.decode(e.lifetime_rewards),R.decode(e.auth_data))}}class oA{convert(e){return g(e,Ha),{lifetime_rewards:N.encode(e.lifetimeRewards),auth_data:R.encode(e.authData)}}}class nA extends c{encoder=new oA;decoder=new tA}const zn=new nA;new V(new L(zn),new M(zn));class _a{constructor(e,o){this.height=e,this.address=o,Object.freeze(this)}toJSON(){return Fn.encode(this)}}class rA{convert(e){return i(e,"height","address"),new _a(u.decode(e.height),l.decode(e.address))}}class sA{convert(e){return g(e,_a),{height:u.encode(e.height),address:l.encode(e.address)}}}class cA extends c{encoder=new sA;decoder=new rA}const Fn=new cA;new V(new L(Fn),new M(Fn));class Wa{coords;country;constructor(e,o){this.coords=e,this.country=o}toJSON(){return Jn.encode(this)}}class aA{convert(e){return{coords:Zc.encode(e.coords),country:J.encode(e.country)}}}class iA{convert(e){return i(e,"coords","country"),new Wa(Zc.decode(e.coords),be(J.decode(e.country)))}}class dA extends c{encoder=new aA;decoder=new iA}const Jn=new dA,za=new V(new L(Jn),new M(Jn));class Fa{publicKey;name;publicURL;company;companyWebsite;location;operatingSystem;nodeType;networkType;constructor(e,o,n,r,s,a,d,f,h){this.publicKey=e,this.name=o,this.publicURL=n,this.company=r,this.companyWebsite=s,this.location=a,this.operatingSystem=d,this.nodeType=f,this.networkType=h}toJSON(){return ct.encode(this)}}class lA{convert(e){return{public_key:w.encode(e.publicKey),name:J.encode(e.name),public_url:vt.encode(e.publicURL),company:J.encode(e.company),company_website:vt.encode(e.companyWebsite),location:za.encode(e.location),operating_system:J.encode(e.operatingSystem),node_type:J.encode(e.nodeType),network_type:J.encode(e.networkType)}}}class uA{convert(e){return i(e,"public_key","name","public_url","company","company_website","location","operating_system","node_type","network_type"),new Fa(w.decode(e.public_key),be(J.decode(e.name)),vt.decode(e.public_url),be(J.decode(e.company)),vt.decode(e.company_website),za.decode(e.location),be(J.decode(e.operating_system)),be(J.decode(e.node_type)),be(J.decode(e.network_type)))}}class hA extends c{encoder=new lA;decoder=new uA}const ct=new hA,Ja=new E(new k(ct),new v(ct));class Q{}const Ga="SubscribeNodeIdentity";class Gn extends Q{valueOf(){return Ga}}const qa="SubscribeLatestBlock";class qn extends Q{valueOf(){return qa}}const Qa="SubscribeVoters";class Qn extends Q{valueOf(){return Qa}}const ja="SubscribeValidators";class wA extends Q{valueOf(){return ja}}const $a="SubscribeStakeTables";class fA extends Q{valueOf(){return $a}}const Ka="RequestNodeIdentitySnapshot";class jn extends Q{valueOf(){return Ka}}const Xa="RequestBlocksSnapshot";class $n extends Q{valueOf(){return Xa}}const Ya="RequestHistogramSnapshot";class Kn extends Q{valueOf(){return Ya}}const Za="RequestVotersSnapshot";class Xn extends Q{valueOf(){return Za}}const ei="RequestValidatorsSnapshot";class ti extends Q{valueOf(){return ei}}const oi="RequestStakeTableSnapshot";class ni extends Q{valueOf(){return oi}}class mA{convert(e){return e.valueOf()}}class pA{convert(e){if(typeof e!="string")throw new p(typeof e,"string");switch(e){case Ga:return new Gn;case qa:return new qn;case Qa:return new Qn;case Ka:return new jn;case Xa:return new $n;case Ya:return new Kn;case Za:return new Xn;case ja:return new wA;case $a:return new fA;case ei:return new ti;case oi:return new ni;default:throw new p(e,"CappuccinoNodeValidatorRequest")}}}class gA extends c{encoder=new mA;decoder=new pA}const Yn=new gA,at="NodeValidatorRequest";class Mt extends wc{request;get type(){return at}constructor(e){super(),this.request=e}toJSON(){return ri.encode(this)}}class AA{convert(e){return{[at]:Yn.encode(e.request)}}}class yA{convert(e){return i(e,at),new Mt(Yn.decode(e[at]))}}class CA extends c{encoder=new AA;decoder=new yA}const ri=new CA;class j{}const Vt="BlocksSnapshot";class Zn extends j{blocks;constructor(e){super(),this.blocks=e}toJSON(){return er.encode(this)}}class bA{convert(e){i(e,Vt);const o=e[Vt];return new Zn(Da.decode(o))}}class SA{convert(e){return{[Vt]:Da.encode(e.blocks)}}}class kA extends c{encoder=new SA;decoder=new bA}const er=new kA,Ut="HistogramSnapshot";class Ht extends j{histograms;constructor(e){super(),this.histograms=e}toJSON(){return tr.encode(this)}}class vA{convert(e){return i(e,Ut),new Ht(Vn.decode(e[Ut]))}}class EA{convert(e){return{[Ut]:Vn.encode(e.histograms)}}}class BA extends c{encoder=new EA;decoder=new vA}const tr=new BA,_t="LatestBlock";class Wt extends j{latestBlock;constructor(e){super(),this.latestBlock=e}toJSON(){return or.encode(this)}}class xA{convert(e){return i(e,_t),new Wt(st.decode(e[_t]))}}class RA{convert(e){return{[_t]:st.encode(e.latestBlock)}}}class NA extends c{encoder=new RA;decoder=new xA}const or=new NA,zt="LatestStakeTable";class nr extends j{stakeTable;constructor(e){super(),this.stakeTable=e}toJSON(){return rr.encode(this)}}class IA{convert(e){return i(e,zt),new nr(It.decode(e[zt]))}}class DA{convert(e){return{[zt]:It.encode(e.stakeTable)}}}class TA extends c{encoder=new DA;decoder=new IA}const rr=new TA,Ft="LatestVoters";class sr extends j{latestVoter;constructor(e){super(),this.latestVoter=e}toJSON(){return cr.encode(this)}}class OA{convert(e){return i(e,Ft),new sr(Ce.decode(e[Ft]))}}class PA{convert(e){return{[Ft]:Ce.encode(e.latestVoter)}}}class LA extends c{encoder=new PA;decoder=new OA}const cr=new LA,Jt="NodeIdentitySnapshot";class Gt extends j{nodes;constructor(e){super(),this.nodes=e}toJSON(){return ar.encode(this)}}class MA{convert(e){i(e,Jt);const o=e[Jt];return new Gt(Ja.decode(o))}}class VA{convert(e){return{[Jt]:Ja.encode(e.nodes)}}}class UA extends c{encoder=new VA;decoder=new MA}const ar=new UA,qt="LatestNodeIdentity";class si extends j{nodeIdentity;constructor(e){super(),this.nodeIdentity=e}toJSON(){return ir.encode(this)}}class HA{convert(e){return i(e,qt),new si(ct.decode(e[qt]))}}class _A{convert(e){return{[qt]:ct.encode(e.nodeIdentity)}}}class WA extends c{encoder=new _A;decoder=new HA}const ir=new WA,Qt="LatestValidator";class ci extends j{validator;constructor(e){super(),this.validator=e}toJSON(){return dr.encode(this)}}class zA{convert(e){return i(e,Qt),new ci(Be.decode(e[Qt]))}}class FA{convert(e){return{[Qt]:Be.encode(e.validator)}}}class JA extends c{encoder=new FA;decoder=new zA}const dr=new JA,jt="StakeTableSnapshot";class ai extends j{stakeTable;constructor(e){super(),this.stakeTable=e}toJSON(){return lr.encode(this)}}class GA{convert(e){i(e,jt);const o=e[jt];return new ai(It.decode(o))}}class qA{convert(e){return{[jt]:It.encode(e.stakeTable)}}}class QA extends c{encoder=new qA;decoder=new GA}const lr=new QA,$t="ValidatorsSnapshot";class ur extends j{validators;constructor(e){super(),this.validators=e}toJSON(){return hr.encode(this)}}class jA{convert(e){i(e,$t);const o=e[$t];return new ur(zc.decode(o))}}class $A{convert(e){return{[$t]:zc.encode(e.validators)}}}class KA extends c{encoder=new $A;decoder=new jA}const hr=new KA,Kt="VotersSnapshot";class wr extends j{voters;constructor(e){super(),this.voters=e}toJSON(){return fr.encode(this)}}class XA{convert(e){i(e,Kt);const o=e[Kt];return new wr(pa.decode(o))}}class YA{convert(e){return{[Kt]:pa.encode(e.voters)}}}class ZA extends c{encoder=new YA;decoder=new XA}const fr=new ZA;class ey{convert(e){if(G(e,Vt))return er.decode(e);if(G(e,Ut))return tr.decode(e);if(G(e,_t))return or.decode(e);if(G(e,qt))return ir.decode(e);if(G(e,Ft))return cr.decode(e);if(G(e,Qt))return dr.decode(e);if(G(e,zt))return rr.decode(e);if(G(e,Jt))return ar.decode(e);if(G(e,Kt))return fr.decode(e);if(G(e,$t))return hr.decode(e);if(G(e,jt))return lr.decode(e);throw new z}}class ty{convert(e){if(e instanceof Zn)return er.encode(e);if(e instanceof Ht)return tr.encode(e);if(e instanceof Wt)return or.encode(e);if(e instanceof si)return ir.encode(e);if(e instanceof sr)return cr.encode(e);if(e instanceof ci)return dr.encode(e);if(e instanceof nr)return rr.encode(e);if(e instanceof Gt)return ar.encode(e);if(e instanceof wr)return fr.encode(e);if(e instanceof ur)return hr.encode(e);if(e instanceof ai)return lr.encode(e);throw new z}}class oy extends c{encoder=new ty;decoder=new ey}const Xt=new oy,it="NodeValidatorResponse";class ii extends qo{response;get type(){return it}constructor(e){super(),this.response=e}toJSON(){return di.encode(this)}}class ny{convert(e){return{[it]:Xt.encode(e.response)}}}class ry{convert(e){i(e,it);const o=e[it];return new ii(Xt.decode(o))}}class sy extends c{encoder=new ny;decoder=new ry}const di=new sy;class cy{convert(e){return new ii(e)}}const mr=new cy;function pr(t){return new Ln(t.hash,t.height,t.time,t.numTransactions,t.proposer,t.proposer,t.size,t.fees)}function li(t){return new Fa(t.pubkey,t.name,null,t.company.name,new URL(t.company.website),new Wa(new x(new D(new _(t.location.coords[0])),new T(new _(t.location.coords[1]))),t.location.country),t.operatingSystem,t.nodeType,t.networkType)}class gr{responseStream;requestStream;lifecycleResponseSink;nodeValidatorResponseSink;constructor(e,o){this.requestStream=e,this.responseStream=o,this.lifecycleResponseSink=pe(fe(o),Xo),this.nodeValidatorResponseSink=pe(fe(o),mr)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}prng=new ie(xt());latestBlock=pr(Mc());latestBlocks=he(50);latestVoters=he(50);histogramBlockTimeData=he(50);histogramBlockSizeData=he(50);histogramBlockTransactionData=he(50);generateVotersFromBlockDetail(e){const o=new ie(e.time.valueOf()),n=ge.length,r=Math.ceil(n/16),s=new Uint16Array(o.fillBytes(r*2));return new yn(Ie.lsb0,new gn(16,0),n,Array.from(q(s,d=>BigInt(d))))}histogramBlockHeightData=he(50);async updateBlockDetails(e){const o=this.latestBlock,n=(e.time.valueOf()-o.time.valueOf())/1e3,r=this.generateVotersFromBlockDetail(e);this.latestBlock=e,this.latestBlocks.put(e),this.latestVoters.put(r),this.histogramBlockTimeData.put(n),this.histogramBlockSizeData.put(e.size),this.histogramBlockTransactionData.put(e.numTransactions),this.histogramBlockHeightData.put(e.height),this.isConnected&&(this.isSubscribedToLatestBlock&&await this.nodeValidatorResponseSink.send(new Wt(e)),this.isSubscribedToVoters&&this.nodeValidatorResponseSink.send(new sr(r)))}async initializeState(){for await(const e of qf(this.prng))this.updateBlockDetails(pr(e));await this.nodeValidatorResponseSink.send(new Wt(this.latestBlock)),await this.nodeValidatorResponseSink.send(new Ht(new Lt(Array.from(this.histogramBlockTimeData.immutableIterable()),Array.from(this.histogramBlockSizeData.immutableIterable()),Array.from(this.histogramBlockTransactionData.immutableIterable()),Array.from(this.histogramBlockHeightData.immutableIterable())))),this.nodeValidatorResponseSink.send(new Gt(ge.map(li)))}async startProcessing(){await this.initializeState(),this.handleRequests(),this.streamBlocks()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async streamBlocks(){const e=this.latestBlock;for await(const o of Qf(this.prng,e.time.valueOf(),e.height)){const n=pr(o);this.updateBlockDetails(n)}}async handleRequest(e){if(e instanceof Fe){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof Mt){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unrecognized request type",e)}async handleWebSocketCommand(e){if(e instanceof ze){await this.handleConnect();return}if(e instanceof _e){await this.handleClose();return}}async handleNodeValidatorRequest(e){if(e instanceof qn){await this.handleSubscribeLatestBlock();return}if(e instanceof Gn){await this.handleSubscribeNodeIdentity();return}if(e instanceof Qn){await this.handleSubscribeVoters();return}if(e instanceof $n){await this.handleRequestBlocksSnapshot();return}if(e instanceof Kn){await this.handleRequestHistogramSnapshot();return}if(e instanceof jn){await this.handleRequestNodeIdentitySnapshot();return}if(e instanceof Xn){await this.handleRequestVotersSnapshot();return}if(e instanceof ti){await this.handleRequestValidatorsSnapshot();return}if(e instanceof ni){await this.handleRequestStakeTableSnapshot();return}}isConnected=!1;isSubscribedToLatestBlock=!1;isSubscribedToVoters=!1;async handleConnect(){if(this.isConnected)throw new Error("already connected to WebSocket");this.isConnected=!0,await this.lifecycleResponseSink.send(new je),await this.lifecycleResponseSink.send(new Ke)}async handleClose(){if(!this.isConnected)throw new Error("not connected to WebSocket");this.isConnected=!1,this.isSubscribedToLatestBlock=!1,this.isSubscribedToVoters=!1,await this.lifecycleResponseSink.send(new ke)}async assertIsConnected(){if(!this.isConnected)throw new Error("not connected to WebSocket")}async handleSubscribeLatestBlock(){await this.assertIsConnected(),this.isSubscribedToLatestBlock=!0}async handleSubscribeNodeIdentity(){await this.assertIsConnected()}async handleSubscribeVoters(){await this.assertIsConnected(),this.isSubscribedToVoters=!0}async handleRequestBlocksSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Zn(Array.from(this.latestBlocks.immutableIterable())))}async handleRequestHistogramSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Ht(new Lt(Array.from(this.histogramBlockTimeData.immutableIterable()),Array.from(this.histogramBlockSizeData.immutableIterable()),Array.from(this.histogramBlockTransactionData.immutableIterable()),Array.from(this.histogramBlockHeightData.immutableIterable()))))}async handleRequestNodeIdentitySnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new Gt(ge.map(li)))}async handleRequestVotersSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new wr(Array.from(this.latestVoters.immutableIterable())))}async handleRequestValidatorsSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new ur(ge.map(e=>{const o=new _c(e.address);return new sn(o,e.pubkey,e.stateVerKey,e.stake,new on(e.commission),new Map([[o.toString(),e.stake]]))})))}async handleRequestStakeTableSnapshot(){await this.assertIsConnected(),await this.nodeValidatorResponseSink.send(new nr(ge.map(e=>new rn(new nn(e.pubkey,e.stake),e.stateVerKey))))}}class Ar{responseStream;requestStream;capturedHAR;lifecycleResponseSink;nodeValidatorResponseSink;constructor(e,o,n){this.requestStream=e,this.responseStream=o,this.capturedHAR=n,this.lifecycleResponseSink=pe(fe(o),Xo),this.nodeValidatorResponseSink=pe(fe(o),mr)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof Fe){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof Mt){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unknown request type",e)}async handleWebSocketCommand(e){if(e instanceof ze){await this.handleConnect();return}if(e instanceof _e){await this.handleClose();return}}async handleNodeValidatorRequest(e){if(e instanceof qn){await this.handleSubscribeLatestBlock();return}if(e instanceof Gn){await this.handleSubscribeNodeIdentity();return}if(e instanceof Qn){await this.handleSubscribeVoters();return}if(e instanceof $n){await this.handleRequestBlocksSnapshot();return}if(e instanceof Kn){await this.handleRequestHistogramSnapshot();return}if(e instanceof jn){await this.handleRequestNodeIdentitySnapshot();return}if(e instanceof Xn){await this.handleRequestVotersSnapshot();return}}async handleConnect(){await this.lifecycleResponseSink.send(new je),await this.lifecycleResponseSink.send(new Ke);const e=Mo(this.capturedHAR.log.entries,r=>"_webSocketMessages"in r?r._webSocketMessages:[]),o=Lo(e,r=>r.type==="receive");let n=0;for(const r of o){if(n>0){const s=r.time*1e3-n*1e3;await Yo(s)}n=r.time;try{const s=Xt.decode(JSON.parse(r.data));await this.nodeValidatorResponseSink.send(s)}catch(s){console.error(`Failed to decode message: ${r.data}`,s);continue}}await this.lifecycleResponseSink.send(new ke)}async handleClose(){}async handleSubscribeLatestBlock(){}async handleSubscribeNodeIdentity(){}async handleSubscribeVoters(){}async handleRequestBlocksSnapshot(){}async handleRequestHistogramSnapshot(){}async handleRequestNodeIdentitySnapshot(){}async handleRequestVotersSnapshot(){}}const yr="WebSocketError";class dt extends B{cause;constructor(e,o=`websocket error: ${String(e)}`){super(o),this.cause=e,Object.freeze(this)}get code(){return yr}}class ay{convert(e){return i(e,"code","message"),b(e,yr),new dt({},l.decode(e.message))}}class iy extends W{}class dy extends c{encoder=new iy;decoder=new ay}const ly=new dy;S(yr,ly);class uy{completer;lifecycleResponseSink;onClose;constructor(e,o,n){this.completer=e,this.lifecycleResponseSink=o,this.onClose=n}async handleEvent(){await this.lifecycleResponseSink.send(new ke),this.completer.isCompleted||this.completer.completeError(new dt(null,"web socket error: unknown error")),this.onClose()}}class hy{completer;errorResponseSink;constructor(e,o){this.completer=e,this.errorResponseSink=o}errorFromEvent(e){return"error"in e?new dt(e.error):new dt(null,"web socket error: unknown error")}handleEvent(e){const o=this.errorFromEvent(e);this.errorResponseSink.send(o),this.completer.isCompleted||this.completer.completeError(o)}}class wy{nodeValidatorResponseSink;constructor(e){this.nodeValidatorResponseSink=e}decodeMessage(e){return Xt.decode(JSON.parse(e.data))}async relayMessage(e){try{await this.nodeValidatorResponseSink.send(e)}catch(o){console.error("attempt to publish message to response stream failed",o)}}async handleEvent(e){try{const o=this.decodeMessage(e);this.relayMessage(o)}catch(o){console.error("Failed to decode server message from web socket",o);return}}}class fy{completer;lifecycleResponseSink;constructor(e,o){this.completer=e,this.lifecycleResponseSink=o}handleEvent(e){this.completer.complete(e.target),this.lifecycleResponseSink.send(new Ke)}}class my{webSocket=null;constructor(e,o,n,r,s,a=d=>new WebSocket(d)){const d=a(e);d.addEventListener("open",n),d.addEventListener("message",o),d.addEventListener("close",r),d.addEventListener("error",s),d.addEventListener("close",()=>{d.removeEventListener("open",n),d.removeEventListener("message",o),d.removeEventListener("close",r),d.removeEventListener("error",s),this.webSocket=null}),this.webSocket=d}send(e){if(this.webSocket===null)throw new Error("WebSocket is not connected");this.webSocket.send(e)}async close(e=1e3,o="done"){if(this.webSocket===null)return;const n=ue();return this.webSocket.addEventListener("close",()=>{n.complete()}),this.webSocket.close(e,o),n.promise}}function py(t,e,o,n,r,s=a=>new WebSocket(a)){return new my(t,e,o,n,r,s)}const gy=1e3,Ay=250,yy=5e3;class Cr{responseStream;requestStream;serviceBaseURL;webSocketCreator;lifecycleResponseSink;nodeValidatorResponseSink;errorResponseSink;constructor(e,o,n,r=s=>new WebSocket(s)){this.requestStream=e,this.responseStream=o,this.serviceBaseURL=n,this.webSocketCreator=r,this.lifecycleResponseSink=pe(fe(o),Xo),this.nodeValidatorResponseSink=pe(fe(o),mr),this.errorResponseSink=pe(fe(o),Aw)}get stream(){return this.responseStream}async send(e){await this.requestStream.publish(e)}async startProcessing(){this.handleRequests()}async handleRequests(){for await(const e of this.requestStream)await this.handleRequest(e)}async handleRequest(e){if(e instanceof Fe){try{await this.handleWebSocketCommand(e.command)}catch(o){console.error("failed to handle life cycle request",e,o)}return}if(e instanceof Mt){try{await this.handleNodeValidatorRequest(e.request)}catch(o){console.error("failed to handle node validator request",e,o)}return}console.error("unrecognized request",e)}async handleWebSocketCommand(e){if(e instanceof ze){await this.handleConnect();return}if(e instanceof _e){await this.handleClose();return}}async handleNodeValidatorRequest(e){this.assertConnected(),this.webSocket.send(JSON.stringify(Yn.encode(e)))}assertConnected(){if(this.webSocket===null)throw new Error("Not connected")}lastConnectTime=null;rapidConnectCount=0;async rapidReconnectProtection(){if(this.lastConnectTime===null){this.lastConnectTime=new Date;return}if(new Date().getTime()-this.lastConnectTime.getTime()<gy?this.rapidConnectCount++:this.rapidConnectCount=0,this.rapidConnectCount<=0)return;const n=2**(this.rapidConnectCount-1),r=Math.min(Ay*n,yy);console.info("Delaying connection attempt due to rapid connects:",this.rapidConnectCount,n,r),await Yo(r),this.lastConnectTime=new Date}webSocket=null;async handleConnect(){if(this.webSocket!==null)return;const e=new URL("node-validator/details",this.serviceBaseURL),o=ue();try{const n=new je;await this.lifecycleResponseSink.send(n),await this.rapidReconnectProtection();const r=new wy(this.nodeValidatorResponseSink),s=new fy(o,this.lifecycleResponseSink),a=new uy(o,this.lifecycleResponseSink,()=>this.webSocket=null),d=new hy(o,this.errorResponseSink);this.webSocket=py(e,r,s,a,d,this.webSocketCreator)}catch(n){const r=new dt(n);this.errorResponseSink.send(r),o.completeError(r)}await o.promise}async handleClose(){const e=this.webSocket;if(e===null){this.lifecycleResponseSink.send(new ke);return}await e.close()}}qh(at,ri),mw(it,di);async function Cy(t){const e=t.pathname,o=await fetch(e);if(!o.ok)throw new z;const n=await o.json(),r=we(1024),s=we(1024),a=new Ar(r,s,n);return a.startProcessing(),a}async function ui(t){const e=new URL(t);if(e.protocol==="replay:")return Cy(e);if(e.protocol==="ws:"||e.protocol==="wss:"){const o=we(1024),n=we(1024),r=new Cr(o,n,e);return r.startProcessing(),r}return null}async function by(){try{const r=await(await fetch("/config.json")).json();if(r.node_validator_service_url){const s=await ui(r.node_validator_service_url);if(s!==null)return s}}catch(n){let r=!1;n instanceof TypeError&&/failed to parse url/i.test(n.toString())&&(r=!0),r||console.warn("error determining service implementation, from configuration file",n)}const t=we(1024),e=we(1024),o=new gr(t,e);return o.startProcessing(),o}async function Sy(){return new hi(await by())}class hi{service;constructor(e){this.service=e}get stream(){return this.service.stream}async send(e){return this.service.send(e)}}class wi{}async function fi(t,e,o){const r=(await t).stream[Symbol.asyncIterator]();for(;;){const s=await Promise.race([e,r.next()]);if(s instanceof wi||s.done)return;const a=s.value;o(pw.encode(a))}}class ky{service;stopPublishingResponses;postMessage;requestChannel;constructor(e){const o=Sy();this.service=o;const n=ue();this.stopPublishingResponses=n,this.requestChannel=we(1024),this.postMessage=e,this.processRequests(),fi(o,n.promise,this.postMessage)}async setURL(e){try{switch(new URL(e).protocol){case"replay:":case"ws:":case"wss:":break;default:return console.warn("Invalid protocol for node validator URL:",e),!1}const n=await this.service;this.stopPublishingResponses.complete(new wi),(n instanceof gr||n instanceof Ar||n instanceof Cr)&&n.responseStream.close(),(n instanceof gr||n instanceof Ar||n instanceof Cr)&&n.requestStream.close();const r=await ui(e);if(r===null)return console.warn("Unable to determine service implementation from URL:",e),!1;const s=new hi(r),a=ue();return this.service=Promise.resolve(s),this.stopPublishingResponses=a,fi(Promise.resolve(s),a.promise,this.postMessage),!0}catch(o){return console.warn("error setting URL for node validator",e,o),!1}}async processRequests(){for await(const e of this.requestChannel)try{const o=await this.service;if(e instanceof Fe&&e.command instanceof Fo){await this.setURL(e.command.url);continue}o.send(e)}catch(o){console.warn("error processing message from event",o)}}async handleEvent(e){const o=Qh.decode(e.data);await this.requestChannel.publish(o)}}self.addEventListener("message",new ky(self.postMessage.bind(self)))})();
