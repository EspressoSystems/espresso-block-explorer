(function(){"use strict";class dc{breakpoint(){}}function ic(){return new dc}const lc=ic();function G(){lc.breakpoint()}class hc{assert(){}}function uc(){return new hc}const wc=uc();function x(t,e){wc.assert(t,e)}function Ke(t,e){x(typeof t===e,`type assertion failed: expected "${e}", received "${typeof t}"`)}function fc(t){x(t!=null,"expected a non-null value, received null")}function C(t,e){x(t instanceof e,`given value is not an instance of "${e.name}", specific type is "${typeof t=="object"&&t!==null?t.constructor.name:typeof t}"`)}class Ge extends Error{key;haveType;constructor(e,r,o=`expected object with key: "${r}", instead found ${e}`){super(o),this.haveType=e,this.key=r,Object.freeze(this),G()}toJSON(){return{code:Ge.name,message:this.message,have:this.haveType,key:this.key}}}class Qe{encode(e){return this.encoder.convert(e)}decode(e){return this.decoder.convert(e)}}class s extends Qe{}function no(t){return typeof t=="number"}function Se(t){return typeof t=="string"}function gc(t){return typeof t=="bigint"}function mc(t){return typeof t=="object"&&t!==null}function vc(t){return t!==void 0}function pc(t,e){return Array.isArray(t)&&t.every(e)}function yc(t){return e=>pc(e,t)}function A(t,...e){return mc(t)&&e.every(r=>r in t)}function c(t,...e){if(typeof t!="object")throw new Error("expected object");if(t===null)throw new Error("received null");for(const r of e)if(!(r in t))throw new Ge("object",r)}function S(t,e){if(!Se(t.code))throw new Error("code must be a string");if(t.code!==e)throw new Error(`expected code to be ${e}, got ${t.code}`)}class y extends Error{constructor(e){super(e)}get code(){return this.constructor.name}toJSON(){return M.convert(this)}}class R{convert(e){return C(e,y),{code:e.code,message:e.message}}}const M=new R,Sc="NoCodecFoundError";class be extends Error{codec;constructor(e,r=`no codec found for: "${e}"`){super(r),this.codec=e,Object.freeze(this),G()}toJSON(){return{code:a.encode(be.name),message:a.encode(this.message),codec:a.encode(this.codec)}}get code(){return Sc}}const Xe=new Map;class bc{convert(e){c(e,"code");const r=a.decode(e.code),o=Xe.get(r);if(!o)throw new be(r);return o.decode(e)}}class Ec{convert(e){const r=Xe.get(e.code);if(!r)throw new be(e.code);return r.encode(e)}}class Cc extends Qe{encoder=new Ec;decoder=new bc}const Ee=new Cc;function b(t,e){Xe.set(t,e)}const Ze="InvalidTypeError";class E extends y{have;want;constructor(e,r,o=`invalid type: have "${e}", want "${r}"`){super(o),this.have=e,this.want=r,Object.freeze(this)}toJSON(){return so.encode(this)}get code(){return Ze}}class xc{convert(e){return c(e,"code","have","want","message"),S(e,Ze),new E(a.decode(e.have),a.decode(e.want),a.decode(e.message))}}class Nc{convert(e){return C(e,E),{...M.convert(e),have:a.encode(e.have),want:a.encode(e.want)}}}class kc extends s{encoder=new Nc;decoder=new xc}const so=new kc;b(Ze,so);const Oc=yc(vc);class Bc{convert(e){return e}}const co=new Bc;class Ic extends Qe{encoder=co;decoder=co}const Ce=new Ic;class N{itemCodec;constructor(e){this.itemCodec=e}convert(e){if(!Oc(e)){const r=typeof e=="object"&&e!==null?e.constructor.name:typeof e,o="array";throw new Error(`invalid array value: have "${r}", want "${o}"`)}return e.map(r=>this.itemCodec.decode(r))}}class k{itemCodec;constructor(e){this.itemCodec=e}convert(e){return C(e,Array),e.map(r=>this.itemCodec.encode(r))}}class O extends s{encoder;decoder;constructor(e,r){super(),this.encoder=r,this.decoder=e}}class U{itemCodec;constructor(e){this.itemCodec=e}convert(e){return e===null?null:this.itemCodec.decode(e)}}class J{itemCodec;constructor(e){this.itemCodec=e}convert(e){return e===null?null:(fc(e),this.itemCodec.encode(e))}}class L extends s{encoder;decoder;constructor(e,r){super(),this.encoder=r,this.decoder=e}}class Dc{convert(e){if(!Se(e))throw new E(typeof e,"string");return e}}class Rc{convert(e){return Ke(e,"string"),e}}class Ac extends s{encoder=new Rc;decoder=new Dc}const a=new Ac;new O(new N(a),new k(a)),new L(new U(a),new J(a));class Ye extends y{constructor(e="completer has already been completed"){super(e),Object.freeze(this)}get code(){return ao}}const ao="CompleterAlreadyCompletedError";class Uc{convert(e){return c(e,"code","message"),S(e,ao),new Ye(a.decode(e.message))}}class Jc extends R{}class Lc extends s{encoder=new Jc;decoder=new Uc}const Wc=new Lc;b(Ye.name,Wc);function xe(){x(!1,"completer is not ready, this should never be reached")}function Ne(){throw new Ye}class Mc{resolve=xe;reject=xe;completed=!1;promise;get isCompleted(){return this.completed}constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r}),x(this.resolve!==xe,"resolve should be set"),x(this.reject!==xe,"resolve should be set")}complete(e){const r=this.resolve,o=this.reject;if(this.completed=!0,this.resolve=Ne,this.reject=Ne,e instanceof Promise){e.then(r,o);return}r(e)}completeError(e){this.reject(e),this.completed=!0,this.resolve=Ne,this.reject=Ne}}function et(){return new Mc}class re extends y{response;status;constructor(e,r,o){super(o),this.status=e,this.response=r}toJSON(){return io.convert(this)}}class ke{convert(e){return C(e,re),{...M.convert(e),status:e.status}}}const io=new ke,tt="BadResponseClientError";class lo extends re{constructor(e,r,o="bad server response: client error"){super(e,r,o),Object.freeze(this)}get code(){return tt}toJSON(){return ho.encode(this)}}class Pc{convert(e){return c(e,"code","message","status"),S(e,tt),new lo(Number(e.status),null,a.decode(e.message))}}class Tc extends ke{}class Fc extends s{encoder=new Tc;decoder=new Pc}const ho=new Fc;b(tt,ho);const rt="BadResponseError";class uo extends re{constructor(e,r,o="bad server response"){super(e,r,o),Object.freeze(this)}get code(){return rt}toJSON(){return wo.encode(this)}}class zc{convert(e){return c(e,"code","message","status"),S(e,rt),new uo(Number(e.status),null,a.decode(e.message))}}class _c extends ke{}class jc extends s{encoder=new _c;decoder=new zc}const wo=new jc;b(rt,wo);class fo extends re{constructor(e,r,o="bad server response: server error"){super(e,r,o),Object.freeze(this)}get code(){return ot}}const ot="BadResponseServerError";class Vc{convert(e){return c(e,"code","message","status"),S(e,ot),new fo(Number(e.status),null,a.decode(e.message))}}class Hc extends ke{}class qc extends s{encoder=new Hc;decoder=new Vc}const $c=new qc;b(ot,$c);const nt="ChannelClosedError";class oe extends y{constructor(e="channel closed"){super(e),Object.freeze(this)}get code(){return nt}}class Kc{convert(e){return c(e,"code","message"),S(e,nt),new oe(a.decode(e.message))}}class Gc extends R{}class Qc extends s{encoder=new Gc;decoder=new Kc}const Xc=new Qc;b(nt,Xc);const st="FetchError";class go extends y{cause;constructor(e,r=`fetch failed: ${String(e)}`){super(r),this.cause=e,Object.freeze(this)}get code(){return st}}class Zc{convert(e){return c(e,"code","message"),S(e,st),new go({},a.decode(e.message))}}class Yc extends R{}class ea extends s{encoder=new Yc;decoder=new Zc}const ta=new ea;b(st,ta);const ct="IncorrectBase64PaddingError";class mo extends y{constructor(e="incorrect padding"){super(e),Object.freeze(this)}get code(){return ct}}class ra{convert(e){return c(e,"code","message"),S(e,ct),new mo(a.decode(e.message))}}class oa extends R{}class na extends s{encoder=new oa;decoder=new ra}const sa=new na;b(ct,sa);class ca{convert(e){if(!no(e))throw new E(typeof e,"number");return e}}class aa{convert(e){return Ke(e,"number"),e}}class da extends s{encoder=new aa;decoder=new ca}const v=new da,vo=new L(new U(v),new J(v)),po=new O(new N(v),new k(v));new O(new N(vo),new k(vo));const at="InvalidBase64AlphabetLengthError";class dt extends y{length;constructor(e,r=`alphabet needs to be 64 characters, received ${e}`){super(r),this.length=e,Object.freeze(this)}toJSON(){return yo.encode(this)}get code(){return at}}class ia{convert(e){return c(e,"code","length","message"),S(e,at),new dt(v.decode(e.length),a.decode(e.message))}}class la{convert(e){return C(e,dt),{...M.convert(e),length:v.encode(e.length)}}}class ha extends s{encoder=new la;decoder=new ia}const yo=new ha;b(at,yo);const it="InvalidHexStringError";class So extends y{constructor(e="invalid hex string"){super(e),Object.freeze(this)}get code(){return it}}class ua{convert(e){return c(e,"code","message"),S(e,it),new So(a.decode(e.message))}}class wa extends R{}class fa extends s{encoder=new wa;decoder=new ua}const ga=new fa;b(it,ga);const lt="InvalidHexValueError";class bo extends y{value;constructor(e,r=`invalid hex value "${e}"`){super(r),this.value=e,Object.freeze(this)}toJSON(){return Eo.encode(this)}get code(){return lt}}class ma{convert(e){return c(e,"code","value","message"),S(e,lt),new bo(v.decode(e.value),a.decode(e.message))}}class va{convert(e){return{...M.convert(e),value:v.encode(e.value)}}}class pa extends s{encoder=new va;decoder=new ma}const Eo=new pa;b(lt,Eo);const ht="InvalidInputError";class ne extends y{constructor(e="invalid input"){super(e),Object.freeze(this),G()}get code(){return ht}}class ya{convert(e){return c(e,"code","message"),S(e,ht),new ne(a.decode(e.message))}}class Sa extends R{}class ba extends s{encoder=new Sa;decoder=new ya}const Ea=new ba;b(ht,Ea);const ut="InvalidStringValueError";class Co extends y{have;want;constructor(e,r,o=`invalid string value: have "${e}", want "${r}"`){super(o),this.have=e,this.want=r,Object.freeze(this)}toJSON(){return xo.encode(this)}get code(){return ut}}class Ca{convert(e){return c(e,"code","have","want","message"),S(e,ut),new Co(a.decode(e.have),a.decode(e.want),a.decode(e.message))}}class xa{convert(e){return C(e,Co),{...M.convert(e),have:a.encode(e.have),want:a.encode(e.want)}}}class Na extends s{encoder=new xa;decoder=new Ca}const xo=new Na;b(ut,xo);const wt="InvalidTaggedBase64EncodingError";class No extends y{constructor(e="invalid tagged base64 encoding"){super(e),Object.freeze(this)}toJSON(){return ko.encode(this)}get code(){return wt}}class ka{convert(e){return c(e,"code","message"),S(e,wt),new No(a.decode(e.message))}}class Oa extends R{}class Ba extends s{encoder=new Oa;decoder=new ka}const ko=new Ba;b(wt,ko);const ft="MissingElementError";class Oe extends y{constructor(e="missing element"){super(e),Object.freeze(this)}get code(){return ft}}class Ia{convert(e){return c(e,"code","message"),S(e,ft),new Oe(a.decode(e.message))}}class Da extends R{}class Ra extends s{encoder=new Da;decoder=new Ia}const Aa=new Ra;b(ft,Aa);const gt="NoCompleterFoundForRequestID";class Oo extends y{requestID;constructor(e,r=`no completer found for request id "${e}"`){super(r),this.requestID=e,Object.freeze(this)}toJSON(){return Bo.encode(this)}get code(){return gt}}class Ua{convert(e){return c(e,"code","requestID","message"),S(e,gt),new Oo(Ce.decode(e.requestID),a.decode(e.message))}}class Ja{convert(e){return C(e,Oo),{...M.convert(e),requestID:Ce.encode(e.requestID)}}}class La extends s{encoder=new Ja;decoder=new Ua}const Bo=new La;b(gt,Bo);const mt="NotFoundError";class Wa extends y{key;constructor(e,r=`Not Found: ${e}`){super(r),this.key=e,Object.freeze(this)}get code(){return mt}}class Io{codec;constructor(e){this.codec=e}convert(e){return c(e,"code","key"),S(e,mt),new Wa(this.codec.decode(e.key))}}class Do{codec;constructor(e){this.codec=e}convert(e){return{...M.convert(e),key:this.codec.encode(e.key)}}}class Ro extends s{encoder;decoder;constructor(e,r){super(),this.encoder=e,this.decoder=r}}new Ro(new Do(a),new Io(a));const Ma=new Ro(new Do(Ce),new Io(Ce));b(mt,Ma);const vt="NoURLProvidedError";class Pa extends y{constructor(e="no url provided"){super(e),Object.freeze(this)}get code(){return vt}}class Ta{convert(e){return c(e,"code","message"),S(e,vt),new Pa(a.decode(e.message))}}class Fa extends R{}class za extends s{encoder=new Fa;decoder=new Ta}const _a=new za;b(vt,_a);const pt="UnimplementedError";class P extends y{constructor(e="unimplemented"){super(e),Object.freeze(this),G()}get code(){return pt}}class ja{convert(e){return c(e,"code","message"),S(e,pt),new P(a.decode(e.message))}}class Va extends R{}class Ha extends s{encoder=new Va;decoder=new ja}const qa=new Ha;b(pt,qa);const yt="QUERY_ERROR";class $a extends y{error;constructor(e,r="missing element"){super(r),this.error=e,Object.freeze(this)}get code(){return yt}}class Ka{convert(e){return c(e,"code","error","message"),S(e,yt),new $a(Lo.decode(e.error),a.decode(e.message))}}class Ga{convert(e){return{code:e.code,error:Lo.encode(e.error),message:a.encode(e.message)}}}class Qa extends s{encoder=new Ga;decoder=new Ka}const Xa=new Qa;class St{}const bt="NotFound";class Ao extends St{constructor(){super(),Object.freeze(this)}valueOf(){return bt}toJSON(){return this.valueOf()}}const Za=new Ao,Et="Missing";class Uo extends St{constructor(){super(),Object.freeze(this)}valueOf(){return Et}toJSON(){return this.valueOf()}}const Ya=new Uo;class Jo extends St{error;constructor(e){super(),this.error=e,Object.freeze(this)}toJSON(){return xt.encode(this)}}class ed{message;constructor(e){this.message=e,Object.freeze(this)}toJSON(){return Ct.encode(this)}}class td{convert(e){return c(e,"message"),new ed(a.decode(e.message))}}class rd{convert(e){return{message:a.encode(e.message)}}}class od extends s{encoder=new rd;decoder=new td}const Ct=new od;class nd{convert(e){return c(e,"Error"),new Jo(Ct.decode(e.Error))}}class sd{convert(e){return{Error:Ct.encode(e.error)}}}class cd extends s{encoder=new sd;decoder=new nd}const xt=new cd;class ad{convert(e){return e===bt?Za:e===Et?Ya:xt.decode(e)}}class dd{convert(e){if(e instanceof Ao)return bt;if(e instanceof Uo)return Et;if(e instanceof Jo)return xt.encode(e);throw new P}}class id extends s{encoder=new dd;decoder=new ad}const Lo=new id;b(yt,Xa);const Wo="ResponseContentTypeIsNotApplicationJSONError";class se extends re{haveHeaderType;constructor(e,r,o,n="response content type is not application/json"){super(r,o,n),this.haveHeaderType=e,Object.freeze(this)}static fromResponse(e,r){return new se(e.headers.get("content-type")??"undefined",e.status,e,r)}toJSON(){return Mo.encode(this)}get code(){return Wo}}class ld{convert(e){return c(e,"code","status","have","want","message"),S(e,Wo),new se(a.decode(e.code),v.decode(e.status),null,a.decode(e.message))}}class hd{convert(e){return{...io.convert(e),have:a.encode(e.haveHeaderType),want:a.encode("application/json")}}}class ud extends s{encoder=new hd;decoder=new ld}const Mo=new ud;b(se.name,Mo);const Nt="WebWorkerErrorResponse";class wd extends y{error;constructor(e,r="error in web worker"){super(r),this.error=e,Object.freeze(this)}toJSON(){return Po.encode(this)}get code(){return Nt}}class fd{convert(e){return c(e,"code","error","message"),S(e,Nt),new wd(Ee.decode(e.error),a.decode(e.message))}}class gd{convert(e){return{...M.convert(e),error:Ee.encode(e.error)}}}class md extends s{encoder=new gd;decoder=new fd}const Po=new md;b(Nt,Po);var To=(t=>(t[t.success=0]="success",t[t.full=1]="full",t[t.failed=2]="failed",t))(To||{});class vd{getFromEmpty(){}}class pd{getFromEmpty(){throw new Oe}}const Fo={returnUndefined:new vd,throwMissingElement:new pd};class yd{maxSize;constructor(e){x(!Number.isNaN(e),"maxSize must not be NaN"),x(Number.isInteger(e),"maxSize must be an integer"),x(e>0,"maxSize must be greater than 0"),this.maxSize=e}nextIndex(e){return x(e>=0,"index must be greater than or equal to 0"),(e+1)%this.maxSize}}class Sd{preComputedSizeMinus1;constructor(e){x(!Number.isNaN(e),"maxSize must not be NaN"),x(Number.isInteger(e),"maxSize must be an integer"),x(e>0,"maxSize must be greater than 0"),x(zo(e),"maxSize must be a power of two"),this.preComputedSizeMinus1=e-1}nextIndex(e){return x(e>=0,"index must be greater than or equal to 0"),e+1&this.preComputedSizeMinus1}}function zo(t){return(t&t-1)===0}const kt="BufferFullError";class _o extends y{constructor(e="buffer full"){super(e),Object.freeze(this)}get code(){return kt}}class bd{convert(e){return c(e,"code","message"),S(e,kt),new _o(a.decode(e.message))}}class Ed extends R{}class Cd extends s{encoder=new Ed;decoder=new bd}const xd=new Cd;b(kt,xd);class Nd{putToFull(e,r){return e.get(),e.put(r)}}class kd{putToFull(){throw new _o}}const jo={overwriteOldest:new Nd,throw:new kd};function Od(t){return zo(t)?new Sd(t):new yd(t)}class Bd{readIndex=0;writeIndex=0;buffer;nextIndex;getOnEmpty;putOnFull;constructor(e,r,o){x(!Number.isNaN(e),"maxSize must not be NaN"),this.buffer=new Array(e),this.nextIndex=Od(e),this.getOnEmpty=r,this.putOnFull=o}get maxSize(){return this.buffer.length}get length(){return this.writeIndex<this.readIndex?this.writeIndex+this.maxSize-this.readIndex:this.writeIndex-this.readIndex}put(e){const r=this.nextIndex.nextIndex(this.writeIndex);return r===this.readIndex?this.putOnFull.putToFull(this,e):(this.buffer[this.writeIndex]=e,this.writeIndex=r,To.success)}get(){if(this.readIndex===this.writeIndex)return this.getOnEmpty.getFromEmpty(this);const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),e}[Symbol.iterator](){return new Id(this)}immutableIterable(){return{[Symbol.iterator]:()=>this.immutableIterator()}}immutableIterator(){return new Dd(this.readIndex,this.writeIndex,this.buffer,this.nextIndex)}}class Id{buffer;constructor(e){this.buffer=e}next(){const e=this.buffer.get();return e==null?{value:void 0,done:!0}:{value:e,done:!1}}}class Dd{readIndex;writeIndex;buffer;nextIndex;constructor(e,r,o,n){this.readIndex=e,this.writeIndex=r,this.buffer=o,this.nextIndex=n}next(){if(this.readIndex===this.writeIndex)return{value:void 0,done:!0};const e=this.buffer[this.readIndex];return this.readIndex=this.nextIndex.nextIndex(this.readIndex),{value:e,done:!1}}}function Rd(t=32,e=Fo.returnUndefined,r=jo.overwriteOldest){return new Bd(t,e,r)}class Ad{publishQueue;pollBlocked;publishBlocked;capacity;closed=!1;constructor(e){this.publishQueue=Rd(Math.max(2,e),Fo.throwMissingElement,jo.throw);const r=et();this.pollBlocked=r,this.publishBlocked=r,r.complete(),this.capacity=e-1}get isClosed(){return this.closed}close(){if(this.closed)throw new oe;this.closed=!0}async drain(){for(;this.publishQueue.length>0;)this.publishQueue.get()}async publish(e){if(this.closed)throw new oe;if(this.publishQueue.length>=this.capacity){if(this.publishBlocked.isCompleted){const r=et();this.publishBlocked=r,await r.promise}return await this.publishBlocked.promise,this.publish(e)}this.publishQueue.put(e),this.pollBlocked.isCompleted||this.pollBlocked.complete()}async poll(){if(this.publishQueue.length<=0){if(this.isClosed)throw new oe;if(this.pollBlocked.isCompleted){const r=et();this.pollBlocked=r}return await this.pollBlocked.promise,this.poll()}const e=this.publishQueue.get();return this.publishBlocked.isCompleted||this.publishBlocked.complete(),e}[Symbol.asyncIterator](){return new Ud(this)}}class Ud{channel;constructor(e){this.channel=e}async next(){try{return{done:!1,value:await this.channel.poll()}}catch(e){if(e instanceof oe)return{done:!0,value:void 0};throw e}}}function Jd(t){return new Ad(t)}class Ld{convert(e){if(gc(e))return e;if(no(e))return BigInt(e);if(!Se(e))throw new E(typeof e,"string | bigint | number");return BigInt(e)}}class Wd{convert(e){return Ke(e,"bigint"),`0x${e.toString(16)}`}}class Md extends s{encoder=new Wd;decoder=new Ld}const l=new Md,Vo=new L(new U(l),new J(l)),Ho=new O(new N(l),new k(l));new O(new N(Vo),new k(Vo)),BigInt.prototype.toJSON=function(){return l.encode(this)};class z{constructor(e,r,o){this.alpha3Code=e,this.code=r,this.significantDigits=o,this.alpha3Code=e,this.code=r,this.significantDigits=o,this.significantDigitsMultiplier=BigInt(10)**BigInt(this.significantDigits)}significantDigitsMultiplier;toJSON(){return Bt.encode(this)}}const qo=new z("JPY",392,0),Pd=new z("GBP",826,2),$o=new z("USD",840,2),Td=new z("EUR",978,2),Fd=new z("XXX",999,2),Ko=new z("ETH",1001,18),Ot=new z("XBT",1002,8),Go=new z("ESP",10001,18),zd=[qo,Pd,$o,Td,Fd,Ko,Ot,Go],_d=new Map(zd.map(t=>[t.alpha3Code,t]));class jd{convert(e){if(typeof e!="string")throw new ne("CurrencyCodeDecoder: expected string");if(e==="BTC")return Ot;const r=_d.get(e);if(r===void 0)throw new ne(`CurrencyCodeDecoder: unknown currency: "${e}"`);return r}}class Vd{convert(e){return C(e,z),e.alpha3Code}}class Hd extends s{decoder=new jd;encoder=new Vd}const Bt=new Hd;class T{constructor(e,r){this.currency=e,this.value=r,this.currency=e,this.value=r}static USD(e){return new T($o,BigInt(e))}static ETH(e){return new T(Ko,BigInt(e))}static ESP(e){return new T(Go,BigInt(e))}static JPY(e){return new T(qo,BigInt(e))}static BTC(e){return new T(Ot,BigInt(e))}toString(){return Be.encode(this)}toISOString(){return this.toString()}toNumericLiteralString(){return Qo.convert(this)}toHexString(){return l.encode(this.value)}toJSON(){return Be.encode(this)}}function qd(t){return t==="."||t===","||t===" "}function $d(t,e){let r=-1;const o=t.length;for(let n=0;n<o;n++)e(t[n])&&(r=n);return r}class Kd{parseCurrencyCode(e){return Bt.decode(e)}parseValue(e,r){let o=1n;r[0]==="-"&&(o=-1n,r=r.substring(1));const n=$d(r,qd);if(n===-1){const h=BigInt(r.replace(/\D/g,""))*e.significantDigitsMultiplier;return o*h}const d=r.substring(0,n).replace(/\D/g,""),u=r.substring(n+1).replace(/\D/g,""),w=BigInt(d)*e.significantDigitsMultiplier,m=BigInt(u)*10n**BigInt(e.significantDigits-u.length);return o*(w+m)}convert(e){if(typeof e!="string")throw new ne("MonetaryValueDecoder: expected string");const r=e.indexOf(" ");if(r<=-1)throw new ne("MonetaryValueDecoder: missing non-breaking space");const o=e.substring(0,r),n=e.substring(r+1);if(/^-?[\d .,]+$/.test(o)){const u=this.parseCurrencyCode(n);return new T(u,this.parseValue(u,o))}const d=this.parseCurrencyCode(o);return new T(d,this.parseValue(d,n))}}class Gd{convert(e){const r=e.value<0n?"-":"",o=e.value<0n?-e.value:e.value,n=o%e.currency.significantDigitsMultiplier,d=o/e.currency.significantDigitsMultiplier,u=String(d),w=String(n);return/^0+$/.test(w)?`${r}${u}`:`${r}${d}.${String(n).padStart(e.currency.significantDigits,"0")}`}}const Qo=new Gd;class Qd{convert(e){C(e,T);const r=Qo.convert(e);return`${Bt.encode(e.currency)} ${r}`}}class Xd extends s{decoder=new Kd;encoder=new Qd}const Be=new Xd;new O(new N(Be),new k(Be));class p{namespace;name;site;blockExplorer;constructor(e,r,o,n){this.namespace=e,this.name=r,this.site=o,this.blockExplorer=n}}const Zd=new p(202374881,"Vienna",new URL("https://vienna.caldera.dev/"),new URL("https://vienna.calderaexplorer.xyz/")),Yd=new p(202374882,"OP Stack",new URL("https://stack.optimism.io/"),new URL("https://www.blockscout.com/")),ei=new p(33914988448,"Arbitrum",new URL("https://arbitrum.io/"),new URL("https://arbiscan.io/")),ti=new p(33914988449,"Eigen Layer",new URL("https://www.eigenlayer.xyz/"),new URL("https://www.blockscout.com/")),ri=new p(33914988450,"Spire",new URL("https://www.spire.dev/"),new URL("https://www.blockscout.com/")),oi=new p(33914988451,"Alt Layer",new URL("https://altlayer.io/"),new URL("https://www.blockscout.com/")),ni=new p(33914988452,"Caldera",new URL("https://www.caldera.xyz/"),new URL("https://www.blockscout.com/")),si=new p(33914988453,"Vistara Labs",new URL("https://vistara.dev/"),new URL("https://www.blockscout.com/")),ci=new p(33914988454,"Polygon",new URL("https://polygon.technology/"),new URL("https://www.blockscout.com/")),ai=new p(263,"Milan",new URL("https://milan.caldera.dev/"),new URL("https://milan-devnet.explorer.caldera.xyz/")),di=new p(41234687,"Kyoto",new URL("https://example.com/"),new URL("https://kyoto-explorer.altlayer.io/")),ii=1918988905,li=new p(ii,"RARI",new URL("https://rarichain.org/"),new URL("https://explorer.rarichain.org/")),hi=1380012617,ui=new p(hi,"RARI",new URL("https://rarichain.org/"),new URL("https://mainnet.explorer.rarichain.org/")),wi=9369,fi=new p(wi,"LogX",new URL("https://logx.network/"),new URL("https://kartel-testnet-explorer.alt.technology/")),gi=936369,mi=new p(gi,"LogX",new URL("https://logx.network/"),new URL("https://vzjuxmhfn70kgnlds27h-explorer.alt.technology")),vi=466,pi=new p(vi,"AppChain",new URL("https://appchain.xyz/"),new URL("https://explorer.appchain.xyz/")),yi=4661,Si=new p(yi,"AppChain",new URL("https://appchain.xyz/"),new URL("https://appchaintestnet.explorer.caldera.xyz/")),bi=360,Ei=new p(bi,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),Ci=3609,xi=new p(Ci,"Molten",new URL("https://www.moltennetwork.com/"),new URL("https://molten.explorer.caldera.dev/")),Ni=33139,ki=new p(Ni,"APECHAIN",new URL("https://apechain.com/"),new URL("https://apescan.io/")),Oi=3313939,Bi=new p(Oi,"APECHAIN",new URL("https://apechain.com/"),new URL("https://apechain-testnet.explorer.caldera.xyz/")),Ii=13107,Di=new p(Ii,"t3rn",new URL("https://t3rn.io/"),new URL("https://brn-testnet.explorer.caldera.xyz/")),Ri=819,Ai=new p(Ri,"t3rn",new URL("https://t3rn.io/"),new URL("https://exporer.t3rn.io/")),Xo=21341,Ui=new p(Xo,"Rufus",new URL("https://l2beat.com/scaling/projects/rufus"),new URL("https://rufus-sepolia-testnet.explorer.caldera.xyz/")),Ji=new p(Xo,"Rufus",new URL("https://l2beat.com/scaling/projects/rufus"),new URL("https://rufus.calderaexplorer.xyz/")),Li=2524852,Wi=new p(Li,"Huddle01",new URL("https://huddle01.com/"),new URL("https://hudlscan.com/txs")),Mi=1397311310,Zo=new p(Mi,"Infinite Garden",new URL("https://infinitegarden.espressosys.com/"),new URL("https://explorer.main.net.espressosys.com/")),Pi=10101,Ti=new p(Pi,"Timeboost Decaf",new URL("https://espressosys.com/"),new URL("https://explorer.decaf.testnet.espresso.network/")),Fi=[Zo,ui,mi,Ei,pi,ki,Ai,Ji],zi=[Zo,li,fi,Si,xi,Bi,Di,Ui,Wi,Ti],_i=new Map([Zd,Yd,ei,ci,ti,ri,oi,ni,si,ai,di,...Fi,...zi].map(t=>[t.namespace,t])),It="CorruptBase64InputError";class V extends y{offset;constructor(e,r=`corrupt input error at ${e}`){super(r),this.offset=e,Object.freeze(this)}get code(){return It}toJSON(){return Yo.encode(this)}}class ji{convert(e){return c(e,"code","offset","message"),S(e,It),new V(v.decode(e.offset),a.decode(e.message))}}class Vi{convert(e){return C(e,V),{...M.convert(e),offset:v.encode(e.offset),message:a.encode(e.message)}}}class Hi extends s{encoder=new Vi;decoder=new ji}const Yo=new Hi;b(It,Yo);class qi{convert(e){const r=new ArrayBuffer(e.byteLength);return new Uint8Array(r).set(e),r}}class $i{convert(e){return new Uint8Array(e)}}class Ki extends s{encoder=new qi;decoder=new $i}const Dt=new Ki,Gi=new TextEncoder;function en(t){return Gi.encode(t)}const Qi=new TextDecoder;function Xi(t){return Qi.decode(t)}function*tn(t){yield*en(t)}function*Zi(){for(let t=0;t<256;t++)yield 255}const ce=-1,Yi=61;class ae{encodeMap;decodeMap;padChar;strict;constructor(e,r,o=Yi,n=!1){this.encodeMap=e,this.decodeMap=r,this.padChar=o,this.strict=n}static withAlphabet(e){const r=e.length;if(r!==64)throw new dt(r);const o=Array.from(tn(e)),n=Array.from(Zi());for(let d=0;d<r;d++)n[o[d]]=d;return new ae(o,n)}withPadding(e){return new ae(this.encodeMap,this.decodeMap,e,this.strict)}encode(e){if(e.byteLength===0)return new ArrayBuffer(0);let r=0,o=0;const n=Math.floor(e.byteLength/3)*3,d=Math.ceil(e.byteLength/3)*4,u=new ArrayBuffer(d),w=new DataView(e),m=new DataView(u);for(;o<n;){const I=w.getUint8(o+0)<<16|w.getUint8(o+1)<<8|w.getUint8(o+2);m.setUint8(r+0,this.encodeMap[I>>18&63]),m.setUint8(r+1,this.encodeMap[I>>12&63]),m.setUint8(r+2,this.encodeMap[I>>6&63]),m.setUint8(r+3,this.encodeMap[I&63]),o+=3,r+=4}const h=e.byteLength-o;if(h===0)return u;let B=w.getUint8(o+0)<<16;switch(h===2&&(B|=w.getUint8(o+1)<<8),m.setUint8(r+0,this.encodeMap[B>>18&63]),m.setUint8(r+1,this.encodeMap[B>>12&63]),h){case 2:return m.setUint8(r+2,this.encodeMap[B>>6&63]),this.padChar!==ce?(m.setUint8(r+3,this.padChar),u.slice(0,r+4)):u.slice(0,r+3);case 1:if(this.padChar!==ce)return m.setUint8(r+2,this.padChar),m.setUint8(r+3,this.padChar),u.slice(0,r+4);break}return u.slice(0,r+2)}decode(e){const r=e.byteLength;if(r===0)return new ArrayBuffer(0);const o=new DataView(e),n=new ArrayBuffer(Math.floor(r/4*3)),d=new DataView(n),u=new ArrayBuffer(4),w=new DataView(u);let m=0,h=0,B=0,I=!1;for(;h<r&&!I;){let g=3,f=4;for(let D=0;D<4;D++){if(h===r){if(D===0)return n;if(D===1||this.padChar!==ce)throw new V(h-D);g=D-1,f=D,I=!0;break}const K=o.getUint8(h);h++;const ye=this.decodeMap[K];if(ye!==255){w.setUint8(D,ye);continue}if(K===10||K===13){D--;continue}if(K===this.padChar){switch(D){case 0:case 1:throw new mo;case 2:for(;h<r&&(o.getUint8(h)===10||o.getUint8(h)===13);)h++;if(h===r)throw new V(r);h++}for(;h<r&&(o.getUint8(h)===10||o.getUint8(h)===13);)h++;if(h<r)throw new V(h);g=3,f=D,I=!0;break}throw new V(h-1)}const te=w.getUint8(0)<<18|w.getUint8(1)<<12|w.getUint8(2)<<6|w.getUint8(3);switch(w.setUint8(2,te>>0&255),w.setUint8(1,te>>8&255),w.setUint8(0,te>>16&255),f){case 4:d.setUint8(B+2,w.getUint8(2)),w.setUint8(2,0);case 3:if(d.setUint8(B+1,w.getUint8(1)),this.strict&&w.getUint8(2)!==0)throw new V(h-1);case 2:if(d.setUint8(B+0,w.getUint8(0)),this.strict&&(w.getUint8(1)!==0||w.getUint8(2)!==0))throw new V(h-2)}B+=g,m+=f-1}return n.slice(0,m)}decodeString(e){return this.decode(Dt.encode(en(e)))}encodeToString(e){return Xi(this.encode(e))}}const rn=ae.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),el=rn.withPadding(ce),on=ae.withAlphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Rt=on.withPadding(ce);class F{tag;data;constructor(e,r){this.tag=e,this.data=r}static fromString(e){const r=e.indexOf("~");if(r<0)throw new No;const o=e.substring(0,r),n=Rt.decodeString(e.substring(r+1));return new F(o,n)}static inflate(e){return W.decode(e)}toString(){return`${this.tag}~${Rt.encodeToString(this.data)}`}valueOf(){return this.toString()}toJSON(){return this.toString()}}class tl{convert(e){if(typeof e!="string")throw new E(typeof e,"string");return F.fromString(e)}}class rl{convert(e){return C(e,F),e.toString()}}class ol extends s{encoder=new rl;decoder=new tl}const W=new ol,de=2147483648,nl=1103515245,sl=12345;class Q{state;constructor(e){this.state=e!==void 0?e:Math.floor(Math.random()*(de-1))}nextInt(){return this.state=(nl*this.state+sl)%de,this.state}nextFloat(){return this.nextInt()/(de-1)}nextRange(e,r){const o=r-e,n=this.nextInt()/de;return e+Math.floor(n*o)}nextRangeBigInt(e,r){const o=r-e,n=BigInt(this.nextInt())*1000000n/BigInt(de);return e+n*o/1000000n}fillBytes(e){const r=new ArrayBuffer(e),o=new DataView(r);let n=0;for(;n<e-4;n+=4)o.setUint32(n,this.nextRange(0,4294967295));for(let d=n;d<e;d++)o.setUint8(d,this.nextRange(0,256));return r}}const Ie=new Date,nn=new Date(Ie.getFullYear(),Ie.getMonth(),Ie.getDate()).valueOf(),cl=nn;function sn(){return Ie.valueOf()}function al(){return nn}function At(){return cl}function*dl(t,e){for(let r=t.next();!r.done;r=t.next())e(r.value)&&(yield r.value)}function il(t,e){return dl(t[Symbol.iterator](),e)}function*cn(t,e){for(let r=t.next();!r.done;r=t.next())yield e(r.value)}function De(t,e){return cn(t[Symbol.iterator](),e)}function*ll(t,e){for(let r=0;r<e;r++){const o=t.next();if(o.done)return;yield o.value}}function hl(t,e){return ll(t[Symbol.iterator](),e)}function ul(t){let e;for(let r=t.next();!r.done;r=t.next())e=r.value;if(e===void 0)throw new Oe;return e}function wl(t){return ul(t[Symbol.iterator]())}function*fl(t,e){for(let r=t.next();!r.done;r=t.next())yield*e(r.value)}function gl(t,e){return fl(t[Symbol.iterator](),e)}function*ml(){let t=0;for(;;)yield t++}function vl(t){return hl(ml(),Math.ceil(t))}function*pl(t,e,r){for(let o=t.next(),n=e.next();!o.done&&!n.done;o=t.next(),n=e.next())yield r(o.value,n.value)}function an(t,e,r){return pl(t[Symbol.iterator](),e[Symbol.iterator](),r)}const dn=["Residential","Mobile","Enterprise","AWS","Azure","GCP"],ln=["Espresso v1.0","Espresso v1.1","Espresso v1.2","Espresso v1.3","Espresso v1.4"],hn=["Linux","Unix","Windows","MacOS"],un=[["Espresso","https://espressosys.com/"],["BlockDaemon","https://www.blockdaemon.com/"],["Unit 410","https://unit410.com/"],["Nethermind","https://www.nethermind.io/"],["Sub7","https://sub7.xyz/"],["KudasaiJP","https://kudasai.co.jp/"],["Informal Systems","https://informal.systems/"],["P2P","https://p2p.org/"],["LinkPool","https://linkpool.com/"],["ZKV","https://zkvalidator.com/"],["Figment","https://figment.io/"]],yl=[[["Mexico City",19.4333,-99.1333,"MX"],["Guadalajara",20.6767,-103.3475,"MX"],["Monterrey",25.6667,-100.3,"MX"],["Guatemala City",14.6133,-90.5353,"GT"],["Tijuana",32.525,-117.0333,"MX"],["Ecatepec",19.6097,-99.06,"MX"],["Tegucigalpa",14.1058,-87.2047,"HN"],["León de los Aldama",21.1167,-101.6833,"MX"],["San José",9.9325,-84.08,"CR"],["Panama City",8.9833,-79.5167,"PA"],["Juárez",31.745,-106.485,"MX"],["Comayagüela",14.098,-87.21,"HN"],["Mexicali",32.6633,-115.4678,"MX"],["Nezahualcóyotl",19.4081,-99.0186,"MX"],["Managua",12.1364,-86.2514,"NI"],["Morelia",19.7683,-101.1894,"MX"],["Aguascalientes",21.876,-102.296,"MX"],["Mérida",20.97,-89.62,"MX"],["Saltillo",25.4231,-100.9919,"MX"],["Culiacán",24.8069,-107.3939,"MX"]],[["Havana",23.1367,-82.3589,"CU"],["San Juan",18.3985,-66.061,"PR"],["Santiago",19.4572,-70.6889,"DO"],["Santo Domingo",18.4667,-69.95,"DO"],["Port-au-Prince",18.5333,-72.3333,"HT"],["Santo Domingo Este",18.4855,-69.8734,"DO"],["Kingston",17.9714,-76.7931,"JM"],["Carrefour",18.5344,-72.4094,"HT"],["Santiago de Cuba",20.0217,-75.8294,"CU"],["Pétion-Ville",18.5128,-72.2864,"HT"],["Holguín",20.8869,-76.2592,"CU"],["Gonaïves",19.4456,-72.6883,"HT"],["Camagüey",21.3839,-77.9075,"CU"],["Puerto Plata",19.8,-70.6833,"DO"],["Croix-des-Bouquets",18.5761,-72.2269,"HT"],["Nassau",25.0781,-77.3386,"BS"],["Fort-de-France",14.6,-61.0667,"MQ"],["Higüey",18.6167,-68.7,"DO"],["Santa Clara",22.4069,-79.9649,"CU"],["Bayamo",20.3817,-76.6428,"CU"]],[["Cairo",30.0444,31.2358,"EG"],["Lagos",6.455,3.3841,"NG"],["Kinshasa",-4.3219,15.3119,"CD"],["Luanda",-8.8383,13.2344,"AO"],["Johannesburg",-26.2044,28.0456,"ZA"],["Dar es Salaam",-6.8161,39.2803,"TZ"],["Douala",4.05,9.7,"CM"],["Giza",29.987,31.2118,"EG"],["Abidjan",5.3167,-4.0333,"CI"],["Cape Town",-33.9253,18.4239,"ZA"],["Bamako",12.6392,-8.0028,"ML"],["Abuja",9.0667,7.4833,"NG"],["Ibadan",7.3964,3.9167,"NG"],["Addis Ababa",9.03,38.74,"ET"],["Mbuji-Mayi",-6.15,23.6,"CD"],["Mogadishu",2.0392,45.3419,"SO"],["Lusaka",-15.4167,28.2833,"ZM"],["Antananarivo",-18.91,47.525,"MG"],["Awka",6.2069,7.0678,"NG"],["Bamenda",5.9614,10.1517,"CM"]],[["Tokyo",35.6897,139.6922,"JP"],["Delhi",28.61,77.23,"IN"],["Manila",14.5958,120.9772,"PH"],["Dhaka",23.7639,90.3889,"BD"],["Moscow",55.7558,37.6172,"RU"],["Ho Chi Minh City",10.7756,106.7019,"VN"],["Xi’an",34.2611,108.9422,"CN"],["Dongguan",23.021,113.752,"CN"],["Tongshan",34.204,117.284,"CN"],["Jining",35.4151,116.5871,"CN"],["Cangzhou",38.3047,116.8387,"CN"],["Shaoyang",27.2395,111.4679,"CN"],["Dalian",38.9,121.6,"CN"],["Ankara",39.93,32.85,"TR"],["Zhangzhou",24.513,117.647,"CN"],["Changsha",28.228,112.939,"CN"],["Ürümqi",43.8225,87.6125,"CN"],["Ningbo",29.8603,121.6245,"CN"],["Suihua",46.654,126.969,"CN"],["Deyang",31.127,104.398,"CN"]],[["London",51.5072,-.1275,"GB"],["Madrid",40.4169,-3.7033,"ES"],["Berlin",52.52,13.405,"DE"],["Barcelona",41.3828,2.1769,"ES"],["Athens",37.9842,23.7281,"GR"],["Budapest",47.4925,19.0514,"HU"],["Birmingham",52.48,-1.9025,"GB"],["Stuttgart",48.7775,9.18,"DE"],["Munich",48.1375,11.575,"DE"],["Hamburg",53.55,10,"DE"],["Bucharest",44.4325,26.1039,"RO"],["Vienna",48.2083,16.3725,"AT"],["Stockholm",59.3294,18.0686,"SE"],["Minsk",53.9,27.5667,"BY"],["Warsaw",52.23,21.0111,"PL"],["Valencia",39.47,-.3764,"ES"],["Amsterdam",52.3728,4.8936,"NL"],["Copenhagen",55.6761,12.5683,"DK"],["Porto",41.1621,-8.622,"PT"],["Brussels",50.8467,4.3525,"BE"]],[["New York",40.6943,-73.9249,"US"],["Los Angeles",34.1141,-118.4068,"US"],["Chicago",41.8375,-87.6866,"US"],["Miami",25.784,-80.2101,"US"],["Dallas",32.7935,-96.7667,"US"],["Philadelphia",40.0077,-75.1339,"US"],["Atlanta",33.7628,-84.422,"US"],["Boston",42.3188,-71.0852,"US"],["Phoenix",33.5722,-112.0892,"US"],["Detroit",42.3834,-83.1024,"US"],["Seattle",47.6211,-122.3244,"US"],["San Francisco",37.7558,-122.4449,"US"],["San Diego",32.8313,-117.1222,"US"],["Minneapolis",44.9635,-93.2678,"US"],["Brooklyn",40.6501,-73.9496,"US"],["Vancouver",49.25,-123.1,"CA"],["Riverside",33.9381,-117.3949,"US"],["Baltimore",39.3051,-76.6144,"US"],["Portland",45.5371,-122.65,"US"],["Sacramento",38.5677,-121.4685,"US"]],[["Melbourne",-37.8142,144.9631,"AU"],["Sydney",-33.8678,151.21,"AU"],["Brisbane",-27.4678,153.0281,"AU"],["Perth",-31.9559,115.8606,"AU"],["Auckland",-36.8406,174.74,"NZ"],["Adelaide",-34.9275,138.6,"AU"],["Port Moresby",-9.4789,147.1494,"PG"],["Gold Coast",-28.0167,153.4,"AU"],["Cranbourne",-38.0996,145.2834,"AU"],["Christchurch",-43.531,172.6365,"NZ"],["Manukau City",-37,174.885,"NZ"],["Central Coast",-33.3,151.2,"AU"],["Wollongong",-34.4331,150.8831,"AU"],["Ipswich",-27.6144,152.7608,"AU"],["Wellington",-41.2889,174.7772,"NZ"],["Northcote",-36.8019,174.7494,"NZ"],["Hobart",-42.8806,147.325,"AU"],["Lae",-6.7303,147.0008,"PG"],["Suva",-18.1416,178.4419,"FJ"],["Nouméa",-22.2758,166.458,"NC"]],[["São Paulo",-23.55,-46.6333,"BR"],["Buenos Aires",-34.6033,-58.3817,"AR"],["Rio de Janeiro",-22.9111,-43.2056,"BR"],["Lima",-12.06,-77.0375,"PE"],["Bogotá",4.7111,-74.0722,"CO"],["Santiago",-33.4372,-70.6506,"CL"],["Belo Horizonte",-19.9167,-43.9333,"BR"],["Fortaleza",-3.7275,-38.5275,"BR"],["Santa Cruz de la Sierra",-17.7892,-63.1975,"BO"],["La Paz",-16.4958,-68.1333,"BO"],["Guayaquil",-2.19,-79.8875,"EC"],["Medellín",6.2308,-75.5906,"CO"],["Salvador",-12.9747,-38.4767,"BR"],["Caracas",10.4806,-66.9036,"VE"],["Córdoba",-31.4167,-64.1833,"AR"],["Santos",-23.9369,-46.325,"BR"],["Curitiba",-25.4297,-49.2711,"BR"],["Maracaibo",10.6333,-71.6333,"VE"],["Recife",-8.05,-34.9,"BR"],["Porto Alegre",-30.0331,-51.23,"BR"]]],wn=[0,0,5,26,28,26,9,6],Sl=wn.reduce((t,e)=>t+e,0),bl=wn.reduce((t,e)=>{const r=t[t.length-1]??0;return t.push(r+e),t},[]),El=Array.from(an(bl,yl,(t,e)=>[t,e]));function Cl(t){const e=t.nextRange(0,Sl),r=il(El,([u])=>u<=e),[,o]=wl(r),n=t.nextRange(0,o.length);return o[n]}function xl(t){const e=t.nextRange(0,un.length);return un[e]}function Nl(t){const e=t.nextRange(0,hn.length);return hn[e]}function kl(t){const e=t.nextRange(0,ln.length);return ln[e]}function Ol(t){const e=t.nextRange(0,dn.length);return dn[e]}function Bl(t){const[e,r]=xl(t),[,o,n,d]=Cl(t),u=Nl(t),w=kl(t),m=Ol(t);return{pubkey:new F("PUBKEY",t.fillBytes(32)),stateVerKey:new F("STATE_VER_KEY",t.fillBytes(32)),stake:t.nextRangeBigInt(0n,1000n)*1000000000000000000n,commission:t.nextRange(0,5e3),name:`${e} Node ${d} ${t.nextRange(0,100)}`,address:t.fillBytes(32),company:{name:e,website:r},location:{coords:[o,n],country:d},operatingSystem:u,networkType:m,nodeType:w}}function*Il(t=new Q(At())){const e=t.nextRange(100,350);for(let r=0;r<e;r++)yield Bl(new Q(r))}const Re=Array.from(Il());async function*Dl(){}function Rl(){const t=new Uint8Array(new Array(20).map(()=>0)).buffer;return{hash:new F("BLOCK",t),height:0,time:new Date(0),genTime:0,transactions:Dl(),numTransactions:0,proposer:[],size:0,fees:[]}}async function*Al(t,e=sn()){let r=1,o=At();for(;o<e;){const n=Math.floor(t.nextFloat()*14*1e3);yield Jl(new Q(r+n),r,o,o+n),o+=n,r++}}async function*Ul(t=new Q(At()),e=sn()){yield Rl(),yield*Al(t,e)}function Jl(t,e,r,o){const n=Math.floor(t.nextRange(0,5)),d=t.nextRange(0,Re.length),u=Re[d];return{hash:new F("BLOCK",t.fillBytes(32)),height:e,genTime:o-r,time:new Date(o),numTransactions:n,transactions:Wl(new Q(e+r),e,r,o,n),proposer:[u.address],size:Math.floor(t.nextFloat()*1024*n)+8,fees:[T.ESP(BigInt(t.nextRange(0,1e9)*1e3))]}}const fn=Array.from(_i.keys());function Ll(t){return t.nextFloat()>.98?1:fn[t.nextRange(0,fn.length)]}async function*Wl(t,e,r,o,n){const d=(o-r)/n;for(let u=0,w=r;w<o;w+=d,u++){const m=Ll(t),h=Math.floor(1024*t.nextFloat());yield{block:e,index:u,size:h,hash:new F("COMMIT",t.fillBytes(32)),time:new Date(w),sender:new F("PUBKEY",t.fillBytes(32)),tree:{namespace:m,data:t.fillBytes(h)}}}}function Ut(t){if(t.startsWith("0x"))return Ut(t.substring(2));if((t.length&1)!==0)return Ut("0"+t);const e=new ArrayBuffer(t.length/2);return Ml(tn(t),e),e}function Ml(t,e){const r=new DataView(e);let o=0;for(;o<e.byteLength;){const n=t.next(),d=t.next();if(n.done||d.done)throw new So;const u=gn(n.value),w=gn(d.value),m=u<<4|w;r.setUint8(o,m),o++}}function gn(t){if(t>=48&&t<=57)return t-48;if(t>=97&&t<=102)return t-97+10;if(t>=65&&t<=70)return t-65+10;throw new bo(t)}function Pl(t){return t.toString(16).padStart(2,"0")}function*Tl(t){yield*cn(t,Pl)}function mn(t){return Tl(t[Symbol.iterator]())}class Fl{convert(e){if(typeof e!="string")throw new E(typeof e,"string");return Ut(e)}}class zl{convert(e){return`0x${Array.from(mn(new Uint8Array(e))).join("")}`}}class _l extends s{encoder=new zl;decoder=new Fl}const i=new _l;new L(new U(i),new J(i));const vn=new O(new N(i),new k(i));class jl{encoding;constructor(e){this.encoding=e}convert(e){if(typeof e!="string")throw new E(typeof e,"string");return this.encoding.decodeString(e)}}class Vl{encoding;constructor(e){this.encoding=e}convert(e){return this.encoding.encodeToString(e)}}class Ae extends s{encoder;decoder;constructor(e){super(),this.encoder=new Vl(e),this.decoder=new jl(e)}}new Ae(Rt),new Ae(el),new Ae(on);const Jt=new Ae(rn);new L(new U(Jt),new J(Jt));class pn{constructor(e,r,o){this.number=e,this.hash=r,this.parent=o,Object.freeze(this)}toJSON(){return ie.encode(this)}}class Hl{convert(e){return c(e,"number","hash","parent"),new pn(l.decode(e.number),i.decode(e.hash),i.decode(e.parent))}}class ql{convert(e){return{number:l.encode(e.number),hash:i.encode(e.hash),parent:i.encode(e.parent)}}}class $l extends s{encoder=new ql;decoder=new Hl}const ie=new $l,Kl=1000000000n,Gl=12n;class Ql{async getBlockForHeight(e){const r=new ArrayBuffer(32);new DataView(r).setBigUint64(24,BigInt(e),!1);const n=new ArrayBuffer(32);return new DataView(n).setBigUint64(24,e-1n,!1),new pn(BigInt(e),r,n)}async getLatestBlock(){const e=BigInt(Math.floor(al()/1e3)),o=(BigInt(Math.floor(Date.now()/1e3))-e)/Gl,n=Kl+o;return this.getBlockForHeight(n)}}async function Xl(t){let e;for(let r=await t.next();!r.done;r=await t.next())e=r.value;if(e===void 0)throw new Oe;return e}async function Zl(t){return Xl(t[Symbol.asyncIterator]())}new Promise(()=>{});class q{constructor(){}static floatingPoint(e){return new Ue(e)}static rational(e,r){return new le(e,r)}valueOf(){return this.ratio}toString(){return this.ratio.toString()}toJSON(){return he.encode(this)}}class Ue extends q{constructor(e){if(super(),this.ratio=e,e<0||e>1)throw new RangeError("Ratio must be between 0 and 1");Object.freeze(this)}oneMinus(){return new Ue(1-this.ratio)}}class le extends q{constructor(e,r){if(super(),this.numerator=e,this.denominator=r,e<BigInt(0)||e>r)throw new RangeError("Numerator must be between 0 and denominator inclusive");Object.freeze(this)}oneMinus(){return new le(this.denominator-this.numerator,this.denominator)}get ratio(){return Number(this.numerator)/Number(this.denominator)}}class Yl{convert(e){return v.encode(e.ratio)}}class eh{convert(e){return new Ue(v.decode(e))}}class th extends s{encoder=new Yl;decoder=new eh}const he=new th,Je=new L(new U(he),new J(he));class Lt{constructor(e,r,o){this.address=e,this.voterParticipation=r,this.leaderParticipation=o,this.addressText=i.encode(e),Object.freeze(this)}addressText;toJSON(){return Wt.encode(this)}}class rh{convert(e){return A(e,"address","voter_participation","leader_participation")?new Lt(i.decode(e.address),Je.decode(e.voter_participation),Je.decode(e.leader_participation)):(c(e,"address","eligible_votes","proposals","slots","votes"),new Lt(i.decode(e.address),q.rational(l.decode(e.votes),l.decode(e.eligible_votes)),q.rational(l.decode(e.proposals),l.decode(e.slots))))}}class oh{convert(e){return e.voterParticipation instanceof le&&e.leaderParticipation instanceof le?{address:i.encode(e.address),eligible_votes:l.encode(e.voterParticipation.denominator),proposals:l.encode(e.leaderParticipation.numerator),slots:l.encode(e.leaderParticipation.denominator),votes:l.encode(e.voterParticipation.numerator)}:{address:i.encode(e.address),voter_participation:Je.encode(e.voterParticipation),leader_participation:Je.encode(e.leaderParticipation)}}}class nh extends s{encoder=new oh;decoder=new rh}const Wt=new nh,yn=new O(new N(Wt),new k(Wt)),Sn=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648];function Le(t){for(let e=0;e<24;++e){const r=t[0]^t[10]^t[20]^t[30]^t[40],o=t[1]^t[11]^t[21]^t[31]^t[41],n=t[2]^t[12]^t[22]^t[32]^t[42],d=t[3]^t[13]^t[23]^t[33]^t[43],u=t[4]^t[14]^t[24]^t[34]^t[44],w=t[5]^t[15]^t[25]^t[35]^t[45],m=t[6]^t[16]^t[26]^t[36]^t[46],h=t[7]^t[17]^t[27]^t[37]^t[47],B=t[8]^t[18]^t[28]^t[38]^t[48],I=t[9]^t[19]^t[29]^t[39]^t[49];let g=B^(n<<1|d>>>31),f=I^(d<<1|n>>>31);const te=t[0]^g,D=t[1]^f,K=t[10]^g,ye=t[11]^f,ms=t[20]^g,vs=t[21]^f,ps=t[30]^g,ys=t[31]^f,Ss=t[40]^g,bs=t[41]^f;g=r^(u<<1|w>>>31),f=o^(w<<1|u>>>31);const Es=t[2]^g,Cs=t[3]^f,xs=t[12]^g,Ns=t[13]^f,ks=t[22]^g,Os=t[23]^f,Bs=t[32]^g,Is=t[33]^f,Ds=t[42]^g,Rs=t[43]^f;g=n^(m<<1|h>>>31),f=d^(h<<1|m>>>31);const As=t[4]^g,Us=t[5]^f,Js=t[14]^g,Ls=t[15]^f,Ws=t[24]^g,Ms=t[25]^f,Ps=t[34]^g,Ts=t[35]^f,Fs=t[44]^g,zs=t[45]^f;g=u^(B<<1|I>>>31),f=w^(I<<1|B>>>31);const _s=t[6]^g,js=t[7]^f,Vs=t[16]^g,Hs=t[17]^f,qs=t[26]^g,$s=t[27]^f,Ks=t[36]^g,Gs=t[37]^f,Qs=t[46]^g,Xs=t[47]^f;g=m^(r<<1|o>>>31),f=h^(o<<1|r>>>31);const Zs=t[8]^g,Ys=t[9]^f,ec=t[18]^g,tc=t[19]^f,rc=t[28]^g,oc=t[29]^f,nc=t[38]^g,sc=t[39]^f,cc=t[48]^g,ac=t[49]^f,dr=te,ir=D,lr=ye<<4|K>>>28,hr=K<<4|ye>>>28,ur=ms<<3|vs>>>29,wr=vs<<3|ms>>>29,fr=ys<<9|ps>>>23,gr=ps<<9|ys>>>23,mr=Ss<<18|bs>>>14,vr=bs<<18|Ss>>>14,pr=Es<<1|Cs>>>31,yr=Cs<<1|Es>>>31,Sr=Ns<<12|xs>>>20,br=xs<<12|Ns>>>20,Er=ks<<10|Os>>>22,Cr=Os<<10|ks>>>22,xr=Is<<13|Bs>>>19,Nr=Bs<<13|Is>>>19,kr=Ds<<2|Rs>>>30,Or=Rs<<2|Ds>>>30,Br=Us<<30|As>>>2,Ir=As<<30|Us>>>2,Dr=Js<<6|Ls>>>26,Rr=Ls<<6|Js>>>26,Ar=Ms<<11|Ws>>>21,Ur=Ws<<11|Ms>>>21,Jr=Ps<<15|Ts>>>17,Lr=Ts<<15|Ps>>>17,Wr=zs<<29|Fs>>>3,Mr=Fs<<29|zs>>>3,Pr=_s<<28|js>>>4,Tr=js<<28|_s>>>4,Fr=Hs<<23|Vs>>>9,zr=Vs<<23|Hs>>>9,_r=qs<<25|$s>>>7,jr=$s<<25|qs>>>7,Vr=Ks<<21|Gs>>>11,Hr=Gs<<21|Ks>>>11,qr=Xs<<24|Qs>>>8,$r=Qs<<24|Xs>>>8,Kr=Zs<<27|Ys>>>5,Gr=Ys<<27|Zs>>>5,Qr=ec<<20|tc>>>12,Xr=tc<<20|ec>>>12,Zr=oc<<7|rc>>>25,Yr=rc<<7|oc>>>25,eo=nc<<8|sc>>>24,to=sc<<8|nc>>>24,ro=cc<<14|ac>>>18,oo=ac<<14|cc>>>18;t[0]=dr^~Sr&Ar,t[1]=ir^~br&Ur,t[10]=Pr^~Qr&ur,t[11]=Tr^~Xr&wr,t[20]=pr^~Dr&_r,t[21]=yr^~Rr&jr,t[30]=Kr^~lr&Er,t[31]=Gr^~hr&Cr,t[40]=Br^~Fr&Zr,t[41]=Ir^~zr&Yr,t[2]=Sr^~Ar&Vr,t[3]=br^~Ur&Hr,t[12]=Qr^~ur&xr,t[13]=Xr^~wr&Nr,t[22]=Dr^~_r&eo,t[23]=Rr^~jr&to,t[32]=lr^~Er&Jr,t[33]=hr^~Cr&Lr,t[42]=Fr^~Zr&fr,t[43]=zr^~Yr&gr,t[4]=Ar^~Vr&ro,t[5]=Ur^~Hr&oo,t[14]=ur^~xr&Wr,t[15]=wr^~Nr&Mr,t[24]=_r^~eo&mr,t[25]=jr^~to&vr,t[34]=Er^~Jr&qr,t[35]=Cr^~Lr&$r,t[44]=Zr^~fr&kr,t[45]=Yr^~gr&Or,t[6]=Vr^~ro&dr,t[7]=Hr^~oo&ir,t[16]=xr^~Wr&Pr,t[17]=Nr^~Mr&Tr,t[26]=eo^~mr&pr,t[27]=to^~vr&yr,t[36]=Jr^~qr&Kr,t[37]=Lr^~$r&Gr,t[46]=fr^~kr&Br,t[47]=gr^~Or&Ir,t[8]=ro^~dr&Sr,t[9]=oo^~ir&br,t[18]=Wr^~Pr&Qr,t[19]=Mr^~Tr&Xr,t[28]=mr^~pr&Dr,t[29]=vr^~yr&Rr,t[38]=qr^~Kr&lr,t[39]=$r^~Gr&hr,t[48]=kr^~Br&Fr,t[49]=Or^~Ir&zr,t[0]^=Sn[e*2],t[1]^=Sn[e*2+1]}}class sh{state=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];blockSize=0;count=0;squeezing=!1;initialize(e,r){for(let o=0;o<50;++o)this.state[o]=0;this.blockSize=e/8,this.count=0,this.squeezing=!1}absorb(e){for(let r=0;r<e.length;++r)this.state[~~(this.count/4)]^=e[r]<<8*(this.count%4),this.count+=1,this.count===this.blockSize&&(Le(this.state),this.count=0)}absorbLastFewBits(e){this.state[~~(this.count/4)]^=e<<8*(this.count%4),(e&128)!==0&&this.count===this.blockSize-1&&Le(this.state),this.state[~~((this.blockSize-1)/4)]^=128<<8*((this.blockSize-1)%4),Le(this.state),this.count=0,this.squeezing=!0}squeeze(e){this.squeezing||this.absorbLastFewBits(1);const r=new Uint8Array(e);for(let o=0;o<e;++o)r[o]=this.state[~~(this.count/4)]>>>8*(this.count%4)&255,this.count+=1,this.count===this.blockSize&&(Le(this.state),this.count=0);return r}copy(e){for(let r=0;r<50;++r)e.state[r]=this.state[r];e.blockSize=this.blockSize,e.count=this.count,e.squeezing=this.squeezing}}class H{_rate;_capacity;_delimitedSuffix;_hashBitLength;_state;_finalized;constructor(e,r,o,n){this._rate=e,this._capacity=r,this._delimitedSuffix=o,this._hashBitLength=n,this._state=new sh,this._state.initialize(e,r),this._finalized=!1}update(e){if(this._finalized)throw new Error("Digest already called");return this._state.absorb(new Uint8Array(e)),this}digest(){if(this._finalized)throw new Error("Digest already called");this._finalized=!0,this._delimitedSuffix&&this._state.absorbLastFewBits(this._delimitedSuffix);const e=this._state.squeeze(this._hashBitLength/8);return this._resetState(),Dt.encode(e)}_resetState(){return this._state.initialize(this._rate,this._capacity),this}}function ch(t){switch(t.toLowerCase()){case"keccak224":return new H(1152,448,null,224);case"keccak256":return new H(1088,512,null,256);case"keccak384":return new H(832,768,null,384);case"keccak512":return new H(576,1024,null,512);case"sha3-224":return new H(1152,448,6,224);case"sha3-256":return new H(1088,512,6,256);case"sha3-384":return new H(832,768,6,384);case"sha3-512":return new H(576,1024,6,512);default:throw new Error("invalid algorithm: "+t)}}const ah=48,dh=57,ih=97,lh=102;class hh{convert(e){if(C(e,ArrayBuffer),e.byteLength!==20)throw new E(typeof e,"20-byte ArrayBuffer");const o=[...gl(mn(new Uint8Array(e)),m=>m.split(""))],n=ch("keccak256"),d=new TextEncoder;n.update(Dt.encode(d.encode(o.join(""))));const u=new Uint8Array(n.digest());return["0x",...De(an(vl(e.byteLength*2),o,(m,h)=>[m,h]),([m,h])=>{const B=h.charCodeAt(0);if(B>=ah&&B<=dh)return h;if(B>=ih&&B<=lh){const I=Math.floor(m/2),g=m&1,f=u[I];return(g===0?f>>4:f&15)>7?h.toUpperCase():h}throw new P})].join("")}}const uh=new hh;class wh{keyCodec;valueCodec;constructor(e,r){this.keyCodec=e,this.valueCodec=r}convert(e){if(typeof e!="object"||e===null)throw new Error(`invalid map value: expected an object, got ${typeof e}`);const r=new Map;for(const[o,n]of Object.entries(e)){const d=this.keyCodec.decode(o),u=this.valueCodec.decode(n);r.set(d,u)}return r}}class fh{keyCodec;valueCodec;constructor(e,r){this.keyCodec=e,this.valueCodec=r}convert(e){C(e,Map);const r={};for(const[o,n]of e.entries()){const d=this.keyCodec.encode(o),u=this.valueCodec.encode(n);r[d]=u}return r}}class Mt extends s{encoder;decoder;constructor(e,r){super(),this.encoder=r,this.decoder=e}static keyStringCodec(e){return new Mt(new wh(a,e),new fh(a,e))}}class gh{convert(e){if(!Se(e))throw new E(typeof e,"string");return new URL(e)}}class mh{convert(e){return e.toString()}}class vh extends s{encoder=new mh;decoder=new gh}const bn=new vh;new L(new U(bn),new J(bn));class Pt{constructor(e,r,o){this.epoch=e,this.block=r,this.timestamp=o,Object.freeze(this)}static determineEpoch(e,r){return r===0n?(G(),0n):e/r+1n}get blocksPerEpoch(){if(this.epoch===0n)return G(),0n;const e=this.block/(this.epoch-1n);return x(this.epoch===this.block/e+1n,"Inconsistent epoch and block numbers"),e}toJSON(){return ue.encode(this)}}class ph{convert(e){return c(e,"epoch","block","timestamp"),new Pt(l.decode(e.epoch),l.decode(e.block),new Date(v.decode(e.timestamp)))}}class yh{convert(e){return{epoch:l.encode(e.epoch),block:l.encode(e.block),timestamp:v.encode(e.timestamp.getTime())}}}class Sh extends s{encoder=new yh;decoder=new ph}const ue=new Sh;class En{constructor(e,r){this.espressoBlock=e,this.nodes=r,Object.freeze(this)}toJSON(){return we.encode(this)}}class bh{convert(e){return c(e,"espresso_block","nodes"),new En(ue.decode(e.espresso_block),yn.decode(e.nodes))}}class Eh{convert(e){return{espresso_block:ue.encode(e.espressoBlock),nodes:yn.encode(e.nodes)}}}class Ch extends s{encoder=new Eh;decoder=new bh}const we=new Ch;class Cn{width;index;constructor(e,r){this.width=e,this.index=r}toJSON(){return Tt.encode(this)}}class xh{convert(e){return c(e,"width","index"),new Cn(v.decode(e.width),v.decode(e.index))}}class Nh{convert(e){return C(e,Cn),{width:v.encode(e.width),index:v.encode(e.index)}}}class kh extends s{encoder=new Nh;decoder=new xh}const Tt=new kh;class fe{static get lsb0(){return Bh}static get msb0(){return Dh}valueOf(){return this.toString()}toJSON(){return this.toString()}}const xn="bitvec::order::Lsb0",Nn="bitvec::order::Msb0";class Oh extends fe{toString(){return xn}}const Bh=new Oh;class Ih extends fe{toString(){return Nn}}const Dh=new Ih;class Rh{convert(e){if(typeof e!="string")throw new E(typeof e,"string");switch(e){case xn:return fe.lsb0;case Nn:return fe.msb0;default:throw new E(e,"CappuccinoAPIBitVecOrder")}}}class Ah{convert(e){return e.toString()}}class Uh extends s{encoder=new Ah;decoder=new Rh}const kn=new Uh;class On{order;head;bits;data;constructor(e,r,o,n){this.order=e,this.head=r,this.bits=o,this.data=n}getBitVecIndexIterable(){return this.order===fe.lsb0?new Th(this.head.width,this.bits):new zh(this.head.width,this.bits)}[Symbol.iterator](){const e=this.getBitVecIndexIterable();return De(e,r=>Mh(this.data,r))[Symbol.iterator]()}toJSON(){return ge.encode(this)}}class Jh{convert(e){return c(e,"order","head","bits","data"),new On(kn.decode(e.order),Tt.decode(e.head),v.decode(e.bits),Ho.decode(e.data))}}class Lh{convert(e){return C(e,On),{order:kn.encode(e.order),head:Tt.encode(e.head),bits:v.encode(e.bits),data:Ho.encode(e.data)}}}class Wh extends s{encoder=new Lh;decoder=new Jh}const ge=new Wh;new O(new N(ge),new k(ge));function Mh(t,e){return(t[e.bucket]>>e.bitOffset&1n)===1n}class Bn{constructor(e,r){this.bucket=e,this.bitOffset=r}}function In(t){switch(x(t===8||t===16||t===32||t===64,"bit width should be a power of two that is supported"),t){case 8:return 3;case 16:return 4;case 32:return 5;case 64:return 6;default:throw new P}}class Ph{totalBits;bitWidthMask;bitWidthShift;offset=0n;constructor(e,r){this.totalBits=r;const o=BigInt(In(e));this.bitWidthMask=BigInt(e)-1n,this.bitWidthShift=o}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,r=this.offset&this.bitWidthMask;return this.offset+=1n,{done:!1,value:new Bn(Number(e),r)}}}class Th{bitWidth;totalBits;constructor(e,r){this.bitWidth=e,this.totalBits=r}[Symbol.iterator](){return new Ph(this.bitWidth,this.totalBits)}}class Fh{bitWidth;totalBits;bitWidthMask;bitWidthShift;offset=0n;constructor(e,r){this.bitWidth=BigInt(e),this.totalBits=BigInt(r);const o=BigInt(In(e));this.bitWidthMask=BigInt(e)-1n,this.bitWidthShift=o}next(){if(this.offset>=this.totalBits)return{done:!0,value:void 0};const e=this.offset>>this.bitWidthShift,r=this.bitWidth-1n-(this.offset&this.bitWidthMask);return this.offset+=1n,{done:!1,value:new Bn(Number(e),r)}}}class zh{bitWidth;totalBits;constructor(e,r){this.bitWidth=e,this.totalBits=r}[Symbol.iterator](){return new Fh(this.bitWidth,this.totalBits)}}class Dn{}class Rn extends Dn{constructor(e,r,o){super(),this.leaderIndex=e,this.failedLeaders=r,this.votersBitVec=o,Object.freeze(this)}toJSON(){return Ft.encode(this)}}class _h{convert(e){return c(e,"leader","failed_leaders","voters"),new Rn(v.decode(e.leader),po.decode(e.failed_leaders),ge.decode(e.voters))}}class jh{convert(e){return{leader:v.encode(e.leaderIndex),failed_leaders:po.encode(e.failedLeaders),voters:ge.encode(e.votersBitVec)}}}class Vh extends s{encoder=new jh;decoder=new _h}const We="NewBlock",Ft=new Vh;class An extends Dn{constructor(e){super(),this.entries=e,Object.freeze(this)}toJSON(){return zt.encode(this)}}class Hh{convert(e){return new An(vn.decode(e))}}class qh{convert(e){return vn.encode(e.entries)}}class $h extends s{encoder=new qh;decoder=new Hh}const Me="NewEpoch",zt=new $h;class Kh{convert(e){if(c(e),A(e,Me))return zt.decode(e[Me]);if(A(e,We))return Ft.decode(e[We]);const r=Object.keys(e);if(r.length<=0)throw new E("Empty EspressoMessage object","object");const[o]=r;throw new E(o,`${Me} | ${We}`)}}class Gh{convert(e){if(e instanceof An)return{[Me]:zt.encode(e)};if(e instanceof Rn)return{[We]:Ft.encode(e)};throw new E("Unrecognized EspressoMessage type","Valid EspressoMessage Type")}}class Qh extends s{encoder=new Gh;decoder=new Kh}const Un=new Qh,Jn=new O(new N(Un),new k(Un));class Ln{constructor(e,r){this.espressoBlock=e,this.diff=r,Object.freeze(this)}toJSON(){return _t.encode(this)}}class Xh{convert(e){return c(e,"espresso_block","diff"),new Ln(ue.decode(e.espresso_block),Jn.decode(e.diff))}}class Zh{convert(e){return{espresso_block:ue.encode(e.espressoBlock),diff:Jn.encode(e.diff)}}}class Yh extends s{encoder=new Zh;decoder=new Xh}const _t=new Yh;class eu{async active(){const e=await Zl(Ul()),r=Re.slice().sort((n,d)=>Number(d.stake-n.stake)).slice(0,100),o=new Q(e.genTime);return new En(new Pt(Pt.determineEpoch(BigInt(e.height),100n),BigInt(e.height),new Date(e.time)),Array.from(De(r,n=>new Lt(n.address,q.floatingPoint(o.nextFloat()),q.floatingPoint(o.nextFloat())))))}async activeFor(){return this.active()}async updatesSince(){const e=await this.active();return new Ln(e.espressoBlock,[])}}class Pe{constructor(e,r,o){this.number=e,this.hash=r,this.timestamp=o,Object.freeze(this)}toJSON(){return _.encode(this)}}class tu{convert(e){return c(e,"number","hash","timestamp"),new Pe(l.decode(e.number),i.decode(e.hash),new Date(v.decode(e.timestamp)))}}class ru{convert(e){return{number:l.encode(e.number),hash:i.encode(e.hash),timestamp:v.encode(e.timestamp.valueOf())}}}class ou extends s{encoder=new ru;decoder=new tu}const _=new ou,jt=1e4,Wn=0,nu="PercentageOutOfRange";class su extends y{value;constructor(e,r=`the commission percentage is outside of the range [${Wn}, ${jt}], have ${e}`){super(r),this.value=e,Object.freeze(this)}get code(){return nu}}class Mn{value;constructor(e){if(e<Wn||e>jt)throw new su(e);this.value=e}toString(){return`${this.value/100}%`}toJSON(){return this.value}valueOf(){return this.value/jt}}class cu{convert(e){if(typeof e!="number")throw new E(typeof e,"number");return new Mn(e)}}class au{convert(e){if(!(e instanceof Mn))throw new E(e,"CommissionPercent");return Math.floor(e.value)}}class du extends s{encoder=new au;decoder=new cu}const Pn=new du;class Tn{stakeKey;stakeAmount;constructor(e,r){this.stakeKey=e,this.stakeAmount=r}}class iu{convert(e){return c(e,"stake_key","stake_amount"),new Tn(W.decode(e.stake_key),l.decode(e.stake_amount))}}class lu{convert(e){return C(e,Tn),{stake_key:W.encode(e.stakeKey),stake_amount:l.encode(e.stakeAmount)}}}class hu extends s{encoder=new lu;decoder=new iu}const X=new hu;new L(new U(X),new J(X)),new O(new N(X),new k(X));class Fn{stakeTableEntry;stateVerKey;constructor(e,r){this.stakeTableEntry=e,this.stateVerKey=r}}class uu{convert(e){return c(e,"stake_table_entry","state_ver_key"),new Fn(X.decode(e.stake_table_entry),W.decode(e.state_ver_key))}}class wu{convert(e){return C(e,Fn),{stake_table_entry:X.encode(e.stakeTableEntry),state_ver_key:W.encode(e.stateVerKey)}}}class fu extends s{encoder=new wu;decoder=new uu}const Te=new fu;new L(new U(Te),new J(Te)),new O(new N(Te),new k(Te));class gu{address;constructor(e){this.address=e,Object.freeze(this)}toJSON(){return Z.encode(this)}toString(){return Z.encode(this)}}class mu{convert(e){return e.address.byteLength!==20?i.encode(e.address):uh.convert(e.address)}}class vu{convert(e){return new gu(i.decode(e))}}class pu extends s{encoder=new mu;decoder=new vu}const Z=new pu;new L(new U(Z),new J(Z));const zn=Mt.keyStringCodec(l);class _n{account;stakeTableKey;stateVerKey;stake;commission;delegators;constructor(e,r,o,n,d,u){this.account=e,this.stakeTableKey=r,this.stateVerKey=o,this.stake=n,this.commission=d,this.delegators=u}}class yu{convert(e){return c(e,"account","stake_table_key","state_ver_key","stake","commission","delegators"),new _n(Z.decode(e.account),W.decode(e.stake_table_key),W.decode(e.state_ver_key),l.decode(e.stake),Pn.decode(e.commission),zn.decode(e.delegators))}}class Su{convert(e){return C(e,_n),{account:Z.encode(e.account),stake_table_key:W.encode(e.stakeTableKey),state_ver_key:W.encode(e.stateVerKey),stake:l.encode(e.stake),commission:Pn.encode(e.commission),delegators:zn.encode(e.delegators)}}}class bu extends s{encoder=new Su;decoder=new yu}const Fe=new bu;new L(new U(Fe),new J(Fe)),new O(new N(Fe),new k(Fe));class jn{constructor(e,r,o,n){this.address=e,this.stakingKey=r,this.stake=o,this.commission=n,this.addressText=i.encode(e),Object.freeze(this)}addressText;toJSON(){return me.encode(this)}}class Eu{convert(e){return c(e,"address","staking_key","stake","commission"),new jn(i.decode(e.address),W.decode(e.staking_key),l.decode(e.stake),he.decode(e.commission))}}class Cu{convert(e){return{address:i.encode(e.address),staking_key:W.encode(e.stakingKey),stake:l.encode(e.stake),commission:he.encode(e.commission)}}}class xu extends s{encoder=new Cu;decoder=new Eu}const me=new xu,Vn=new O(new N(me),new k(me));class Hn{constructor(e,r=[]){this.l1Block=e,this.nodes=r,Object.freeze(this)}toJSON(){return Vt.encode(this)}}class Nu{convert(e){return c(e,"l1_block","nodes"),new Hn(_.decode(e.l1_block),Vn.decode(e.nodes))}}class ku{convert(e){return{l1_block:_.encode(e.l1Block),nodes:Vn.encode(e.nodes)}}}class Ou extends s{encoder=new ku;decoder=new Nu}const Vt=new Ou;class Bu{constructor(e,r){this.address=e,this.exitTime=r,Object.freeze(this)}toJSON(){return Ht.encode(this)}}class Iu{convert(e){return c(e,"address","exit_time"),new Bu(i.decode(e.address),new Date(e.exit_time))}}class Du{convert(e){return{address:i.encode(e.address),exit_time:e.exitTime.toISOString()}}}class Ru extends s{encoder=new Du;decoder=new Iu}const Ht=new Ru;class qn{}class $n extends qn{constructor(e){super(),this.validatorExit=e,Object.freeze(this)}toJSON(){return $t.encode(this)}}class Au{convert(e){return c(e,"validator_exit"),new $n(Ht.decode(e.validator_exit))}}class Uu{convert(e){return{validator_exit:Ht.encode(e.validatorExit)}}}class Ju extends s{encoder=new Uu;decoder=new Au}const qt="NodeExit",$t=new Ju;class Kn extends qn{constructor(e){super(),this.validatorInformation=e,Object.freeze(this)}toJSON(){return Gt.encode(this)}}class Lu{convert(e){return new Kn(me.decode(e))}}class Wu{convert(e){return me.encode(e.validatorInformation)}}class Mu extends s{encoder=new Wu;decoder=new Lu}const Kt="NodeUpdate",Gt=new Mu;class Pu{convert(e){if(c(e),A(e,Kt))return Gt.decode(e[Kt]);if(A(e,qt))return $t.decode(e[qt]);throw Object.keys(e).length<=0?new E("Empty L1Message object","object"):new E("Unrecognized L1Message type","Valid L1 Type")}}class Tu{convert(e){if(e instanceof Kn)return{[Kt]:Gt.encode(e)};if(e instanceof $n)return{[qt]:$t.encode(e)};throw new E("Unrecognized L1Message type","Valid L1 Type")}}class Fu extends s{encoder=new Tu;decoder=new Pu}const Gn=new Fu,Qn=new O(new N(Gn),new k(Gn));class Xn{constructor(e,r=[]){this.l1Block=e,this.diff=r,Object.freeze(this)}toJSON(){return Qt.encode(this)}}class zu{convert(e){return c(e,"l1_block","diff"),new Xn(_.decode(e.l1_block),Qn.decode(e.diff))}}class _u{convert(e){return{l1_block:_.encode(e.l1Block),diff:Qn.encode(e.diff)}}}class ju extends s{encoder=new _u;decoder=new zu}const Qt=new ju;class Vu{async snapshot(){return new Hn(new Pe(BigInt(1),new ArrayBuffer(32),new Date),Array.from(De(Re,e=>new jn(e.address,e.stateVerKey,e.stake,q.floatingPoint(e.commission/1e4)))))}async updatesSince(){const e=await this.snapshot();return new Xn(e.l1Block,[])}}class Hu{constructor(e,r,o){this.delegator=e,this.node=r,this.amount=o,this.delegatorText=i.encode(e),this.nodeText=i.encode(r),Object.freeze(this)}delegatorText;nodeText;toJSON(){return ve.encode(this)}}class qu{convert(e){return{delegator:i.encode(e.delegator),node:i.encode(e.node),amount:l.encode(e.amount)}}}class $u{convert(e){return c(e,"delegator","node","amount"),new Hu(i.decode(e.delegator),i.decode(e.node),l.decode(e.amount))}}class Ku extends s{encoder=new qu;decoder=new $u}const ve=new Ku,Zn=new O(new N(ve),new k(ve));class Gu{constructor(e,r,o,n){this.delegator=e,this.node=r,this.amount=o,this.availableTime=n,this.nodeText=i.encode(r),Object.freeze(this)}nodeText;toJSON(){return $.encode(this)}}class Qu{convert(e){return{delegator:i.encode(e.delegator),node:i.encode(e.node),amount:l.encode(e.amount),available_time:v.encode(e.availableTime.valueOf()/1e3)}}}class Xu{convert(e){return c(e,"delegator","node","amount","available_time"),new Gu(i.decode(e.delegator),i.decode(e.node),l.decode(e.amount),new Date(v.decode(e.available_time)*1e3))}}class Zu extends s{encoder=new Qu;decoder=new Xu}const $=new Zu,ze=new O(new N($),new k($));class Yn{constructor(e,r,o,n,d){this.nodes=e,this.pendingUndelegations=r,this.pendingExits=o,this.claimedRewards=n,this.l1Block=d,Object.freeze(this)}toJSON(){return Xt.encode(this)}}class Yu{convert(e){return c(e,"nodes","pending_undelegations","pending_exits","claimed_rewards","l1_block"),new Yn(Zn.decode(e.nodes),ze.decode(e.pending_undelegations),ze.decode(e.pending_exits),l.decode(e.claimed_rewards),_.decode(e.l1_block))}}class ew{convert(e){return{nodes:Zn.encode(e.nodes),pending_undelegations:ze.encode(e.pendingUndelegations),pending_exits:ze.encode(e.pendingExits),claimed_rewards:l.encode(e.claimedRewards),l1_block:_.encode(e.l1Block)}}}class tw extends s{encoder=new ew;decoder=new Yu}const Xt=new tw;class Y{}class es extends Y{constructor(e){super(),this.claimedRewards=e,Object.freeze(this)}toJSON(){return Zt.encode(this)}}class rw{convert(e){return new es(l.decode(e))}}class ow{convert(e){return l.encode(e.claimedRewards)}}class nw extends s{encoder=new ow;decoder=new rw}const _e="ClaimedRewards",Zt=new nw;class ts extends Y{constructor(e){super(),this.delegation=e,Object.freeze(this)}toJSON(){return Yt.encode(this)}}class sw{convert(e){return new ts(ve.decode(e))}}class cw{convert(e){return ve.encode(e.delegation)}}class aw extends s{encoder=new cw;decoder=new sw}const je="DelegatedToNode",Yt=new aw;class dw{constructor(e,r,o){this.delegator=e,this.node=r,this.amount=o,Object.freeze(this)}toJSON(){return pe.encode(this)}}class iw{convert(e){return{delegator:i.encode(e.delegator),node:i.encode(e.node),amount:l.encode(e.amount)}}}class lw{convert(e){return c(e,"delegator","node","amount"),new dw(i.decode(e.delegator),i.decode(e.node),l.decode(e.amount))}}class hw extends s{encoder=new iw;decoder=new lw}const pe=new hw;class rs extends Y{constructor(e){super(),this.withdrawal=e,Object.freeze(this)}toJSON(){return er.encode(this)}}class uw{convert(e){return new rs(pe.decode(e))}}class ww{convert(e){return pe.encode(e.withdrawal)}}class fw extends s{encoder=new ww;decoder=new uw}const Ve="NodeExitWithdrawal",er=new fw;class os extends Y{constructor(e){super(),this.pendingWithdrawal=e,Object.freeze(this)}toJSON(){return tr.encode(this)}}class gw{convert(e){return new os($.decode(e))}}class mw{convert(e){return $.encode(e.pendingWithdrawal)}}class vw extends s{encoder=new mw;decoder=new gw}const He="NodeExited",tr=new vw;class ns extends Y{constructor(e){super(),this.pendingWithdrawal=e,Object.freeze(this)}toJSON(){return rr.encode(this)}}class pw{convert(e){return new ns($.decode(e))}}class yw{convert(e){return $.encode(e.pendingWithdrawal)}}class Sw extends s{encoder=new yw;decoder=new pw}const qe="UndelegatedFromNode",rr=new Sw;class ss extends Y{constructor(e){super(),this.withdrawal=e,Object.freeze(this)}toJSON(){return or.encode(this)}}class bw{convert(e){return new ss(pe.decode(e))}}class Ew{convert(e){return pe.encode(e.withdrawal)}}class Cw extends s{encoder=new Ew;decoder=new bw}const $e="UndelegationWithdrawal",or=new Cw;class xw{convert(e){if(c(e),A(e,_e))return Zt.decode(e[_e]);if(A(e,je))return Yt.decode(e[je]);if(A(e,Ve))return er.decode(e[Ve]);if(A(e,He))return tr.decode(e[He]);if(A(e,qe))return rr.decode(e[qe]);if(A(e,$e))return or.decode(e[$e]);const r=Object.keys(e);if(r.length<=0)throw new E("Empty WalletDiff object","object");const[o]=r;throw new E(o,`${_e} | ${je} | ${Ve} | ${He} | ${qe} | ${$e}`)}}class Nw{convert(e){if(e instanceof es)return{[_e]:Zt.encode(e)};if(e instanceof ts)return{[je]:Yt.encode(e)};if(e instanceof rs)return{[Ve]:er.encode(e)};if(e instanceof os)return{[He]:tr.encode(e)};if(e instanceof ns)return{[qe]:rr.encode(e)};if(e instanceof ss)return{[$e]:or.encode(e)};throw new E("Unrecognized EspressoMessage type","Valid EspressoMessage Type")}}class kw extends s{encoder=new Nw;decoder=new xw}const cs=new kw,as=new O(new N(cs),new k(cs));class ds{constructor(e,r){this.l1Block=e,this.diff=r,Object.freeze(this)}toJSON(){return nr.encode(this)}}class Ow{convert(e){return c(e,"l1_block","diff"),new ds(_.decode(e.l1_block),as.decode(e.diff))}}class Bw{convert(e){return{l1_block:_.encode(e.l1Block),diff:as.encode(e.diff)}}}class Iw extends s{encoder=new Bw;decoder=new Ow}const nr=new Iw;class Dw{async snapshot(){return new Yn([],[],[],0n,new Pe(0n,new ArrayBuffer(0),new Date(0)))}async updates(){return new ds(new Pe(0n,new ArrayBuffer(0),new Date(0)),[])}}class Rw{l1Block=new Ql;validatorsAll=new Vu;validatorsActive=new eu;wallet=new Dw;async setURL(){throw new P}}function j(t,e){return async r=>(await Aw(r,e),sr(r),t.convert(await r.json()))}async function Aw(t,e){if(!t.ok){if(t.status>=500&&t.status<600){try{sr(t)}catch(r){if(r instanceof y)throw r;console.error("encountered an error attempting to decode a server error from the server",r)}throw new fo(t.status,t)}if(t.status>=400&&t.status<500){try{sr(t)}catch(r){if(r instanceof y)throw r;console.error("encountered an error attempting to decode a client error from the server",r)}throw new lo(t.status,t)}throw new uo(t.status,t)}}function sr(t){const e=t.headers.get("content-type");if(!e||!e.startsWith("application/json"))throw se.fromResponse(t,e||"undefined")}class Uw{fetcher;baseURL;constructor(e,r){this.fetcher=e,this.baseURL=r}async getBlockForHeight(e){const r=new URL(`./${e}`,this.baseURL);return this.fetcher(r).then(j(ie.decoder))}async getLatestBlock(){const e=new URL("latest",this.baseURL);return this.fetcher(e).then(j(ie.decoder))}}class Jw{fetcher;baseURL;constructor(e,r){this.fetcher=e,this.baseURL=r}async active(){return this.fetcher(this.baseURL).then(j(we.decoder))}async activeFor(e){const r=new URL(`active/${e}`,this.baseURL);return this.fetcher(r).then(j(we.decoder))}async updatesSince(e){const r=new URL(`active/updates/${e}`,this.baseURL);return this.fetcher(r).then(j(_t.decoder))}}class Lw{fetcher;baseURL;constructor(e,r){this.fetcher=e,this.baseURL=r}async snapshot(e){const r=i.encode(e),o=new URL(`./${r}`,this.baseURL);return this.fetcher(o).then(j(Vt.decoder))}async updatesSince(e){const r=new URL(`updates/${i.encode(e)}`,this.baseURL);return this.fetcher(r).then(j(Qt.decoder))}}class Ww{fetcher;baseURL;constructor(e,r){this.fetcher=e,this.baseURL=r}async snapshot(e,r){const o=new URL(`./${i.encode(e)}/${i.encode(r)}`,this.baseURL);return this.fetcher(o).then(j(Xt.decoder))}async updates(e,r){const o=new URL(`./${i.encode(e)}/updates/${i.encode(r)}`,this.baseURL);return this.fetcher(o).then(j(nr.decoder))}}class is{l1Block;validatorsAll;validatorsActive;wallet;constructor(e,r){this.l1Block=new Uw(e,new URL("l1/block/",r)),this.validatorsAll=new Lw(e,new URL("nodes/all/",r)),this.validatorsActive=new Jw(e,new URL("nodes/active",r)),this.wallet=new Ww(e,new URL("wallet/",r))}async setURL(){throw new P}}class Mw{service;constructor(e){this.service=e}async getBlockForHeight(e){return this.service.getBlockForHeight(e)}async getLatestBlock(){return this.service.getLatestBlock()}async handleRequest(e){switch(e.method){case"getBlockForHeight":return ie.encode(await this.getBlockForHeight(l.decode(e.param[0])));case"getLatestBlock":return ie.encode(await this.getLatestBlock());default:throw new P}}}class Pw{service;constructor(e){this.service=e}async active(){return this.service.active()}async activeFor(e){return this.service.activeFor(e)}async updatesSince(e){return this.service.updatesSince(e)}async handleRequest(e){switch(e.method){case"active":return we.encode(await this.active());case"activeFor":return we.encode(await this.activeFor(l.decode(e.param[0])));case"updatesSince":return _t.encode(await this.updatesSince(l.decode(e.param[0])))}}}class Tw{service;constructor(e){this.service=e}async snapshot(e){return this.service.snapshot(e)}async updatesSince(e){return this.service.updatesSince(e)}async handleRequest(e){switch(e.method){case"snapshot":{const r=i.decode(e.param[0]);return Vt.encode(await this.snapshot(r))}case"updatesSince":return Qt.encode(await this.updatesSince(Jt.decode(e.param[0])))}}}class Fw{constructor(e){this.service=e}async snapshot(e,r){return this.service.snapshot(e,r)}async updates(e,r){return this.service.updates(e,r)}async handleRequest(e){switch(e.method){case"snapshot":return Xt.encode(await this.snapshot(i.decode(e.param[0]),i.decode(e.param[1])));case"updates":return nr.encode(await this.updates(i.decode(e.param[0]),i.decode(e.param[1])))}}}class ls{l1Block;validatorsActive;validatorsAll;wallet;constructor(e){this.l1Block=new Mw(e.l1Block),this.validatorsActive=new Pw(e.validatorsActive),this.validatorsAll=new Tw(e.validatorsAll),this.wallet=new Fw(e.wallet)}async handleRequest(e){switch(e.api){case"l1Block":return this.l1Block.handleRequest(e);case"validatorsActive":return this.validatorsActive.handleRequest(e);case"validatorsAll":return this.validatorsAll.handleRequest(e);case"wallet":return this.wallet.handleRequest(e);default:throw new P}}}const ee=v;class hs{requestID;api;method;param;constructor(e,r,o,n){this.requestID=e,this.api=r,this.method=o,this.param=n}toJSON(){return{requestID:this.requestID,api:this.api,method:this.method,param:this.param}}}class zw{convert(e){return c(e,"requestID","api","method","param"),new hs(ee.decode(e.requestID),a.decode(e.api),a.decode(e.method),e.param)}}class _w{convert(e){return C(e,hs),{requestID:ee.encode(e.requestID),api:a.encode(e.api),method:a.encode(e.method),param:e.param}}}class jw extends s{encoder=new _w;decoder=new zw}const Vw=new jw;class us{requestID;constructor(e){this.requestID=e}}class cr extends us{response;constructor(e,r){super(e),this.response=r}toJSON(){return ws.encode(this)}}class Hw{convert(e){return c(e,"requestID","response"),new cr(ee.decode(e.requestID),e.response)}}class qw{convert(e){return C(e,cr),{requestID:ee.encode(e.requestID),response:e.response}}}class $w extends s{encoder=new qw;decoder=new Hw}const ws=new $w;class ar extends us{error;constructor(e,r){super(e),this.error=r}toJSON(){return fs.encode(this)}}class Kw{convert(e){return c(e,"requestID","error"),new ar(ee.decode(e.requestID),Ee.decode(e.error))}}class Gw{convert(e){return C(e,ar),{requestID:ee.encode(e.requestID),error:Ee.encode(e.error)}}}class Qw extends s{encoder=new Gw;decoder=new Kw}const fs=new Qw,gs=async(t,e)=>{try{return await fetch(t,e)}catch(r){throw new go(r)}};async function Xw(){try{const e=await(await fetch("/config.json")).json();if(e.l1_validators_service_url){const r=new URL(e.l1_validators_service_url);return new is(gs,r)}}catch{}return new Rw}async function Zw(){return new ls(await Xw())}class Yw{service;postMessage;requestChannel;constructor(e){this.postMessage=e,this.service=Zw(),this.requestChannel=Jd(10),this.processRequests()}async handleProxyRequest(e){if(e.method==="set-url"){const r=e.param[0];if(!r||typeof r!="string")throw new P("Invalid URL provided");return this.service=Promise.resolve(new ls(new is(gs,new URL(r)))),!0}else throw new P(`Unknown proxy method: ${e.method}`)}async processRequests(){for await(const e of this.requestChannel)try{const r=await this.service;let o;e.api==="proxy"?o=await this.handleProxyRequest(e):o=await r.handleRequest(e),this.postMessage(ws.encode(new cr(e.requestID,o)))}catch(r){this.postMessage(fs.encode(new ar(e.requestID,r)))}}async handleEvent(e){const r=Vw.decode(e.data);await this.requestChannel.publish(r)}}self.addEventListener("message",new Yw(self.postMessage.bind(self)))})();
